class ChallengeCalendarSystem{constructor(){this.challenges=this.loadChallenges(),this.activeChallenge=this.loadActiveChallenge(),this.challengeHistory=this.loadChallengeHistory(),this.init()}init(){console.log("‚ö° Challenge Calendar System initialized"),this.checkDailyProgress()}loadChallenges(){return{"7-day-meditation":{id:"7-day-meditation",name:"7-Day Meditation Challenge",description:"Meditate for at least 10 minutes every day for 7 consecutive days",duration:7,type:"meditation",icon:"üßò",xpReward:500,milestones:[{day:3,reward:100,message:"Halfway there! Keep going!"},{day:5,reward:150,message:"Amazing progress!"},{day:7,reward:250,message:"Challenge complete! üéâ"}]},"30-day-gratitude":{id:"30-day-gratitude",name:"30-Day Gratitude Challenge",description:"Write 3 things you're grateful for every day for 30 days",duration:30,type:"gratitude",icon:"üôè",xpReward:2e3,milestones:[{day:7,reward:200,message:"One week of gratitude!"},{day:14,reward:300,message:"Two weeks strong!"},{day:21,reward:400,message:"Three weeks! Amazing!"},{day:30,reward:1100,message:"Challenge complete! üåü"}]},"90-day-transformation":{id:"90-day-transformation",name:"90-Day Transformation Challenge",description:"Complete daily spiritual practice for 90 consecutive days",duration:90,type:"transformation",icon:"‚ú®",xpReward:1e4,milestones:[{day:7,reward:500,message:"First week complete!"},{day:30,reward:1500,message:"One month down!"},{day:60,reward:2500,message:"Two months! Incredible!"},{day:90,reward:5500,message:"TRANSFORMATION COMPLETE! üéä"}]},"21-day-chakra":{id:"21-day-chakra",name:"21-Day Chakra Balance Challenge",description:"Work on balancing all 7 chakras over 21 days",duration:21,type:"chakra",icon:"‚ö°",xpReward:1500,milestones:[{day:7,reward:300,message:"One week of chakra work!"},{day:14,reward:450,message:"Two weeks of balance!"},{day:21,reward:750,message:"All chakras balanced! üåà"}]},"14-day-crystal":{id:"14-day-crystal",name:"14-Day Crystal Healing Challenge",description:"Work with a different crystal each day for 14 days",duration:14,type:"crystal",icon:"üíé",xpReward:1e3,milestones:[{day:7,reward:250,message:"Halfway through crystal healing!"},{day:14,reward:750,message:"Crystal master! üíé"}]}}}loadActiveChallenge(){return JSON.parse(localStorage.getItem("divineTemple_activeChallenge")||"null")}saveActiveChallenge(){localStorage.setItem("divineTemple_activeChallenge",JSON.stringify(this.activeChallenge))}loadChallengeHistory(){return JSON.parse(localStorage.getItem("divineTemple_challengeHistory")||"[]")}saveChallengeHistory(){localStorage.setItem("divineTemple_challengeHistory",JSON.stringify(this.challengeHistory))}startChallenge(e){if(this.activeChallenge)return{success:!1,message:"You already have an active challenge! Complete or abandon it first."};const n=this.challenges[e];return n?(this.activeChallenge={...n,startDate:(new Date).toISOString(),currentDay:0,completedDays:[],missedDays:0,milestonesClaimed:[],status:"active"},this.saveActiveChallenge(),window.progressSystem&&(window.progressSystem.awardXP(50,`Started ${n.name}`,"challenges"),window.progressSystem.logActivity("challenge_start","challenges",{challengeId:e,challengeName:n.name})),{success:!0,message:`üéØ ${n.name} started! Good luck!`,challenge:this.activeChallenge}):{success:!1,message:"Challenge not found"}}checkDailyProgress(){if(!this.activeChallenge)return;const e=(new Date).toISOString().split("T")[0],n=this.activeChallenge.completedDays[this.activeChallenge.completedDays.length-1];if(n!==e){if(n){const a=new Date(n),t=new Date(e),l=Math.floor((t-a)/864e5);if(l>1&&(this.activeChallenge.missedDays+=l-1,console.log(`‚ö†Ô∏è Missed ${l-1} days`),this.activeChallenge.missedDays>=3))return void this.failChallenge()}}else console.log("‚úÖ Challenge already completed today")}completeTodayProgress(){if(!this.activeChallenge)return{success:!1,message:"No active challenge"};const e=(new Date).toISOString().split("T")[0];if(this.activeChallenge.completedDays.includes(e))return{success:!1,message:"Already completed today!"};this.activeChallenge.completedDays.push(e),this.activeChallenge.currentDay++;const n=this.checkMilestones();return this.activeChallenge.currentDay>=this.activeChallenge.duration?this.completeChallenge():(this.saveActiveChallenge(),{success:!0,message:`Day ${this.activeChallenge.currentDay}/${this.activeChallenge.duration} complete!`,milestone:n})}checkMilestones(){const e=this.activeChallenge.currentDay,n=this.activeChallenge.milestones.find(n=>n.day===e&&!this.activeChallenge.milestonesClaimed.includes(n.day));return n?(this.activeChallenge.milestonesClaimed.push(n.day),window.progressSystem&&window.progressSystem.awardXP(n.reward,n.message,"challenges"),n):null}completeChallenge(){const e={...this.activeChallenge,completedDate:(new Date).toISOString(),status:"completed"};return this.challengeHistory.unshift(e),this.saveChallengeHistory(),window.progressSystem&&(window.progressSystem.awardXP(this.activeChallenge.xpReward,`Completed ${this.activeChallenge.name}!`,"challenges"),window.progressSystem.logActivity("challenge_complete","challenges",{challengeId:this.activeChallenge.id,challengeName:this.activeChallenge.name,duration:this.activeChallenge.duration})),this.activeChallenge=null,this.saveActiveChallenge(),{success:!0,message:`üéä ${e.name} COMPLETE! You earned ${e.xpReward} XP!`,challenge:e}}failChallenge(){const e={...this.activeChallenge,failedDate:(new Date).toISOString(),status:"failed"};this.challengeHistory.unshift(e),this.saveChallengeHistory(),this.activeChallenge=null,this.saveActiveChallenge(),"function"==typeof window.showNotification&&window.showNotification(`Challenge failed due to ${e.missedDays} missed days. Try again!`,"warning")}abandonChallenge(){if(!this.activeChallenge)return{success:!1,message:"No active challenge"};const e={...this.activeChallenge,abandonedDate:(new Date).toISOString(),status:"abandoned"};return this.challengeHistory.unshift(e),this.saveChallengeHistory(),this.activeChallenge=null,this.saveActiveChallenge(),{success:!0,message:"Challenge abandoned. You can start a new one!"}}getChallengeStats(){const e=this.challengeHistory.filter(e=>"completed"===e.status).length,n=this.challengeHistory.filter(e=>"failed"===e.status).length,a=this.challengeHistory.filter(e=>"abandoned"===e.status).length,t=this.challengeHistory.filter(e=>"completed"===e.status).reduce((e,n)=>e+n.xpReward,0);return{completed:e,failed:n,abandoned:a,total:this.challengeHistory.length,totalXP:t,activeChallenge:this.activeChallenge}}renderChallengeCalendar(e){const n=document.getElementById(e);if(!n)return;const a=this.getChallengeStats();n.innerHTML=`\n            <div class="challenge-calendar">\n                <h2 class="challenge-header">‚ö° Challenge Calendar</h2>\n\n                \x3c!-- Stats Overview --\x3e\n                <div class="challenge-stats">\n                    <div class="stat-card">\n                        <div class="stat-number">${a.completed}</div>\n                        <div class="stat-label">Completed</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-number">${a.totalXP.toLocaleString()}</div>\n                        <div class="stat-label">Total XP</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-number">${a.total}</div>\n                        <div class="stat-label">Total Attempts</div>\n                    </div>\n                </div>\n\n                \x3c!-- Active Challenge --\x3e\n                ${this.activeChallenge?`\n                    <div class="active-challenge">\n                        <h3>${this.activeChallenge.icon} ${this.activeChallenge.name}</h3>\n                        <p>${this.activeChallenge.description}</p>\n                        <div class="challenge-progress">\n                            <div class="progress-bar">\n                                <div class="progress-fill" style="width: ${this.activeChallenge.currentDay/this.activeChallenge.duration*100}%"></div>\n                            </div>\n                            <div class="progress-text">Day ${this.activeChallenge.currentDay} / ${this.activeChallenge.duration}</div>\n                        </div>\n                        <div class="challenge-actions">\n                            <button class="btn-complete" onclick="challengeCalendar.completeTodayProgress()">\n                                ‚úÖ Complete Today\n                            </button>\n                            <button class="btn-abandon" onclick="challengeCalendar.abandonChallenge()">\n                                ‚ùå Abandon\n                            </button>\n                        </div>\n                    </div>\n                `:'\n                    <div class="no-challenge">\n                        <p>No active challenge. Choose one to start!</p>\n                    </div>\n                '}\n\n                \x3c!-- Available Challenges --\x3e\n                <h3 class="section-title">Available Challenges</h3>\n                <div class="challenges-grid">\n                    ${Object.values(this.challenges).map(e=>`\n                        <div class="challenge-card ${this.activeChallenge?"disabled":""}">\n                            <div class="challenge-icon">${e.icon}</div>\n                            <h4>${e.name}</h4>\n                            <p>${e.description}</p>\n                            <div class="challenge-info">\n                                <span>‚è∞ ${e.duration} days</span>\n                                <span>‚≠ê ${e.xpReward} XP</span>\n                            </div>\n                            <button\n                                class="btn-start-challenge"\n                                onclick="challengeCalendar.startChallenge('${e.id}')"\n                                ${this.activeChallenge?"disabled":""}\n                            >\n                                Start Challenge\n                            </button>\n                        </div>\n                    `).join("")}\n                </div>\n\n                <style>\n                    .challenge-calendar {\n                        padding: 2rem;\n                        background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(59, 130, 246, 0.05));\n                        border-radius: 20px;\n                        margin: 1rem 0;\n                    }\n                    .challenge-header {\n                        text-align: center;\n                        font-size: 2.5rem;\n                        margin-bottom: 2rem;\n                        background: linear-gradient(135deg, #d4af37, #8b5cf6);\n                        -webkit-background-clip: text;\n                        background-clip: text;\n                        -webkit-text-fill-color: transparent;\n                    }\n                    .challenge-stats {\n                        display: grid;\n                        grid-template-columns: repeat(3, 1fr);\n                        gap: 1rem;\n                        margin-bottom: 2rem;\n                    }\n                    .stat-card {\n                        text-align: center;\n                        padding: 1.5rem;\n                        background: rgba(255, 255, 255, 0.05);\n                        border-radius: 15px;\n                        border: 1px solid rgba(255, 255, 255, 0.1);\n                    }\n                    .stat-number {\n                        font-size: 2.5rem;\n                        font-weight: 700;\n                        color: #d4af37;\n                    }\n                    .stat-label {\n                        color: rgba(255, 255, 255, 0.7);\n                        margin-top: 0.5rem;\n                    }\n                    .active-challenge {\n                        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2));\n                        border: 2px solid #8b5cf6;\n                        border-radius: 20px;\n                        padding: 2rem;\n                        margin: 2rem 0;\n                    }\n                    .active-challenge h3 {\n                        font-size: 1.8rem;\n                        margin-bottom: 0.5rem;\n                    }\n                    .challenge-progress {\n                        margin: 1.5rem 0;\n                    }\n                    .progress-bar {\n                        height: 20px;\n                        background: rgba(255, 255, 255, 0.1);\n                        border-radius: 10px;\n                        overflow: hidden;\n                        margin-bottom: 0.5rem;\n                    }\n                    .progress-fill {\n                        height: 100%;\n                        background: linear-gradient(90deg, #10b981, #059669);\n                        transition: width 0.3s;\n                    }\n                    .progress-text {\n                        text-align: center;\n                        font-weight: 600;\n                        color: #10b981;\n                    }\n                    .challenge-actions {\n                        display: flex;\n                        gap: 1rem;\n                        margin-top: 1.5rem;\n                    }\n                    .btn-complete, .btn-abandon {\n                        flex: 1;\n                        padding: 1rem;\n                        border: none;\n                        border-radius: 12px;\n                        font-size: 1rem;\n                        font-weight: 600;\n                        cursor: pointer;\n                        transition: all 0.3s;\n                    }\n                    .btn-complete {\n                        background: linear-gradient(135deg, #10b981, #059669);\n                        color: white;\n                    }\n                    .btn-abandon {\n                        background: rgba(239, 68, 68, 0.2);\n                        color: #fca5a5;\n                        border: 1px solid rgba(239, 68, 68, 0.3);\n                    }\n                    .btn-complete:hover, .btn-abandon:hover {\n                        transform: translateY(-2px);\n                    }\n                    .no-challenge {\n                        text-align: center;\n                        padding: 3rem;\n                        color: rgba(255, 255, 255, 0.6);\n                        font-size: 1.1rem;\n                    }\n                    .section-title {\n                        font-size: 1.8rem;\n                        margin: 2rem 0 1rem;\n                        text-align: center;\n                    }\n                    .challenges-grid {\n                        display: grid;\n                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n                        gap: 1.5rem;\n                    }\n                    .challenge-card {\n                        background: rgba(255, 255, 255, 0.05);\n                        border: 1px solid rgba(255, 255, 255, 0.1);\n                        border-radius: 15px;\n                        padding: 1.5rem;\n                        transition: all 0.3s;\n                    }\n                    .challenge-card:not(.disabled):hover {\n                        transform: translateY(-5px);\n                        border-color: #8b5cf6;\n                        box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);\n                    }\n                    .challenge-card.disabled {\n                        opacity: 0.5;\n                        cursor: not-allowed;\n                    }\n                    .challenge-icon {\n                        font-size: 3rem;\n                        text-align: center;\n                        margin-bottom: 1rem;\n                    }\n                    .challenge-card h4 {\n                        font-size: 1.3rem;\n                        margin-bottom: 0.5rem;\n                        text-align: center;\n                    }\n                    .challenge-card p {\n                        color: rgba(255, 255, 255, 0.7);\n                        font-size: 0.9rem;\n                        text-align: center;\n                        margin-bottom: 1rem;\n                    }\n                    .challenge-info {\n                        display: flex;\n                        justify-content: space-around;\n                        margin: 1rem 0;\n                        padding: 0.75rem;\n                        background: rgba(255, 255, 255, 0.05);\n                        border-radius: 10px;\n                    }\n                    .challenge-info span {\n                        font-size: 0.9rem;\n                        color: #d4af37;\n                    }\n                    .btn-start-challenge {\n                        width: 100%;\n                        padding: 1rem;\n                        background: linear-gradient(135deg, #8b5cf6, #6366f1);\n                        border: none;\n                        border-radius: 12px;\n                        color: white;\n                        font-size: 1rem;\n                        font-weight: 600;\n                        cursor: pointer;\n                        transition: all 0.3s;\n                    }\n                    .btn-start-challenge:not(:disabled):hover {\n                        transform: translateY(-2px);\n                        box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);\n                    }\n                    .btn-start-challenge:disabled {\n                        opacity: 0.5;\n                        cursor: not-allowed;\n                    }\n                    @media (max-width: 768px) {\n                        .challenge-stats {\n                            grid-template-columns: 1fr;\n                        }\n                        .challenges-grid {\n                            grid-template-columns: 1fr;\n                        }\n                    }\n                </style>\n            </div>\n        `}}window.challengeCalendar=new ChallengeCalendarSystem,window.ChallengeCalendarSystem=ChallengeCalendarSystem;