class PersonalizationAI{constructor(){this.userProfile=this.loadUserProfile(),this.behaviorData=this.loadBehaviorData(),this.preferences=this.loadPreferences(),this.recommendations=[],this.init()}init(){console.log("ðŸ¤– Personalization AI initialized"),this.setupActivityListeners(),this.generateDailyRecommendations(),setInterval(()=>{this.generateDailyRecommendations()},36e5)}loadUserProfile(){const e=localStorage.getItem("ai_user_profile");return e?JSON.parse(e):{level:1,interests:[],activityHistory:[],completedContent:[],timeOfDay:null,sessionDuration:30,preferredCategories:{},streak:0}}saveUserProfile(){localStorage.setItem("ai_user_profile",JSON.stringify(this.userProfile))}loadBehaviorData(){const e=localStorage.getItem("ai_behavior_data");return e?JSON.parse(e):{loginTimes:[],sessionLengths:[],completionRates:{},categoryTimeSpent:{},interactionPatterns:[],abandonmentPoints:[]}}saveBehaviorData(){localStorage.setItem("ai_behavior_data",JSON.stringify(this.behaviorData))}loadPreferences(){const e=localStorage.getItem("ai_preferences");return e?JSON.parse(e):{contentTypes:{video:.5,audio:.5,text:.5,interactive:.5},difficulty:"medium",duration:"medium",themes:{}}}savePreferences(){localStorage.setItem("ai_preferences",JSON.stringify(this.preferences))}setupActivityListeners(){window.addEventListener("xp-awarded",e=>{this.trackActivity({type:"xp_earned",section:e.detail.section,amount:e.detail.amount,reason:e.detail.reason,timestamp:Date.now()})}),window.addEventListener("section-visited",e=>{this.trackActivity({type:"section_visit",section:e.detail.section,timestamp:Date.now()})}),window.addEventListener("content-completed",e=>{this.trackCompletion(e.detail)}),this.trackSessionStart(),window.addEventListener("beforeunload",()=>{this.trackSessionEnd()})}trackActivity(e){this.behaviorData.interactionPatterns.push(e),this.behaviorData.interactionPatterns.length>1e3&&(this.behaviorData.interactionPatterns=this.behaviorData.interactionPatterns.slice(-1e3)),e.section&&(this.behaviorData.categoryTimeSpent[e.section]=(this.behaviorData.categoryTimeSpent[e.section]||0)+1),this.saveBehaviorData(),this.updateRecommendations()}trackCompletion(e){const{contentId:t,contentType:i,section:o,difficulty:n}=e;o&&(this.behaviorData.completionRates[o]||(this.behaviorData.completionRates[o]={completed:0,attempted:0}),this.behaviorData.completionRates[o].completed++,this.behaviorData.completionRates[o].attempted++),this.userProfile.completedContent.push({contentId:t,contentType:i,section:o,difficulty:n,completedAt:Date.now()}),i&&void 0!==this.preferences.contentTypes[i]&&(this.preferences.contentTypes[i]=Math.min(1,this.preferences.contentTypes[i]+.05)),this.saveUserProfile(),this.savePreferences()}trackSessionStart(){const e=new Date;this.behaviorData.loginTimes.push({timestamp:e.getTime(),hour:e.getHours(),dayOfWeek:e.getDay()}),this.sessionStartTime=Date.now(),this.behaviorData.loginTimes.length>100&&(this.behaviorData.loginTimes=this.behaviorData.loginTimes.slice(-100)),this.saveBehaviorData()}trackSessionEnd(){if(this.sessionStartTime){const e=(Date.now()-this.sessionStartTime)/1e3/60;this.behaviorData.sessionLengths.push(e),this.behaviorData.sessionLengths.length>100&&(this.behaviorData.sessionLengths=this.behaviorData.sessionLengths.slice(-100)),this.saveBehaviorData()}}generateDailyRecommendations(){this.recommendations=[],this.recommendations.push(...this.getInterestBasedRecommendations()),this.recommendations.push(...this.getPatternBasedRecommendations()),this.recommendations.push(...this.getTimeBasedRecommendations()),this.recommendations.push(...this.getTrendingRecommendations()),this.recommendations.push(...this.getChallengeRecommendations()),this.recommendations=this.deduplicate(this.recommendations.sort((e,t)=>t.score-e.score)),console.log("Generated recommendations:",this.recommendations.length),window.dispatchEvent(new CustomEvent("recommendations-updated",{detail:{recommendations:this.recommendations}}))}getInterestBasedRecommendations(){const e=[],t={};for(const[e,i]of Object.entries(this.behaviorData.categoryTimeSpent))t[e]=i;return Object.entries(t).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e])=>e).forEach(t=>{e.push({type:"content",section:t,title:`Explore more ${t}`,description:`Based on your interest in ${t}`,score:.9,reason:"interest"})}),e}getPatternBasedRecommendations(){const e=[],t=[];for(const[e,i]of Object.entries(this.behaviorData.completionRates))if(i.attempted>i.completed){const o=i.completed/i.attempted;o<.7&&t.push({section:e,completionRate:o})}return t.forEach(t=>{e.push({type:"completion",section:t.section,title:`Complete your ${t.section} journey`,description:`You're ${Math.round(100*t.completionRate)}% done!`,score:.8,reason:"completion"})}),e}getTimeBasedRecommendations(){const e=[],t=(new Date).getHours();return t>=5&&t<12?(e.push({type:"routine",title:"Morning Meditation",description:"Start your day with mindful awareness",score:.85,reason:"time_of_day",content:"meditation"}),e.push({type:"routine",title:"Yoga Sun Salutation",description:"Energize your body with yoga",score:.82,reason:"time_of_day",content:"yoga"})):t>=12&&t<17?e.push({type:"routine",title:"Spiritual Study",description:"Expand your knowledge with sacred texts",score:.78,reason:"time_of_day",content:"study"}):t>=17&&t<22?(e.push({type:"routine",title:"Evening Journaling",description:"Reflect on your day and insights",score:.83,reason:"time_of_day",content:"journal"}),e.push({type:"routine",title:"Gratitude Practice",description:"Count your blessings before sleep",score:.81,reason:"time_of_day",content:"gratitude"})):e.push({type:"routine",title:"Sleep Meditation",description:"Prepare for restful sleep",score:.86,reason:"time_of_day",content:"sleep"}),e}getTrendingRecommendations(){return[{type:"trending",title:"Full Moon Ceremony",description:"Join the community for tonight's full moon ritual",score:.75,reason:"trending"}]}getChallengeRecommendations(){const e=[],t=window.progressSystem?window.progressSystem.level:1;return t>=5&&t<15?e.push({type:"challenge",title:"7-Day Meditation Challenge",description:"Build a consistent meditation practice",score:.77,reason:"challenge",difficulty:"beginner"}):t>=15&&e.push({type:"challenge",title:"30-Day Transformation Challenge",description:"Deep spiritual transformation",score:.79,reason:"challenge",difficulty:"advanced"}),e}deduplicate(e){const t=new Set;return e.filter(e=>{const i=`${e.type}-${e.title}`;return!t.has(i)&&(t.add(i),!0)})}updateRecommendations(){this.lastUpdate&&Date.now()-this.lastUpdate<3e5||(this.lastUpdate=Date.now(),this.generateDailyRecommendations())}getAdaptiveDifficulty(e){const t=this.behaviorData.completionRates[e];if(!t||t.attempted<5)return"medium";const i=t.completed/t.attempted;return i>.85?"hard":i<.5?"easy":"medium"}generatePersonalizedQuests(){const e=[];this.identifyWeakAreas().forEach(t=>{e.push({title:`Strengthen your ${t} practice`,description:`Complete activities in ${t} to improve`,xpReward:100,category:t,type:"improvement"})});return this.findUnexploredContent().forEach(t=>{e.push({title:`Discover ${t}`,description:"Try something new for your growth",xpReward:75,category:t,type:"exploration"})}),e}identifyWeakAreas(){const e=[];for(const[t,i]of Object.entries(this.behaviorData.completionRates)){i.completed/i.attempted<.6&&e.push(t)}return e}findUnexploredContent(){const e=Object.keys(this.behaviorData.categoryTimeSpent);return["meditation","energy-healing","chakras","crystals","tarot","astrology","manifestation","yoga","breathwork"].filter(t=>!e.includes(t))}generateInsights(){const e=[],t=this.getMostActiveHour();null!==t&&e.push({type:"time",title:"Peak Performance Time",message:`You're most active around ${t}:00. Schedule important practices then!`});const i=this.getFavoriteCategory();i&&e.push({type:"interest",title:"Your Spiritual Path",message:`You're deeply connected to ${i}. Continue exploring this path!`});const o=this.getConsistencyScore();return o<.5?e.push({type:"improvement",title:"Build Consistency",message:"Try practicing at the same time daily to build a strong habit."}):o>.8&&e.push({type:"achievement",title:"Excellent Consistency!",message:"Your dedication is inspiring! Keep up the amazing work."}),e}getMostActiveHour(){if(0===this.behaviorData.loginTimes.length)return null;const e={};return this.behaviorData.loginTimes.forEach(t=>{e[t.hour]=(e[t.hour]||0)+1}),parseInt(Object.entries(e).sort((e,t)=>t[1]-e[1])[0][0])}getFavoriteCategory(){const e=this.behaviorData.categoryTimeSpent;return 0===Object.keys(e).length?null:Object.entries(e).sort((e,t)=>t[1]-e[1])[0][0]}getConsistencyScore(){const e=this.behaviorData.loginTimes;if(e.length<7)return 0;const t=e.slice(-7).map(e=>e.hour),i=t.reduce((e,t)=>e+t,0)/t.length,o=t.reduce((e,t)=>e+Math.pow(t-i,2),0)/t.length;return Math.max(0,1-o/100)}getRecommendations(e=10){return this.recommendations.slice(0,e)}getInsights(){return this.generateInsights()}getUserStats(){return{totalActivities:this.behaviorData.interactionPatterns.length,avgSessionLength:this.getAverageSessionLength(),mostActiveHour:this.getMostActiveHour(),favoriteCategory:this.getFavoriteCategory(),consistencyScore:this.getConsistencyScore(),completedContent:this.userProfile.completedContent.length}}getAverageSessionLength(){const e=this.behaviorData.sessionLengths;return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}}"undefined"!=typeof window&&(window.personalizationAI=new PersonalizationAI,console.log("ðŸ¤– Personalization AI ready!"));