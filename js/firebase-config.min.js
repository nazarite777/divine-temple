const firebaseConfig={apiKey:"AIzaSyCOyZPb4gfYE5q_RwmYaKG6cpTvrE-3LxI",authDomain:"sacred-community.firebaseapp.com",projectId:"sacred-community",storageBucket:"sacred-community.firebasestorage.app",messagingSenderId:"582271923489",appId:"1:582271923489:web:aa46a8bb5ac0859fe83a60",measurementId:"G-83D6SSJKMH"};let app,auth,db,analytics,storage;function initializeFirebase(){try{return app=firebase.initializeApp(firebaseConfig),console.log("ðŸ”¥ Firebase initialized successfully"),auth=firebase.auth(),db=firebase.firestore(),"function"==typeof firebase.analytics&&(analytics=firebase.analytics(),console.log("ðŸ“Š Firebase Analytics initialized")),"function"==typeof firebase.storage&&(storage=firebase.storage(),console.log("ðŸ’¾ Firebase Storage initialized")),db.settings({cacheSizeBytes:firebase.firestore.CACHE_SIZE_UNLIMITED}),db.enablePersistence({synchronizeTabs:!0}).then(()=>console.log("âœ… Firestore offline persistence enabled")).catch(e=>console.log("âš ï¸ Offline persistence failed:",e)),!0}catch(e){return console.error("âŒ Firebase initialization failed:",e),!1}}function onAuthStateChanged(e){if(auth)return auth.onAuthStateChanged(e);console.error("âŒ Firebase Auth not initialized")}const ADMIN_EMAILS=["nazir@edenconsciousness.com","nazir@edenconsiousness.com"],FirebaseAuth={isAdminEmail(e){if(!e)return!1;const t=e.toLowerCase();return ADMIN_EMAILS.some(e=>t===e.toLowerCase())},isAdmin(){const e=auth.currentUser;return!(!e||!this.isAdminEmail(e.email))},getCurrentUser:()=>auth.currentUser,async createUser(e,t,s){try{const r=(await auth.createUserWithEmailAndPassword(e,t)).user;return await r.updateProfile({displayName:s}),await db.collection("users").doc(r.uid).set({email:r.email,displayName:s,createdAt:firebase.firestore.FieldValue.serverTimestamp(),membershipLevel:"basic",preferences:{theme:"sacred",notifications:!0},progress:{sectionsVisited:[],completedActions:[],lastActive:firebase.firestore.FieldValue.serverTimestamp()}}),console.log("âœ… User created successfully:",r.uid),{success:!0,user:r}}catch(e){return console.error("âŒ User creation failed:",e),{success:!1,error:e.message}}},async signIn(e,t){try{const s=(await auth.signInWithEmailAndPassword(e,t)).user;return await db.collection("users").doc(s.uid).update({"progress.lastActive":firebase.firestore.FieldValue.serverTimestamp()}),console.log("âœ… User signed in:",s.uid),{success:!0,user:s}}catch(e){return console.error("âŒ Sign in failed:",e),{success:!1,error:e.message}}},async signOut(){try{return await auth.signOut(),console.log("âœ… User signed out"),{success:!0}}catch(e){return console.error("âŒ Sign out failed:",e),{success:!1,error:e.message}}},getCurrentUser:()=>auth.currentUser,isAuthenticated:()=>!!auth.currentUser},FirebaseAnalytics={trackPageView(e,t){analytics&&analytics.logEvent("page_view",{page_title:t,page_location:window.location.href,page_path:window.location.pathname,custom_page_name:e})},trackEvent(e,t={}){analytics&&analytics.logEvent(e,{timestamp:(new Date).toISOString(),user_id:auth.currentUser?.uid||"anonymous",...t})},trackPurchase(e,t,s="USD"){analytics&&analytics.logEvent("purchase",{currency:s,value:t,items:[{item_id:e.toLowerCase().replace(/\s+/g,"_"),item_name:e,category:"spiritual_content",quantity:1,price:t}]})},trackSectionVisit(e){this.trackEvent("section_visit",{section_name:e,user_authenticated:this.isAuthenticated()})}},FirebaseData={async saveProgress(e,t,s={}){if(auth.currentUser)try{const r=db.collection("users").doc(auth.currentUser.uid);await r.update({[`progress.${e}`]:{lastVisited:firebase.firestore.FieldValue.serverTimestamp(),actionType:t,data:s},"progress.lastActive":firebase.firestore.FieldValue.serverTimestamp()})}catch(e){console.error("âŒ Failed to save progress:",e)}},async getUserData(e=null){const t=e||auth.currentUser?.uid;if(!t)return null;try{const e=await db.collection("users").doc(t).get();return e.exists?e.data():null}catch(e){return console.error("âŒ Failed to get user data:",e),null}},async saveTestimonial(e){try{return await db.collection("testimonials").add({...e,userId:auth.currentUser?.uid||null,createdAt:firebase.firestore.FieldValue.serverTimestamp(),approved:!1}),{success:!0}}catch(e){return console.error("âŒ Failed to save testimonial:",e),{success:!1,error:e.message}}},async getTestimonials(e=10){try{return(await db.collection("testimonials").where("approved","==",!0).orderBy("createdAt","desc").limit(e).get()).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("âŒ Failed to get testimonials:",e),[]}},async saveSupportTicket(e){try{const t=`SACRED-${Date.now()}-${Math.random().toString(36).substr(2,4).toUpperCase()}`,s={...e,ticketId:t,userId:auth.currentUser?.uid||null,userEmail:auth.currentUser?.email||e.email,status:"open",createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()};return await db.collection("support_tickets").doc(t).set(s),{success:!0,ticketId:t}}catch(e){return console.error("âŒ Failed to save support ticket:",e),{success:!1,error:e.message}}},async getUserTickets(e=null){const t=e||auth.currentUser?.uid;if(!t)return[];try{return(await db.collection("support_tickets").where("userId","==",t).orderBy("createdAt","desc").get()).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("âŒ Failed to get user tickets:",e),[]}}};window.FirebaseConfig={initialize:initializeFirebase,auth:FirebaseAuth,analytics:FirebaseAnalytics,data:FirebaseData,onAuthStateChanged:onAuthStateChanged},"undefined"!=typeof firebase&&document.addEventListener("DOMContentLoaded",()=>{initializeFirebase()});