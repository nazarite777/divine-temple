!function(){"use strict";const e=["premium","elite","admin","founding"],t=["daily-trivia-PREMIUM.html","members-new.html","members.html","chakras-auras.html","meditation-mindfulness.html","oracle-divination.html","tarot.html","crystal-oracle.html","energy-healing.html","sacred-knowledge.html","spiritual-practices.html","personal-growth.html","devotion-growth.html","videos-media.html","spiritual-music.html","sacred-arts-sound.html","singing-bowl-garden.html","spiritual-tools.html","sacred-books.html","reward-shop.html","progress-dashboard.html","calendar.html","oracle-divination-hub.html"],s=["daily-trivia-FREE.html","community.html","chakra-memory-match.html","crystal-memory-game.html","mandala-coloring.html","crystals-elements.html"];window.PremiumAccessControl=new class{constructor(){this.initialized=!1,this.currentUser=null,this.membershipLevel=null,this.hasPremiumAccess=!1}async initialize(){this.initialized||(console.log("üîê Initializing Premium Access Control..."),await this.waitForFirebase(),await this.checkAuthentication(),this.initialized=!0,console.log("‚úÖ Access Control Initialized"))}async waitForFirebase(){return new Promise(e=>{const t=()=>{"undefined"!=typeof firebase&&firebase.auth?e():setTimeout(t,100)};t()})}async checkAuthentication(){return new Promise(e=>{firebase.auth().onAuthStateChanged(async t=>{t?(this.currentUser=t,await this.checkAuthorization(t)):(this.currentUser=null,this.membershipLevel=null,this.hasPremiumAccess=!1,localStorage.removeItem("membershipLevel"),localStorage.removeItem("isAuthorizedUser")),e()})})}async checkAuthorization(e){try{const t=firebase.functions().httpsCallable("verifyPremiumAccess"),s=await t({});this.hasPremiumAccess=s.data.hasPremiumAccess,this.hasPremiumAccess?(console.log("‚úÖ Server verified premium access"),await this.getMembershipLevel(e.uid),localStorage.setItem("hasPremiumAccess","true")):(console.log("‚õî User has free tier access"),this.membershipLevel="free",this.hasPremiumAccess=!1,localStorage.setItem("hasPremiumAccess","false"),localStorage.setItem("membershipLevel","free"))}catch(e){console.error("‚ùå Error checking authorization:",e),console.error("‚ùå Server validation failed - denying premium access"),this.membershipLevel="free",this.hasPremiumAccess=!1,localStorage.setItem("hasPremiumAccess","false")}}async getMembershipLevel(t){try{const s=await firebase.firestore().collection("users").doc(t).get();if(s.exists){const t=s.data();this.membershipLevel=t.membershipLevel||"basic",localStorage.setItem("membershipLevel",this.membershipLevel),this.hasPremiumAccess=e.includes(this.membershipLevel),console.log("üìä Membership Level:",this.membershipLevel),console.log("üíé Premium Access:",this.hasPremiumAccess)}else this.membershipLevel="basic",this.hasPremiumAccess=!1,console.warn("‚ö†Ô∏è No user document found - defaulting to basic")}catch(e){console.error("‚ùå Error fetching membership level:",e),this.membershipLevel="basic",this.hasPremiumAccess=!1}}isCurrentPagePremium(){const e=window.location.pathname.split("/").pop();return t.includes(e)}isCurrentPageFree(){const e=window.location.pathname.split("/").pop();return s.includes(e)}async hasAccessToCurrentPage(){return await this.initialize(),!!this.currentUser&&(!this.isCurrentPagePremium()||this.hasPremiumAccess)}async enforceAccess(){if(await this.initialize(),console.log("üîí Enforcing access control..."),!this.currentUser)return console.warn("‚õî Not authenticated - redirecting to login"),this.redirectToLogin(),!1;if(this.isCurrentPagePremium()){if(!this.hasPremiumAccess)return console.warn("‚õî Premium access required"),console.warn("   User:",this.currentUser?.email),console.warn("   Page:",window.location.pathname),console.warn("   Membership:",this.membershipLevel),this.showAccessBlockedMessage(),!1;console.log("‚úÖ Premium access granted")}return console.log("‚úÖ Access granted"),!0}redirectToLogin(){const e=window.location.pathname;sessionStorage.setItem("redirectAfterLogin",e),this.showAccessDeniedMessage("Please log in to access this content"),setTimeout(()=>{window.location.href="/login.html"},1500)}showAccessBlockedMessage(){this.currentUser;this.showAccessDeniedMessage("This content requires a Premium membership. Upgrade to unlock all features and spiritual content."),setTimeout(()=>{window.location.href="/free-dashboard.html?showUpgrade=true"},3e3)}redirectToUpgrade(){const e=window.location.pathname;sessionStorage.setItem("intendedDestination",e),this.showAccessDeniedMessage("This content requires a premium membership"),setTimeout(()=>{window.location.href="/free-dashboard.html?showUpgrade=true"},2e3)}showAccessDeniedMessage(e){const t=document.createElement("div");t.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 999999;\n                animation: fadeIn 0.3s ease;\n            ";const s=document.createElement("div");s.style.cssText="\n                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n                border: 2px solid #d4af37;\n                border-radius: 20px;\n                padding: 3rem;\n                text-align: center;\n                max-width: 500px;\n                box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);\n            ",s.innerHTML=`\n                <div style="font-size: 4rem; margin-bottom: 1rem;">üîí</div>\n                <h2 style="color: #d4af37; font-size: 1.8rem; margin-bottom: 1rem; font-family: 'Playfair Display', serif;">\n                    Access Restricted\n                </h2>\n                <p style="color: #ffffff; font-size: 1.1rem; margin-bottom: 1.5rem;">\n                    ${e}\n                </p>\n                <div style="color: #8b5cf6; font-size: 0.9rem;">\n                    Redirecting...\n                </div>\n            `,t.appendChild(s),document.body.appendChild(t);const n=document.createElement("style");n.textContent="\n                @keyframes fadeIn {\n                    from { opacity: 0; }\n                    to { opacity: 1; }\n                }\n            ",document.head.appendChild(n)}canAccessSection(e){return this.initialized?t.includes(e)?this.hasPremiumAccess:!!s.includes(e)&&!!this.currentUser:(console.warn("Access control not initialized"),!1)}getUpgradeUrl(){return"/free-dashboard.html?showUpgrade=true"}showUpgradeModal(){const e=document.createElement("div");e.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.85);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 999999;\n                animation: fadeIn 0.3s ease;\n            ",e.innerHTML='\n                <div style="\n                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n                    border: 2px solid #d4af37;\n                    border-radius: 25px;\n                    padding: 3rem;\n                    max-width: 600px;\n                    text-align: center;\n                    box-shadow: 0 25px 70px rgba(212, 175, 55, 0.4);\n                ">\n                    <div style="font-size: 4rem; margin-bottom: 1rem;">üíé</div>\n                    <h2 style="color: #d4af37; font-size: 2rem; margin-bottom: 1rem; font-family: \'Playfair Display\', serif;">\n                        Unlock Premium Access\n                    </h2>\n                    <p style="color: #ffffff; font-size: 1.1rem; margin-bottom: 2rem; line-height: 1.6;">\n                        Access exclusive content, advanced features, and the complete Divine Temple experience.\n                    </p>\n                    <div style="display: flex; gap: 1rem; justify-content: center;">\n                        <button onclick="window.location.href=\'/free-dashboard.html?showUpgrade=true\'" style="\n                            background: linear-gradient(135deg, #d4af37, #f59e0b);\n                            border: none;\n                            color: white;\n                            padding: 1rem 2rem;\n                            border-radius: 15px;\n                            font-size: 1.1rem;\n                            font-weight: 600;\n                            cursor: pointer;\n                            transition: transform 0.3s ease;\n                        ">\n                            View Plans\n                        </button>\n                        <button onclick="this.closest(\'div\').parentElement.remove()" style="\n                            background: rgba(255, 255, 255, 0.1);\n                            border: 1px solid rgba(255, 255, 255, 0.3);\n                            color: white;\n                            padding: 1rem 2rem;\n                            border-radius: 15px;\n                            font-size: 1.1rem;\n                            font-weight: 600;\n                            cursor: pointer;\n                        ">\n                            Close\n                        </button>\n                    </div>\n                </div>\n            ',document.body.appendChild(e)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.PremiumAccessControl.enforceAccess()}):window.PremiumAccessControl.enforceAccess(),console.log("üîê Premium Access Control Module Loaded")}();