class DivineProgressWidget{constructor(n="divine-progress-widget"){this.containerId=n,this.sectionName=this.detectSectionName(),this.init()}detectSectionName(){const n=window.location.pathname,e={"meditation-mindfulness":"meditation-mindfulness","oracle-divination":"oracle-divination","spiritual-practices":"spiritual-practices","chakras-auras":"chakras-auras",calendar:"calendar","energy-healing":"energy-healing","sacred-arts-sound":"sacred-arts-sound","devotion-growth":"devotion-growth","sacred-knowledge":"sacred-knowledge",community:"community","crystals-elements":"crystals-elements","spiritual-music":"spiritual-music","sacred-books":"sacred-books","videos-media":"videos-media"};for(const[t,i]of Object.entries(e))if(n.includes(t))return i;return null}async init(){if("undefined"==typeof progressSystem)return console.warn("‚ö†Ô∏è Progress system not loaded yet, retrying..."),void setTimeout(()=>this.init(),500);progressSystem.addEventListener("userLoaded",()=>this.render()),progressSystem.addEventListener("xpAwarded",()=>this.render()),progressSystem.addEventListener("levelUp",n=>this.showLevelUpCelebration(n)),progressSystem.addEventListener("achievementUnlocked",n=>this.showAchievementPopup(n)),progressSystem.addEventListener("streakContinued",()=>this.render()),progressSystem.userData&&this.render()}render(){const n=document.getElementById(this.containerId);if(!n)return;const e=progressSystem.userData;e?(n.innerHTML=this.getWidgetHTML(e),this.attachEventListeners()):n.innerHTML=this.getLoadingHTML()}getWidgetHTML(n){const e=progressSystem.getLevelProgress(),t=this.sectionName?progressSystem.getSectionProgress(this.sectionName):null,i=n.achievements.slice(-3).reverse();return`\n            <div class="divine-progress-widget">\n                \x3c!-- Compact Header --\x3e\n                <div class="progress-widget-header">\n                    <div class="user-level-badge">\n                        <div class="level-circle">\n                            <span class="level-number">${n.level}</span>\n                        </div>\n                        <div class="rank-info">\n                            <div class="rank-icon">${n.spiritualRankIcon||"üîç"}</div>\n                            <div class="rank-name">${n.spiritualRank}</div>\n                        </div>\n                    </div>\n\n                    <div class="streak-badge">\n                        <div class="streak-icon">üî•</div>\n                        <div class="streak-info">\n                            <div class="streak-number">${n.streaks.daily.count}</div>\n                            <div class="streak-label">Day Streak</div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- XP Progress Bar --\x3e\n                <div class="xp-progress-section">\n                    <div class="xp-label">\n                        <span>Level ${n.level}</span>\n                        <span>${n.currentLevelXP} / ${n.nextLevelXP} XP</span>\n                    </div>\n                    <div class="xp-bar">\n                        <div class="xp-fill" style="width: ${e}%">\n                            <div class="xp-shimmer"></div>\n                        </div>\n                    </div>\n                    <div class="xp-next-level">\n                        ${Math.ceil(e)}% to Level ${n.level+1}\n                    </div>\n                </div>\n\n                ${t?this.getSectionProgressHTML(t):""}\n\n                ${i.length>0?this.getAchievementsHTML(i):""}\n\n                \x3c!-- Quick Stats --\x3e\n                <div class="quick-stats">\n                    <div class="stat-item">\n                        <span class="stat-icon">üßò</span>\n                        <span class="stat-value">${n.stats.meditations}</span>\n                    </div>\n                    <div class="stat-item">\n                        <span class="stat-icon">üîÆ</span>\n                        <span class="stat-value">${n.stats.oracleReadings}</span>\n                    </div>\n                    <div class="stat-item">\n                        <span class="stat-icon">üìù</span>\n                        <span class="stat-value">${n.stats.journalEntries}</span>\n                    </div>\n                    <div class="stat-item">\n                        <span class="stat-icon">üèÜ</span>\n                        <span class="stat-value">${n.achievements.length}</span>\n                    </div>\n                </div>\n\n                \x3c!-- View Full Progress --\x3e\n                <button class="view-progress-btn" onclick="window.divineProgressWidget.openProgressDashboard()">\n                    View Full Progress ‚Üí\n                </button>\n            </div>\n\n            <style>\n                .divine-progress-widget {\n                    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(212, 175, 55, 0.1));\n                    backdrop-filter: blur(20px);\n                    border: 2px solid rgba(212, 175, 55, 0.3);\n                    border-radius: 20px;\n                    padding: 1.5rem;\n                    margin-bottom: 2rem;\n                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n                }\n\n                .progress-widget-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 1.5rem;\n                    gap: 1rem;\n                }\n\n                .user-level-badge {\n                    display: flex;\n                    align-items: center;\n                    gap: 1rem;\n                }\n\n                .level-circle {\n                    width: 60px;\n                    height: 60px;\n                    border-radius: 50%;\n                    background: linear-gradient(135deg, #D4AF37, #FFD700);\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);\n                    position: relative;\n                }\n\n                .level-circle::after {\n                    content: '';\n                    position: absolute;\n                    top: -3px;\n                    left: -3px;\n                    right: -3px;\n                    bottom: -3px;\n                    border-radius: 50%;\n                    border: 2px solid rgba(212, 175, 55, 0.3);\n                    animation: pulse-ring 2s ease-in-out infinite;\n                }\n\n                @keyframes pulse-ring {\n                    0%, 100% { transform: scale(1); opacity: 0.5; }\n                    50% { transform: scale(1.1); opacity: 0.8; }\n                }\n\n                .level-number {\n                    font-size: 1.8rem;\n                    font-weight: 700;\n                    color: #0F0F23;\n                }\n\n                .rank-info {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: flex-start;\n                }\n\n                .rank-icon {\n                    font-size: 1.5rem;\n                }\n\n                .rank-name {\n                    font-size: 1.1rem;\n                    font-weight: 600;\n                    color: #D4AF37;\n                }\n\n                .streak-badge {\n                    display: flex;\n                    align-items: center;\n                    gap: 0.75rem;\n                    background: rgba(255, 107, 53, 0.2);\n                    padding: 0.75rem 1rem;\n                    border-radius: 15px;\n                    border: 2px solid rgba(255, 107, 53, 0.3);\n                }\n\n                .streak-icon {\n                    font-size: 2rem;\n                    animation: flicker 1.5s ease-in-out infinite;\n                }\n\n                @keyframes flicker {\n                    0%, 100% { opacity: 1; transform: scale(1); }\n                    50% { opacity: 0.8; transform: scale(1.1); }\n                }\n\n                .streak-info {\n                    text-align: left;\n                }\n\n                .streak-number {\n                    font-size: 1.5rem;\n                    font-weight: 700;\n                    color: #FF6B35;\n                }\n\n                .streak-label {\n                    font-size: 0.75rem;\n                    color: rgba(255, 255, 255, 0.7);\n                    text-transform: uppercase;\n                    letter-spacing: 0.5px;\n                }\n\n                .xp-progress-section {\n                    margin-bottom: 1.5rem;\n                }\n\n                .xp-label {\n                    display: flex;\n                    justify-content: space-between;\n                    margin-bottom: 0.5rem;\n                    font-size: 0.9rem;\n                    color: rgba(255, 255, 255, 0.8);\n                }\n\n                .xp-bar {\n                    height: 12px;\n                    background: rgba(255, 255, 255, 0.1);\n                    border-radius: 10px;\n                    overflow: hidden;\n                    position: relative;\n                }\n\n                .xp-fill {\n                    height: 100%;\n                    background: linear-gradient(90deg, #8B5CF6, #D4AF37);\n                    border-radius: 10px;\n                    transition: width 0.5s ease-out;\n                    position: relative;\n                    overflow: hidden;\n                }\n\n                .xp-shimmer {\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(\n                        90deg,\n                        transparent,\n                        rgba(255, 255, 255, 0.3),\n                        transparent\n                    );\n                    animation: shimmer 2s infinite;\n                }\n\n                @keyframes shimmer {\n                    to { left: 100%; }\n                }\n\n                .xp-next-level {\n                    text-align: center;\n                    margin-top: 0.5rem;\n                    font-size: 0.85rem;\n                    color: rgba(255, 255, 255, 0.6);\n                }\n\n                .section-progress {\n                    background: rgba(255, 255, 255, 0.05);\n                    padding: 1rem;\n                    border-radius: 12px;\n                    margin-bottom: 1rem;\n                }\n\n                .section-progress-title {\n                    font-size: 0.9rem;\n                    color: #D4AF37;\n                    margin-bottom: 0.75rem;\n                    font-weight: 600;\n                }\n\n                .section-stats {\n                    display: grid;\n                    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n                    gap: 0.75rem;\n                }\n\n                .section-stat {\n                    text-align: center;\n                }\n\n                .section-stat-value {\n                    font-size: 1.3rem;\n                    font-weight: 700;\n                    color: #8B5CF6;\n                }\n\n                .section-stat-label {\n                    font-size: 0.75rem;\n                    color: rgba(255, 255, 255, 0.6);\n                }\n\n                .recent-achievements {\n                    background: rgba(255, 255, 255, 0.05);\n                    padding: 1rem;\n                    border-radius: 12px;\n                    margin-bottom: 1rem;\n                }\n\n                .achievements-title {\n                    font-size: 0.9rem;\n                    color: #D4AF37;\n                    margin-bottom: 0.75rem;\n                    font-weight: 600;\n                    display: flex;\n                    align-items: center;\n                    gap: 0.5rem;\n                }\n\n                .achievement-badges {\n                    display: flex;\n                    gap: 0.5rem;\n                    flex-wrap: wrap;\n                }\n\n                .achievement-badge {\n                    background: rgba(212, 175, 55, 0.2);\n                    border: 1px solid rgba(212, 175, 55, 0.4);\n                    padding: 0.5rem 1rem;\n                    border-radius: 20px;\n                    font-size: 0.85rem;\n                    display: flex;\n                    align-items: center;\n                    gap: 0.5rem;\n                    cursor: help;\n                }\n\n                .quick-stats {\n                    display: grid;\n                    grid-template-columns: repeat(4, 1fr);\n                    gap: 1rem;\n                    margin-bottom: 1.5rem;\n                }\n\n                .stat-item {\n                    text-align: center;\n                    padding: 0.75rem;\n                    background: rgba(255, 255, 255, 0.05);\n                    border-radius: 12px;\n                    transition: all 0.3s ease;\n                }\n\n                .stat-item:hover {\n                    background: rgba(255, 255, 255, 0.1);\n                    transform: translateY(-2px);\n                }\n\n                .stat-icon {\n                    font-size: 1.5rem;\n                    display: block;\n                    margin-bottom: 0.25rem;\n                }\n\n                .stat-value {\n                    font-size: 1.2rem;\n                    font-weight: 700;\n                    color: #D4AF37;\n                }\n\n                .view-progress-btn {\n                    width: 100%;\n                    padding: 1rem;\n                    background: linear-gradient(135deg, #8B5CF6, #D4AF37);\n                    border: none;\n                    border-radius: 12px;\n                    color: white;\n                    font-weight: 600;\n                    cursor: pointer;\n                    transition: all 0.3s ease;\n                    font-size: 1rem;\n                }\n\n                .view-progress-btn:hover {\n                    transform: translateY(-2px);\n                    box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);\n                }\n\n                @media (max-width: 768px) {\n                    .progress-widget-header {\n                        flex-direction: column;\n                        align-items: stretch;\n                    }\n\n                    .streak-badge {\n                        justify-content: center;\n                    }\n\n                    .quick-stats {\n                        grid-template-columns: repeat(2, 1fr);\n                    }\n                }\n            </style>\n        `}getSectionProgressHTML(n){return`\n            <div class="section-progress">\n                <div class="section-progress-title">üìä This Section</div>\n                <div class="section-stats">\n                    <div class="section-stat">\n                        <div class="section-stat-value">${n.visits}</div>\n                        <div class="section-stat-label">Visits</div>\n                    </div>\n                    <div class="section-stat">\n                        <div class="section-stat-value">${n.xp}</div>\n                        <div class="section-stat-label">XP Earned</div>\n                    </div>\n                    <div class="section-stat">\n                        <div class="section-stat-value">${n.activities.length}</div>\n                        <div class="section-stat-label">Activities</div>\n                    </div>\n                </div>\n            </div>\n        `}getAchievementsHTML(n){const e=progressSystem.getAchievementDefinitions();return`\n            <div class="recent-achievements">\n                <div class="achievements-title">\n                    <span>üèÜ</span>\n                    <span>Recent Achievements</span>\n                </div>\n                <div class="achievement-badges">\n                    ${n.map(n=>{const t=e.find(e=>e.id===n.id);return t?`\n                <div class="achievement-badge" title="${t.description}">\n                    <span>${t.icon}</span>\n                    <span>${t.name}</span>\n                </div>\n            `:""}).join("")}\n                </div>\n            </div>\n        `}getLoadingHTML(){return'\n            <div class="divine-progress-widget" style="text-align: center; padding: 2rem;">\n                <div style="font-size: 2rem; margin-bottom: 1rem;">‚ú®</div>\n                <div>Loading your progress...</div>\n            </div>\n        '}attachEventListeners(){}showLevelUpCelebration(n){const e=document.createElement("div");e.className="level-up-celebration",e.innerHTML=`\n            <div class="celebration-content">\n                <div class="celebration-icon">üéâ</div>\n                <div class="celebration-title">LEVEL UP!</div>\n                <div class="celebration-level">Level ${n.newLevel}</div>\n                <div class="celebration-rank">${n.rank}</div>\n            </div>\n            <style>\n                .level-up-celebration {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0, 0, 0, 0.9);\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    z-index: 999999;\n                    animation: fadeIn 0.3s ease;\n                }\n\n                .celebration-content {\n                    text-align: center;\n                    animation: zoomIn 0.5s ease;\n                }\n\n                .celebration-icon {\n                    font-size: 5rem;\n                    margin-bottom: 1rem;\n                    animation: bounce 1s ease infinite;\n                }\n\n                .celebration-title {\n                    font-size: 3rem;\n                    font-weight: 700;\n                    background: linear-gradient(135deg, #D4AF37, #FFD700);\n                    -webkit-background-clip: text;\n                    background-clip: text;\n                    -webkit-text-fill-color: transparent;\n                    margin-bottom: 1rem;\n                }\n\n                .celebration-level {\n                    font-size: 4rem;\n                    font-weight: 700;\n                    color: #D4AF37;\n                    margin-bottom: 0.5rem;\n                }\n\n                .celebration-rank {\n                    font-size: 2rem;\n                    color: #8B5CF6;\n                }\n\n                @keyframes fadeIn {\n                    from { opacity: 0; }\n                    to { opacity: 1; }\n                }\n\n                @keyframes zoomIn {\n                    from { transform: scale(0.5); opacity: 0; }\n                    to { transform: scale(1); opacity: 1; }\n                }\n\n                @keyframes bounce {\n                    0%, 100% { transform: translateY(0); }\n                    50% { transform: translateY(-20px); }\n                }\n            </style>\n        `,document.body.appendChild(e),this.createParticleExplosion(e),window.divineAudio&&(divineAudio.playBell(528,3),setTimeout(()=>divineAudio.playBell(639,3),500),setTimeout(()=>divineAudio.playBell(741,3),1e3)),setTimeout(()=>{e.style.animation="fadeOut 0.5s ease",setTimeout(()=>e.remove(),500)},4e3)}showAchievementPopup(n){const e=document.createElement("div");e.className="achievement-popup",e.innerHTML=`\n            <div class="achievement-popup-content">\n                <div class="achievement-popup-icon">${n.icon}</div>\n                <div class="achievement-popup-title">Achievement Unlocked!</div>\n                <div class="achievement-popup-name">${n.name}</div>\n                <div class="achievement-popup-desc">${n.description}</div>\n                <div class="achievement-popup-xp">+${n.xp} XP</div>\n            </div>\n            <style>\n                .achievement-popup {\n                    position: fixed;\n                    top: 2rem;\n                    right: 2rem;\n                    background: linear-gradient(135deg, rgba(212, 175, 55, 0.95), rgba(255, 215, 0, 0.95));\n                    backdrop-filter: blur(20px);\n                    border-radius: 20px;\n                    padding: 1.5rem;\n                    box-shadow: 0 10px 40px rgba(212, 175, 55, 0.5);\n                    z-index: 99999;\n                    animation: slideInRight 0.5s ease;\n                    max-width: 350px;\n                }\n\n                .achievement-popup-content {\n                    text-align: center;\n                    color: #0F0F23;\n                }\n\n                .achievement-popup-icon {\n                    font-size: 3rem;\n                    margin-bottom: 0.5rem;\n                }\n\n                .achievement-popup-title {\n                    font-size: 0.9rem;\n                    font-weight: 600;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                    margin-bottom: 0.5rem;\n                }\n\n                .achievement-popup-name {\n                    font-size: 1.5rem;\n                    font-weight: 700;\n                    margin-bottom: 0.5rem;\n                }\n\n                .achievement-popup-desc {\n                    font-size: 0.9rem;\n                    opacity: 0.8;\n                    margin-bottom: 0.75rem;\n                }\n\n                .achievement-popup-xp {\n                    font-size: 1.2rem;\n                    font-weight: 700;\n                    color: #8B5CF6;\n                }\n\n                @keyframes slideInRight {\n                    from {\n                        transform: translateX(400px);\n                        opacity: 0;\n                    }\n                    to {\n                        transform: translateX(0);\n                        opacity: 1;\n                    }\n                }\n            </style>\n        `,document.body.appendChild(e),window.divineAudio&&divineAudio.playBell(639,2),setTimeout(()=>{e.style.animation="slideOutRight 0.5s ease",setTimeout(()=>e.remove(),500)},5e3)}createParticleExplosion(n){const e=["#D4AF37","#FFD700","#8B5CF6","#4fc3f7","#66bb6a","#ff6b6b"],t=["‚ú®","üåü","‚≠ê","üí´","‚ú¥Ô∏è","üîÜ"];for(let i=0;i<50;i++){const s=document.createElement("div"),a=Math.random()>.5;s.style.position="fixed",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.style.pointerEvents="none",s.style.zIndex="999998",a?(s.textContent=t[Math.floor(Math.random()*t.length)],s.style.fontSize=20*Math.random()+15+"px"):(s.style.width=8*Math.random()+4+"px",s.style.height=s.style.width,s.style.backgroundColor=e[Math.floor(Math.random()*e.length)],s.style.borderRadius="50%");const r=2*Math.PI*i/50,o=300*Math.random()+200,d=Math.cos(r)*o,l=Math.sin(r)*o;s.animate([{transform:"translate(-50%, -50%) scale(1)",opacity:1},{transform:`translate(calc(-50% + ${d}px), calc(-50% + ${l}px)) scale(0)`,opacity:0}],{duration:1e3*Math.random()+1500,easing:"cubic-bezier(0, .9, .57, 1)",fill:"forwards"}),n.appendChild(s),setTimeout(()=>s.remove(),2500)}}openProgressDashboard(){alert("Full Progress Dashboard coming soon! üìä")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.divineProgressWidget=new DivineProgressWidget}):window.divineProgressWidget=new DivineProgressWidget,console.log("‚ú® Divine Progress Widget loaded");