class PerformanceOptimizer{constructor(){this.isLowPowerMode=this.detectLowPowerMode(),this.isMobile=this.detectMobileDevice(),this.connection=this.getConnectionInfo(),this.observers=new Map,this.animationFrames=new Map,this.timeouts=new Map,this.intervals=new Map,this.init()}init(){this.setupIntersectionObserver(),this.setupPerformanceMonitoring(),this.optimizeAnimations(),this.setupMemoryManagement(),console.log("üöÄ Performance Optimizer initialized"),console.log("üì± Device: "+(this.isMobile?"Mobile":"Desktop")),console.log("‚ö° Low Power: "+(this.isLowPowerMode?"Yes":"No")),console.log(`üåê Connection: ${this.connection.effectiveType||"Unknown"}`)}detectMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}detectLowPowerMode(){const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches,t=navigator.deviceMemory&&navigator.deviceMemory<4,o=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4;return e||t||o}getConnectionInfo(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection||{}}setupIntersectionObserver(){"IntersectionObserver"in window?(this.imageObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;this.loadImage(t),this.imageObserver.unobserve(t)}})},{rootMargin:"50px 0px",threshold:.01}),this.sectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;this.loadSection(t),this.sectionObserver.unobserve(t)}})},{rootMargin:"100px 0px",threshold:.1}),this.animationObserver=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target;e.isIntersecting?this.enableAnimations(t):this.pauseAnimations(t)})},{threshold:.1})):console.warn("IntersectionObserver not supported - falling back to immediate loading")}lazyLoadImages(e=document){e.querySelectorAll("img[data-src], [data-background]").forEach(e=>{this.imageObserver?this.imageObserver.observe(e):this.loadImage(e)})}loadImage(e){const t=e.dataset.src,o=e.dataset.background;if(t){const o=new Image;o.onload=()=>{e.src=t,e.classList.add("loaded"),e.removeAttribute("data-src")},o.onerror=()=>{e.classList.add("error"),console.warn("Failed to load image:",t)},o.src=t}o&&(e.style.backgroundImage=`url(${o})`,e.classList.add("loaded"),e.removeAttribute("data-background"))}lazyLoadSections(e=document){e.querySelectorAll(".lazy-section, [data-lazy]").forEach(e=>{this.sectionObserver?this.sectionObserver.observe(e):this.loadSection(e)})}loadSection(e){const t=e.dataset.loadFunction,o=e.dataset.lazyContent;if(t&&window[t])try{window[t](),e.classList.add("loaded")}catch(e){console.error("Failed to load section:",e)}o&&this.loadLazyContent(e,o),e.classList.add("loaded"),e.removeAttribute("data-lazy")}loadLazyContent(e,t){switch(t){case"oracle-cards":this.loadOracleCards(e);break;case"video-grid":this.loadVideoGrid(e);break;case"geometry-patterns":this.loadGeometryPatterns(e);break;default:console.log("Loading generic lazy content")}}optimizeAnimations(){this.isLowPowerMode&&(document.documentElement.style.setProperty("--animation-duration","0.01s"),document.documentElement.style.setProperty("--transition-duration","0.01s")),this.isMobile&&document.documentElement.style.setProperty("--animation-complexity","simple")}enableAnimations(e){this.isLowPowerMode||(e.style.willChange="transform, opacity",e.classList.add("animations-enabled"))}pauseAnimations(e){e.style.willChange="auto",e.classList.remove("animations-enabled");(e.getAnimations?e.getAnimations():[]).forEach(e=>{"running"===e.playState&&e.pause()})}smoothAnimation(e,t=1e3,o=null){if(this.isLowPowerMode)return void e(1);const i=performance.now(),a=Math.random().toString(36).substr(2,9),n=r=>{const s=r-i,c=Math.min(s/t,1),l=this.easeOutCubic(c);e(l),c<1?this.animationFrames.set(a,requestAnimationFrame(n)):(this.animationFrames.delete(a),o&&(o.style.willChange="auto"))};return o&&(o.style.willChange="transform, opacity"),this.animationFrames.set(a,requestAnimationFrame(n)),a}easeOutCubic(e){return 1-Math.pow(1-e,3)}cancelAnimation(e){const t=this.animationFrames.get(e);t&&(cancelAnimationFrame(t),this.animationFrames.delete(e))}setupMemoryManagement(){window.addEventListener("beforeunload",()=>{this.cleanup()}),"memory"in performance&&this.monitorMemory(),this.setupPeriodicCleanup()}cleanup(){this.animationFrames.forEach(e=>{cancelAnimationFrame(e)}),this.animationFrames.clear(),this.timeouts.forEach(e=>{clearTimeout(e)}),this.timeouts.clear(),this.intervals.forEach(e=>{clearInterval(e)}),this.intervals.clear(),this.imageObserver&&this.imageObserver.disconnect(),this.sectionObserver&&this.sectionObserver.disconnect(),this.animationObserver&&this.animationObserver.disconnect(),console.log("üßπ Performance Optimizer cleaned up")}monitorMemory(){setInterval(()=>{const e=performance.memory,t=e.usedJSHeapSize/e.jsHeapSizeLimit;t>.8&&(console.warn("üö® High memory usage detected:",t.toFixed(2)),this.triggerMemoryOptimization())},3e4)}triggerMemoryOptimization(){window.gc&&window.gc(),this.clearCaches(),document.documentElement.style.setProperty("--animation-complexity","minimal")}clearCaches(){const e=Date.now();for(let t=localStorage.length-1;t>=0;t--){const o=localStorage.key(t);if(o&&o.startsWith("cache_"))try{const t=JSON.parse(localStorage.getItem(o));t.timestamp&&e-t.timestamp>864e5&&localStorage.removeItem(o)}catch(e){localStorage.removeItem(o)}}}setupPeriodicCleanup(){const e=setInterval(()=>{this.clearCaches();document.querySelectorAll(".inactive, .hidden").forEach(e=>{"true"===e.dataset.cleanup&&e.remove()})},3e5);this.intervals.set("cleanup",e)}setupPerformanceMonitoring(){window.addEventListener("load",()=>{const e=performance.timing.loadEventEnd-performance.timing.navigationStart;console.log(`‚è±Ô∏è Page load time: ${e}ms`),e>3e3&&(console.warn("üêå Slow page load detected"),this.optimizeForSlowLoad())}),this.monitorFrameRate()}monitorFrameRate(){let e=performance.now(),t=0;const o=()=>{t++;const i=performance.now();if(i-e>=1e3){const o=Math.round(1e3*t/(i-e));o<30&&(console.warn(`üéØ Low FPS detected: ${o}`),this.optimizeForLowFPS()),t=0,e=i}requestAnimationFrame(o)};requestAnimationFrame(o)}optimizeForSlowLoad(){document.documentElement.style.setProperty("--animation-duration","0.2s"),this.prioritizeCriticalContent()}optimizeForLowFPS(){document.documentElement.style.setProperty("--animation-duration","0.5s"),document.documentElement.style.setProperty("--animation-complexity","minimal"),this.pauseNonCriticalAnimations()}prioritizeCriticalContent(){document.querySelectorAll(".critical, .above-fold").forEach(e=>{e.style.willChange="auto"})}pauseNonCriticalAnimations(){document.querySelectorAll(".decorative, .background-animation").forEach(e=>{e.style.animationPlayState="paused"})}loadOracleCards(e){const t=e.querySelector(".cards-grid");if(!t)return;const o=this.isMobile?12:24,i=t.querySelectorAll(".card");for(let e=0;e<i.length;e+=o){const t=Array.from(i).slice(e,e+o);setTimeout(()=>{t.forEach(e=>{e.classList.add("loaded")})},50*e)}}loadVideoGrid(e){e.querySelectorAll(".video-card").forEach((e,t)=>{setTimeout(()=>{e.classList.add("loaded"),this.lazyLoadImages(e)},100*t)})}loadGeometryPatterns(e){e.querySelectorAll(".pattern").forEach(e=>{this.isLowPowerMode?e.classList.add("simplified"):e.classList.add("full-detail")})}debounce(e,t){let o;return function(...i){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),e(...i)},t)}}throttle(e,t){let o;return function(){const i=arguments,a=this;o||(e.apply(a,i),o=!0,setTimeout(()=>o=!1,t))}}managedTimeout(e,t){const o=setTimeout(e,t);return this.timeouts.set(o,o),o}managedInterval(e,t){const o=setInterval(e,t);return this.intervals.set(o,o),o}clearManagedTimeout(e){clearTimeout(e),this.timeouts.delete(e)}clearManagedInterval(e){clearInterval(e),this.intervals.delete(e)}getPerformanceMetrics(){return{isMobile:this.isMobile,isLowPowerMode:this.isLowPowerMode,connection:this.connection,activeAnimations:this.animationFrames.size,activeTimeouts:this.timeouts.size,activeIntervals:this.intervals.size,memoryUsage:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:null}}optimizeElement(e,t={}){const{lazyLoad:o=!0,enableAnimations:i=!0,preload:a=!1}=t;o&&!a&&(e.dataset.lazy="true",this.lazyLoadSections(e.parentNode)),i&&this.animationObserver&&this.animationObserver.observe(e),this.lazyLoadImages(e)}optimizeCriticalSection(e){const t=document.getElementById(e);t&&(this.loadSection(t),this.lazyLoadImages(t),this.isLowPowerMode&&t.classList.add("low-power-mode"),this.isMobile&&t.classList.add("mobile-optimized"))}}window.PerformanceOptimizer=PerformanceOptimizer,window.performanceOptimizer||(window.performanceOptimizer=new PerformanceOptimizer),console.log("üöÄ Performance Optimizer loaded");