class DivineAudioEngine{constructor(){this.context=null,this.masterGain=null,this.activeSources=new Map,this.isInitialized=!1,this.FADE_TIME=.5,this.DEFAULT_VOLUME=.3,console.log("ðŸŽµ Divine Audio Engine created")}init(){if(!this.isInitialized)try{this.context=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.context.createGain(),this.masterGain.gain.value=this.DEFAULT_VOLUME,this.masterGain.connect(this.context.destination),this.isInitialized=!0,console.log("âœ… Divine Audio Engine initialized")}catch(t){console.error("âŒ Failed to initialize audio:",t)}}playSolfeggio(t,e="solfeggio",i=0){this.init(),this.stop(e);const n=[],a=[],s=this.context.createOscillator();s.type="sine",s.frequency.setValueAtTime(t,this.context.currentTime);const c=this.context.createGain();c.gain.setValueAtTime(0,this.context.currentTime),c.gain.linearRampToValueAtTime(.4,this.context.currentTime+this.FADE_TIME),s.connect(c),c.connect(this.masterGain),n.push(s),a.push(c);const o=this.context.createOscillator();o.type="sine",o.frequency.setValueAtTime(2*t,this.context.currentTime);const r=this.context.createGain();r.gain.setValueAtTime(0,this.context.currentTime),r.gain.linearRampToValueAtTime(.15,this.context.currentTime+this.FADE_TIME),o.connect(r),r.connect(this.masterGain),n.push(o),a.push(r);const l=this.context.createOscillator();l.type="sine",l.frequency.setValueAtTime(1.5*t,this.context.currentTime);const u=this.context.createGain();u.gain.setValueAtTime(0,this.context.currentTime),u.gain.linearRampToValueAtTime(.1,this.context.currentTime+this.FADE_TIME),l.connect(u),u.connect(this.masterGain),n.push(l),a.push(u);const h=this.context.createOscillator();h.type="sine",h.frequency.setValueAtTime(t/2,this.context.currentTime);const m=this.context.createGain();return m.gain.setValueAtTime(0,this.context.currentTime),m.gain.linearRampToValueAtTime(.2,this.context.currentTime+this.FADE_TIME),h.connect(m),m.connect(this.masterGain),n.push(h),a.push(m),n.forEach(t=>t.start()),i>0&&setTimeout(()=>this.stop(e),1e3*i),this.activeSources.set(e,{oscillators:n,gains:a}),e}playBinauralBeat(t,e,i="binaural"){this.init(),this.stop(i);const n=this.context.createOscillator(),a=this.context.createOscillator(),s=this.context.createGain(),c=this.context.createGain(),o=this.context.createStereoPanner(),r=this.context.createStereoPanner();return n.type="sine",n.frequency.setValueAtTime(t,this.context.currentTime),o.pan.value=-1,a.type="sine",a.frequency.setValueAtTime(t+e,this.context.currentTime),r.pan.value=1,s.gain.setValueAtTime(0,this.context.currentTime),s.gain.linearRampToValueAtTime(.3,this.context.currentTime+this.FADE_TIME),c.gain.setValueAtTime(0,this.context.currentTime),c.gain.linearRampToValueAtTime(.3,this.context.currentTime+this.FADE_TIME),n.connect(s),s.connect(o),o.connect(this.masterGain),a.connect(c),c.connect(r),r.connect(this.masterGain),n.start(),a.start(),this.activeSources.set(i,{oscillators:[n,a],gains:[s,c]}),i}playChakraFrequency(t,e=null){const i={root:396,sacral:417,solar:528,heart:639,throat:741,"third-eye":852,crown:963}[t.toLowerCase()];return i?this.playSolfeggio(i,e||`chakra-${t}`):(console.error("Unknown chakra:",t),null)}playAmbientSound(t="ocean",e="ambient"){this.init(),this.stop(e);const i=2*this.context.sampleRate,n=this.context.createBuffer(1,i,this.context.sampleRate),a=n.getChannelData(0);for(let t=0;t<i;t++)a[t]=2*Math.random()-1;const s=this.context.createBufferSource();s.buffer=n,s.loop=!0;const c=this.context.createBiquadFilter();switch(t){case"ocean":c.type="lowpass",c.frequency.value=500,c.Q.value=.5;break;case"rain":c.type="bandpass",c.frequency.value=1e3,c.Q.value=2;break;case"wind":c.type="highpass",c.frequency.value=800,c.Q.value=.3;break;case"forest":c.type="bandpass",c.frequency.value=600,c.Q.value=1}const o=this.context.createGain();return o.gain.setValueAtTime(0,this.context.currentTime),o.gain.linearRampToValueAtTime(.2,this.context.currentTime+2*this.FADE_TIME),s.connect(c),c.connect(o),o.connect(this.masterGain),s.start(),this.activeSources.set(e,{oscillators:[s],gains:[o]}),e}playBell(t=528,e=3,i=null){this.init();const n=i||`bell-${Date.now()}`,a=this.context.createOscillator();a.type="sine",a.frequency.setValueAtTime(t,this.context.currentTime);const s=this.context.createGain();return s.gain.setValueAtTime(0,this.context.currentTime),s.gain.linearRampToValueAtTime(.6,this.context.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+e),a.connect(s),s.connect(this.masterGain),a.start(),a.stop(this.context.currentTime+e),n}playIntervalBells(t=[60,120,180]){t.forEach(t=>{setTimeout(()=>this.playBell(528,2),1e3*t)})}playOm(t="om"){return this.playSolfeggio(136.1,t)}stop(t){if(!this.activeSources.has(t))return;const{oscillators:e,gains:i}=this.activeSources.get(t),n=this.FADE_TIME;i.forEach(t=>{t.gain.linearRampToValueAtTime(0,this.context.currentTime+n)}),setTimeout(()=>{e.forEach(t=>{try{t.stop()}catch(t){}}),this.activeSources.delete(t)},1e3*n)}stopAll(){Array.from(this.activeSources.keys()).forEach(t=>this.stop(t))}setVolume(t){if(!this.masterGain)return;const e=Math.max(0,Math.min(1,t));this.masterGain.gain.linearRampToValueAtTime(e,this.context.currentTime+.1)}getVolume(){return this.masterGain?this.masterGain.gain.value:this.DEFAULT_VOLUME}isPlaying(t){return this.activeSources.has(t)}getActiveSounds(){return Array.from(this.activeSources.keys())}playMeditationPreset(t="peaceful"){const e={peaceful:()=>{this.playBinauralBeat(200,8,"binaural"),this.playAmbientSound("ocean","ambient")},deep:()=>{this.playBinauralBeat(200,4,"binaural"),this.playAmbientSound("rain","ambient")},focused:()=>{this.playBinauralBeat(200,14,"binaural"),this.playAmbientSound("forest","ambient")},heart:()=>{this.playChakraFrequency("heart","chakra"),this.playAmbientSound("wind","ambient")},sacred:()=>{this.playOm("om"),setTimeout(()=>this.playBell(528,3),5e3)}}[t];e?e():console.error("Unknown preset:",t)}async resume(){this.context&&"suspended"===this.context.state&&(await this.context.resume(),console.log("ðŸŽµ Audio context resumed"))}getState(){return this.context?this.context.state:"not-initialized"}}window.divineAudio=new DivineAudioEngine,document.addEventListener("click",()=>{window.divineAudio.resume()},{once:!0}),document.addEventListener("touchstart",()=>{window.divineAudio.resume()},{once:!0}),console.log("âœ¨ Divine Audio Engine loaded and ready");