class IntegrationsSystem{constructor(){this.connectedServices=this.loadConnectedServices(),this.apiKeys={spotify:{clientId:"YOUR_SPOTIFY_CLIENT_ID",redirectUri:window.location.origin+"/callback/spotify"},google:{clientId:"YOUR_GOOGLE_CLIENT_ID",redirectUri:window.location.origin+"/callback/google",apiKey:"YOUR_GOOGLE_API_KEY"},youtube:{apiKey:"YOUR_YOUTUBE_API_KEY"}},this.init()}init(){console.log("ðŸ”— Integrations System initialized"),this.handleOAuthCallback()}loadConnectedServices(){const n=localStorage.getItem("connected_services");return n?JSON.parse(n):{}}saveConnectedServices(){localStorage.setItem("connected_services",JSON.stringify(this.connectedServices))}isConnected(n){return this.connectedServices[n]&&this.connectedServices[n].connected}async connectSpotify(){const n=`https://accounts.spotify.com/authorize?client_id=${this.apiKeys.spotify.clientId}&response_type=token&redirect_uri=${encodeURIComponent(this.apiKeys.spotify.redirectUri)}&scope=${encodeURIComponent(["user-read-private","user-read-email","playlist-modify-public","playlist-modify-private","user-library-modify","user-library-read"].join(" "))}`;window.location.href=n}handleSpotifyCallback(n){return this.connectedServices.spotify={connected:!0,accessToken:n,connectedAt:(new Date).toISOString()},this.saveConnectedServices(),window.progressSystem&&window.progressSystem.awardXP(30,"Connected Spotify! ðŸŽµ","integrations"),{success:!0,message:"Spotify connected!"}}async createSpotifyPlaylist(n,e,t=[]){if(!this.isConnected("spotify"))return{success:!1,message:"Spotify not connected"};try{const i=this.connectedServices.spotify.accessToken,o=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${i}`}}),s=await o.json(),a=await fetch(`https://api.spotify.com/v1/users/${s.id}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:e,public:!1})}),c=await a.json();return t.length>0&&await fetch(`https://api.spotify.com/v1/playlists/${c.id}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({uris:t})}),window.progressSystem&&window.progressSystem.awardXP(25,`Created Spotify playlist: ${n}`,"integrations"),{success:!0,message:"Playlist created!",playlist:c}}catch(n){return console.error("Error creating Spotify playlist:",n),{success:!1,message:"Failed to create playlist"}}}async searchSpotifyMusic(n,e="track",t=20){if(!this.isConnected("spotify"))return{success:!1,results:[]};try{const i=this.connectedServices.spotify.accessToken,o=await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(n)}&type=${e}&limit=${t}`,{headers:{Authorization:`Bearer ${i}`}});return{success:!0,results:(await o.json())[e+"s"].items}}catch(n){return console.error("Error searching Spotify:",n),{success:!1,results:[]}}}getSpiritualPlaylists(){return[{name:"Divine Temple Meditation",description:"Calming meditation music for your spiritual practice",tracks:["spotify:track:meditation1","spotify:track:meditation2"]},{name:"Chakra Healing",description:"Frequencies for chakra balancing and healing",tracks:["spotify:track:chakra1","spotify:track:chakra2"]},{name:"Sacred Mantras",description:"Powerful mantras for devotional practice",tracks:["spotify:track:mantra1","spotify:track:mantra2"]}]}async connectYouTube(){return this.connectGoogle("youtube")}async subscribeToYouTubeChannel(n){if(!this.isConnected("youtube"))return{success:!1,message:"YouTube not connected"};try{const e=this.connectedServices.google.accessToken,t=await fetch("https://www.googleapis.com/youtube/v3/subscriptions?part=snippet",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({snippet:{resourceId:{kind:"youtube#channel",channelId:n}}})}),i=await t.json();return window.progressSystem&&window.progressSystem.awardXP(15,"Subscribed to YouTube channel! ðŸ“º","integrations"),{success:!0,message:"Subscribed to channel!",data:i}}catch(n){return console.error("Error subscribing to YouTube channel:",n),{success:!1,message:"Failed to subscribe"}}}async searchYouTubeVideos(n,e=25){try{const t=await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(n)}&type=video&maxResults=${e}&key=${this.apiKeys.youtube.apiKey}`);return{success:!0,videos:(await t.json()).items}}catch(n){return console.error("Error searching YouTube:",n),{success:!1,videos:[]}}}async connectGoogle(n="calendar"){const e="calendar"===n?["https://www.googleapis.com/auth/calendar.events"]:["https://www.googleapis.com/auth/youtube.force-ssl"],t=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${this.apiKeys.google.clientId}&redirect_uri=${encodeURIComponent(this.apiKeys.google.redirectUri)}&response_type=token&scope=${encodeURIComponent(e.join(" "))}`;window.location.href=t}handleGoogleCallback(n){return this.connectedServices.google={connected:!0,accessToken:n,connectedAt:(new Date).toISOString()},this.connectedServices.youtube={connected:!0,accessToken:n,connectedAt:(new Date).toISOString()},this.connectedServices.calendar={connected:!0,accessToken:n,connectedAt:(new Date).toISOString()},this.saveConnectedServices(),window.progressSystem&&window.progressSystem.awardXP(30,"Connected Google Calendar! ðŸ“…","integrations"),{success:!0,message:"Google services connected!"}}async createCalendarEvent(n){if(!this.isConnected("calendar"))return{success:!1,message:"Google Calendar not connected"};try{const e=this.connectedServices.google.accessToken,t={summary:n.title,description:n.description||"",start:{dateTime:n.startTime,timeZone:n.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone},end:{dateTime:n.endTime,timeZone:n.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone},reminders:{useDefault:!1,overrides:[{method:"popup",minutes:15}]}},i=await fetch("https://www.googleapis.com/calendar/v3/calendars/primary/events",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await i.json();return window.progressSystem&&window.progressSystem.awardXP(15,"Scheduled spiritual practice! ðŸ“…","integrations"),{success:!0,message:"Event created in Google Calendar!",event:o}}catch(n){return console.error("Error creating calendar event:",n),{success:!1,message:"Failed to create event"}}}scheduleQuickPractice(n,e,t=30){const i={meditation:{title:"ðŸ§˜ Daily Meditation",description:"Take time for your meditation practice"},yoga:{title:"ðŸ•‰ï¸ Yoga Session",description:"Practice yoga for body and mind"},journaling:{title:"ðŸ“– Spiritual Journaling",description:"Reflect on your spiritual journey"},prayer:{title:"ðŸ™ Prayer & Devotion",description:"Connect with the divine through prayer"}},o=i[n]||i.meditation,s=new Date(e),a=new Date(s.getTime()+6e4*t);return this.createCalendarEvent({title:o.title,description:o.description,startTime:s.toISOString(),endTime:a.toISOString()})}handleOAuthCallback(){const n=window.location.hash.substring(1),e=new URLSearchParams(n),t=e.get("access_token"),i=e.get("state");t&&i&&(i.includes("spotify")?this.handleSpotifyCallback(t):i.includes("google")&&this.handleGoogleCallback(t),window.history.replaceState({},document.title,window.location.pathname))}disconnectService(n){return this.connectedServices[n]?(delete this.connectedServices[n],this.saveConnectedServices(),{success:!0,message:`${n} disconnected`}):{success:!1,message:"Service not connected"}}getConnectedServices(){return Object.keys(this.connectedServices).filter(n=>this.connectedServices[n].connected)}getIntegrationStats(){return{totalConnected:this.getConnectedServices().length,spotify:this.isConnected("spotify"),youtube:this.isConnected("youtube"),calendar:this.isConnected("calendar"),google:this.isConnected("google")}}openIntegrationsModal(){const n=document.createElement("div");n.className="integrations-modal",n.id="integrationsModal";const e=this.getIntegrationStats();n.innerHTML=`\n            <div class="integrations-modal-content">\n                <div class="integrations-modal-header">\n                    <h2>ðŸ”— Integrations</h2>\n                    <button onclick="document.getElementById('integrationsModal').remove()" class="modal-close">âœ•</button>\n                </div>\n\n                <div class="integrations-modal-body">\n                    <p class="integrations-intro">\n                        Connect your favorite services to enhance your spiritual practice\n                    </p>\n\n                    <div class="integrations-list">\n                        \x3c!-- Spotify --\x3e\n                        <div class="integration-card">\n                            <div class="integration-icon">ðŸŽµ</div>\n                            <div class="integration-info">\n                                <h3>Spotify</h3>\n                                <p>Create spiritual playlists and listen to meditation music</p>\n                            </div>\n                            <div class="integration-action">\n                                ${e.spotify?'\n                                    <span class="connected-badge">âœ“ Connected</span>\n                                    <button onclick="window.integrationsSystem.disconnectService(\'spotify\'); location.reload();" class="disconnect-btn">\n                                        Disconnect\n                                    </button>\n                                ':'\n                                    <button onclick="window.integrationsSystem.connectSpotify()" class="connect-btn">\n                                        Connect\n                                    </button>\n                                '}\n                            </div>\n                        </div>\n\n                        \x3c!-- YouTube --\x3e\n                        <div class="integration-card">\n                            <div class="integration-icon">ðŸ“º</div>\n                            <div class="integration-info">\n                                <h3>YouTube</h3>\n                                <p>Subscribe to spiritual channels and access guided videos</p>\n                            </div>\n                            <div class="integration-action">\n                                ${e.youtube?'\n                                    <span class="connected-badge">âœ“ Connected</span>\n                                    <button onclick="window.integrationsSystem.disconnectService(\'youtube\'); location.reload();" class="disconnect-btn">\n                                        Disconnect\n                                    </button>\n                                ':'\n                                    <button onclick="window.integrationsSystem.connectYouTube()" class="connect-btn">\n                                        Connect\n                                    </button>\n                                '}\n                            </div>\n                        </div>\n\n                        \x3c!-- Google Calendar --\x3e\n                        <div class="integration-card">\n                            <div class="integration-icon">ðŸ“…</div>\n                            <div class="integration-info">\n                                <h3>Google Calendar</h3>\n                                <p>Schedule your spiritual practices and get reminders</p>\n                            </div>\n                            <div class="integration-action">\n                                ${e.calendar?'\n                                    <span class="connected-badge">âœ“ Connected</span>\n                                    <button onclick="window.integrationsSystem.disconnectService(\'calendar\'); location.reload();" class="disconnect-btn">\n                                        Disconnect\n                                    </button>\n                                ':'\n                                    <button onclick="window.integrationsSystem.connectGoogle(\'calendar\')" class="connect-btn">\n                                        Connect\n                                    </button>\n                                '}\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="integrations-stats">\n                        <h4>ðŸ“Š Integration Stats</h4>\n                        <p><strong>${e.totalConnected}</strong> services connected</p>\n                    </div>\n                </div>\n            </div>\n        `,this.addIntegrationsStyles(),document.body.appendChild(n)}addIntegrationsStyles(){if(document.getElementById("integrationsStyles"))return;const n=document.createElement("style");n.id="integrationsStyles",n.textContent="\n            .integrations-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n                animation: fadeIn 0.3s ease;\n            }\n\n            .integrations-modal-content {\n                background: white;\n                border-radius: 20px;\n                width: 90%;\n                max-width: 700px;\n                max-height: 90vh;\n                overflow: hidden;\n                display: flex;\n                flex-direction: column;\n            }\n\n            .integrations-modal-header {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 25px 30px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n\n            .integrations-modal-header h2 {\n                margin: 0;\n            }\n\n            .modal-close {\n                background: rgba(255,255,255,0.2);\n                border: none;\n                color: white;\n                width: 32px;\n                height: 32px;\n                border-radius: 50%;\n                cursor: pointer;\n                font-size: 20px;\n            }\n\n            .integrations-modal-body {\n                flex: 1;\n                overflow-y: auto;\n                padding: 30px;\n            }\n\n            .integrations-intro {\n                text-align: center;\n                color: #666;\n                margin-bottom: 30px;\n            }\n\n            .integrations-list {\n                display: flex;\n                flex-direction: column;\n                gap: 20px;\n            }\n\n            .integration-card {\n                display: flex;\n                align-items: center;\n                gap: 20px;\n                padding: 20px;\n                background: #f9f9f9;\n                border-radius: 15px;\n                border: 2px solid #e0e0e0;\n                transition: all 0.2s;\n            }\n\n            .integration-card:hover {\n                border-color: #667eea;\n                background: #f9f9ff;\n            }\n\n            .integration-icon {\n                font-size: 48px;\n                flex-shrink: 0;\n            }\n\n            .integration-info {\n                flex: 1;\n            }\n\n            .integration-info h3 {\n                margin: 0 0 5px 0;\n                font-size: 18px;\n            }\n\n            .integration-info p {\n                margin: 0;\n                color: #666;\n                font-size: 14px;\n            }\n\n            .integration-action {\n                display: flex;\n                flex-direction: column;\n                align-items: flex-end;\n                gap: 10px;\n            }\n\n            .connected-badge {\n                color: #10b981;\n                font-weight: 600;\n                font-size: 14px;\n            }\n\n            .connect-btn, .disconnect-btn {\n                padding: 10px 24px;\n                border: none;\n                border-radius: 8px;\n                cursor: pointer;\n                font-weight: 600;\n                font-size: 14px;\n                transition: transform 0.2s;\n            }\n\n            .connect-btn {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n            }\n\n            .connect-btn:hover {\n                transform: translateY(-2px);\n            }\n\n            .disconnect-btn {\n                background: #f0f0f0;\n                color: #666;\n            }\n\n            .integrations-stats {\n                margin-top: 30px;\n                padding: 20px;\n                background: #f0f0f0;\n                border-radius: 12px;\n                text-align: center;\n            }\n\n            .integrations-stats h4 {\n                margin: 0 0 10px 0;\n            }\n\n            .integrations-stats p {\n                margin: 0;\n            }\n\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n        ",document.head.appendChild(n)}}"undefined"!=typeof window&&(window.integrationsSystem=new IntegrationsSystem,console.log("ðŸ”— Integrations System ready!"));