class PWAHandler{constructor(){this.deferredPrompt=null,this.isInstalled=!1,this.isOnline=navigator.onLine,this.init()}async init(){await this.registerServiceWorker(),this.setupInstallPrompt(),this.setupNetworkMonitoring(),this.checkPWAMode(),this.setupPWAUI()}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw-trivia.js",{scope:"/"});console.log("Service Worker registered successfully:",e),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})})}catch(e){console.error("Service Worker registration failed:",e)}}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.deferredPrompt=e,this.showInstallBanner()});const e=document.getElementById("installBtn");e&&e.addEventListener("click",()=>{this.installApp()});const t=document.getElementById("dismissInstall");t&&t.addEventListener("click",()=>{this.dismissInstallBanner()}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed successfully"),this.isInstalled=!0,this.hideInstallBanner(),this.showInstallSuccessMessage()})}setupNetworkMonitoring(){window.addEventListener("online",()=>{this.isOnline=!0,this.updateNetworkStatus()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.updateNetworkStatus()}),this.updateNetworkStatus()}checkPWAMode(){const e=window.matchMedia("(display-mode: standalone)").matches,t=(/iPad|iPhone|iPod/.test(navigator.userAgent),!0===window.navigator.standalone);(e||t)&&(document.body.classList.add("pwa-mode"),this.setupPWANavigation())}setupPWAUI(){this.createStatusIndicator(),this.createPWAHeader(),this.setupGestureNavigation()}showInstallBanner(){const e=document.getElementById("installBanner");e&&!this.isInstalled&&(e.style.display="block")}hideInstallBanner(){const e=document.getElementById("installBanner");e&&(e.style.display="none")}dismissInstallBanner(){this.hideInstallBanner(),localStorage.setItem("installBannerDismissed",Date.now().toString())}async installApp(){if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),this.deferredPrompt=null}updateNetworkStatus(){const e=document.getElementById("offlineIndicator"),t=document.querySelector(".pwa-status");this.isOnline?(e&&(e.style.display="none"),t&&(t.textContent="üü¢ Online",t.className="pwa-status online")):(e&&(e.style.display="block"),t&&(t.textContent="üî¥ Offline",t.className="pwa-status offline"))}createStatusIndicator(){if(document.querySelector(".pwa-status"))return;const e=document.createElement("div");e.className=this.isOnline?"pwa-status online":"pwa-status offline",e.textContent=this.isOnline?"üü¢ Online":"üî¥ Offline",document.body.appendChild(e)}createPWAHeader(){const e=document.createElement("div");e.className="pwa-header",e.innerHTML='\n            <div class="pwa-title">üß† Consciousness Trivia</div>\n            <div class="pwa-actions">\n                <button class="pwa-btn" id="syncBtn" title="Sync Progress">\n                    <span>üîÑ</span>\n                </button>\n                <button class="pwa-btn" id="settingsBtn" title="Settings">\n                    <span>‚öôÔ∏è</span>\n                </button>\n            </div>\n        ';const t=document.querySelector(".premium-container");t&&t.insertBefore(e,t.firstChild),document.getElementById("syncBtn")?.addEventListener("click",()=>{this.syncProgress()}),document.getElementById("settingsBtn")?.addEventListener("click",()=>{this.showSettings()})}setupPWANavigation(){let e=0,t=0;document.addEventListener("touchstart",n=>{e=n.touches[0].clientX,t=n.touches[0].clientY}),document.addEventListener("touchend",n=>{if(!n.changedTouches.length)return;const i=n.changedTouches[0].clientX,s=n.changedTouches[0].clientY-t;i-e>50&&Math.abs(s)<50&&window.premiumTrivia&&"function"==typeof window.premiumTrivia.showDashboard&&window.premiumTrivia.showDashboard()})}setupGestureNavigation(){let e=0,t=0,n=0;document.addEventListener("touchstart",t=>{0===window.scrollY&&(e=t.touches[0].clientY)}),document.addEventListener("touchmove",i=>{e&&0===window.scrollY&&(t=i.touches[0].clientY,n=t-e,n>0&&(i.preventDefault(),this.showPullToRefreshIndicator(n)))}),document.addEventListener("touchend",()=>{n>100&&this.triggerRefresh(),this.hidePullToRefreshIndicator(),e=0,n=0})}showPullToRefreshIndicator(e){let t=document.getElementById("pullRefreshIndicator");t||(t=document.createElement("div"),t.id="pullRefreshIndicator",t.style.cssText="\n                position: fixed;\n                top: -50px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: var(--glass-bg);\n                backdrop-filter: blur(20px);\n                border: 1px solid var(--glass-border);\n                border-radius: 25px;\n                padding: 1rem 2rem;\n                color: var(--primary-gold);\n                font-weight: 600;\n                z-index: 2000;\n                transition: all 0.3s ease;\n            ",document.body.appendChild(t));const n=Math.min(e/100,1);t.style.top=`${Math.max(.5*e-50,-50)}px`,t.textContent=n>=1?"üîÑ Release to refresh":"‚¨áÔ∏è Pull to refresh",t.style.opacity=Math.min(n,1)}hidePullToRefreshIndicator(){const e=document.getElementById("pullRefreshIndicator");e&&(e.style.top="-50px",e.style.opacity="0")}async triggerRefresh(){console.log("Refreshing trivia data..."),this.showRefreshingIndicator(),await new Promise(e=>setTimeout(e,1500)),window.premiumTrivia&&window.premiumTrivia.updateStats(),this.hideRefreshingIndicator()}showRefreshingIndicator(){let e=document.getElementById("pullRefreshIndicator");e&&(e.textContent="üîÑ Refreshing...",e.style.top="20px",e.style.opacity="1")}hideRefreshingIndicator(){setTimeout(()=>{const e=document.getElementById("pullRefreshIndicator");e&&(e.style.top="-50px",e.style.opacity="0")},1e3)}async syncProgress(){console.log("Syncing progress...");const e=document.getElementById("syncBtn");e&&(e.innerHTML="<span>‚è≥</span>",await new Promise(e=>setTimeout(e,2e3)),e.innerHTML="<span>‚úÖ</span>",setTimeout(()=>{e.innerHTML="<span>üîÑ</span>"},2e3))}showSettings(){console.log("Opening PWA settings..."),this.createSettingsModal()}createSettingsModal(){const e=document.getElementById("pwaSettingsModal");e&&e.remove();const t=document.createElement("div");t.id="pwaSettingsModal",t.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.9);\n            backdrop-filter: blur(10px);\n            z-index: 3000;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        ",t.innerHTML='\n            <div style="\n                background: var(--glass-bg);\n                backdrop-filter: blur(30px);\n                border: 2px solid var(--primary-gold);\n                border-radius: 25px;\n                padding: 2rem;\n                max-width: 400px;\n                width: 90%;\n                text-align: center;\n            ">\n                <h3 style="color: var(--primary-gold); margin-bottom: 1.5rem;">‚öôÔ∏è PWA Settings</h3>\n                \n                <div style="text-align: left; margin-bottom: 1.5rem;">\n                    <label style="display: flex; align-items: center; margin-bottom: 1rem; cursor: pointer;">\n                        <input type="checkbox" id="notifications" style="margin-right: 0.75rem;">\n                        <span>Enable daily reminders</span>\n                    </label>\n                    \n                    <label style="display: flex; align-items: center; margin-bottom: 1rem; cursor: pointer;">\n                        <input type="checkbox" id="offline" checked style="margin-right: 0.75rem;">\n                        <span>Enable offline mode</span>\n                    </label>\n                    \n                    <label style="display: flex; align-items: center; margin-bottom: 1rem; cursor: pointer;">\n                        <input type="checkbox" id="analytics" style="margin-right: 0.75rem;">\n                        <span>Share usage analytics</span>\n                    </label>\n                </div>\n                \n                <div style="display: flex; gap: 1rem; justify-content: center;">\n                    <button id="saveSettings" style="\n                        background: var(--gradient-primary);\n                        border: none;\n                        padding: 0.75rem 1.5rem;\n                        border-radius: 15px;\n                        color: white;\n                        font-weight: 600;\n                        cursor: pointer;\n                    ">Save</button>\n                    \n                    <button id="closeSettings" style="\n                        background: transparent;\n                        border: 1px solid var(--glass-border);\n                        padding: 0.75rem 1.5rem;\n                        border-radius: 15px;\n                        color: var(--text-primary);\n                        cursor: pointer;\n                    ">Cancel</button>\n                </div>\n            </div>\n        ',document.body.appendChild(t),document.getElementById("saveSettings").addEventListener("click",()=>{this.saveSettings(),t.remove()}),document.getElementById("closeSettings").addEventListener("click",()=>{t.remove()}),t.addEventListener("click",e=>{e.target===t&&t.remove()})}saveSettings(){const e={notifications:document.getElementById("notifications")?.checked||!1,offline:document.getElementById("offline")?.checked||!0,analytics:document.getElementById("analytics")?.checked||!1};localStorage.setItem("pwaSettings",JSON.stringify(e)),console.log("PWA settings saved:",e),e.notifications&&"Notification"in window&&Notification.requestPermission()}showUpdateNotification(){"Notification"in window&&"granted"===Notification.permission&&new Notification("Consciousness Trivia Updated!",{body:"New questions and features available. Restart the app to update.",icon:"/images/icons/icon-192.png",tag:"app-update"})}showInstallSuccessMessage(){const e=document.createElement("div");e.style.cssText="\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: var(--gradient-primary);\n            color: white;\n            padding: 1.5rem 2rem;\n            border-radius: 20px;\n            font-weight: 600;\n            z-index: 4000;\n            text-align: center;\n        ",e.innerHTML='\n            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéâ</div>\n            <div>Consciousness Trivia Installed!</div>\n            <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 0.5rem;">\n                Access it from your home screen\n            </div>\n        ',document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{window.pwaHandler=new PWAHandler}),window.PWAHandler=PWAHandler;