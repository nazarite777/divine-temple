class AudioContentSystem{constructor(){this.audioPlayer=null,this.currentTrack=null,this.playlist=[],this.playlistIndex=0,this.audioLibrary=this.loadAudioLibrary(),this.favorites=this.loadFavorites(),this.listeningHistory=this.loadHistory(),this.downloadedTracks=this.loadDownloaded(),this.currentCategory="all",this.isPlaying=!1,this.sleepTimer=null,this.init()}init(){console.log("ðŸŽ§ Audio Content System initialized"),this.setupAudioPlayer(),this.setupEventListeners()}setupAudioPlayer(){this.audioPlayer||(this.audioPlayer=new Audio,this.audioPlayer.preload="metadata",this.audioPlayer.addEventListener("ended",()=>this.handleTrackEnded()),this.audioPlayer.addEventListener("timeupdate",()=>this.handleTimeUpdate()),this.audioPlayer.addEventListener("loadedmetadata",()=>this.handleMetadataLoaded()),this.audioPlayer.addEventListener("error",t=>this.handleError(t)),this.audioPlayer.addEventListener("play",()=>this.isPlaying=!0),this.audioPlayer.addEventListener("pause",()=>this.isPlaying=!1))}setupEventListeners(){document.addEventListener("visibilitychange",()=>{document.hidden&&this.sleepTimer})}loadAudioLibrary(){return{podcasts:[{id:"podcast-1",title:"Awakening the Divine Within",description:"Discover your inner divinity through ancient wisdom teachings",duration:3600,category:"podcast",series:"Divine Wisdom",episode:1,author:"Master Sage",imageUrl:"/img/audio/podcast-1.jpg",audioUrl:"/audio/podcasts/awakening-divine.mp3",tags:["spirituality","wisdom","awakening"],releasedDate:"2024-01-15"},{id:"podcast-2",title:"The Path of Enlightenment",description:"Journey through the stages of spiritual enlightenment",duration:2700,category:"podcast",series:"Divine Wisdom",episode:2,author:"Master Sage",imageUrl:"/img/audio/podcast-2.jpg",audioUrl:"/audio/podcasts/path-enlightenment.mp3",tags:["enlightenment","spiritual path","awakening"],releasedDate:"2024-01-22"}],audiobooks:[{id:"audiobook-1",title:"The Bhagavad Gita",description:"Sacred Hindu scripture narrated with divine wisdom",duration:18e3,category:"audiobook",author:"Narrated by Divine Voice",imageUrl:"/img/audio/bhagavad-gita.jpg",audioUrl:"/audio/audiobooks/bhagavad-gita.mp3",tags:["sacred text","hinduism","wisdom"],chapters:18},{id:"audiobook-2",title:"The Power of Now",description:"A guide to spiritual enlightenment",duration:12600,category:"audiobook",author:"Eckhart Tolle",imageUrl:"/img/audio/power-of-now.jpg",audioUrl:"/audio/audiobooks/power-of-now.mp3",tags:["mindfulness","present moment","enlightenment"]}],meditations:[{id:"meditation-1",title:"Morning Awakening Meditation",description:"Start your day with divine energy and intention",duration:600,category:"meditation",type:"guided",difficulty:"beginner",guide:"Serene Voice",imageUrl:"/img/audio/morning-meditation.jpg",audioUrl:"/audio/meditations/morning-awakening.mp3",tags:["morning","energy","awakening"]},{id:"meditation-2",title:"Chakra Balancing Journey",description:"Align and balance all seven chakras",duration:1800,category:"meditation",type:"guided",difficulty:"intermediate",guide:"Master Healer",imageUrl:"/img/audio/chakra-balancing.jpg",audioUrl:"/audio/meditations/chakra-balancing.mp3",tags:["chakras","energy healing","balance"]},{id:"meditation-3",title:"Deep Spiritual Connection",description:"Connect with your higher self and divine guidance",duration:3600,category:"meditation",type:"guided",difficulty:"advanced",guide:"Spiritual Master",imageUrl:"/img/audio/deep-connection.jpg",audioUrl:"/audio/meditations/deep-connection.mp3",tags:["deep meditation","spiritual connection","higher self"]}],sleepStories:[{id:"sleep-1",title:"Journey to the Sacred Temple",description:"A peaceful journey to a mystical temple in the clouds",duration:2400,category:"sleep",narrator:"Soothing Voice",imageUrl:"/img/audio/sacred-temple.jpg",audioUrl:"/audio/sleep/sacred-temple.mp3",tags:["sleep","temple","peaceful"]},{id:"sleep-2",title:"The Crystal Cave of Dreams",description:"Drift into deep sleep in a magical crystal cave",duration:3e3,category:"sleep",narrator:"Dreamy Voice",imageUrl:"/img/audio/crystal-cave.jpg",audioUrl:"/audio/sleep/crystal-cave.mp3",tags:["sleep","crystals","dreams"]}],chants:[{id:"chant-1",title:"Om Mani Padme Hum",description:"Tibetan Buddhist mantra for compassion",duration:300,category:"chant",tradition:"Buddhism",imageUrl:"/img/audio/om-mani.jpg",audioUrl:"/audio/chants/om-mani-padme-hum.mp3",tags:["mantra","buddhism","compassion"],loopable:!0},{id:"chant-2",title:"Gayatri Mantra",description:"Ancient Vedic mantra for enlightenment",duration:420,category:"chant",tradition:"Hinduism",imageUrl:"/img/audio/gayatri.jpg",audioUrl:"/audio/chants/gayatri-mantra.mp3",tags:["mantra","hinduism","enlightenment"],loopable:!0}],binauralBeats:[{id:"binaural-1",title:"Deep Theta Meditation",description:"6 Hz theta waves for deep meditation",duration:1800,category:"binaural",frequency:"6 Hz",brainwaveState:"Theta",imageUrl:"/img/audio/theta-waves.jpg",audioUrl:"/audio/binaural/theta-meditation.mp3",tags:["binaural beats","theta","meditation"],loopable:!0},{id:"binaural-2",title:"Alpha Relaxation",description:"10 Hz alpha waves for relaxation and creativity",duration:1200,category:"binaural",frequency:"10 Hz",brainwaveState:"Alpha",imageUrl:"/img/audio/alpha-waves.jpg",audioUrl:"/audio/binaural/alpha-relaxation.mp3",tags:["binaural beats","alpha","relaxation"],loopable:!0}]}}getAllTracks(){const t=[];for(const e in this.audioLibrary)t.push(...this.audioLibrary[e]);return t}getTrackById(t){return this.getAllTracks().find(e=>e.id===t)}getTracksByCategory(t){return"all"===t?this.getAllTracks():this.audioLibrary[t]||[]}async playTrack(t){const e=this.getTrackById(t);if(!e)return console.error("Track not found:",t),{success:!1,message:"Track not found"};try{return this.currentTrack=e,this.audioPlayer.src=e.audioUrl,await this.audioPlayer.play(),this.addToHistory(e),this.updatePlayerUI(),window.progressSystem&&(window.progressSystem.awardXP(10,`Started listening: ${e.title}`,"audio"),window.progressSystem.logActivity("audio_started","audio",{trackId:e.id,title:e.title,category:e.category})),{success:!0,track:e}}catch(t){return console.error("Error playing track:",t),{success:!1,message:"Failed to play track"}}}pause(){this.audioPlayer&&this.audioPlayer.pause()}resume(){this.audioPlayer&&this.currentTrack&&this.audioPlayer.play()}stop(){this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.currentTrack=null,this.updatePlayerUI())}seek(t){this.audioPlayer&&(this.audioPlayer.currentTime=t)}setVolume(t){this.audioPlayer&&(this.audioPlayer.volume=Math.max(0,Math.min(1,t)))}setPlaybackSpeed(t){this.audioPlayer&&(this.audioPlayer.playbackRate=t,localStorage.setItem("audio_playback_speed",t))}getPlaybackSpeed(){return parseFloat(localStorage.getItem("audio_playback_speed")||"1.0")}handleTrackEnded(){if(this.currentTrack&&window.progressSystem){const t=this.calculateCompletionXP(this.currentTrack);window.progressSystem.awardXP(t,`Completed: ${this.currentTrack.title}`,"audio"),window.progressSystem.logActivity("audio_completed","audio",{trackId:this.currentTrack.id,duration:this.currentTrack.duration})}if(this.playlist.length>0&&this.playlistIndex<this.playlist.length-1){this.playlistIndex++;const t=this.playlist[this.playlistIndex];this.playTrack(t.id)}else this.currentTrack&&this.currentTrack.loopable?(this.audioPlayer.currentTime=0,this.audioPlayer.play()):this.stop()}calculateCompletionXP(t){let e=20;return t.duration>=3600?e+=50:t.duration>=1800?e+=30:t.duration>=600&&(e+=15),"meditation"===t.category&&(e+=20),"audiobook"===t.category&&(e+=25),"advanced"===t.difficulty&&(e+=15),e}handleTimeUpdate(){if(this.currentTrack){const t=this.audioPlayer.currentTime/this.audioPlayer.duration*100;this.updateProgress(t);const e=Math.floor(t),i=localStorage.getItem(`audio_milestone_${this.currentTrack.id}`);(!i||parseInt(i)<e)&&(e>=25&&parseInt(i||0)<25?(this.awardMilestoneXP(25),localStorage.setItem(`audio_milestone_${this.currentTrack.id}`,"25")):e>=50&&parseInt(i||0)<50?(this.awardMilestoneXP(50),localStorage.setItem(`audio_milestone_${this.currentTrack.id}`,"50")):e>=75&&parseInt(i||0)<75&&(this.awardMilestoneXP(75),localStorage.setItem(`audio_milestone_${this.currentTrack.id}`,"75")))}this.sleepTimer&&Date.now()>=this.sleepTimer&&this.fadeOut()}awardMilestoneXP(t){window.progressSystem&&window.progressSystem.awardXP(5,`${t}% progress`,"audio")}handleMetadataLoaded(){this.updatePlayerUI()}handleError(t){console.error("Audio player error:",t),alert("Error loading audio. Please try again.")}addToHistory(t){const e={trackId:t.id,title:t.title,category:t.category,timestamp:(new Date).toISOString()};this.listeningHistory.unshift(e),this.listeningHistory.length>100&&(this.listeningHistory=this.listeningHistory.slice(0,100)),this.saveHistory()}toggleFavorite(t){const e=this.favorites.indexOf(t);return-1===e?(this.favorites.push(t),window.progressSystem&&window.progressSystem.awardXP(5,"Added to favorites","audio")):this.favorites.splice(e,1),this.saveFavorites(),this.favorites.includes(t)}isFavorite(t){return this.favorites.includes(t)}getFavorites(){return this.favorites.map(t=>this.getTrackById(t)).filter(t=>void 0!==t)}createPlaylist(t){this.playlist=t,this.playlistIndex=0}addToPlaylist(t){const e=this.getTrackById(t);e&&!this.playlist.find(e=>e.id===t)&&this.playlist.push(e)}removeFromPlaylist(t){t>=0&&t<this.playlist.length&&(this.playlist.splice(t,1),this.playlistIndex>=t&&this.playlistIndex>0&&this.playlistIndex--)}clearPlaylist(){this.playlist=[],this.playlistIndex=0}nextTrack(){this.playlist.length>0&&this.playlistIndex<this.playlist.length-1&&(this.playlistIndex++,this.playTrack(this.playlist[this.playlistIndex].id))}previousTrack(){this.playlist.length>0&&this.playlistIndex>0&&(this.playlistIndex--,this.playTrack(this.playlist[this.playlistIndex].id))}setSleepTimer(t){t>0?(this.sleepTimer=Date.now()+60*t*1e3,localStorage.setItem("audio_sleep_timer",this.sleepTimer),alert(`Sleep timer set for ${t} minutes`)):(this.sleepTimer=null,localStorage.removeItem("audio_sleep_timer"))}fadeOut(t=5e3){if(!this.audioPlayer)return;const e=this.audioPlayer.volume,i=t/100,a=e/i;let r=0;const s=setInterval(()=>{r++;const t=e-a*r;t<=0||r>=i?(clearInterval(s),this.audioPlayer.volume=0,this.pause(),this.sleepTimer=null,localStorage.removeItem("audio_sleep_timer")):this.audioPlayer.volume=t},100)}async downloadTrack(t){this.downloadedTracks.includes(t)||(this.downloadedTracks.push(t),this.saveDownloaded(),window.progressSystem&&window.progressSystem.awardXP(10,"Downloaded track for offline","audio"))}isDownloaded(t){return this.downloadedTracks.includes(t)}loadFavorites(){const t=localStorage.getItem("audio_favorites");return t?JSON.parse(t):[]}saveFavorites(){localStorage.setItem("audio_favorites",JSON.stringify(this.favorites))}loadHistory(){const t=localStorage.getItem("audio_history");return t?JSON.parse(t):[]}saveHistory(){localStorage.setItem("audio_history",JSON.stringify(this.listeningHistory))}loadDownloaded(){const t=localStorage.getItem("audio_downloaded");return t?JSON.parse(t):[]}saveDownloaded(){localStorage.setItem("audio_downloaded",JSON.stringify(this.downloadedTracks))}getStats(){const t=this.getAllTracks(),e=this.listeningHistory.length,i=this.favorites.length,a=this.downloadedTracks.length,r=this.listeningHistory.reduce((t,e)=>{const i=this.getTrackById(e.trackId);return t+(i?i.duration:0)},0);return{totalTracks:t.length,listened:e,favorites:i,downloaded:a,totalListeningTime:r,totalListeningHours:Math.floor(r/3600)}}formatDuration(t){const e=Math.floor(t/3600),i=Math.floor(t%3600/60),a=Math.floor(t%60);return e>0?`${e}:${String(i).padStart(2,"0")}:${String(a).padStart(2,"0")}`:`${i}:${String(a).padStart(2,"0")}`}updatePlayerUI(){window.dispatchEvent(new CustomEvent("audio-player-updated",{detail:{track:this.currentTrack,isPlaying:this.isPlaying,currentTime:this.audioPlayer?.currentTime||0,duration:this.audioPlayer?.duration||0}}))}updateProgress(t){window.dispatchEvent(new CustomEvent("audio-progress-updated",{detail:{progress:t,currentTime:this.audioPlayer?.currentTime||0,duration:this.audioPlayer?.duration||0}}))}}"undefined"!=typeof window&&(window.audioContentSystem=new AudioContentSystem,console.log("ðŸŽ§ Audio Content System ready!"));