class EnhancedPWAInstaller{constructor(){this.deferredPrompt=null,this.isInstalled=!1,this.isStandalone=this.checkStandaloneMode(),this.supportsPWA=this.checkPWASupport(),this.init()}init(){console.log("ğŸš€ Enhanced PWA Installer initialized"),console.log("ğŸ“Š PWA Status:",{isInstalled:this.isInstalled,isStandalone:this.isStandalone,supportsPWA:this.supportsPWA,userAgent:navigator.userAgent}),this.setupEventListeners(),this.registerServiceWorker(),setTimeout(()=>{this.updateInstallButtons()},100),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{console.log("ğŸ”„ DOM loaded, re-checking buttons"),this.updateInstallButtons()},500)})}checkStandaloneMode(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://")}checkPWASupport(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}setupEventListeners(){window.addEventListener("beforeinstallprompt",e=>{console.log("ğŸ“± beforeinstallprompt event captured"),e.preventDefault(),this.deferredPrompt=e,this.updateInstallButtons(),setTimeout(()=>{this.maybeShowInstallBanner()},3e3)}),window.addEventListener("appinstalled",e=>{console.log("ğŸ‰ PWA was installed successfully"),this.isInstalled=!0,this.hideAllInstallElements(),this.showInstallSuccessMessage(),localStorage.setItem("pwa-installed","true")}),document.addEventListener("visibilitychange",()=>{if(!document.hidden){const e=this.isStandalone;this.isStandalone=this.checkStandaloneMode(),!e&&this.isStandalone&&(console.log("ğŸ›ï¸ App launched in standalone mode"),this.hideAllInstallElements())}})}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");console.log("âœ… Service Worker registered:",e),e.addEventListener("updatefound",()=>{console.log("ğŸ”„ Service Worker update found")})}catch(e){console.error("âŒ Service Worker registration failed:",e)}}updateInstallButtons(){const e=document.querySelectorAll('[id*="nstallBtn"], [id*="manual"], .pwa-install-btn, .pwa-manual-btn');console.log("ğŸ” Found install buttons:",e.length),e.forEach((e,t)=>{e&&(console.log(`ğŸ“± Button ${t+1}:`,{id:e.id,class:e.className,isStandalone:this.isStandalone,supportsPWA:this.supportsPWA}),this.isStandalone?(e.classList.add("hidden"),e.style.display="none",console.log("âœ… Already installed, hiding button")):this.supportsPWA?(e.classList.remove("hidden"),e.style.display="flex",e.style.visibility="visible",e.style.opacity="1",this.deferredPrompt?e.title="Install Divine Temple as PWA":e.title="Use browser menu to install",console.log("ğŸš€ PWA supported, showing button")):(e.classList.add("hidden"),e.style.display="none",console.log("âŒ PWA not supported, hiding button")))})}maybeShowInstallBanner(){const e=localStorage.getItem("pwa-banner-dismissed"),t=Date.now()-864e5;if(this.deferredPrompt&&(!e||parseInt(e)<t)){const e=document.getElementById("pwaInstallBanner")||document.getElementById("installBanner");e&&this.showInstallBanner(e)}}showInstallBanner(e){e.style.display="block",setTimeout(()=>{e.classList.add("show")},100)}hideInstallBanner(){document.querySelectorAll("#pwaInstallBanner, #installBanner").forEach(e=>{e.classList.remove("show"),setTimeout(()=>{e.style.display="none"},300)}),localStorage.setItem("pwa-banner-dismissed",Date.now().toString())}hideAllInstallElements(){document.querySelectorAll('[id*="nstallBtn"], [id*="manual"], .pwa-install-btn, .pwa-manual-btn, #pwaInstallBanner, #installBanner').forEach(e=>{e.classList.add("hidden"),setTimeout(()=>{e.style.display="none"},400)})}async promptInstall(){if(console.log("ğŸ¯ Install prompt triggered"),this.isStandalone)return this.showMessage("âœ… Divine Temple is already installed!","success"),{outcome:"already-installed"};if(!this.deferredPrompt)return console.log("ğŸ“± No deferred prompt available, showing fallback"),this.showFallbackInstructions(),{outcome:"no-prompt-available"};try{await this.deferredPrompt.prompt();const e=await this.deferredPrompt.userChoice;return console.log("ğŸ‘¤ User choice:",e.outcome),"accepted"===e.outcome?this.showMessage("ğŸ‰ Installing Divine Temple...","success"):this.showMessage("ğŸ’¡ Install anytime using your browser menu","info"),this.deferredPrompt=null,e}catch(e){return console.error("âŒ Install failed:",e),this.showMessage('âŒ Installation failed. Try using your browser menu â†’ "Install app"',"error"),{outcome:"error",error:e}}}showFallbackInstructions(){const e=navigator.userAgent.toLowerCase();let t="",n="ğŸ“±";e.includes("chrome")&&!e.includes("edg")?(n="ğŸŒ",t="Chrome: Click the install icon (âŠ•) in the address bar"):e.includes("edg")?(n="ğŸ”·",t="Edge: Click the install icon (âŠ•) in the address bar"):e.includes("firefox")?(n="ğŸ¦Š",t="Firefox: Look for install option in address bar or menu"):e.includes("safari")?(n="ğŸ§­",t='Safari: Tap Share button â†’ "Add to Home Screen"'):t='Use your browser menu â†’ "Install app" or "Add to Home Screen"',this.showMessage(`${n} ${t}`,"info",8e3)}showMessage(e,t="info",n=5e3){window.uxEnhancementManager&&window.uxEnhancementManager.showNotification?window.uxEnhancementManager.showNotification(e,t,n):this.createCustomNotification(e,t,n)}createCustomNotification(e,t,n){const s=document.createElement("div");s.className=`pwa-notification pwa-notification-${t}`,s.innerHTML=`\n            <div class="notification-content">\n                <span>${e}</span>\n                <button onclick="this.parentElement.parentElement.remove()" style="background: transparent; border: none; color: inherit; cursor: pointer; margin-left: 10px;">âœ•</button>\n            </div>\n        `,this.ensureNotificationStyles(),document.body.appendChild(s),setTimeout(()=>{s.parentElement&&s.remove()},n)}ensureNotificationStyles(){if(document.querySelector("#pwa-notification-styles"))return;const e=document.createElement("style");e.id="pwa-notification-styles",e.textContent="\n            .pwa-notification {\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                z-index: 10000;\n                background: rgba(26, 26, 46, 0.95);\n                backdrop-filter: blur(10px);\n                border: 1px solid #d4af37;\n                border-radius: 10px;\n                padding: 1rem 1.5rem;\n                color: white;\n                max-width: 350px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n                animation: slideInRight 0.3s ease;\n                font-family: 'Inter', sans-serif;\n            }\n            .pwa-notification-success { border-color: #10b981; }\n            .pwa-notification-error { border-color: #ef4444; }\n            .pwa-notification-info { border-color: #3b82f6; }\n            .notification-content { \n                display: flex; \n                justify-content: space-between; \n                align-items: center; \n                gap: 10px;\n            }\n            @keyframes slideInRight { \n                from { transform: translateX(100%); opacity: 0; } \n                to { transform: translateX(0); opacity: 1; } \n            }\n            @media (max-width: 480px) {\n                .pwa-notification {\n                    top: 10px;\n                    right: 10px;\n                    left: 10px;\n                    max-width: none;\n                }\n            }\n        ",document.head.appendChild(e)}showInstallSuccessMessage(){this.showMessage("ğŸ‰ Divine Temple installed successfully! Check your home screen or app launcher.","success",6e3)}install(){return this.promptInstall()}getStatus(){return{isInstalled:this.isInstalled,isStandalone:this.isStandalone,supportsPWA:this.supportsPWA,hasPrompt:!!this.deferredPrompt}}}window.enhancedPWAInstaller=new EnhancedPWAInstaller,window.installPWA=()=>window.enhancedPWAInstaller.install(),window.addEventListener("beforeinstallprompt",e=>{window.deferredPrompt=e}),console.log("ğŸ›ï¸ Enhanced PWA Install System loaded");