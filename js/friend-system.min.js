class FriendSystem{constructor(){this.friends=[],this.friendRequests=[],this.sentRequests=[],this.currentUser=null,this.activityFeed=[],this.init()}async init(){console.log("üë• Friend System initialized"),"undefined"!=typeof firebase&&firebase.auth?(this.useLocalStorage=!1,await this.initFirebase()):(console.warn("Firebase not available. Friend system will use local storage only."),this.useLocalStorage=!0,this.loadLocalData()),window.addEventListener("xp-awarded",e=>{this.broadcastActivity("xp_earned",{amount:e.detail.amount,reason:e.detail.reason})}),window.addEventListener("achievement-unlocked",e=>{this.broadcastActivity("achievement",{name:e.detail.name,icon:e.detail.icon})})}async initFirebase(){try{firebase.auth().onAuthStateChanged(async e=>{e?(this.currentUser={uid:e.uid,email:e.email,displayName:e.displayName||e.email.split("@")[0]},await this.loadFriendsFromFirebase(),this.setupRealtimeListeners()):this.currentUser=null})}catch(e){console.error("Firebase initialization error:",e),this.useLocalStorage=!0,this.loadLocalData()}}async loadFriendsFromFirebase(){if(this.currentUser)try{const e=firebase.firestore(),n=await e.collection("friends").doc(this.currentUser.uid).get();if(n.exists){const e=n.data();this.friends=e.friends||[],this.friendRequests=e.requests||[],this.sentRequests=e.sentRequests||[]}await this.loadFriendProfiles()}catch(e){console.error("Error loading friends:",e)}}async loadFriendProfiles(){if(0!==this.friends.length)try{const e=firebase.firestore(),n=await Promise.all(this.friends.map(async n=>{const t=await e.collection("users").doc(n).get(),i=await e.collection("userProgress").doc(n).get();return{uid:n,profile:t.exists?t.data():{},progress:i.exists?i.data():{}}}));this.friendProfiles=n}catch(e){console.error("Error loading friend profiles:",e)}}setupRealtimeListeners(){if(!this.currentUser)return;const e=firebase.firestore();e.collection("friends").doc(this.currentUser.uid).onSnapshot(e=>{if(e.exists){const n=e.data(),t=n.requests||[];t.length>this.friendRequests.length&&this.showNewRequestNotification(),this.friendRequests=t,this.sentRequests=n.sentRequests||[],window.dispatchEvent(new CustomEvent("friends-updated"))}}),this.friends.forEach(n=>{e.collection("userActivity").where("userId","==",n).orderBy("timestamp","desc").limit(10).onSnapshot(e=>{e.docChanges().forEach(e=>{if("added"===e.type){const n=e.doc.data();this.addToActivityFeed(n)}})})})}loadLocalData(){const e=localStorage.getItem("divine_temple_friends");if(e){const n=JSON.parse(e);this.friends=n.friends||[],this.friendRequests=n.requests||[],this.sentRequests=n.sentRequests||[]}this.currentUser={uid:localStorage.getItem("divine_temple_user_id")||"local_user_"+Date.now(),email:"local@user.com",displayName:"Local User"},localStorage.setItem("divine_temple_user_id",this.currentUser.uid)}saveLocalData(){localStorage.setItem("divine_temple_friends",JSON.stringify({friends:this.friends,requests:this.friendRequests,sentRequests:this.sentRequests}))}async sendFriendRequest(e){if(this.useLocalStorage)return{success:!1,message:"Friend system requires Firebase authentication. Please log in."};if(!this.currentUser)return{success:!1,message:"Please log in first"};if(e===this.currentUser.email)return{success:!1,message:"You cannot add yourself as a friend"};try{const n=firebase.firestore(),t=await n.collection("users").where("email","==",e).get();if(t.empty)return{success:!1,message:"User not found with that email"};const i=t.docs[0].id;return this.friends.includes(i)?{success:!1,message:"Already friends with this user"}:this.sentRequests.includes(i)?{success:!1,message:"Friend request already sent"}:(await n.collection("friends").doc(this.currentUser.uid).set({sentRequests:firebase.firestore.FieldValue.arrayUnion(i)},{merge:!0}),await n.collection("friends").doc(i).set({requests:firebase.firestore.FieldValue.arrayUnion(this.currentUser.uid)},{merge:!0}),this.sentRequests.push(i),window.progressSystem&&window.progressSystem.awardXP(20,"Sent friend request","social"),{success:!0,message:"Friend request sent!",friendId:i})}catch(e){return console.error("Error sending friend request:",e),{success:!1,message:"Failed to send request: "+e.message}}}async acceptFriendRequest(e){if(this.useLocalStorage)return{success:!1,message:"Friend system requires Firebase authentication"};try{const n=firebase.firestore();return await n.collection("friends").doc(this.currentUser.uid).set({friends:firebase.firestore.FieldValue.arrayUnion(e),requests:firebase.firestore.FieldValue.arrayRemove(e)},{merge:!0}),await n.collection("friends").doc(e).set({friends:firebase.firestore.FieldValue.arrayUnion(this.currentUser.uid),sentRequests:firebase.firestore.FieldValue.arrayRemove(this.currentUser.uid)},{merge:!0}),this.friends.push(e),this.friendRequests=this.friendRequests.filter(n=>n!==e),await this.loadFriendProfiles(),window.progressSystem&&window.progressSystem.awardXP(50,"New friend added! üéâ","social"),{success:!0,message:"Friend request accepted!"}}catch(e){return console.error("Error accepting friend request:",e),{success:!1,message:"Failed to accept request"}}}async rejectFriendRequest(e){if(this.useLocalStorage)return{success:!1};try{const n=firebase.firestore();return await n.collection("friends").doc(this.currentUser.uid).set({requests:firebase.firestore.FieldValue.arrayRemove(e)},{merge:!0}),await n.collection("friends").doc(e).set({sentRequests:firebase.firestore.FieldValue.arrayRemove(this.currentUser.uid)},{merge:!0}),this.friendRequests=this.friendRequests.filter(n=>n!==e),{success:!0}}catch(e){return console.error("Error rejecting friend request:",e),{success:!1}}}async removeFriend(e){if(this.useLocalStorage)return this.friends=this.friends.filter(n=>n!==e),this.saveLocalData(),{success:!0};try{const n=firebase.firestore();return await n.collection("friends").doc(this.currentUser.uid).set({friends:firebase.firestore.FieldValue.arrayRemove(e)},{merge:!0}),await n.collection("friends").doc(e).set({friends:firebase.firestore.FieldValue.arrayRemove(this.currentUser.uid)},{merge:!0}),this.friends=this.friends.filter(n=>n!==e),await this.loadFriendProfiles(),{success:!0,message:"Friend removed"}}catch(e){return console.error("Error removing friend:",e),{success:!1}}}async giftXP(e,n,t=""){if(this.useLocalStorage)return{success:!1,message:"XP gifting requires Firebase"};if(!this.friends.includes(e))return{success:!1,message:"Can only gift XP to friends"};const i=`xp_gift_cooldown_${e}`,s=localStorage.getItem(i),r=(new Date).toISOString().split("T")[0];if(s===r)return{success:!1,message:"You can only gift XP once per day to each friend"};if((window.progressSystem?window.progressSystem.xp:0)<n)return{success:!1,message:"Not enough XP to gift"};try{const s=firebase.firestore();if(await s.collection("xpGifts").add({from:this.currentUser.uid,to:e,amount:n,message:t,timestamp:firebase.firestore.FieldValue.serverTimestamp(),status:"sent"}),window.progressSystem&&(window.progressSystem.xp-=n,window.progressSystem.saveProgress()),localStorage.setItem(i,r),window.progressSystem){const e=Math.floor(.1*n);window.progressSystem.awardXP(e,"Karma for gifting XP üíù","social")}return{success:!0,message:`Sent ${n} XP to your friend! üíù`,karmaXP:Math.floor(.1*n)}}catch(e){return console.error("Error gifting XP:",e),{success:!1,message:"Failed to send gift"}}}async checkXPGifts(){if(!this.useLocalStorage&&this.currentUser)try{const e=firebase.firestore(),n=await e.collection("xpGifts").where("to","==",this.currentUser.uid).where("status","==","sent").get();for(const e of n.docs){const n=e.data();if(window.progressSystem){n.from;window.progressSystem.awardXP(n.amount,"XP gift from friend! "+(n.message?"üíù "+n.message:""),"social")}await e.ref.update({status:"received"}),this.showGiftNotification(n)}}catch(e){console.error("Error checking XP gifts:",e)}}showGiftNotification(e){const n=document.createElement("div");n.className="xp-gift-notification",n.innerHTML=`\n            <div class="gift-notification-content">\n                <div class="gift-icon">üéÅ</div>\n                <div class="gift-text">\n                    <h4>XP Gift Received!</h4>\n                    <p>+${e.amount} XP from a friend</p>\n                    ${e.message?`<p class="gift-message">"${e.message}"</p>`:""}\n                </div>\n            </div>\n        `,document.body.appendChild(n),setTimeout(()=>n.remove(),5e3)}async broadcastActivity(e,n){if(!this.useLocalStorage&&this.currentUser)try{const t=firebase.firestore();await t.collection("userActivity").add({userId:this.currentUser.uid,userName:this.currentUser.displayName,type:e,data:n,timestamp:firebase.firestore.FieldValue.serverTimestamp()})}catch(e){console.error("Error broadcasting activity:",e)}}addToActivityFeed(e){this.activityFeed.unshift(e),this.activityFeed.length>50&&(this.activityFeed=this.activityFeed.slice(0,50)),window.dispatchEvent(new CustomEvent("friend-activity-added",{detail:e}))}getActivityFeed(e=20){return this.activityFeed.slice(0,e)}async compareFriend(e){if(this.useLocalStorage)return{success:!1,message:"Comparison requires Firebase"};try{const n=firebase.firestore(),t=await n.collection("userProgress").doc(e).get(),i=t.exists?t.data():{},s=window.progressSystem?{xp:window.progressSystem.xp,level:window.progressSystem.level,achievements:window.progressSystem.achievements.length,streak:window.progressSystem.streakDays}:{};return{success:!0,myProgress:s,friendProgress:i,comparison:this.calculateComparison(s,i)}}catch(e){return console.error("Error comparing with friend:",e),{success:!1}}}calculateComparison(e,n){return{xpDiff:e.xp-(n.xp||0),levelDiff:e.level-(n.level||0),achievementDiff:e.achievements-(n.achievements||0),streakDiff:e.streak-(n.streak||0)}}showNewRequestNotification(){const e=document.createElement("div");e.className="friend-request-notification",e.innerHTML='\n            <div class="request-notification-content">\n                <div class="request-icon">üë•</div>\n                <div class="request-text">\n                    <h4>New Friend Request!</h4>\n                    <p>Someone wants to connect with you</p>\n                </div>\n                <button onclick="window.friendSystem.openFriendsModal()" class="view-request-btn">\n                    View\n                </button>\n            </div>\n        ',document.body.appendChild(e),setTimeout(()=>e.remove(),5e3)}openFriendsModal(){const e=document.createElement("div");e.className="friends-modal",e.id="friendsModal",e.innerHTML=`\n            <div class="friends-modal-content">\n                <div class="friends-modal-header">\n                    <h2>üë• Friends</h2>\n                    <button onclick="document.getElementById('friendsModal').remove()" class="modal-close">‚úï</button>\n                </div>\n\n                <div class="friends-tabs">\n                    <button class="friends-tab active" onclick="window.friendSystem.switchTab('friends')">\n                        My Friends (${this.friends.length})\n                    </button>\n                    <button class="friends-tab" onclick="window.friendSystem.switchTab('requests')">\n                        Requests (${this.friendRequests.length})\n                    </button>\n                    <button class="friends-tab" onclick="window.friendSystem.switchTab('add')">\n                        Add Friend\n                    </button>\n                    <button class="friends-tab" onclick="window.friendSystem.switchTab('activity')">\n                        Activity\n                    </button>\n                </div>\n\n                <div class="friends-content" id="friendsContent">\n                    ${this.renderFriendsTab()}\n                </div>\n            </div>\n        `,this.addFriendsModalStyles(),document.body.appendChild(e)}switchTab(e){document.querySelectorAll(".friends-tab").forEach(e=>e.classList.remove("active")),event.target.classList.add("active");const n=document.getElementById("friendsContent");switch(e){case"friends":n.innerHTML=this.renderFriendsTab();break;case"requests":n.innerHTML=this.renderRequestsTab();break;case"add":n.innerHTML=this.renderAddFriendTab();break;case"activity":n.innerHTML=this.renderActivityTab()}}renderFriendsTab(){return 0===this.friends.length?'\n                <div class="empty-state">\n                    <div class="empty-icon">üë•</div>\n                    <h3>No friends yet</h3>\n                    <p>Add friends to see their progress and share your journey!</p>\n                </div>\n            ':`\n            <div class="friends-list">\n                ${this.friends.map(e=>this.renderFriendCard(e)).join("")}\n            </div>\n        `}renderFriendCard(e){const n=this.friendProfiles?.find(n=>n.uid===e);if(!n)return"";const t=n.profile||{},i=n.progress||{};return`\n            <div class="friend-card">\n                <div class="friend-avatar">\n                    ${t.photoURL?`<img src="${t.photoURL}" alt="${t.displayName}">`:`<div class="avatar-placeholder">${(t.displayName||"U")[0].toUpperCase()}</div>`}\n                </div>\n                <div class="friend-info">\n                    <h4>${t.displayName||t.email||"Friend"}</h4>\n                    <div class="friend-stats">\n                        <span>Level ${i.level||1}</span>\n                        <span>‚Ä¢</span>\n                        <span>${(i.xp||0).toLocaleString()} XP</span>\n                    </div>\n                </div>\n                <div class="friend-actions">\n                    <button onclick="window.friendSystem.showGiftXPModal('${e}')" class="gift-btn" title="Gift XP">\n                        üéÅ\n                    </button>\n                    <button onclick="window.friendSystem.showCompareModal('${e}')" class="compare-btn" title="Compare Progress">\n                        üìä\n                    </button>\n                    <button onclick="window.friendSystem.removeFriend('${e}')" class="remove-btn" title="Remove Friend">\n                        ‚úï\n                    </button>\n                </div>\n            </div>\n        `}renderRequestsTab(){return 0===this.friendRequests.length?'\n                <div class="empty-state">\n                    <div class="empty-icon">üì¨</div>\n                    <h3>No pending requests</h3>\n                    <p>Friend requests will appear here</p>\n                </div>\n            ':`\n            <div class="requests-list">\n                ${this.friendRequests.map(e=>`\n                    <div class="request-card">\n                        <div class="request-info">\n                            <h4>Friend Request</h4>\n                            <p>User ID: ${e.substring(0,8)}...</p>\n                        </div>\n                        <div class="request-actions">\n                            <button onclick="window.friendSystem.acceptFriendRequest('${e}')" class="accept-btn">\n                                ‚úì Accept\n                            </button>\n                            <button onclick="window.friendSystem.rejectFriendRequest('${e}')" class="reject-btn">\n                                ‚úï Reject\n                            </button>\n                        </div>\n                    </div>\n                `).join("")}\n            </div>\n        `}renderAddFriendTab(){return`\n            <div class="add-friend-section">\n                <div class="add-friend-form">\n                    <h3>Add Friend by Email</h3>\n                    <input type="email" id="friendEmail" placeholder="friend@example.com" class="friend-email-input">\n                    <button onclick="window.friendSystem.sendFriendRequestFromModal()" class="send-request-btn">\n                        üì® Send Friend Request\n                    </button>\n                </div>\n\n                <div class="friend-code-section">\n                    <h3>Your Friend Code</h3>\n                    <div class="friend-code">\n                        ${this.currentUser?.email||"Not logged in"}\n                    </div>\n                    <button onclick="navigator.clipboard.writeText('${this.currentUser?.email||""}'); alert('Copied!');"\n                            class="copy-code-btn">\n                        üìã Copy Email\n                    </button>\n                </div>\n            </div>\n        `}renderActivityTab(){const e=this.getActivityFeed();return 0===e.length?'\n                <div class="empty-state">\n                    <div class="empty-icon">üì∞</div>\n                    <h3>No activity yet</h3>\n                    <p>Your friends\' activities will appear here</p>\n                </div>\n            ':`\n            <div class="activity-feed">\n                ${e.map(e=>this.renderActivityItem(e)).join("")}\n            </div>\n        `}renderActivityItem(e){let n="‚≠ê",t="";"xp_earned"===e.type?(n="‚ö°",t=`earned ${e.data.amount} XP for ${e.data.reason}`):"achievement"===e.type?(n=e.data.icon||"üèÜ",t=`unlocked "${e.data.name}"`):"level_up"===e.type&&(n="üéâ",t=`reached Level ${e.data.level}!`);const i=this.getTimeAgo(e.timestamp);return`\n            <div class="activity-item">\n                <div class="activity-icon">${n}</div>\n                <div class="activity-text">\n                    <strong>${e.userName}</strong> ${t}\n                    <span class="activity-time">${i}</span>\n                </div>\n            </div>\n        `}getTimeAgo(e){if(!e)return"Just now";const n=new Date,t=e.toDate?e.toDate():new Date(e),i=Math.floor((n-t)/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:`${Math.floor(i/86400)}d ago`}async sendFriendRequestFromModal(){const e=document.getElementById("friendEmail").value.trim();if(!e)return void alert("Please enter an email address");const n=await this.sendFriendRequest(e);alert(n.message),n.success&&(document.getElementById("friendEmail").value="")}showGiftXPModal(e){const n=document.createElement("div");n.className="gift-xp-modal",n.innerHTML=`\n            <div class="gift-modal-content">\n                <h3>üéÅ Gift XP</h3>\n                <p>Send XP to your friend!</p>\n                <input type="number" id="giftAmount" placeholder="Amount" min="10" max="500" class="gift-input">\n                <textarea id="giftMessage" placeholder="Optional message..." class="gift-message"></textarea>\n                <div class="gift-modal-actions">\n                    <button onclick="window.friendSystem.sendGift('${e}')" class="send-gift-btn">\n                        üíù Send Gift\n                    </button>\n                    <button onclick="this.parentElement.parentElement.parentElement.remove()" class="cancel-btn">\n                        Cancel\n                    </button>\n                </div>\n            </div>\n        `,document.body.appendChild(n)}async sendGift(e){const n=parseInt(document.getElementById("giftAmount").value),t=document.getElementById("giftMessage").value.trim();if(!n||n<10)return void alert("Please enter at least 10 XP");const i=await this.giftXP(e,n,t);alert(i.message),i.success&&document.querySelector(".gift-xp-modal").remove()}showCompareModal(e){alert("Comparison feature coming soon!")}addFriendsModalStyles(){if(document.getElementById("friendsModalStyles"))return;const e=document.createElement("style");e.id="friendsModalStyles",e.textContent="\n            .friends-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n            }\n\n            .friends-modal-content {\n                background: white;\n                border-radius: 20px;\n                width: 90%;\n                max-width: 800px;\n                max-height: 90vh;\n                overflow: hidden;\n                display: flex;\n                flex-direction: column;\n            }\n\n            .friends-modal-header {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 20px 30px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n\n            .friends-modal-header h2 {\n                margin: 0;\n            }\n\n            .modal-close {\n                background: rgba(255,255,255,0.2);\n                border: none;\n                color: white;\n                width: 32px;\n                height: 32px;\n                border-radius: 50%;\n                cursor: pointer;\n                font-size: 20px;\n            }\n\n            .friends-tabs {\n                display: flex;\n                border-bottom: 2px solid #e0e0e0;\n                background: #f9f9f9;\n            }\n\n            .friends-tab {\n                flex: 1;\n                padding: 15px;\n                border: none;\n                background: none;\n                cursor: pointer;\n                font-weight: 600;\n                color: #666;\n                transition: all 0.2s;\n            }\n\n            .friends-tab.active {\n                color: #667eea;\n                background: white;\n                border-bottom: 3px solid #667eea;\n            }\n\n            .friends-content {\n                flex: 1;\n                overflow-y: auto;\n                padding: 20px;\n            }\n\n            .friends-list, .requests-list {\n                display: flex;\n                flex-direction: column;\n                gap: 15px;\n            }\n\n            .friend-card, .request-card {\n                display: flex;\n                align-items: center;\n                gap: 15px;\n                padding: 15px;\n                background: #f9f9f9;\n                border-radius: 12px;\n                transition: background 0.2s;\n            }\n\n            .friend-card:hover {\n                background: #f0f0f0;\n            }\n\n            .friend-avatar {\n                width: 50px;\n                height: 50px;\n                border-radius: 50%;\n                overflow: hidden;\n            }\n\n            .friend-avatar img {\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n            }\n\n            .avatar-placeholder {\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 24px;\n                font-weight: bold;\n            }\n\n            .friend-info {\n                flex: 1;\n            }\n\n            .friend-info h4 {\n                margin: 0 0 5px 0;\n            }\n\n            .friend-stats {\n                font-size: 13px;\n                color: #666;\n            }\n\n            .friend-actions {\n                display: flex;\n                gap: 8px;\n            }\n\n            .friend-actions button {\n                width: 36px;\n                height: 36px;\n                border: none;\n                border-radius: 8px;\n                cursor: pointer;\n                font-size: 16px;\n                transition: transform 0.2s;\n            }\n\n            .friend-actions button:hover {\n                transform: scale(1.1);\n            }\n\n            .gift-btn {\n                background: #ffd700;\n            }\n\n            .compare-btn {\n                background: #3b82f6;\n                color: white;\n            }\n\n            .remove-btn {\n                background: #ef4444;\n                color: white;\n            }\n\n            .empty-state {\n                text-align: center;\n                padding: 60px 20px;\n                color: #999;\n            }\n\n            .empty-icon {\n                font-size: 64px;\n                margin-bottom: 20px;\n            }\n\n            .empty-state h3 {\n                margin: 0 0 10px 0;\n                color: #666;\n            }\n\n            .add-friend-section {\n                max-width: 500px;\n                margin: 0 auto;\n            }\n\n            .add-friend-form, .friend-code-section {\n                background: #f9f9f9;\n                padding: 25px;\n                border-radius: 12px;\n                margin-bottom: 20px;\n            }\n\n            .add-friend-form h3, .friend-code-section h3 {\n                margin-top: 0;\n            }\n\n            .friend-email-input, .gift-input {\n                width: 100%;\n                padding: 12px;\n                border: 2px solid #e0e0e0;\n                border-radius: 8px;\n                font-size: 15px;\n                margin-bottom: 15px;\n            }\n\n            .send-request-btn, .copy-code-btn, .send-gift-btn {\n                width: 100%;\n                padding: 12px;\n                border: none;\n                border-radius: 8px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                font-weight: 600;\n                cursor: pointer;\n                transition: transform 0.2s;\n            }\n\n            .send-request-btn:hover, .copy-code-btn:hover, .send-gift-btn:hover {\n                transform: translateY(-2px);\n            }\n\n            .friend-code {\n                background: white;\n                padding: 15px;\n                border-radius: 8px;\n                text-align: center;\n                font-family: monospace;\n                font-size: 16px;\n                margin: 15px 0;\n                border: 2px dashed #667eea;\n            }\n\n            .activity-feed {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n\n            .activity-item {\n                display: flex;\n                gap: 12px;\n                padding: 12px;\n                background: #f9f9f9;\n                border-radius: 8px;\n                border-left: 3px solid #667eea;\n            }\n\n            .activity-icon {\n                font-size: 24px;\n            }\n\n            .activity-text {\n                flex: 1;\n                line-height: 1.5;\n            }\n\n            .activity-time {\n                display: block;\n                font-size: 12px;\n                color: #999;\n                margin-top: 3px;\n            }\n\n            .request-actions {\n                display: flex;\n                gap: 8px;\n            }\n\n            .accept-btn, .reject-btn {\n                padding: 8px 16px;\n                border: none;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: 600;\n            }\n\n            .accept-btn {\n                background: #10b981;\n                color: white;\n            }\n\n            .reject-btn {\n                background: #ef4444;\n                color: white;\n            }\n\n            .gift-xp-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10001;\n            }\n\n            .gift-modal-content {\n                background: white;\n                padding: 30px;\n                border-radius: 15px;\n                max-width: 400px;\n                width: 90%;\n            }\n\n            .gift-message {\n                width: 100%;\n                padding: 12px;\n                border: 2px solid #e0e0e0;\n                border-radius: 8px;\n                font-family: inherit;\n                margin-bottom: 15px;\n                resize: vertical;\n            }\n\n            .gift-modal-actions {\n                display: flex;\n                gap: 10px;\n            }\n\n            .cancel-btn {\n                flex: 1;\n                padding: 12px;\n                border: none;\n                border-radius: 8px;\n                background: #e0e0e0;\n                cursor: pointer;\n            }\n\n            .xp-gift-notification, .friend-request-notification {\n                position: fixed;\n                top: 80px;\n                right: 20px;\n                z-index: 10000;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 20px;\n                border-radius: 15px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n                animation: slideInRight 0.5s ease;\n            }\n\n            .gift-notification-content, .request-notification-content {\n                display: flex;\n                gap: 15px;\n                align-items: center;\n            }\n\n            .gift-icon, .request-icon {\n                font-size: 32px;\n            }\n\n            .gift-text h4, .request-text h4 {\n                margin: 0 0 5px 0;\n            }\n\n            .gift-text p, .request-text p {\n                margin: 0;\n                opacity: 0.95;\n            }\n\n            .gift-message {\n                font-style: italic;\n                font-size: 13px;\n                margin-top: 8px;\n            }\n\n            .view-request-btn {\n                padding: 8px 16px;\n                border: 2px solid white;\n                background: rgba(255,255,255,0.2);\n                color: white;\n                border-radius: 8px;\n                cursor: pointer;\n                font-weight: 600;\n            }\n\n            @keyframes slideInRight {\n                from {\n                    transform: translateX(400px);\n                    opacity: 0;\n                }\n                to {\n                    transform: translateX(0);\n                    opacity: 1;\n                }\n            }\n        ",document.head.appendChild(e)}}"undefined"!=typeof window&&(window.friendSystem=new FriendSystem,console.log("üë• Friend System ready!"),window.addEventListener("load",()=>{setTimeout(()=>{window.friendSystem&&window.friendSystem.checkXPGifts()},2e3)}));