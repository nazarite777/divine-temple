class SmartInsightsSystem{constructor(){this.currentUser=null,this.insightsData=null,this.isInitialized=!1,this.init()}async init(){console.log("ðŸ“Š Initializing Smart Insights System..."),window.progressSystem?(await this.waitForProgressSystem(),this.analyzeUserData(),this.isInitialized=!0,console.log("âœ… Smart Insights System ready")):setTimeout(()=>this.init(),1e3)}async waitForProgressSystem(){return new Promise(e=>{window.progressSystem&&window.progressSystem.isInitialized?e():setTimeout(()=>this.waitForProgressSystem().then(e),500)})}analyzeUserData(){if(!window.progressSystem||!window.progressSystem.userData)return void console.warn("No user data available for analysis");const e=window.progressSystem.userData;this.insightsData={patterns:this.analyzePatterns(e),trends:this.analyzeTrends(e),recommendations:this.generateRecommendations(e),stats:this.generateStats(e),achievements:this.analyzeAchievements(e),updatedAt:(new Date).toISOString()},console.log("ðŸ“Š Insights generated:",this.insightsData)}analyzePatterns(e){return{bestDay:this.findBestDay(e),peakTime:this.findPeakTime(e),favoriteSections:this.findFavoriteSections(e),activityFrequency:this.calculateActivityFrequency(e),streakQuality:this.analyzeStreakQuality(e)}}findBestDay(e){const t={};Object.values(e.sections).forEach(e=>{e.activities.forEach(e=>{const s=new Date(e.timestamp).getDay();t[s]=(t[s]||0)+1})});let s=0,i=0;return Object.entries(t).forEach(([e,t])=>{t>i&&(i=t,s=parseInt(e))}),{name:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[s]||"Not enough data",count:i}}findPeakTime(e){const t={};Object.values(e.sections).forEach(e=>{e.activities.forEach(e=>{const s=new Date(e.timestamp).getHours();t[s]=(t[s]||0)+1})});let s=0,i=0;Object.entries(t).forEach(([e,t])=>{t>i&&(i=t,s=parseInt(e))});let a="Not enough data";if(i>0){const e=(s+2)%24;a=`${this.formatHour(s)}-${this.formatHour(e)}`}return{range:a,hour:s,count:i}}formatHour(e){return`${e%12||12}${e>=12?"PM":"AM"}`}findFavoriteSections(e){return Object.entries(e.sections).map(([e,t])=>({id:e,xp:t.xp,visits:t.visits,activities:t.activities.length})).filter(e=>e.xp>0).sort((e,t)=>t.xp-e.xp).slice(0,3)}calculateActivityFrequency(e){const t=Object.values(e.sections).flatMap(e=>e.activities).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));if(t.length<2)return{frequency:"New user",avgPerWeek:0};const s=new Date(t[t.length-1].timestamp),i=new Date(t[0].timestamp),a=Math.max(1,(i-s)/6048e5),n=Math.round(t.length/a);let r="Occasional";return n>=20?r="Very Active":n>=10?r="Active":n>=5&&(r="Regular"),{frequency:r,avgPerWeek:n}}analyzeStreakQuality(e){const t=e.streaks.daily.count;let s="Building",i="ðŸŒ±";return t>=30?(s="Legendary",i="ðŸ‘‘"):t>=14?(s="Excellent",i="ðŸ”¥"):t>=7?(s="Strong",i="â­"):t>=3&&(s="Growing",i="ðŸŒŸ"),{quality:s,emoji:i,current:t,longest:e.streaks.daily.longestStreak}}analyzeTrends(e){return{weeklyGrowth:this.calculateWeeklyGrowth(e),levelProgress:this.analyzeLevelProgress(e),sectionDiversity:this.calculateSectionDiversity(e),consistencyScore:this.calculateConsistencyScore(e)}}calculateWeeklyGrowth(e){const t=Date.now(),s=t-6048e5,i=t-12096e5;let a=0,n=0;Object.values(e.sections).forEach(e=>{e.activities.forEach(e=>{const t=new Date(e.timestamp).getTime();t>=s?a+=e.xp||0:t>=i&&(n+=e.xp||0)})});const r=n>0?(a-n)/n*100:0;return{thisWeek:a,lastWeek:n,growth:Math.round(r),trend:r>0?"up":r<0?"down":"stable"}}analyzeLevelProgress(e){const t=e.nextLevelXP-e.currentLevelXP,s=e.currentLevelXP/e.nextLevelXP*100;let i="Unknown";const a=this.calculateAverageXpPerDay(e);if(a>0){const e=Math.ceil(t/a);i=1===e?"Tomorrow!":`${e} days`}return{currentLevel:e.level,progress:Math.round(s),xpNeeded:t,estimate:i}}calculateAverageXpPerDay(e){const t=Object.values(e.sections).flatMap(e=>e.activities);if(0===t.length)return 0;const s=new Date(t[t.length-1].timestamp),i=new Date,a=Math.max(1,(i-s)/864e5);return Math.round(e.totalXP/a)}calculateSectionDiversity(e){const t=Object.values(e.sections).filter(e=>e.visits>0).length,s=Object.keys(e.sections).length,i=t/s*100;let a="Explorer";return i>=90?a="Master of All":i>=70?a="Well-Rounded":i>=50?a="Diverse":i>=30&&(a="Focused"),{diversity:a,visited:t,total:s,percentage:Math.round(i)}}calculateConsistencyScore(e){const t=e.streaks.daily.count,s=e.streaks.daily.longestStreak;let i=0;return i=t>=30?100:t>=21?90:t>=14?80:t>=7?70:t>=3?60:Math.min(50,15*t),{score:i,currentStreak:t,longestStreak:s}}generateRecommendations(e){const t=[],s=e.streaks.daily.count;0===s?t.push({type:"streak",priority:"high",icon:"ðŸ”¥",title:"Start Your Streak!",message:"Complete one activity today to begin building your daily streak.",action:"Meditate Now"}):s>=1&&s<7&&t.push({type:"streak",priority:"medium",icon:"â­",title:"Keep It Going!",message:`You're at ${s} days. Reach 7 days for the Week Warrior achievement!`,action:"Continue Streak"});e.currentLevelXP/e.nextLevelXP*100>=80&&t.push({type:"level",priority:"high",icon:"âš¡",title:"Almost There!",message:`Only ${e.nextLevelXP-e.currentLevelXP} XP until Level ${e.level+1}!`,action:"Earn More XP"});if(Object.values(e.sections).filter(e=>e.visits>0).length<.5*Object.keys(e.sections).length){const s=this.getUnvisitedSections(e);s.length>0&&t.push({type:"explore",priority:"low",icon:"ðŸ—ºï¸",title:"Explore New Sections",message:`Try ${s[0]} to diversify your spiritual practice!`,action:`Visit ${s[0]}`})}const i=this.analyzePatterns(e);if(i.peakTime.count>0){const e=(new Date).getHours(),s=i.peakTime.hour;Math.abs(e-s)<=1&&t.push({type:"timing",priority:"medium",icon:"â°",title:"Perfect Timing!",message:`This is your peak practice time (${i.peakTime.range}). Make the most of it!`,action:"Start Practice"})}const a=this.findNearAchievements(e);if(a.length>0){const e=a[0];t.push({type:"achievement",priority:"medium",icon:"ðŸ†",title:"Achievement Close!",message:e.message,action:"View Achievements"})}return t.slice(0,4)}getUnvisitedSections(e){const t={"energy-healing":"Energy Healing","sacred-arts-sound":"Sacred Arts","devotion-growth":"Devotion & Growth","crystals-elements":"Crystals & Elements",community:"Community"},s=[];return Object.entries(e.sections).forEach(([e,i])=>{0===i.visits&&t[e]&&s.push(t[e])}),s}findNearAchievements(e){const t=[],s=e.stats.meditations||0;s>=5&&s<10&&t.push({message:10-s+" more meditations for Meditation Devotee!"});const i=e.streaks.daily.count;return i>=5&&i<7?t.push({message:7-i+" more days for Week Warrior!"}):i>=25&&i<30&&t.push({message:30-i+" more days for Month Master!"}),t}generateStats(e){return{totalXP:e.totalXP,level:e.level,rank:e.spiritualRank,achievements:e.achievements.length,streak:e.streaks.daily.count,activitiesThisWeek:this.countRecentActivities(e,7),sectionsActive:Object.values(e.sections).filter(e=>e.visits>0).length}}countRecentActivities(e,t){const s=Date.now()-24*t*60*60*1e3;let i=0;return Object.values(e.sections).forEach(e=>{e.activities.forEach(e=>{new Date(e.timestamp).getTime()>=s&&i++})}),i}analyzeAchievements(e){const t=window.progressSystem?.getAchievementDefinitions().length||0,s=e.achievements.length,i=s/t*100;return{unlocked:s,total:t,percentage:Math.round(i),recent:e.achievements.slice(0,3)}}getInsights(){return this.insightsData}getWeeklySummary(){return this.insightsData?{xpGrowth:this.insightsData.trends.weeklyGrowth,bestDay:this.insightsData.patterns.bestDay,peakTime:this.insightsData.patterns.peakTime,recommendations:this.insightsData.recommendations.slice(0,2)}:null}refreshInsights(){this.analyzeUserData(),window.dispatchEvent(new CustomEvent("insightsUpdated",{detail:{insights:this.insightsData}}))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.smartInsights=new SmartInsightsSystem}):window.smartInsights=new SmartInsightsSystem,console.log("ðŸ“Š Smart Insights System loaded");