class GuildsSystem{constructor(){this.circles=[],this.myCircles=[],this.currentCircle=null,this.currentUser=null,this.useLocalStorage=!1,this.init()}async init(){console.log("üè∞ Guilds/Circles System initialized"),"undefined"!=typeof firebase&&firebase.auth?(this.useLocalStorage=!1,await this.initFirebase()):(console.warn("Firebase not available. Circles will use local storage only."),this.useLocalStorage=!0,this.loadLocalData())}async initFirebase(){try{firebase.auth().onAuthStateChanged(async e=>{e?(this.currentUser={uid:e.uid,email:e.email,displayName:e.displayName||e.email.split("@")[0]},await this.loadMyCircles()):this.currentUser=null})}catch(e){console.error("Firebase initialization error:",e),this.useLocalStorage=!0,this.loadLocalData()}}loadLocalData(){const e=localStorage.getItem("divine_temple_circles");if(e){const n=JSON.parse(e);this.myCircles=n.myCircles||[],this.circles=n.allCircles||[]}this.currentUser={uid:localStorage.getItem("divine_temple_user_id")||"local_user_"+Date.now(),email:"local@user.com",displayName:"Local User"}}saveLocalData(){localStorage.setItem("divine_temple_circles",JSON.stringify({myCircles:this.myCircles,allCircles:this.circles}))}async loadMyCircles(){if(!this.useLocalStorage)try{const e=firebase.firestore(),n=await e.collection("circles").where("members","array-contains",this.currentUser.uid).get();this.myCircles=[],n.forEach(e=>{this.myCircles.push({id:e.id,...e.data()})}),console.log("Loaded circles:",this.myCircles.length)}catch(e){console.error("Error loading circles:",e)}}async createCircle(e){if(this.useLocalStorage)return{success:!1,message:"Circles require Firebase authentication"};if(!this.currentUser)return{success:!1,message:"Please log in first"};if(!e.name||e.name.length<3)return{success:!1,message:"Circle name must be at least 3 characters"};if(!e.description||e.description.length<10)return{success:!1,message:"Description must be at least 10 characters"};try{const n=firebase.firestore(),r={name:e.name,description:e.description,type:e.type||"general",creator:this.currentUser.uid,creatorName:this.currentUser.displayName,members:[this.currentUser.uid],memberCount:1,maxMembers:e.maxMembers||20,isPrivate:e.isPrivate||!1,tags:e.tags||[],rules:e.rules||[],goals:[],resources:[],stats:{totalXP:0,totalActivities:0,activeMembers:1},createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()},t=await n.collection("circles").add(r);return r.id=t.id,this.myCircles.push(r),window.progressSystem&&(window.progressSystem.awardXP(100,`Created circle: ${r.name}`,"guilds"),window.progressSystem.logActivity("circle_created","guilds",{circleId:r.id,circleName:r.name})),{success:!0,message:"Circle created successfully! üè∞",circle:r}}catch(e){return console.error("Error creating circle:",e),{success:!1,message:"Failed to create circle: "+e.message}}}async searchCircles(e="",n={}){if(this.useLocalStorage)return{success:!1,circles:[]};try{let r=firebase.firestore().collection("circles").where("isPrivate","==",!1).limit(50);n.type&&(r=r.where("type","==",n.type));const t=await r.get();let s=[];return t.forEach(n=>{const r={id:n.id,...n.data()};if(e){const n=e.toLowerCase();(r.name.toLowerCase().includes(n)||r.description.toLowerCase().includes(n)||r.tags&&r.tags.some(e=>e.toLowerCase().includes(n)))&&s.push(r)}else s.push(r)}),s.sort((e,n)=>n.memberCount-e.memberCount),{success:!0,circles:s}}catch(e){return console.error("Error searching circles:",e),{success:!1,circles:[]}}}async joinCircle(e){if(this.useLocalStorage)return{success:!1,message:"Circles require Firebase"};if(!this.currentUser)return{success:!1,message:"Please log in first"};try{const n=firebase.firestore().collection("circles").doc(e),r=await n.get();if(!r.exists)return{success:!1,message:"Circle not found"};const t=r.data();return t.members.includes(this.currentUser.uid)?{success:!1,message:"Already a member of this circle"}:t.members.length>=t.maxMembers?{success:!1,message:"Circle is full"}:(await n.update({members:firebase.firestore.FieldValue.arrayUnion(this.currentUser.uid),memberCount:firebase.firestore.FieldValue.increment(1),"stats.activeMembers":firebase.firestore.FieldValue.increment(1)}),await this.sendMessage(e,{text:`${this.currentUser.displayName} joined the circle! üéâ`,type:"system"}),await this.loadMyCircles(),window.progressSystem&&window.progressSystem.awardXP(50,`Joined circle: ${t.name}`,"guilds"),{success:!0,message:"Successfully joined the circle! üéâ",circle:t})}catch(e){return console.error("Error joining circle:",e),{success:!1,message:"Failed to join circle"}}}async leaveCircle(e){if(this.useLocalStorage)return{success:!1,message:"Circles require Firebase"};try{const n=firebase.firestore().collection("circles").doc(e),r=await n.get();if(!r.exists)return{success:!1,message:"Circle not found"};return r.data().creator===this.currentUser.uid?{success:!1,message:"Circle creator cannot leave. Delete the circle instead."}:(await n.update({members:firebase.firestore.FieldValue.arrayRemove(this.currentUser.uid),memberCount:firebase.firestore.FieldValue.increment(-1),"stats.activeMembers":firebase.firestore.FieldValue.increment(-1)}),await this.sendMessage(e,{text:`${this.currentUser.displayName} left the circle`,type:"system"}),await this.loadMyCircles(),{success:!0,message:"Left the circle"})}catch(e){return console.error("Error leaving circle:",e),{success:!1,message:"Failed to leave circle"}}}async deleteCircle(e){if(this.useLocalStorage)return{success:!1,message:"Circles require Firebase"};try{const n=firebase.firestore(),r=n.collection("circles").doc(e),t=await r.get();if(!t.exists)return{success:!1,message:"Circle not found"};if(t.data().creator!==this.currentUser.uid)return{success:!1,message:"Only the creator can delete the circle"};await r.delete();const s=await n.collection("circleMessages").where("circleId","==",e).get(),i=n.batch();return s.forEach(e=>i.delete(e.ref)),await i.commit(),await this.loadMyCircles(),{success:!0,message:"Circle deleted"}}catch(e){return console.error("Error deleting circle:",e),{success:!1,message:"Failed to delete circle"}}}async sendMessage(e,n){if(this.useLocalStorage)return{success:!1,message:"Chat requires Firebase"};try{const r=firebase.firestore(),t={circleId:e,userId:this.currentUser.uid,userName:this.currentUser.displayName,text:n.text,type:n.type||"user",timestamp:firebase.firestore.FieldValue.serverTimestamp()};return await r.collection("circleMessages").add(t),await r.collection("circles").doc(e).update({"stats.totalActivities":firebase.firestore.FieldValue.increment(1),updatedAt:firebase.firestore.FieldValue.serverTimestamp()}),"user"===n.type&&window.progressSystem&&window.progressSystem.awardXP(5,"Circle message sent","guilds"),{success:!0}}catch(e){return console.error("Error sending message:",e),{success:!1,message:"Failed to send message"}}}setupCircleChat(e,n){if(this.useLocalStorage)return;if(!document.getElementById(n))return;firebase.firestore().collection("circleMessages").where("circleId","==",e).orderBy("timestamp","desc").limit(50).onSnapshot(e=>{const r=[];e.forEach(e=>{r.push({id:e.id,...e.data()})}),r.reverse(),this.renderChatMessages(n,r)})}renderChatMessages(e,n){const r=document.getElementById(e);r&&(r.innerHTML=n.map(e=>{if("system"===e.type)return`\n                    <div class="system-message">\n                        <span>${e.text}</span>\n                    </div>\n                `;const n=e.userId===this.currentUser?.uid,r=e.timestamp?new Date(e.timestamp.toDate()).toLocaleTimeString():"";return`\n                <div class="chat-message ${n?"own-message":""}">\n                    <div class="message-header">\n                        <strong>${e.userName}</strong>\n                        <span class="message-time">${r}</span>\n                    </div>\n                    <div class="message-text">${e.text}</div>\n                </div>\n            `}).join(""),r.scrollTop=r.scrollHeight)}async createSharedGoal(e,n){if(this.useLocalStorage)return{success:!1,message:"Shared goals require Firebase"};try{const r=firebase.firestore(),t={circleId:e,title:n.title,description:n.description,target:n.target,current:0,type:n.type||"collective",xpReward:n.xpReward||500,deadline:n.deadline||null,participants:[],progress:{},createdBy:this.currentUser.uid,createdAt:firebase.firestore.FieldValue.serverTimestamp(),status:"active"},s=await r.collection("circleGoals").add(t);return await r.collection("circles").doc(e).update({goals:firebase.firestore.FieldValue.arrayUnion(s.id)}),await this.sendMessage(e,{text:`üìå New shared goal: ${t.title}`,type:"system"}),window.progressSystem&&window.progressSystem.awardXP(30,"Created shared goal","guilds"),{success:!0,message:"Shared goal created! üìå",goal:{id:s.id,...t}}}catch(e){return console.error("Error creating shared goal:",e),{success:!1,message:"Failed to create goal"}}}async contributeToGoal(e,n){if(this.useLocalStorage)return{success:!1};try{const r=firebase.firestore().collection("circleGoals").doc(e),t=await r.get();if(!t.exists)return{success:!1,message:"Goal not found"};const s=t.data();await r.update({current:firebase.firestore.FieldValue.increment(n),[`progress.${this.currentUser.uid}`]:firebase.firestore.FieldValue.increment(n)});return s.current+n>=s.target&&"active"===s.status&&await this.completeCircleGoal(e),window.progressSystem&&window.progressSystem.awardXP(20,"Contributed to circle goal","guilds"),{success:!0,message:`Contributed ${n} to goal!`}}catch(e){return console.error("Error contributing to goal:",e),{success:!1}}}async completeCircleGoal(e){if(!this.useLocalStorage)try{const n=firebase.firestore(),r=n.collection("circleGoals").doc(e),t=(await r.get()).data();await r.update({status:"completed",completedAt:firebase.firestore.FieldValue.serverTimestamp()});const s=await n.collection("circles").doc(t.circleId).get();s.data().members.forEach(e=>{}),await this.sendMessage(t.circleId,{text:`üéâ Shared goal completed: ${t.title}! Everyone earns ${t.xpReward} XP!`,type:"system"}),window.progressSystem&&window.progressSystem.awardXP(t.xpReward,`Circle goal completed: ${t.title}`,"guilds")}catch(e){console.error("Error completing goal:",e)}}async getCircleLeaderboard(e){if(this.useLocalStorage)return{success:!1,members:[]};try{const n=firebase.firestore(),r=await n.collection("circles").doc(e).get();if(!r.exists)return{success:!1,members:[]};const t=r.data(),s=await Promise.all(t.members.map(async e=>{const r=await n.collection("userProgress").doc(e).get(),t=await n.collection("users").doc(e).get();return{uid:e,name:t.exists?t.data().displayName:"User",xp:r.exists?r.data().xp:0,level:r.exists?r.data().level:1,achievements:r.exists&&r.data().achievements?.length||0}}));return s.sort((e,n)=>n.xp-e.xp),{success:!0,members:s}}catch(e){return console.error("Error getting leaderboard:",e),{success:!1,members:[]}}}openCirclesModal(){const e=document.createElement("div");e.className="circles-modal",e.id="circlesModal",e.innerHTML=`\n            <div class="circles-modal-content">\n                <div class="circles-modal-header">\n                    <h2>üè∞ Spiritual Circles</h2>\n                    <button onclick="document.getElementById('circlesModal').remove()" class="modal-close">‚úï</button>\n                </div>\n\n                <div class="circles-tabs">\n                    <button class="circles-tab active" onclick="window.guildsSystem.switchCircleTab('my-circles')">\n                        My Circles (${this.myCircles.length})\n                    </button>\n                    <button class="circles-tab" onclick="window.guildsSystem.switchCircleTab('discover')">\n                        Discover\n                    </button>\n                    <button class="circles-tab" onclick="window.guildsSystem.switchCircleTab('create')">\n                        Create Circle\n                    </button>\n                </div>\n\n                <div class="circles-content" id="circlesContent">\n                    ${this.renderMyCirclesTab()}\n                </div>\n            </div>\n        `,this.addCirclesModalStyles(),document.body.appendChild(e)}switchCircleTab(e){document.querySelectorAll(".circles-tab").forEach(e=>e.classList.remove("active")),event.target.classList.add("active");const n=document.getElementById("circlesContent");switch(e){case"my-circles":n.innerHTML=this.renderMyCirclesTab();break;case"discover":n.innerHTML=this.renderDiscoverTab(),this.loadDiscoverCircles();break;case"create":n.innerHTML=this.renderCreateCircleTab()}}renderMyCirclesTab(){return 0===this.myCircles.length?'\n                <div class="empty-state">\n                    <div class="empty-icon">üè∞</div>\n                    <h3>No circles yet</h3>\n                    <p>Join or create a circle to connect with fellow spiritual seekers!</p>\n                </div>\n            ':`\n            <div class="circles-list">\n                ${this.myCircles.map(e=>this.renderCircleCard(e,!0)).join("")}\n            </div>\n        `}renderDiscoverTab(){return`\n            <div class="discover-section">\n                <div class="search-bar">\n                    <input type="text" id="circleSearch" placeholder="Search circles..." class="search-input">\n                    <button onclick="window.guildsSystem.searchCirclesFromModal()" class="search-btn">üîç</button>\n                </div>\n\n                <div class="circle-types">\n                    ${["general","meditation","healing","manifestation","study","support"].map(e=>`\n                        <button onclick="window.guildsSystem.filterByType('${e}')" class="type-filter-btn">\n                            ${this.getCircleTypeIcon(e)} ${e}\n                        </button>\n                    `).join("")}\n                </div>\n\n                <div id="discoverResults" class="circles-list">\n                    <p class="loading-text">Loading circles...</p>\n                </div>\n            </div>\n        `}async loadDiscoverCircles(){const e=await this.searchCircles(),n=document.getElementById("discoverResults");n&&(0===e.circles.length?n.innerHTML='<p class="no-results">No circles found. Create the first one!</p>':n.innerHTML=e.circles.map(e=>this.renderCircleCard(e,!1)).join(""))}async searchCirclesFromModal(){const e=document.getElementById("circleSearch").value,n=await this.searchCircles(e),r=document.getElementById("discoverResults");r&&(r.innerHTML=n.circles.map(e=>this.renderCircleCard(e,!1)).join(""))}async filterByType(e){const n=await this.searchCircles("",{type:e}),r=document.getElementById("discoverResults");r&&(r.innerHTML=n.circles.map(e=>this.renderCircleCard(e,!1)).join(""))}getCircleTypeIcon(e){return{general:"‚≠ê",meditation:"üßò",healing:"üíö",manifestation:"‚ú®",study:"üìö",support:"ü§ù"}[e]||"‚≠ê"}renderCircleCard(e,n){return`\n            <div class="circle-card">\n                <div class="circle-header">\n                    <div class="circle-icon">${this.getCircleTypeIcon(e.type)}</div>\n                    <div class="circle-info">\n                        <h3>${e.name}</h3>\n                        <p class="circle-desc">${e.description}</p>\n                    </div>\n                </div>\n\n                <div class="circle-stats">\n                    <span>üë• ${e.memberCount}/${e.maxMembers}</span>\n                    <span>‚ö° ${e.stats?.totalXP||0} XP</span>\n                    ${e.isPrivate?"<span>üîí Private</span>":"<span>üåê Public</span>"}\n                </div>\n\n                ${e.tags&&e.tags.length>0?`\n                    <div class="circle-tags">\n                        ${e.tags.map(e=>`<span class="circle-tag">#${e}</span>`).join("")}\n                    </div>\n                `:""}\n\n                <div class="circle-actions">\n                    ${n?`\n                        <button onclick="window.guildsSystem.openCircleView('${e.id}')" class="circle-btn primary">\n                            üè∞ Enter Circle\n                        </button>\n                        ${e.creator===this.currentUser?.uid?`\n                            <button onclick="window.guildsSystem.deleteCircle('${e.id}')" class="circle-btn danger">\n                                Delete\n                            </button>\n                        `:`\n                            <button onclick="window.guildsSystem.leaveCircle('${e.id}')" class="circle-btn">\n                                Leave\n                            </button>\n                        `}\n                    `:`\n                        <button onclick="window.guildsSystem.joinCircle('${e.id}')" class="circle-btn primary">\n                            Join Circle\n                        </button>\n                    `}\n                </div>\n            </div>\n        `}renderCreateCircleTab(){return'\n            <div class="create-circle-section">\n                <form id="createCircleForm" class="create-circle-form">\n                    <div class="form-group">\n                        <label>üè∞ Circle Name:</label>\n                        <input type="text" id="circleName" placeholder="e.g., Meditation Masters" required class="form-input">\n                    </div>\n\n                    <div class="form-group">\n                        <label>üìù Description:</label>\n                        <textarea id="circleDescription" rows="4" placeholder="What is your circle about?" required class="form-textarea"></textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <label>üéØ Circle Type:</label>\n                        <select id="circleType" class="form-select">\n                            <option value="general">‚≠ê General</option>\n                            <option value="meditation">üßò Meditation</option>\n                            <option value="healing">üíö Healing</option>\n                            <option value="manifestation">‚ú® Manifestation</option>\n                            <option value="study">üìö Study</option>\n                            <option value="support">ü§ù Support</option>\n                        </select>\n                    </div>\n\n                    <div class="form-group">\n                        <label>üë• Max Members:</label>\n                        <input type="number" id="circleMaxMembers" value="20" min="2" max="50" class="form-input">\n                    </div>\n\n                    <div class="form-group">\n                        <label>üè∑Ô∏è Tags (comma-separated):</label>\n                        <input type="text" id="circleTags" placeholder="meditation, mindfulness, healing" class="form-input">\n                    </div>\n\n                    <div class="form-group">\n                        <label class="checkbox-label">\n                            <input type="checkbox" id="circlePrivate">\n                            üîí Make this circle private (invite-only)\n                        </label>\n                    </div>\n\n                    <button type="button" onclick="window.guildsSystem.createCircleFromModal()" class="submit-btn">\n                        üè∞ Create Circle\n                    </button>\n                </form>\n            </div>\n        '}async createCircleFromModal(){const e=document.getElementById("circleName").value.trim(),n=document.getElementById("circleDescription").value.trim(),r=document.getElementById("circleType").value,t=parseInt(document.getElementById("circleMaxMembers").value),s=document.getElementById("circleTags").value,i=document.getElementById("circlePrivate").checked,a=s.split(",").map(e=>e.trim()).filter(e=>e.length>0),c=await this.createCircle({name:e,description:n,type:r,maxMembers:t,tags:a,isPrivate:i});c.success?(alert(c.message),this.switchCircleTab("my-circles")):alert(c.message)}async openCircleView(e){const n=this.myCircles.find(n=>n.id===e);if(!n)return;const r=document.createElement("div");r.className="circle-view-modal",r.id="circleViewModal",r.innerHTML=`\n            <div class="circle-view-content">\n                <div class="circle-view-header">\n                    <div>\n                        <div class="circle-type-badge">${this.getCircleTypeIcon(n.type)} ${n.type}</div>\n                        <h2>${n.name}</h2>\n                        <p>${n.description}</p>\n                    </div>\n                    <button onclick="document.getElementById('circleViewModal').remove()" class="modal-close">‚úï</button>\n                </div>\n\n                <div class="circle-view-tabs">\n                    <button class="view-tab active" onclick="window.guildsSystem.switchViewTab('chat', '${e}')">\n                        üí¨ Chat\n                    </button>\n                    <button class="view-tab" onclick="window.guildsSystem.switchViewTab('goals', '${e}')">\n                        üìå Goals\n                    </button>\n                    <button class="view-tab" onclick="window.guildsSystem.switchViewTab('leaderboard', '${e}')">\n                        üèÜ Leaderboard\n                    </button>\n                    <button class="view-tab" onclick="window.guildsSystem.switchViewTab('members', '${e}')">\n                        üë• Members (${n.memberCount})\n                    </button>\n                </div>\n\n                <div class="circle-view-body" id="circleViewBody">\n                    ${this.renderChatTab(e)}\n                </div>\n            </div>\n        `,document.body.appendChild(r),setTimeout(()=>{this.setupCircleChat(e,"circleChatMessages")},100)}switchViewTab(e,n){document.querySelectorAll(".view-tab").forEach(e=>e.classList.remove("active")),event.target.classList.add("active");const r=document.getElementById("circleViewBody");switch(e){case"chat":r.innerHTML=this.renderChatTab(n),setTimeout(()=>{this.setupCircleChat(n,"circleChatMessages")},100);break;case"goals":r.innerHTML=this.renderGoalsTab(n);break;case"leaderboard":r.innerHTML=this.renderLeaderboardTab(n),this.loadCircleLeaderboard(n);break;case"members":r.innerHTML=this.renderMembersTab(n)}}renderChatTab(e){return`\n            <div class="circle-chat">\n                <div class="chat-messages" id="circleChatMessages">\n                    <p class="loading-text">Loading messages...</p>\n                </div>\n\n                <div class="chat-input-area">\n                    <input type="text" id="circleChatInput" placeholder="Type your message..." class="chat-input">\n                    <button onclick="window.guildsSystem.sendChatMessage('${e}')" class="send-btn">\n                        üì® Send\n                    </button>\n                </div>\n            </div>\n        `}async sendChatMessage(e){const n=document.getElementById("circleChatInput"),r=n.value.trim();if(!r)return;(await this.sendMessage(e,{text:r,type:"user"})).success&&(n.value="")}renderGoalsTab(e){return'\n            <div class="circle-goals">\n                <button onclick="alert(\'Create goal feature coming soon!\')" class="create-goal-btn">\n                    üìå Create Shared Goal\n                </button>\n\n                <div id="circleGoalsList" class="goals-list">\n                    <p class="empty-text">No active goals yet. Create one to get started!</p>\n                </div>\n            </div>\n        '}renderLeaderboardTab(e){return'\n            <div class="circle-leaderboard" id="circleLeaderboardContent">\n                <p class="loading-text">Loading leaderboard...</p>\n            </div>\n        '}async loadCircleLeaderboard(e){const n=await this.getCircleLeaderboard(e),r=document.getElementById("circleLeaderboardContent");r&&(n.success&&n.members.length>0?r.innerHTML=`\n                <div class="leaderboard-list">\n                    ${n.members.map((e,n)=>`\n                        <div class="leaderboard-item ${e.uid===this.currentUser?.uid?"own-rank":""}">\n                            <div class="rank">#${n+1}</div>\n                            <div class="member-info">\n                                <strong>${e.name}</strong>\n                                <div class="member-stats">\n                                    Level ${e.level} ‚Ä¢ ${e.xp.toLocaleString()} XP ‚Ä¢ ${e.achievements} achievements\n                                </div>\n                            </div>\n                            ${n<3?`<div class="medal">${["ü•á","ü•à","ü•â"][n]}</div>`:""}\n                        </div>\n                    `).join("")}\n                </div>\n            `:r.innerHTML='<p class="empty-text">No leaderboard data available</p>')}renderMembersTab(e){return'\n            <div class="circle-members">\n                <p class="empty-text">Member list coming soon!</p>\n            </div>\n        '}addCirclesModalStyles(){if(document.getElementById("circlesModalStyles"))return;const e=document.createElement("style");e.id="circlesModalStyles",e.textContent='\n            .circles-modal, .circle-view-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n                animation: fadeIn 0.3s ease;\n            }\n\n            .circles-modal-content, .circle-view-content {\n                background: white;\n                border-radius: 20px;\n                width: 90%;\n                max-width: 900px;\n                max-height: 90vh;\n                overflow: hidden;\n                display: flex;\n                flex-direction: column;\n                animation: slideUp 0.3s ease;\n            }\n\n            .circles-modal-header, .circle-view-header {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 25px 30px;\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n            }\n\n            .circle-view-header h2 {\n                margin: 10px 0 5px 0;\n            }\n\n            .circle-view-header p {\n                margin: 0;\n                opacity: 0.95;\n            }\n\n            .circle-type-badge {\n                display: inline-block;\n                padding: 4px 12px;\n                background: rgba(255,255,255,0.2);\n                border-radius: 20px;\n                font-size: 13px;\n                font-weight: 600;\n                margin-bottom: 8px;\n            }\n\n            .modal-close {\n                background: rgba(255,255,255,0.2);\n                border: none;\n                color: white;\n                width: 32px;\n                height: 32px;\n                border-radius: 50%;\n                cursor: pointer;\n                font-size: 20px;\n                flex-shrink: 0;\n            }\n\n            .circles-tabs, .circle-view-tabs {\n                display: flex;\n                border-bottom: 2px solid #e0e0e0;\n                background: #f9f9f9;\n            }\n\n            .circles-tab, .view-tab {\n                flex: 1;\n                padding: 15px;\n                border: none;\n                background: none;\n                cursor: pointer;\n                font-weight: 600;\n                color: #666;\n                transition: all 0.2s;\n            }\n\n            .circles-tab.active, .view-tab.active {\n                color: #667eea;\n                background: white;\n                border-bottom: 3px solid #667eea;\n            }\n\n            .circles-content, .circle-view-body {\n                flex: 1;\n                overflow-y: auto;\n                padding: 20px;\n            }\n\n            .circles-list {\n                display: grid;\n                gap: 20px;\n            }\n\n            .circle-card {\n                background: white;\n                border: 2px solid #e0e0e0;\n                border-radius: 15px;\n                padding: 20px;\n                transition: all 0.2s;\n            }\n\n            .circle-card:hover {\n                border-color: #667eea;\n                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);\n            }\n\n            .circle-header {\n                display: flex;\n                gap: 15px;\n                margin-bottom: 15px;\n            }\n\n            .circle-icon {\n                font-size: 40px;\n                flex-shrink: 0;\n            }\n\n            .circle-info h3 {\n                margin: 0 0 8px 0;\n                font-size: 20px;\n            }\n\n            .circle-desc {\n                margin: 0;\n                color: #666;\n                line-height: 1.5;\n            }\n\n            .circle-stats {\n                display: flex;\n                gap: 20px;\n                margin: 15px 0;\n                font-size: 14px;\n                color: #666;\n            }\n\n            .circle-tags {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 8px;\n                margin: 15px 0;\n            }\n\n            .circle-tag {\n                padding: 4px 12px;\n                background: #f0f0f0;\n                color: #667eea;\n                border-radius: 20px;\n                font-size: 12px;\n                font-weight: 600;\n            }\n\n            .circle-actions {\n                display: flex;\n                gap: 10px;\n                margin-top: 15px;\n            }\n\n            .circle-btn {\n                flex: 1;\n                padding: 10px 20px;\n                border: 2px solid #e0e0e0;\n                background: white;\n                border-radius: 8px;\n                cursor: pointer;\n                font-weight: 600;\n                transition: all 0.2s;\n            }\n\n            .circle-btn.primary {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                border: none;\n            }\n\n            .circle-btn.primary:hover {\n                transform: translateY(-2px);\n            }\n\n            .circle-btn.danger {\n                border-color: #ef4444;\n                color: #ef4444;\n            }\n\n            .empty-state {\n                text-align: center;\n                padding: 60px 20px;\n                color: #999;\n            }\n\n            .empty-icon {\n                font-size: 64px;\n                margin-bottom: 20px;\n            }\n\n            .empty-state h3 {\n                margin: 0 0 10px 0;\n                color: #666;\n            }\n\n            .discover-section {\n                max-width: 800px;\n                margin: 0 auto;\n            }\n\n            .search-bar {\n                display: flex;\n                gap: 10px;\n                margin-bottom: 20px;\n            }\n\n            .search-input {\n                flex: 1;\n                padding: 12px;\n                border: 2px solid #e0e0e0;\n                border-radius: 10px;\n                font-size: 15px;\n            }\n\n            .search-btn {\n                padding: 12px 24px;\n                border: none;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                border-radius: 10px;\n                cursor: pointer;\n                font-size: 16px;\n            }\n\n            .circle-types {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 10px;\n                margin-bottom: 25px;\n            }\n\n            .type-filter-btn {\n                padding: 8px 16px;\n                border: 2px solid #e0e0e0;\n                background: white;\n                border-radius: 20px;\n                cursor: pointer;\n                font-weight: 600;\n                transition: all 0.2s;\n                text-transform: capitalize;\n            }\n\n            .type-filter-btn:hover {\n                border-color: #667eea;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n            }\n\n            .create-circle-section {\n                max-width: 600px;\n                margin: 0 auto;\n            }\n\n            .create-circle-form {\n                background: #f9f9f9;\n                padding: 30px;\n                border-radius: 15px;\n            }\n\n            .form-group {\n                margin-bottom: 20px;\n            }\n\n            .form-group label {\n                display: block;\n                margin-bottom: 8px;\n                font-weight: 600;\n                color: #333;\n            }\n\n            .form-input, .form-select, .form-textarea {\n                width: 100%;\n                padding: 12px;\n                border: 2px solid #e0e0e0;\n                border-radius: 8px;\n                font-size: 15px;\n                font-family: inherit;\n            }\n\n            .form-textarea {\n                resize: vertical;\n            }\n\n            .checkbox-label {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                cursor: pointer;\n            }\n\n            .checkbox-label input[type="checkbox"] {\n                width: 20px;\n                height: 20px;\n                cursor: pointer;\n            }\n\n            .submit-btn {\n                width: 100%;\n                padding: 14px;\n                border: none;\n                border-radius: 10px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                font-size: 16px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: transform 0.2s;\n            }\n\n            .submit-btn:hover {\n                transform: translateY(-2px);\n            }\n\n            .circle-chat {\n                display: flex;\n                flex-direction: column;\n                height: 500px;\n            }\n\n            .chat-messages {\n                flex: 1;\n                overflow-y: auto;\n                padding: 20px;\n                background: #f9f9f9;\n                border-radius: 10px;\n                margin-bottom: 15px;\n            }\n\n            .chat-message {\n                margin-bottom: 15px;\n                padding: 12px;\n                background: white;\n                border-radius: 10px;\n                max-width: 70%;\n            }\n\n            .chat-message.own-message {\n                margin-left: auto;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n            }\n\n            .message-header {\n                display: flex;\n                justify-content: space-between;\n                margin-bottom: 5px;\n                font-size: 13px;\n            }\n\n            .message-time {\n                opacity: 0.7;\n                font-size: 12px;\n            }\n\n            .message-text {\n                line-height: 1.5;\n            }\n\n            .system-message {\n                text-align: center;\n                padding: 8px;\n                margin: 10px 0;\n                color: #999;\n                font-size: 13px;\n                font-style: italic;\n            }\n\n            .chat-input-area {\n                display: flex;\n                gap: 10px;\n            }\n\n            .chat-input {\n                flex: 1;\n                padding: 12px;\n                border: 2px solid #e0e0e0;\n                border-radius: 10px;\n                font-size: 15px;\n            }\n\n            .send-btn {\n                padding: 12px 24px;\n                border: none;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                border-radius: 10px;\n                cursor: pointer;\n                font-weight: 600;\n            }\n\n            .leaderboard-list {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n\n            .leaderboard-item {\n                display: flex;\n                align-items: center;\n                gap: 15px;\n                padding: 15px;\n                background: #f9f9f9;\n                border-radius: 10px;\n                border-left: 4px solid #667eea;\n            }\n\n            .leaderboard-item.own-rank {\n                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);\n                border-left-color: #764ba2;\n            }\n\n            .rank {\n                font-size: 24px;\n                font-weight: bold;\n                color: #667eea;\n                min-width: 50px;\n            }\n\n            .member-info {\n                flex: 1;\n            }\n\n            .member-info strong {\n                display: block;\n                margin-bottom: 5px;\n            }\n\n            .member-stats {\n                font-size: 13px;\n                color: #666;\n            }\n\n            .medal {\n                font-size: 32px;\n            }\n\n            .loading-text, .empty-text, .no-results {\n                text-align: center;\n                padding: 40px;\n                color: #999;\n            }\n\n            .create-goal-btn {\n                width: 100%;\n                padding: 14px;\n                border: 2px dashed #667eea;\n                background: white;\n                color: #667eea;\n                border-radius: 10px;\n                cursor: pointer;\n                font-weight: 600;\n                margin-bottom: 20px;\n                transition: all 0.2s;\n            }\n\n            .create-goal-btn:hover {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                border-style: solid;\n            }\n\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n\n            @keyframes slideUp {\n                from {\n                    transform: translateY(50px);\n                    opacity: 0;\n                }\n                to {\n                    transform: translateY(0);\n                    opacity: 1;\n                }\n            }\n        ',document.head.appendChild(e)}}"undefined"!=typeof window&&(window.guildsSystem=new GuildsSystem,console.log("üè∞ Guilds/Circles System ready!"));