class RewardShopSystem{constructor(){this.currentUser=null,this.shopData=null,this.isInitialized=!1,this.shopCatalog={themes:[{id:"theme_sunset",name:"Sunset Serenity",description:"Warm orange and pink gradients",cost:500,icon:"üåÖ",type:"theme",preview:"linear-gradient(135deg, #ff6b6b, #feca57, #ee5a6f)"},{id:"theme_ocean",name:"Ocean Depths",description:"Deep blue and teal tones",cost:500,icon:"üåä",type:"theme",preview:"linear-gradient(135deg, #1e3c72, #2a5298, #7303c0)"},{id:"theme_forest",name:"Forest Sanctuary",description:"Natural green and earth tones",cost:500,icon:"üå≤",type:"theme",preview:"linear-gradient(135deg, #134e5e, #71b280)"},{id:"theme_aurora",name:"Aurora Borealis",description:"Mystical northern lights",cost:1e3,icon:"üåå",type:"theme",premium:!0,preview:"linear-gradient(135deg, #00d2ff, #928dab, #ff00ff)"},{id:"theme_golden",name:"Golden Temple",description:"Luxurious gold and purple",cost:1500,icon:"üëë",type:"theme",premium:!0,preview:"linear-gradient(135deg, #D4AF37, #FFD700, #8B5CF6)"}],sounds:[{id:"sound_tibetan",name:"Tibetan Singing Bowls",description:"Deep resonant bowl tones",cost:300,icon:"üéµ",type:"sound"},{id:"sound_rain",name:"Rainforest Ambience",description:"Gentle rain and birds",cost:300,icon:"üåßÔ∏è",type:"sound"},{id:"sound_ocean",name:"Ocean Waves",description:"Calming beach sounds",cost:300,icon:"üåä",type:"sound"},{id:"sound_crystal",name:"Crystal Harmonics",description:"Pure crystalline tones",cost:600,icon:"üíé",type:"sound",premium:!0},{id:"sound_cosmic",name:"Cosmic Frequencies",description:"Space-inspired soundscapes",cost:800,icon:"üåå",type:"sound",premium:!0}],decks:[{id:"deck_angels",name:"Angel Guidance Deck",description:"44 angelic messages",cost:800,icon:"üëº",type:"deck"},{id:"deck_crystals",name:"Crystal Oracle Deck",description:"48 crystal wisdom cards",cost:800,icon:"üíé",type:"deck"},{id:"deck_goddess",name:"Goddess Power Deck",description:"52 divine feminine cards",cost:1e3,icon:"üë∏",type:"deck",premium:!0},{id:"deck_ancient",name:"Ancient Wisdom Deck",description:"78 mystical teachings",cost:1500,icon:"üìú",type:"deck",premium:!0}],effects:[{id:"effect_rainbow",name:"Rainbow Celebration",description:"Colorful particle burst",cost:400,icon:"üåà",type:"effect"},{id:"effect_stars",name:"Starfall Effect",description:"Falling stars animation",cost:400,icon:"‚≠ê",type:"effect"},{id:"effect_hearts",name:"Love & Light",description:"Floating hearts",cost:400,icon:"üíñ",type:"effect"},{id:"effect_divine",name:"Divine Radiance",description:"Golden light rays",cost:1e3,icon:"‚ú®",type:"effect",premium:!0}],avatars:[{id:"avatar_lotus",name:"Lotus Master",description:"Sacred lotus symbol",cost:200,icon:"ü™∑",type:"avatar"},{id:"avatar_om",name:"Om Symbol",description:"Universal sound",cost:200,icon:"üïâÔ∏è",type:"avatar"},{id:"avatar_phoenix",name:"Phoenix Rising",description:"Transformation symbol",cost:500,icon:"üî•",type:"avatar",premium:!0},{id:"avatar_dragon",name:"Mystic Dragon",description:"Eastern wisdom",cost:800,icon:"üêâ",type:"avatar",premium:!0}],boosters:[{id:"boost_xp_24h",name:"24h XP Booster",description:"+50% XP for 24 hours",cost:300,icon:"‚ö°",type:"booster",duration:864e5},{id:"boost_xp_week",name:"Weekly XP Booster",description:"+50% XP for 7 days",cost:1500,icon:"‚ö°‚ö°",type:"booster",duration:6048e5},{id:"boost_double_xp",name:"Double XP (24h)",description:"2x XP for 24 hours",cost:2e3,icon:"üí´",type:"booster",premium:!0,duration:864e5,multiplier:2}]},this.init()}async init(){console.log("üõçÔ∏è Initializing Reward Shop System..."),"undefined"!=typeof firebase&&firebase.auth?firebase.auth().onAuthStateChanged(async e=>{this.currentUser=e,e?await this.loadShopData():this.loadLocalShopData(),this.isInitialized=!0,console.log("‚úÖ Reward Shop System ready")}):(this.loadLocalShopData(),this.isInitialized=!0,console.log("‚úÖ Reward Shop System ready (local mode)"))}async loadShopData(){if(this.currentUser)try{const e=firebase.firestore(),t=await e.collection("rewardShop").doc(this.currentUser.uid).get();t.exists?this.shopData=t.data():(this.shopData=this.getDefaultShopData(),await this.saveShopData())}catch(e){console.error("Error loading shop data:",e),this.loadLocalShopData()}}loadLocalShopData(){const e=localStorage.getItem("rewardShopData");e?this.shopData=JSON.parse(e):(this.shopData=this.getDefaultShopData(),this.saveLocalShopData())}getDefaultShopData(){return{ownedItems:[],activeTheme:"default",activeSound:"default",activeEffect:"default",activeAvatar:"default",activeBoosters:[],purchaseHistory:[]}}async saveShopData(){if(this.currentUser&&"undefined"!=typeof firebase)try{const e=firebase.firestore();await e.collection("rewardShop").doc(this.currentUser.uid).set(this.shopData)}catch(e){console.error("Error saving shop data:",e)}this.saveLocalShopData()}saveLocalShopData(){localStorage.setItem("rewardShopData",JSON.stringify(this.shopData))}async purchaseItem(e){const t=this.findItemById(e);if(!t)return{success:!1,message:"Item not found"};if(this.isItemOwned(e))return{success:!1,message:"Already owned"};const a=window.progressSystem?.userData?.totalXP||0;return a<t.cost?{success:!1,message:`Need ${t.cost-a} more XP`}:(window.progressSystem&&(window.progressSystem.userData.totalXP-=t.cost,await window.progressSystem.saveUserData()),this.shopData.ownedItems.push({id:e,purchasedAt:(new Date).toISOString(),cost:t.cost}),this.shopData.purchaseHistory.unshift({itemId:e,itemName:t.name,cost:t.cost,date:(new Date).toISOString()}),"theme"===t.type?(this.shopData.activeTheme=e,this.applyTheme(e)):"booster"===t.type&&this.activateBooster(t),await this.saveShopData(),this.showPurchaseNotification(t),{success:!0,message:"Purchase successful!"})}activateBooster(e){const t={id:e.id,activatedAt:Date.now(),expiresAt:Date.now()+e.duration,multiplier:e.multiplier||1.5};this.shopData.activeBoosters.push(t),this.saveShopData(),setTimeout(()=>{this.expireBooster(e.id)},e.duration)}expireBooster(e){this.shopData.activeBoosters=this.shopData.activeBoosters.filter(t=>t.id!==e),this.saveShopData(),console.log(`‚ö° Booster expired: ${e}`)}getActiveBoosterMultiplier(){let e=1;const t=Date.now();return this.shopData.activeBoosters.forEach(a=>{a.expiresAt>t&&(e*=a.multiplier)}),e}findItemById(e){for(const t of Object.values(this.shopCatalog)){const a=t.find(t=>t.id===e);if(a)return a}return null}isItemOwned(e){return this.shopData.ownedItems.some(t=>t.id===e)}applyTheme(e){const t=this.findItemById(e);t&&(document.documentElement.style.setProperty("--theme-gradient",t.preview),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{themeId:e,theme:t}})),console.log(`üé® Theme applied: ${t.name}`))}activateItem(e,t){switch(t){case"theme":this.shopData.activeTheme=e,this.applyTheme(e);break;case"sound":this.shopData.activeSound=e;break;case"effect":this.shopData.activeEffect=e;break;case"avatar":this.shopData.activeAvatar=e}this.saveShopData()}showPurchaseNotification(e){const t=document.createElement("div");t.className="purchase-notification",t.innerHTML=`\n            <div class="purchase-content">\n                <div class="purchase-icon">${e.icon}</div>\n                <div class="purchase-text">\n                    <div class="purchase-title">Purchase Complete!</div>\n                    <div class="purchase-name">${e.name}</div>\n                    <div class="purchase-cost">-${e.cost} XP</div>\n                </div>\n            </div>\n            <style>\n                .purchase-notification {\n                    position: fixed;\n                    top: 2rem;\n                    right: 2rem;\n                    background: linear-gradient(135deg, rgba(212, 175, 55, 0.95), rgba(255, 215, 0, 0.95));\n                    backdrop-filter: blur(20px);\n                    border-radius: 20px;\n                    padding: 1.5rem;\n                    box-shadow: 0 10px 40px rgba(212, 175, 55, 0.5);\n                    z-index: 99999;\n                    animation: slideInRight 0.5s ease;\n                    max-width: 350px;\n                }\n\n                .purchase-content {\n                    display: flex;\n                    gap: 1rem;\n                    align-items: center;\n                    color: #0F0F23;\n                }\n\n                .purchase-icon {\n                    font-size: 3rem;\n                }\n\n                .purchase-title {\n                    font-size: 0.9rem;\n                    font-weight: 600;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                    margin-bottom: 0.25rem;\n                }\n\n                .purchase-name {\n                    font-size: 1.3rem;\n                    font-weight: 700;\n                    margin-bottom: 0.25rem;\n                }\n\n                .purchase-cost {\n                    font-size: 1rem;\n                    font-weight: 700;\n                    color: #8B5CF6;\n                }\n            </style>\n        `,document.body.appendChild(t),window.divineAudio&&window.divineAudio.playBell(639,2),setTimeout(()=>{t.style.animation="slideOutRight 0.5s ease",setTimeout(()=>t.remove(),500)},4e3)}getCatalog(){return this.shopCatalog}getOwnedItems(){return this.shopData.ownedItems}getActiveItems(){return{theme:this.shopData.activeTheme,sound:this.shopData.activeSound,effect:this.shopData.activeEffect,avatar:this.shopData.activeAvatar,boosters:this.shopData.activeBoosters}}getPurchaseHistory(){return this.shopData.purchaseHistory}canAfford(e){const t=this.findItemById(e);if(!t)return!1;return(window.progressSystem?.userData?.totalXP||0)>=t.cost}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.rewardShop=new RewardShopSystem}):window.rewardShop=new RewardShopSystem,console.log("üõçÔ∏è Reward Shop System loaded");