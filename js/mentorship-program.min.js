class MentorshipProgram{constructor(){this.currentUser=null,this.userProfile=this.loadUserProfile(),this.mentorships=[],this.requests=[],this.useLocalStorage=!1,this.init()}async init(){console.log("ü§ù Mentorship Program initialized"),"undefined"!=typeof firebase&&firebase.auth?(this.useLocalStorage=!1,await this.initFirebase()):(console.warn("Firebase not available. Mentorship will use local data only."),this.useLocalStorage=!0,this.loadLocalData())}async initFirebase(){try{firebase.auth().onAuthStateChanged(async e=>{e?(this.currentUser={uid:e.uid,email:e.email,displayName:e.displayName||e.email.split("@")[0]},await this.loadUserMentorshipProfile(),await this.loadMentorships()):this.currentUser=null})}catch(e){console.error("Firebase initialization error:",e),this.useLocalStorage=!0,this.loadLocalData()}}loadLocalData(){const e=localStorage.getItem("mentorship_data");if(e){const s=JSON.parse(e);this.mentorships=s.mentorships||[],this.requests=s.requests||[]}this.currentUser={uid:localStorage.getItem("divine_temple_user_id")||"local_user",email:"local@user.com",displayName:"Local User"}}saveLocalData(){localStorage.setItem("mentorship_data",JSON.stringify({mentorships:this.mentorships,requests:this.requests}))}loadUserProfile(){const e=localStorage.getItem("mentorship_profile");return e?JSON.parse(e):{isMentor:!1,isMentee:!1,expertise:[],interests:[],availability:"",bio:"",completedSessions:0,rating:0,reviews:[]}}saveUserProfile(){localStorage.setItem("mentorship_profile",JSON.stringify(this.userProfile))}async loadUserMentorshipProfile(){if(!this.useLocalStorage&&this.currentUser)try{const e=firebase.firestore(),s=await e.collection("mentorshipProfiles").doc(this.currentUser.uid).get();s.exists&&(this.userProfile=s.data())}catch(e){console.error("Error loading mentorship profile:",e)}}async loadMentorships(){if(!this.useLocalStorage&&this.currentUser)try{const e=firebase.firestore(),s=await e.collection("mentorships").where("mentorId","==",this.currentUser.uid).where("status","==","active").get(),t=await e.collection("mentorships").where("menteeId","==",this.currentUser.uid).where("status","==","active").get();this.mentorships=[],s.forEach(e=>{this.mentorships.push({id:e.id,...e.data(),role:"mentor"})}),t.forEach(e=>{this.mentorships.push({id:e.id,...e.data(),role:"mentee"})}),console.log("Loaded mentorships:",this.mentorships.length)}catch(e){console.error("Error loading mentorships:",e)}}async becomeMentor(e){if(this.useLocalStorage)return{success:!1,message:"Mentorship requires Firebase"};if(!e.expertise||0===e.expertise.length)return{success:!1,message:"Please select at least one area of expertise"};if(!e.bio||e.bio.length<50)return{success:!1,message:"Bio must be at least 50 characters"};try{const s=firebase.firestore();return window.progressSystem&&window.progressSystem.level<10?{success:!1,message:"You must be at least Level 10 to become a mentor"}:(this.userProfile={...this.userProfile,isMentor:!0,expertise:e.expertise,availability:e.availability,bio:e.bio,becameMentorAt:(new Date).toISOString(),rating:0,totalReviews:0,completedSessions:0},await s.collection("mentorshipProfiles").doc(this.currentUser.uid).set(this.userProfile,{merge:!0}),this.saveUserProfile(),window.progressSystem&&window.progressSystem.awardXP(100,"Became a mentor! üéì","mentorship"),{success:!0,message:"Welcome to the mentor program! üéì"})}catch(e){return console.error("Error becoming mentor:",e),{success:!1,message:"Failed to join mentor program"}}}async requestMentorship(e){if(this.useLocalStorage)return{success:!1,message:"Mentorship requires Firebase"};if(!e.interests||0===e.interests.length)return{success:!1,message:"Please select at least one area of interest"};try{const s=firebase.firestore();this.userProfile={...this.userProfile,isMentee:!0,interests:e.interests,goals:e.goals||"",becameMenteeAt:(new Date).toISOString()},await s.collection("mentorshipProfiles").doc(this.currentUser.uid).set(this.userProfile,{merge:!0}),this.saveUserProfile();const t=await this.findMentorMatches();return window.progressSystem&&window.progressSystem.awardXP(20,"Joined mentorship program! üìö","mentorship"),{success:!0,message:"Profile created! Finding mentors...",matches:t}}catch(e){return console.error("Error requesting mentorship:",e),{success:!1,message:"Failed to request mentorship"}}}async findMentorMatches(e=10){if(this.useLocalStorage)return[];try{const s=firebase.firestore(),t=await s.collection("mentorshipProfiles").where("isMentor","==",!0).limit(50).get(),r=[];for(const e of t.docs){const t={uid:e.id,...e.data()};if(t.uid===this.currentUser.uid)continue;const o=this.calculateMatchScore(t);if(o>0){const e=await s.collection("users").doc(t.uid).get(),i=e.exists?e.data():{};r.push({...t,displayName:i.displayName||"Mentor",photoURL:i.photoURL||null,matchScore:o})}}return r.sort((e,s)=>s.matchScore-e.matchScore),r.slice(0,e)}catch(e){return console.error("Error finding mentor matches:",e),[]}}calculateMatchScore(e){let s=0;if(this.userProfile.interests&&e.expertise){s+=10*this.userProfile.interests.filter(s=>e.expertise.includes(s)).length}return e.rating&&(s+=2*e.rating),e.completedSessions&&(s+=Math.min(e.completedSessions,20)),s}async sendMentorRequest(e,s=""){if(this.useLocalStorage)return{success:!1,message:"Mentorship requires Firebase"};try{const t=firebase.firestore(),r={menteeId:this.currentUser.uid,menteeName:this.currentUser.displayName,mentorId:e,message:s,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()},o=await t.collection("mentorshipRequests").add(r);return window.progressSystem&&window.progressSystem.awardXP(10,"Sent mentor request","mentorship"),{success:!0,message:"Mentor request sent!",requestId:o.id}}catch(e){return console.error("Error sending mentor request:",e),{success:!1,message:"Failed to send request"}}}async acceptMentorRequest(e){if(this.useLocalStorage)return{success:!1};try{const s=firebase.firestore(),t=await s.collection("mentorshipRequests").doc(e).get();if(!t.exists)return{success:!1,message:"Request not found"};const r=t.data(),o={mentorId:r.mentorId,menteeId:r.menteeId,startDate:firebase.firestore.FieldValue.serverTimestamp(),status:"active",sessions:[],goals:[],resources:[]},i=await s.collection("mentorships").add(o);return await s.collection("mentorshipRequests").doc(e).update({status:"accepted",mentorshipId:i.id}),await this.loadMentorships(),window.progressSystem&&window.progressSystem.awardXP(50,"Accepted mentorship! üéì","mentorship"),{success:!0,message:"Mentorship started!",mentorshipId:i.id}}catch(e){return console.error("Error accepting request:",e),{success:!1,message:"Failed to accept request"}}}async scheduleSession(e,s){if(this.useLocalStorage)return{success:!1};try{const t=firebase.firestore(),r={date:s.date,duration:s.duration||60,topic:s.topic,type:s.type||"video",status:"scheduled",createdAt:firebase.firestore.FieldValue.serverTimestamp()};return await t.collection("mentorships").doc(e).update({sessions:firebase.firestore.FieldValue.arrayUnion(r)}),window.progressSystem&&window.progressSystem.awardXP(20,"Scheduled mentorship session","mentorship"),{success:!0,message:"Session scheduled!",session:r}}catch(e){return console.error("Error scheduling session:",e),{success:!1}}}async completeSession(e,s,t=""){if(this.useLocalStorage)return{success:!1};try{const r=firebase.firestore(),o=r.collection("mentorships").doc(e),i=await o.get();if(!i.exists)return{success:!1};const a=i.data().sessions||[];if(s>=a.length)return{success:!1};a[s].status="completed",a[s].completedAt=(new Date).toISOString(),a[s].notes=t,await o.update({sessions:a}),await r.collection("mentorshipProfiles").doc(this.currentUser.uid).update({completedSessions:firebase.firestore.FieldValue.increment(1)});const n=75;return window.progressSystem&&window.progressSystem.awardXP(n,"Completed mentorship session! üéØ","mentorship"),{success:!0,xp:n}}catch(e){return console.error("Error completing session:",e),{success:!1}}}async addGoal(e,s){if(this.useLocalStorage)return{success:!1};try{const t=firebase.firestore(),r={id:Date.now().toString(),title:s.title,description:s.description,targetDate:s.targetDate,status:"active",progress:0,createdAt:(new Date).toISOString()};return await t.collection("mentorships").doc(e).update({goals:firebase.firestore.FieldValue.arrayUnion(r)}),window.progressSystem&&window.progressSystem.awardXP(15,"Set mentorship goal","mentorship"),{success:!0,goal:r}}catch(e){return console.error("Error adding goal:",e),{success:!1}}}async completeGoal(e,s){if(this.useLocalStorage)return{success:!1};try{const t=firebase.firestore().collection("mentorships").doc(e),r=await t.get(),o=r.data().goals||[],i=o.findIndex(e=>e.id===s);return-1===i?{success:!1}:(o[i].status="completed",o[i].completedAt=(new Date).toISOString(),o[i].progress=100,await t.update({goals:o}),window.progressSystem&&window.progressSystem.awardXP(100,"Completed mentorship goal! üéØ","mentorship"),{success:!0,xp:100})}catch(e){return console.error("Error completing goal:",e),{success:!1}}}async rateMentor(e,s,t){if(this.useLocalStorage)return{success:!1};if(s<1||s>5)return{success:!1,message:"Rating must be between 1 and 5"};try{const r=firebase.firestore(),o={menteeId:this.currentUser.uid,menteeName:this.currentUser.displayName,rating:s,review:t,createdAt:firebase.firestore.FieldValue.serverTimestamp()};await r.collection("mentorReviews").add(o);const i=r.collection("mentorshipProfiles").doc(e),a=await i.get();if(a.exists){const e=a.data(),t=e.rating||0,r=(e.totalReviews||0)+1,o=(t*(r-1)+s)/r;await i.update({rating:o,totalReviews:r})}return window.progressSystem&&window.progressSystem.awardXP(25,"Reviewed mentor","mentorship"),{success:!0,message:"Thank you for your review!"}}catch(e){return console.error("Error rating mentor:",e),{success:!1,message:"Failed to submit review"}}}async graduateMentee(e){if(this.useLocalStorage)return{success:!1};try{const s=firebase.firestore();return await s.collection("mentorships").doc(e).update({status:"graduated",graduatedAt:firebase.firestore.FieldValue.serverTimestamp()}),window.progressSystem&&window.progressSystem.awardXP(500,"Mentorship graduation! üéìüéâ","mentorship"),{success:!0,message:"Congratulations on graduation! üéì",xp:500}}catch(e){return console.error("Error graduating mentee:",e),{success:!1}}}getExpertiseAreas(){return["Meditation","Mindfulness","Chakra Healing","Energy Work","Tarot Reading","Crystal Healing","Astrology","Yoga","Breathwork","Manifestation","Shadow Work","Kundalini","Reiki","Sound Healing","Sacred Geometry"]}getMentorshipStats(){return{isMentor:this.userProfile.isMentor,isMentee:this.userProfile.isMentee,activeMentorships:this.mentorships.filter(e=>"active"===e.status).length,completedSessions:this.userProfile.completedSessions||0,rating:this.userProfile.rating||0,totalReviews:this.userProfile.totalReviews||0}}openMentorshipDashboard(){console.log("Opening mentorship dashboard...");const e=this.getMentorshipStats();alert(`Mentorship Dashboard\n\nMentor: ${e.isMentor?"Yes":"No"}\nMentee: ${e.isMentee?"Yes":"No"}\nActive Mentorships: ${e.activeMentorships}\nCompleted Sessions: ${e.completedSessions}\nRating: ${e.rating.toFixed(1)} ‚≠ê`)}}"undefined"!=typeof window&&(window.mentorshipProgram=new MentorshipProgram,console.log("ü§ù Mentorship Program ready!"));