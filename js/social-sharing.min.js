class SocialSharingSystem{constructor(){this.shareData=this.loadShareData(),this.referralCode=this.generateReferralCode(),this.baseUrl=window.location.origin,this.init()}init(){console.log("üåü Social Sharing System initialized"),this.trackReferrals()}generateReferralCode(){const e=localStorage.getItem("divineTemple_referralCode");if(e)return e;const t="DT"+Math.random().toString(36).substr(2,8).toUpperCase();return localStorage.setItem("divineTemple_referralCode",t),t}loadShareData(){return JSON.parse(localStorage.getItem("divineTemple_shareData")||JSON.stringify({totalShares:0,referrals:0,referralRewards:0,lastShared:null,shareHistory:[]}))}saveShareData(){localStorage.setItem("divineTemple_shareData",JSON.stringify(this.shareData))}trackReferrals(){const e=new URLSearchParams(window.location.search).get("ref");e&&e!==this.referralCode&&(console.log("üìß Referral tracked:",e),localStorage.setItem("divineTemple_referredBy",e),this.recordReferral(e))}recordReferral(e){console.log("‚úÖ Referral recorded for code:",e)}shareAchievement(e,t="üèÜ"){const r=`üåü I just unlocked "${e}" ${t} on Divine Temple! Join me on this spiritual journey! ${this.baseUrl}?ref=${this.referralCode}`,a=`https://twitter.com/intent/tweet?text=${encodeURIComponent(r)}`;this.openShareWindow(a,"Twitter"),this.recordShare("twitter","achievement",e),window.progressSystem&&window.progressSystem.awardXP(50,"Shared achievement on social media","social")}shareStreak(e,t="twitter"){const r=`${e>=100?"üî•üíØ":e>=30?"üî•‚ú®":"üî•"} I've meditated for ${e} days straight on Divine Temple! Join my spiritual journey: ${this.baseUrl}?ref=${this.referralCode}`;let a;switch(t){case"twitter":a=`https://twitter.com/intent/tweet?text=${encodeURIComponent(r)}`;break;case"facebook":a=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(this.baseUrl+"?ref="+this.referralCode)}&quote=${encodeURIComponent(r)}`;break;case"linkedin":a=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(this.baseUrl+"?ref="+this.referralCode)}`}this.openShareWindow(a,t),this.recordShare(t,"streak",e),window.progressSystem&&window.progressSystem.awardXP(75,`Shared ${e}-day streak`,"social")}shareProgress(e){const{level:t,totalXP:r,rank:a,streak:n}=e,s=`‚ö° Level ${t} ‚Ä¢ ${r.toLocaleString()} XP ‚Ä¢ ${a} Rank ‚Ä¢ ${n} day streak!\n\nJoin me on Divine Temple: ${this.baseUrl}?ref=${this.referralCode}`,o=`https://twitter.com/intent/tweet?text=${encodeURIComponent(s)}`;this.openShareWindow(o,"Twitter"),this.recordShare("twitter","progress",t),window.progressSystem&&window.progressSystem.awardXP(100,"Shared progress stats","social")}async generateShareCard(e,t){const r=document.createElement("canvas");r.width=1200,r.height=630;const a=r.getContext("2d"),n=a.createLinearGradient(0,0,r.width,r.height);return n.addColorStop(0,"#1e1b4b"),n.addColorStop(.5,"#4c1d95"),n.addColorStop(1,"#6b21a8"),a.fillStyle=n,a.fillRect(0,0,r.width,r.height),a.fillStyle="#ffffff",a.font="bold 60px Inter, sans-serif",a.textAlign="center",a.fillText("‚ö° Divine Temple",r.width/2,100),a.font="bold 80px Inter, sans-serif",a.fillStyle="#d4af37","streak"===e?(a.fillText(`üî• ${t.days} Day Streak!`,r.width/2,280),a.font="40px Inter, sans-serif",a.fillStyle="#ffffff",a.fillText("Join my spiritual journey",r.width/2,380)):"achievement"===e?(a.fillText(`${t.icon} ${t.name}`,r.width/2,280),a.font="40px Inter, sans-serif",a.fillStyle="#ffffff",a.fillText("Achievement Unlocked!",r.width/2,380)):"level"===e&&(a.fillText(`Level ${t.level} ‚≠ê`,r.width/2,280),a.font="40px Inter, sans-serif",a.fillStyle="#ffffff",a.fillText(`${t.xp.toLocaleString()} Total XP`,r.width/2,380)),a.font="30px Inter, sans-serif",a.fillStyle="rgba(255, 255, 255, 0.7)",a.fillText(`Referral Code: ${this.referralCode}`,r.width/2,520),r.toDataURL("image/png")}async downloadShareCard(e,t){const r=await this.generateShareCard(e,t),a=document.createElement("a");a.download=`divine-temple-${e}.png`,a.href=r,a.click(),window.progressSystem&&window.progressSystem.awardXP(25,"Downloaded share card","social")}openShareWindow(e,t){const r=(window.innerWidth-600)/2,a=(window.innerHeight-400)/2;window.open(e,`share-${t}`,`width=600,height=400,left=${r},top=${a},toolbar=no,menubar=no`)}recordShare(e,t,r){this.shareData.totalShares++,this.shareData.lastShared=(new Date).toISOString(),this.shareData.shareHistory.push({platform:e,type:t,data:r,timestamp:(new Date).toISOString()}),this.shareData.shareHistory.length>50&&(this.shareData.shareHistory=this.shareData.shareHistory.slice(-50)),this.saveShareData(),window.progressSystem&&window.progressSystem.logActivity("social_share","social",{platform:e,type:t,totalShares:this.shareData.totalShares})}copyReferralLink(){const e=`${this.baseUrl}?ref=${this.referralCode}`;if(navigator.clipboard)navigator.clipboard.writeText(e).then(()=>{this.showNotification("‚úÖ Referral link copied to clipboard!"),window.progressSystem&&window.progressSystem.awardXP(10,"Copied referral link","social")});else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.showNotification("‚úÖ Referral link copied!")}}getReferralStats(){return{code:this.referralCode,link:`${this.baseUrl}?ref=${this.referralCode}`,totalShares:this.shareData.totalShares,referrals:this.shareData.referrals,rewardsEarned:this.shareData.referralRewards,lastShared:this.shareData.lastShared}}createShareWidget(e){const t=document.getElementById(e);if(!t)return;const r=this.getReferralStats();t.innerHTML=`\n            <div class="share-widget">\n                <h3 class="share-title">üåü Share Divine Temple</h3>\n\n                <div class="share-stats">\n                    <div class="stat-item">\n                        <div class="stat-value">${r.totalShares}</div>\n                        <div class="stat-label">Total Shares</div>\n                    </div>\n                    <div class="stat-item">\n                        <div class="stat-value">${r.referrals}</div>\n                        <div class="stat-label">Referrals</div>\n                    </div>\n                    <div class="stat-item">\n                        <div class="stat-value">${r.rewardsEarned} XP</div>\n                        <div class="stat-label">Rewards Earned</div>\n                    </div>\n                </div>\n\n                <div class="referral-section">\n                    <h4>Your Referral Link</h4>\n                    <div class="referral-link-container">\n                        <input type="text" readonly value="${r.link}" class="referral-input" id="referral-input">\n                        <button class="copy-btn" onclick="socialSharing.copyReferralLink()">üìã Copy</button>\n                    </div>\n                    <p class="referral-reward">üéÅ Earn 500 XP for each friend who joins!</p>\n                </div>\n\n                <div class="share-buttons">\n                    <button class="share-btn twitter" onclick="socialSharing.shareToTwitter()">\n                        <span class="btn-icon">üê¶</span>\n                        <span class="btn-text">Share on Twitter</span>\n                    </button>\n                    <button class="share-btn facebook" onclick="socialSharing.shareToFacebook()">\n                        <span class="btn-icon">üìò</span>\n                        <span class="btn-text">Share on Facebook</span>\n                    </button>\n                    <button class="share-btn whatsapp" onclick="socialSharing.shareToWhatsApp()">\n                        <span class="btn-icon">üí¨</span>\n                        <span class="btn-text">Share on WhatsApp</span>\n                    </button>\n                </div>\n\n                <style>\n                    .share-widget {\n                        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));\n                        border: 1px solid rgba(139, 92, 246, 0.3);\n                        border-radius: 20px;\n                        padding: 2rem;\n                        margin: 1rem 0;\n                    }\n                    .share-title {\n                        text-align: center;\n                        font-size: 1.8rem;\n                        margin-bottom: 1.5rem;\n                        background: linear-gradient(135deg, #d4af37, #8b5cf6);\n                        -webkit-background-clip: text;\n                        background-clip: text;\n                        -webkit-text-fill-color: transparent;\n                    }\n                    .share-stats {\n                        display: grid;\n                        grid-template-columns: repeat(3, 1fr);\n                        gap: 1rem;\n                        margin-bottom: 2rem;\n                    }\n                    .stat-item {\n                        text-align: center;\n                        padding: 1rem;\n                        background: rgba(255, 255, 255, 0.05);\n                        border-radius: 12px;\n                    }\n                    .stat-value {\n                        font-size: 2rem;\n                        font-weight: 700;\n                        color: #d4af37;\n                        margin-bottom: 0.5rem;\n                    }\n                    .stat-label {\n                        font-size: 0.85rem;\n                        color: rgba(255, 255, 255, 0.7);\n                    }\n                    .referral-section {\n                        margin: 2rem 0;\n                        padding: 1.5rem;\n                        background: rgba(255, 255, 255, 0.05);\n                        border-radius: 12px;\n                    }\n                    .referral-section h4 {\n                        margin-bottom: 1rem;\n                        font-size: 1.2rem;\n                    }\n                    .referral-link-container {\n                        display: flex;\n                        gap: 0.5rem;\n                        margin-bottom: 1rem;\n                    }\n                    .referral-input {\n                        flex: 1;\n                        padding: 0.75rem;\n                        background: rgba(255, 255, 255, 0.1);\n                        border: 1px solid rgba(255, 255, 255, 0.2);\n                        border-radius: 8px;\n                        color: white;\n                        font-size: 0.9rem;\n                    }\n                    .copy-btn {\n                        padding: 0.75rem 1.5rem;\n                        background: linear-gradient(135deg, #d4af37, #f59e0b);\n                        border: none;\n                        border-radius: 8px;\n                        color: white;\n                        font-weight: 600;\n                        cursor: pointer;\n                        transition: all 0.3s;\n                    }\n                    .copy-btn:hover {\n                        transform: translateY(-2px);\n                        box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);\n                    }\n                    .referral-reward {\n                        text-align: center;\n                        color: #10b981;\n                        font-weight: 600;\n                        font-size: 0.95rem;\n                    }\n                    .share-buttons {\n                        display: grid;\n                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n                        gap: 1rem;\n                    }\n                    .share-btn {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        gap: 0.5rem;\n                        padding: 1rem;\n                        border: none;\n                        border-radius: 12px;\n                        font-size: 1rem;\n                        font-weight: 600;\n                        cursor: pointer;\n                        transition: all 0.3s;\n                    }\n                    .share-btn.twitter {\n                        background: linear-gradient(135deg, #1DA1F2, #0d8bd9);\n                        color: white;\n                    }\n                    .share-btn.facebook {\n                        background: linear-gradient(135deg, #4267B2, #365899);\n                        color: white;\n                    }\n                    .share-btn.whatsapp {\n                        background: linear-gradient(135deg, #25D366, #1ebe57);\n                        color: white;\n                    }\n                    .share-btn:hover {\n                        transform: translateY(-3px);\n                        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);\n                    }\n                    @media (max-width: 768px) {\n                        .share-stats {\n                            grid-template-columns: 1fr;\n                        }\n                        .share-buttons {\n                            grid-template-columns: 1fr;\n                        }\n                    }\n                </style>\n            </div>\n        `}shareToTwitter(){if(window.progressSystem&&window.progressSystem.userData){const e=window.progressSystem.userData;this.shareProgress({level:e.level,totalXP:e.totalXP,rank:e.rank,streak:e.currentStreak})}}shareToFacebook(){const e=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(this.baseUrl+"?ref="+this.referralCode)}`;this.openShareWindow(e,"Facebook"),this.recordShare("facebook","general",null)}shareToWhatsApp(){const e=`üåü Join me on Divine Temple - a spiritual growth platform! ${this.baseUrl}?ref=${this.referralCode}`,t=`https://wa.me/?text=${encodeURIComponent(e)}`;window.open(t,"_blank"),this.recordShare("whatsapp","general",null)}showNotification(e){"function"==typeof window.showNotification?window.showNotification(e,"success"):alert(e)}}window.socialSharing=new SocialSharingSystem,window.SocialSharingSystem=SocialSharingSystem;