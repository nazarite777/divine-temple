class CrystalMemoryGame{constructor(){this.crystals={amethyst:{icon:"ðŸ’œ",name:"Amethyst",property:"Spiritual Protection"},clearQuartz:{icon:"ðŸ’Ž",name:"Clear Quartz",property:"Master Healer"},roseQuartz:{icon:"ðŸ’—",name:"Rose Quartz",property:"Unconditional Love"},citrine:{icon:"ðŸ’›",name:"Citrine",property:"Abundance & Joy"},blackTourmaline:{icon:"ðŸ–¤",name:"Black Tourmaline",property:"Protection & Grounding"},hematite:{icon:"âš«",name:"Hematite",property:"Grounding Energy"},smokyQuartz:{icon:"ðŸ¤Ž",name:"Smoky Quartz",property:"Transmutation"},obsidian:{icon:"â¬›",name:"Obsidian",property:"Psychic Protection"},rhodonite:{icon:"ðŸ©·",name:"Rhodonite",property:"Emotional Balance"},lapisLazuli:{icon:"ðŸ’™",name:"Lapis Lazuli",property:"Inner Truth"},sodalite:{icon:"ðŸ”µ",name:"Sodalite",property:"Logic & Intuition"},amazonite:{icon:"ðŸ’š",name:"Amazonite",property:"Soothing Energy"},carnelian:{icon:"ðŸ§¡",name:"Carnelian",property:"Vitality & Courage"},tigerEye:{icon:"ðŸŸ¤",name:"Tiger's Eye",property:"Confidence & Power"},malachite:{icon:"ðŸ’š",name:"Malachite",property:"Transformation"},jade:{icon:"ðŸŸ¢",name:"Jade",property:"Good Fortune"},selenite:{icon:"ðŸ¤",name:"Selenite",property:"Divine Light"},celestite:{icon:"ðŸ©µ",name:"Celestite",property:"Angelic Communication"},angelite:{icon:"ðŸ’«",name:"Angelite",property:"Peace & Tranquility"},moonstone:{icon:"ðŸŒ™",name:"Moonstone",property:"Intuition & Cycles"},pyrite:{icon:"âœ¨",name:"Pyrite",property:"Wealth & Manifestation"},greenAventurine:{icon:"ðŸ€",name:"Green Aventurine",property:"Luck & Opportunity"},sunstone:{icon:"â˜€ï¸",name:"Sunstone",property:"Joy & Vitality"},fluorite:{icon:"ðŸŒˆ",name:"Fluorite",property:"Mental Clarity"}},this.selectedDifficulty=null,this.gameState="menu",this.cards=[],this.flippedCards=[],this.matchedPairs=0,this.moves=0,this.startTime=null,this.timerInterval=null,this.bestTimes=this.loadBestTimes(),console.log("ðŸ’Ž Crystal Memory Quest initialized"),this.loadBestTimesDisplay()}loadBestTimes(){const e=localStorage.getItem("crystalMemoryBestTimes");return e?JSON.parse(e):{easy:null,medium:null,hard:null}}saveBestTimes(){localStorage.setItem("crystalMemoryBestTimes",JSON.stringify(this.bestTimes))}loadBestTimesDisplay(){["easy","medium","hard"].forEach(e=>{const t=document.getElementById(`bestTime${e.charAt(0).toUpperCase()+e.slice(1)}`);if(t){const a=this.bestTimes[e];t.textContent=a?this.formatTime(a):"--:--"}})}formatTime(e){const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}}let game=null;function selectDifficulty(e){game.selectedDifficulty=e,document.querySelectorAll(".difficulty-btn").forEach(e=>{e.classList.remove("selected")}),document.querySelector(`[data-difficulty="${e}"]`).classList.add("selected");const t=document.querySelector(".start-game-btn");t.disabled=!1,t.textContent=`Start ${e.charAt(0).toUpperCase()+e.slice(1)} Mode`}function startGame(){game.selectedDifficulty&&(game.gameState="playing",game.moves=0,game.matchedPairs=0,game.flippedCards=[],game.startTime=Date.now(),document.getElementById("menuScreen").style.display="none",document.querySelector(".best-times").style.display="none",document.getElementById("gameBoard").classList.add("active"),generateCards(),startTimer())}function generateCards(){const e="easy"===game.selectedDifficulty?4:"medium"===game.selectedDifficulty?8:12,t=Object.keys(game.crystals).sort(()=>Math.random()-.5).slice(0,e);game.cards=[],t.forEach((e,t)=>{const a=game.crystals[e];game.cards.push({...a,id:`${e}-1`,pairId:e}),game.cards.push({...a,id:`${e}-2`,pairId:e})}),game.cards=game.cards.sort(()=>Math.random()-.5);const a=document.getElementById("cardsGrid");a.className=`cards-grid ${game.selectedDifficulty}`,a.innerHTML=game.cards.map((e,t)=>`\n        <div class="card" data-index="${t}" data-pair-id="${e.pairId}" onclick="flipCard(${t})">\n            <div class="card-face card-back">\n                ðŸ’Ž\n            </div>\n            <div class="card-face card-front">\n                <div class="card-icon">${e.icon}</div>\n                <div class="card-name">${e.name}</div>\n            </div>\n        </div>\n    `).join(""),document.getElementById("pairsValue").textContent=`0/${e}`}function flipCard(e){if("playing"!==game.gameState)return;const t=document.querySelector(`[data-index="${e}"]`);t.classList.contains("flipped")||t.classList.contains("matched")||(t.classList.add("flipped"),game.flippedCards.push(e),2===game.flippedCards.length&&(game.moves++,document.getElementById("movesValue").textContent=game.moves,setTimeout(()=>checkMatch(),800)))}function checkMatch(){const[e,t]=game.flippedCards,a=document.querySelector(`[data-index="${e}"]`),i=document.querySelector(`[data-index="${t}"]`);if(a.dataset.pairId===i.dataset.pairId){a.classList.add("matched"),i.classList.add("matched"),game.matchedPairs++;const e="easy"===game.selectedDifficulty?4:"medium"===game.selectedDifficulty?8:12;document.getElementById("pairsValue").textContent=`${game.matchedPairs}/${e}`,game.matchedPairs===e&&setTimeout(()=>gameWon(),500)}else a.classList.remove("flipped"),i.classList.remove("flipped");game.flippedCards=[]}function startTimer(){let e=0;game.timerInterval=setInterval(()=>{e++,document.getElementById("timeValue").textContent=game.formatTime(e)},1e3)}function stopTimer(){game.timerInterval&&(clearInterval(game.timerInterval),game.timerInterval=null)}function gameWon(){game.gameState="won",stopTimer();const e=Math.floor((Date.now()-game.startTime)/1e3),t="easy"===game.selectedDifficulty?4:"medium"===game.selectedDifficulty?8:12,a=Math.round(t/game.moves*100);let i="easy"===game.selectedDifficulty?75:"medium"===game.selectedDifficulty?150:300;const n=i+Math.floor(i*(a/100)*.5);(!game.bestTimes[game.selectedDifficulty]||e<game.bestTimes[game.selectedDifficulty])&&(game.bestTimes[game.selectedDifficulty]=e,game.saveBestTimes(),document.getElementById("newRecordMsg").style.display="block"),document.getElementById("finalTime").textContent=game.formatTime(e),document.getElementById("finalMoves").textContent=game.moves,document.getElementById("finalEfficiency").textContent=`${a}%`,document.getElementById("xpEarned").textContent=n,document.getElementById("gameBoard").classList.remove("active"),document.getElementById("victoryScreen").classList.add("active"),window.progressSystem&&(window.progressSystem.awardXP(n,`Completed Crystal Memory Quest (${game.selectedDifficulty})`,"crystals"),window.progressSystem.logActivity("crystal_memory_completed","crystals",{difficulty:game.selectedDifficulty,time:e,moves:game.moves,efficiency:a,xpEarned:n}))}function resetGame(){confirm("Reset the current game?")&&(stopTimer(),startGame())}function backToMenu(){stopTimer(),game.gameState="menu",game.selectedDifficulty=null,document.getElementById("gameBoard").classList.remove("active"),document.getElementById("victoryScreen").classList.remove("active"),document.getElementById("newRecordMsg").style.display="none",document.getElementById("menuScreen").style.display="block",document.querySelector(".best-times").style.display="block";const e=document.querySelector(".start-game-btn");e.disabled=!0,e.textContent="Select a Difficulty to Start",document.querySelectorAll(".difficulty-btn").forEach(e=>{e.classList.remove("selected")}),game.loadBestTimesDisplay()}function playAgain(){document.getElementById("victoryScreen").classList.remove("active"),document.getElementById("newRecordMsg").style.display="none",startGame()}document.addEventListener("DOMContentLoaded",()=>{game=new CrystalMemoryGame,console.log("ðŸ’Ž Crystal Memory Quest ready to play!")});