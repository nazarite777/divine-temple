class ImageOptimizer{constructor(){this.supportedFormats=this.detectSupportedFormats(),this.lazyLoadObserver=null,this.init()}init(){this.setupLazyLoading(),this.optimizeExistingImages(),this.setupResponsiveImages()}detectSupportedFormats(){const e=document.createElement("canvas");e.width=1,e.height=1;const t={webp:!1,avif:!1,jpeg2000:!1};try{t.webp=0===e.toDataURL("image/webp").indexOf("data:image/webp")}catch(e){t.webp=!1}try{t.avif=0===e.toDataURL("image/avif").indexOf("data:image/avif")}catch(e){t.avif=!1}return t}setupLazyLoading(){"IntersectionObserver"in window?(this.lazyLoadObserver=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadImage(e.target),this.lazyLoadObserver.unobserve(e.target))})},{rootMargin:"50px"}),document.querySelectorAll("img[data-src]").forEach(e=>{this.lazyLoadObserver.observe(e)})):document.querySelectorAll("img[data-src]").forEach(e=>{this.loadImage(e)})}loadImage(e){const t=e.dataset.src,a=this.getOptimizedImageUrl(t),n=new Image;n.onload=()=>{e.src=a,e.classList.add("loaded"),e.style.transition="opacity 0.3s ease",e.style.opacity="1"},n.onerror=()=>{e.src=t,e.classList.add("loaded")},n.src=a}getOptimizedImageUrl(e){if(!e)return e;if(e.includes(".webp")||e.includes(".avif"))return e;const t=new URL(e,window.location.origin).pathname.split("."),a=(t.pop(),t.join("."));return this.supportedFormats.avif?`${a}.avif`:this.supportedFormats.webp?`${a}.webp`:e}optimizeExistingImages(){document.querySelectorAll("img:not([data-src])").forEach(e=>{e.dataset.optimized||(this.optimizeImage(e),e.dataset.optimized="true")})}optimizeImage(e){e.hasAttribute("loading")||e.setAttribute("loading","lazy"),e.hasAttribute("width")||e.hasAttribute("height")||(e.onload=()=>{e.setAttribute("width",e.naturalWidth),e.setAttribute("height",e.naturalHeight)}),e.hasAttribute("alt")||e.setAttribute("alt","Divine Temple Sacred Image"),e.classList.contains("loaded")||(e.style.opacity="0",e.style.transition="opacity 0.3s ease",e.complete?(e.style.opacity="1",e.classList.add("loaded")):e.onload=()=>{e.style.opacity="1",e.classList.add("loaded")})}setupResponsiveImages(){document.querySelectorAll("img[data-responsive]").forEach(e=>{const t=e.dataset.responsive,a=[400,800,1200,1600].map(e=>`${this.getResponsiveImageUrl(t,e)} ${e}w`).join(", ");e.setAttribute("srcset",a),e.setAttribute("sizes","(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw")})}getResponsiveImageUrl(e,t){const a=new URL(e,window.location.origin).pathname.split("."),n=a.pop(),i=a.join(".");let o=n;return this.supportedFormats.avif?o="avif":this.supportedFormats.webp&&(o="webp"),`${i}_${t}w.${o}`}createPlaceholder(e=400,t=300,a="Loading..."){const n=document.createElement("canvas");n.width=e,n.height=t;const i=n.getContext("2d"),o=i.createLinearGradient(0,0,e,t);return o.addColorStop(0,"#1a1a2e"),o.addColorStop(1,"#0f3460"),i.fillStyle=o,i.fillRect(0,0,e,t),i.fillStyle="#d4af37",i.font="16px Inter, sans-serif",i.textAlign="center",i.textBaseline="middle",i.fillText("âœ¨ "+a+" âœ¨",e/2,t/2),n.toDataURL()}monitorImagePerformance(){if("PerformanceObserver"in window){new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"img"===e.initiatorType&&(console.log(`ðŸ–¼ï¸ Image loaded: ${e.name} (${Math.round(e.duration)}ms)`),e.duration>1e3&&console.warn(`âš ï¸ Slow image: ${e.name} took ${Math.round(e.duration)}ms`))})}).observe({entryTypes:["resource"]})}}preloadCriticalImages(e){e.forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=this.getOptimizedImageUrl(e),document.head.appendChild(t)})}async convertToWebP(e){return this.supportedFormats.webp?new Promise(t=>{const a=document.createElement("canvas"),n=a.getContext("2d"),i=new Image;i.onload=()=>{a.width=i.width,a.height=i.height,n.drawImage(i,0,0),a.toBlob(t,"image/webp",.8)},i.src=URL.createObjectURL(e)}):e}getCompressionSettings(e){return e<1e5?{quality:.9,format:"original"}:e<5e5?{quality:.8,format:"webp"}:e<1e6?{quality:.7,format:"webp"}:{quality:.6,format:"webp"}}}const imageOptimizationCSS="\n/* Image optimization styles */\nimg {\n    max-width: 100%;\n    height: auto;\n    transition: opacity 0.3s ease;\n}\n\nimg[data-src] {\n    opacity: 0;\n    background: linear-gradient(135deg, #1a1a2e, #0f3460);\n    min-height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\nimg[data-src]::before {\n    content: \"âœ¨ Loading Sacred Image âœ¨\";\n    color: #d4af37;\n    font-family: 'Inter', sans-serif;\n    font-size: 14px;\n}\n\nimg.loaded {\n    opacity: 1;\n}\n\nimg.loading-error {\n    background: rgba(139, 95, 191, 0.1);\n    border: 2px dashed #8b5fbf;\n    min-height: 200px;\n    position: relative;\n}\n\nimg.loading-error::after {\n    content: \"ðŸ›ï¸ Sacred Image Temporarily Unavailable\";\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    color: #8b5fbf;\n    font-family: 'Inter', sans-serif;\n    text-align: center;\n    font-size: 14px;\n}\n\n/* Responsive image container */\n.responsive-image-container {\n    position: relative;\n    overflow: hidden;\n    border-radius: 15px;\n}\n\n.responsive-image-container img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    transition: transform 0.3s ease, opacity 0.3s ease;\n}\n\n.responsive-image-container:hover img {\n    transform: scale(1.05);\n}\n\n/* Image loading skeleton */\n.image-skeleton {\n    background: linear-gradient(90deg, #1a1a2e 25%, #2a2a4e 50%, #1a1a2e 75%);\n    background-size: 200% 100%;\n    animation: loading 1.5s infinite;\n    border-radius: 15px;\n    min-height: 200px;\n}\n\n@keyframes loading {\n    0% { background-position: 200% 0; }\n    100% { background-position: -200% 0; }\n}\n\n/* Progressive enhancement for supported formats */\n.webp .no-webp-fallback { display: none; }\n.no-webp .webp-image { display: none; }\n.avif .no-avif-fallback { display: none; }\n.no-avif .avif-image { display: none; }\n",style=document.createElement("style");style.textContent=imageOptimizationCSS,document.head.appendChild(style);const imageOptimizer=new ImageOptimizer;document.documentElement.classList.add(imageOptimizer.supportedFormats.webp?"webp":"no-webp",imageOptimizer.supportedFormats.avif?"avif":"no-avif"),window.ImageOptimizer=ImageOptimizer,console.log("ðŸ–¼ï¸ Divine Temple Image Optimization Loaded",imageOptimizer.supportedFormats);