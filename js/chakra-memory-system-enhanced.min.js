class ChakraMemoryGameEnhanced{constructor(){this.currentUser=null,this.gameData=null,this.selectedMode=null,this.cards=[],this.flippedCards=[],this.matchedPairs=0,this.moves=0,this.startTime=null,this.timerInterval=null,this.isProcessing=!1,this.debugMode=!0,this.sounds={flip:null,match:null,victory:null,perfect:null,background:null,error:null,click:null},this.soundEnabled=!0,this.musicEnabled=!0,this.initSounds(),this.chakraCards=[{id:"root-symbol",chakra:"Root",type:"symbol",icon:"ðŸ”´",text:"Root Symbol",color:"#E53E3E",pair:"root-name"},{id:"root-name",chakra:"Root",type:"name",icon:"ðŸª¨",text:"Muladhara",color:"#E53E3E",pair:"root-symbol"},{id:"sacral-symbol",chakra:"Sacral",type:"symbol",icon:"ðŸŸ ",text:"Sacral Symbol",color:"#ED8936",pair:"sacral-name"},{id:"sacral-name",chakra:"Sacral",type:"name",icon:"ðŸ’§",text:"Svadhisthana",color:"#ED8936",pair:"sacral-symbol"},{id:"solar-symbol",chakra:"Solar Plexus",type:"symbol",icon:"ðŸŸ¡",text:"Solar Symbol",color:"#ECC94B",pair:"solar-name"},{id:"solar-name",chakra:"Solar Plexus",type:"name",icon:"ðŸ”¥",text:"Manipura",color:"#ECC94B",pair:"solar-symbol"},{id:"heart-symbol",chakra:"Heart",type:"symbol",icon:"ðŸŸ¢",text:"Heart Symbol",color:"#48BB78",pair:"heart-name"},{id:"heart-name",chakra:"Heart",type:"name",icon:"ðŸ’š",text:"Anahata",color:"#48BB78",pair:"heart-symbol"},{id:"throat-symbol",chakra:"Throat",type:"symbol",icon:"ðŸ”µ",text:"Throat Symbol",color:"#4299E1",pair:"throat-name"},{id:"throat-name",chakra:"Throat",type:"name",icon:"ðŸ—£ï¸",text:"Vishuddha",color:"#4299E1",pair:"throat-symbol"},{id:"thirdeye-symbol",chakra:"Third Eye",type:"symbol",icon:"ðŸŸ£",text:"Third Eye Symbol",color:"#667EEA",pair:"thirdeye-name"},{id:"thirdeye-name",chakra:"Third Eye",type:"name",icon:"ðŸ‘ï¸",text:"Ajna",color:"#667EEA",pair:"thirdeye-symbol"},{id:"crown-symbol",chakra:"Crown",type:"symbol",icon:"ðŸŸ£",text:"Crown Symbol",color:"#9F7AEA",pair:"crown-name"},{id:"crown-name",chakra:"Crown",type:"name",icon:"ðŸ‘‘",text:"Sahasrara",color:"#9F7AEA",pair:"crown-symbol"},{id:"root-element",chakra:"Root",type:"element",icon:"ðŸŒ",text:"Earth",color:"#E53E3E",pair:"root-location"},{id:"root-location",chakra:"Root",type:"location",icon:"ðŸ¦¶",text:"Base of Spine",color:"#E53E3E",pair:"root-element"},{id:"sacral-element",chakra:"Sacral",type:"element",icon:"ðŸŒŠ",text:"Water",color:"#ED8936",pair:"sacral-emotion"},{id:"sacral-emotion",chakra:"Sacral",type:"emotion",icon:"ðŸ˜Š",text:"Creativity",color:"#ED8936",pair:"sacral-element"},{id:"solar-element",chakra:"Solar Plexus",type:"element",icon:"ðŸ”¥",text:"Fire",color:"#ECC94B",pair:"solar-power"},{id:"solar-power",chakra:"Solar Plexus",type:"power",icon:"âš¡",text:"Personal Power",color:"#ECC94B",pair:"solar-element"},{id:"heart-element",chakra:"Heart",type:"element",icon:"ðŸ’¨",text:"Air",color:"#48BB78",pair:"heart-emotion"},{id:"heart-emotion",chakra:"Heart",type:"emotion",icon:"ðŸ’–",text:"Love",color:"#48BB78",pair:"heart-element"},{id:"throat-element",chakra:"Throat",type:"element",icon:"ðŸŒ¬ï¸",text:"Ether",color:"#4299E1",pair:"throat-function"},{id:"throat-function",chakra:"Throat",type:"function",icon:"ðŸŽ¤",text:"Communication",color:"#4299E1",pair:"throat-element"}],this.biblicalEtymologyCards=[{id:"yhwh-hebrew",category:"Divine Names",type:"hebrew",icon:"ðŸ”¥",text:"YHWH (×™×”×•×”)",color:"#D4AF37",pair:"yhwh-meaning"},{id:"yhwh-meaning",category:"Divine Names",type:"meaning",icon:"âœ¨",text:"I AM That I AM",color:"#D4AF37",pair:"yhwh-hebrew"},{id:"elohim-hebrew",category:"Divine Names",type:"hebrew",icon:"ðŸ‘¥",text:"Elohim (×Ö±×œÖ¹×”Ö´×™×)",color:"#8B5CF6",pair:"elohim-meaning"},{id:"elohim-meaning",category:"Divine Names",type:"meaning",icon:"ðŸŒŸ",text:"Divine Council/Gods",color:"#8B5CF6",pair:"elohim-hebrew"},{id:"yeshua-hebrew",category:"Divine Names",type:"hebrew",icon:"ðŸ‘¤",text:"Yeshua (×™Öµ×©××•Ö¼×¢Ö·)",color:"#4299E1",pair:"yeshua-meaning"},{id:"yeshua-meaning",category:"Divine Names",type:"meaning",icon:"ðŸ•Šï¸",text:"Yah Saves",color:"#4299E1",pair:"yeshua-hebrew"},{id:"ruach-hebrew",category:"Sacred Concepts",type:"hebrew",icon:"ðŸ’¨",text:"Ruach (×¨×•Ö¼×—Ö·)",color:"#48BB78",pair:"ruach-meaning"},{id:"ruach-meaning",category:"Sacred Concepts",type:"meaning",icon:"ðŸŒ¬ï¸",text:"Spirit/Breath (Feminine)",color:"#48BB78",pair:"ruach-hebrew"},{id:"almah-hebrew",category:"Mistranslations",type:"hebrew",icon:"ðŸ‘©",text:"Almah (×¢Ö·×œÖ°×žÖ¸×”)",color:"#ED8936",pair:"almah-meaning"},{id:"almah-meaning",category:"Mistranslations",type:"meaning",icon:"ðŸŒ¸",text:"Young Woman (NOT Virgin)",color:"#ED8936",pair:"almah-hebrew"},{id:"mashiach-hebrew",category:"Sacred Titles",type:"hebrew",icon:"ðŸ‘‘",text:"Mashiach (×žÖ¸×©Ö´××™×—Ö·)",color:"#ECC94B",pair:"mashiach-meaning"},{id:"mashiach-meaning",category:"Sacred Titles",type:"meaning",icon:"âš¡",text:"Anointed One/Messiah",color:"#ECC94B",pair:"mashiach-hebrew"},{id:"shekinah-hebrew",category:"Divine Presence",type:"hebrew",icon:"âœ¨",text:"Shekinah (×©Ö°××›Ö´×™× Ö¸×”)",color:"#9F7AEA",pair:"shekinah-meaning"},{id:"shekinah-meaning",category:"Divine Presence",type:"meaning",icon:"ðŸ•Šï¸",text:"Divine Feminine Presence",color:"#9F7AEA",pair:"shekinah-hebrew"},{id:"tzaddik-hebrew",category:"Righteousness",type:"hebrew",icon:"âš–ï¸",text:"Tzaddik (×¦Ö·×“Ö´Ö¼×™×§)",color:"#E53E3E",pair:"tzaddik-meaning"},{id:"tzaddik-meaning",category:"Righteousness",type:"meaning",icon:"ðŸ™",text:"Righteous One",color:"#E53E3E",pair:"tzaddik-hebrew"},{id:"nazir-hebrew",category:"Consecration",type:"hebrew",icon:"ðŸ”¥",text:"Nazir (× Ö¸×–Ö´×™×¨)",color:"#667EEA",pair:"nazir-meaning"},{id:"nazir-meaning",category:"Consecration",type:"meaning",icon:"ðŸ‘¤",text:"Consecrated/Set Apart",color:"#667EEA",pair:"nazir-hebrew"},{id:"yah-hebrew",category:"Divine Names",type:"hebrew",icon:"ðŸŒŸ",text:"Yah (×™Ö¸×”Ö¼)",color:"#F687B3",pair:"yah-meaning"},{id:"yah-meaning",category:"Divine Names",type:"meaning",icon:"âœ¨",text:"Sacred Name (Shortened)",color:"#F687B3",pair:"yah-hebrew"},{id:"brit-hebrew",category:"Covenant",type:"hebrew",icon:"ðŸ“œ",text:"Brit (×‘Ö°Ö¼×¨Ö´×™×ª)",color:"#FC8181",pair:"brit-meaning"},{id:"brit-meaning",category:"Covenant",type:"meaning",icon:"ðŸ¤",text:"Covenant/Agreement",color:"#FC8181",pair:"brit-hebrew"},{id:"chesed-hebrew",category:"Divine Attributes",type:"hebrew",icon:"ðŸ’–",text:"Chesed (×—Ö¶×¡Ö¶×“)",color:"#F6AD55",pair:"chesed-meaning"},{id:"chesed-meaning",category:"Divine Attributes",type:"meaning",icon:"ðŸ’",text:"Loving Kindness/Mercy",color:"#F6AD55",pair:"chesed-hebrew"}],this.hebrewNamesCards=[{id:"michael-name",category:"Angelic Names",type:"name",icon:"âš”ï¸",text:"Michael (×žÖ´×™×›Ö¸×Öµ×œ)",color:"#E53E3E",pair:"michael-meaning"},{id:"michael-meaning",category:"Angelic Names",type:"meaning",icon:"â“",text:"Who is Like God?",color:"#E53E3E",pair:"michael-name"},{id:"gabriel-name",category:"Angelic Names",type:"name",icon:"ðŸ“¯",text:"Gabriel (×’Ö·Ö¼×‘Ö°×¨Ö´×™×Öµ×œ)",color:"#ED8936",pair:"gabriel-meaning"},{id:"gabriel-meaning",category:"Angelic Names",type:"meaning",icon:"ðŸ’ª",text:"Strength of God",color:"#ED8936",pair:"gabriel-name"},{id:"nazirel-name",category:"Sacred Names",type:"name",icon:"ðŸ‘‘",text:"Nazir El",color:"#D4AF37",pair:"nazirel-meaning"},{id:"nazirel-meaning",category:"Sacred Names",type:"meaning",icon:"âœ¨",text:"Consecrated to God",color:"#D4AF37",pair:"nazirel-name"},{id:"israel-name",category:"Patriarchs",type:"name",icon:"ðŸ¤¼",text:"Israel (×™Ö´×©Ö°×‚×¨Ö¸×Öµ×œ)",color:"#48BB78",pair:"israel-meaning"},{id:"israel-meaning",category:"Patriarchs",type:"meaning",icon:"âš¡",text:"Wrestles with God",color:"#48BB78",pair:"israel-name"},{id:"emmanuel-name",category:"Prophetic Names",type:"name",icon:"ðŸ•Šï¸",text:"Emmanuel (×¢Ö´×žÖ¸Ö¼× ×•Ö¼×Öµ×œ)",color:"#4299E1",pair:"emmanuel-meaning"},{id:"emmanuel-meaning",category:"Prophetic Names",type:"meaning",icon:"ðŸ™",text:"God With Us",color:"#4299E1",pair:"emmanuel-name"},{id:"elijah-name",category:"Prophets",type:"name",icon:"ðŸ”¥",text:"Elijah (×Öµ×œÖ´×™Ö¸Ö¼×”×•Ö¼)",color:"#667EEA",pair:"elijah-meaning"},{id:"elijah-meaning",category:"Prophets",type:"meaning",icon:"âš¡",text:"My God is Yah",color:"#667EEA",pair:"elijah-name"},{id:"isaiah-name",category:"Prophets",type:"name",icon:"ðŸ“œ",text:"Isaiah (×™Ö°×©Ö·××¢Ö°×™Ö¸×”×•Ö¼)",color:"#9F7AEA",pair:"isaiah-meaning"},{id:"isaiah-meaning",category:"Prophets",type:"meaning",icon:"ðŸ•Šï¸",text:"Salvation of Yah",color:"#9F7AEA",pair:"isaiah-name"},{id:"daniel-name",category:"Prophets",type:"name",icon:"ðŸ¦",text:"Daniel (×“Ö¸Ö¼× Ö´×™ÖµÖ¼××œ)",color:"#ECC94B",pair:"daniel-meaning"},{id:"daniel-meaning",category:"Prophets",type:"meaning",icon:"âš–ï¸",text:"God is My Judge",color:"#ECC94B",pair:"daniel-name"},{id:"raphael-name",category:"Angelic Names",type:"name",icon:"ðŸ’š",text:"Raphael (×¨Ö¸×¤Ö¸×Öµ×œ)",color:"#68D391",pair:"raphael-meaning"},{id:"raphael-meaning",category:"Angelic Names",type:"meaning",icon:"ðŸ©¹",text:"God Heals",color:"#68D391",pair:"raphael-name"},{id:"uriel-name",category:"Angelic Names",type:"name",icon:"ðŸ”¥",text:"Uriel (××•Ö¼×¨Ö´×™×Öµ×œ)",color:"#F6AD55",pair:"uriel-meaning"},{id:"uriel-meaning",category:"Angelic Names",type:"meaning",icon:"ðŸ’¡",text:"Light of God",color:"#F6AD55",pair:"uriel-name"},{id:"jeremiah-name",category:"Prophets",type:"name",icon:"ðŸ˜¢",text:"Jeremiah (×™Ö´×¨Ö°×žÖ°×™Ö¸×”×•Ö¼)",color:"#FC8181",pair:"jeremiah-meaning"},{id:"jeremiah-meaning",category:"Prophets",type:"meaning",icon:"â¬†ï¸",text:"Yah Will Uplift",color:"#FC8181",pair:"jeremiah-name"},{id:"joshua-name",category:"Leaders",type:"name",icon:"ðŸ—¡ï¸",text:"Joshua (×™Ö°×”×•Ö¹×©Ö»××¢Ö·)",color:"#F687B3",pair:"joshua-meaning"},{id:"joshua-meaning",category:"Leaders",type:"meaning",icon:"ðŸ›¡ï¸",text:"Yah is Salvation",color:"#F687B3",pair:"joshua-name"}],this.sacredNumbersCards=[{id:"seven-number",category:"Completion",type:"number",icon:"7ï¸âƒ£",text:"Seven (7)",color:"#D4AF37",pair:"seven-meaning"},{id:"seven-meaning",category:"Completion",type:"meaning",icon:"âœ…",text:"Divine Completion",color:"#D4AF37",pair:"seven-number"},{id:"twelve-number",category:"Government",type:"number",icon:"1ï¸âƒ£2ï¸âƒ£",text:"Twelve (12)",color:"#8B5CF6",pair:"twelve-meaning"},{id:"twelve-meaning",category:"Government",type:"meaning",icon:"ðŸ‘‘",text:"Divine Government",color:"#8B5CF6",pair:"twelve-number"},{id:"forty-number",category:"Testing",type:"number",icon:"4ï¸âƒ£0ï¸âƒ£",text:"Forty (40)",color:"#E53E3E",pair:"forty-meaning"},{id:"forty-meaning",category:"Testing",type:"meaning",icon:"ðŸœï¸",text:"Testing & Trial",color:"#E53E3E",pair:"forty-number"},{id:"three-number",category:"Divine",type:"number",icon:"3ï¸âƒ£",text:"Three (3)",color:"#48BB78",pair:"three-meaning"},{id:"three-meaning",category:"Divine",type:"meaning",icon:"ðŸ”º",text:"Divine Manifestation",color:"#48BB78",pair:"three-number"},{id:"eight-number",category:"Beginning",type:"number",icon:"8ï¸âƒ£",text:"Eight (8)",color:"#4299E1",pair:"eight-meaning"},{id:"eight-meaning",category:"Beginning",type:"meaning",icon:"ðŸŒ…",text:"New Beginning",color:"#4299E1",pair:"eight-number"},{id:"ten-number",category:"Law",type:"number",icon:"ðŸ”Ÿ",text:"Ten (10)",color:"#ECC94B",pair:"ten-meaning"},{id:"ten-meaning",category:"Law",type:"meaning",icon:"ðŸ“œ",text:"Divine Order/Law",color:"#ECC94B",pair:"ten-number"},{id:"five-number",category:"Grace",type:"number",icon:"5ï¸âƒ£",text:"Five (5)",color:"#ED8936",pair:"five-meaning"},{id:"five-meaning",category:"Grace",type:"meaning",icon:"ðŸ™",text:"Divine Grace",color:"#ED8936",pair:"five-number"},{id:"six-number",category:"Humanity",type:"number",icon:"6ï¸âƒ£",text:"Six (6)",color:"#9F7AEA",pair:"six-meaning"},{id:"six-meaning",category:"Humanity",type:"meaning",icon:"ðŸ‘¤",text:"Human Number",color:"#9F7AEA",pair:"six-number"},{id:"one-number",category:"Unity",type:"number",icon:"1ï¸âƒ£",text:"One (1)",color:"#F687B3",pair:"one-meaning"},{id:"one-meaning",category:"Unity",type:"meaning",icon:"âš«",text:"Divine Unity",color:"#F687B3",pair:"one-number"},{id:"four-number",category:"Creation",type:"number",icon:"4ï¸âƒ£",text:"Four (4)",color:"#68D391",pair:"four-meaning"},{id:"four-meaning",category:"Creation",type:"meaning",icon:"ðŸŒ",text:"Creation/Earth",color:"#68D391",pair:"four-number"},{id:"fifty-number",category:"Jubilee",type:"number",icon:"5ï¸âƒ£0ï¸âƒ£",text:"Fifty (50)",color:"#FC8181",pair:"fifty-meaning"},{id:"fifty-meaning",category:"Jubilee",type:"meaning",icon:"ðŸŽ‰",text:"Jubilee/Freedom",color:"#FC8181",pair:"fifty-number"},{id:"twentyone-number",category:"Consecration",type:"number",icon:"2ï¸âƒ£1ï¸âƒ£",text:"Twenty-One (21)",color:"#F6AD55",pair:"twentyone-meaning"},{id:"twentyone-meaning",category:"Consecration",type:"meaning",icon:"ðŸ”¥",text:"Nazarite Age/Maturity",color:"#F6AD55",pair:"twentyone-number"}],this.themes={chakras:{name:"Chakra Energy System",description:"Match chakra symbols with Sanskrit names",icon:"ðŸ§˜",cards:this.chakraCards,color:"#8B5CF6"},etymology:{name:"Biblical Etymology",description:"Match Hebrew terms with their meanings",icon:"ðŸ“œ",cards:this.biblicalEtymologyCards,color:"#D4AF37"},names:{name:"Hebrew Divine Names",description:"Match sacred names with their meanings",icon:"ðŸ‘‘",cards:this.hebrewNamesCards,color:"#4299E1"},numbers:{name:"Sacred Numbers",description:"Match numbers with spiritual meanings",icon:"ðŸ”¢",cards:this.sacredNumbersCards,color:"#48BB78"}},this.currentTheme="chakras",this.difficulties={easy:{pairs:4,minMoves:8,perfectMoves:10,baseXP:50,perfectXP:100,speedBonus:20},medium:{pairs:8,minMoves:16,perfectMoves:20,baseXP:100,perfectXP:200,speedBonus:50},hard:{pairs:12,minMoves:24,perfectMoves:30,baseXP:200,perfectXP:400,speedBonus:100}},this.init()}log(e,t=null){this.debugMode&&console.log(`[ChakraMemory] ${e}`,t||"")}error(e,t=null){console.error(`[ChakraMemory ERROR] ${e}`,t||"")}initSounds(){this.log("Initializing sound system...");try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.log("Audio context created")}catch(e){this.log("Web Audio API not supported, falling back to HTML5 audio")}this.createSoundEffects(),this.addSoundControls()}createSoundEffects(){this.log("Creating sound effects..."),this.sounds.flip=this.createTone([400,600],.1,"sine",.3),this.sounds.match=this.createChord([523,659,784],.4,"sine",.4),this.sounds.victory=this.createChordProgression([[523,659,784],[587,740,880],[659,831,988]],.6,"sine",.5),this.sounds.perfect=this.createSparkleSound(),this.sounds.error=this.createTone([300,200],.2,"triangle",.2),this.sounds.click=this.createTone([800],.05,"sine",.1),this.sounds.background=this.createAmbientLoop(),this.log("Sound effects created")}createTone(e,t,a="sine",i=.3){return()=>{if(this.soundEnabled&&this.audioContext)try{const n=this.audioContext.currentTime;e.forEach((o,r)=>{const s=this.audioContext.createOscillator(),c=this.audioContext.createGain();s.connect(c),c.connect(this.audioContext.destination),s.frequency.setValueAtTime(o,n),s.type=a,c.gain.setValueAtTime(0,n),c.gain.linearRampToValueAtTime(i/e.length,n+.01),c.gain.exponentialRampToValueAtTime(.001,n+t),s.start(n+.05*r),s.stop(n+t+.05*r)})}catch(e){this.error("Error playing tone",e)}}}createChord(e,t,a="sine",i=.4){return()=>{if(this.soundEnabled&&this.audioContext)try{const n=this.audioContext.currentTime;e.forEach(o=>{const r=this.audioContext.createOscillator(),s=this.audioContext.createGain();r.connect(s),s.connect(this.audioContext.destination),r.frequency.setValueAtTime(o,n),r.type=a,s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(i/e.length,n+.01),s.gain.exponentialRampToValueAtTime(.001,n+t),r.start(n),r.stop(n+t)})}catch(e){this.error("Error playing chord",e)}}}createChordProgression(e,t,a="sine",i=.5){return()=>{this.soundEnabled&&this.audioContext&&e.forEach((e,n)=>{setTimeout(()=>{this.createChord(e,.8*t,a,i)()},n*t*500)})}}createSparkleSound(){return()=>{if(!this.soundEnabled||!this.audioContext)return;[1047,1319,1568,1865,2093].forEach((e,t)=>{setTimeout(()=>{this.createTone([e],.3,"sine",.2)()},100*t)})}}createAmbientLoop(){let e=[];return{start:()=>{if(!this.musicEnabled||!this.audioContext||e.length>0)return;this.log("Starting ambient background music");[256,288,320,341,384,426,480].forEach((t,a)=>{setTimeout(()=>{try{const a=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();a.connect(n),n.connect(i),i.connect(this.audioContext.destination),a.frequency.setValueAtTime(t,this.audioContext.currentTime),a.type="sine",n.type="lowpass",n.frequency.setValueAtTime(2*t,this.audioContext.currentTime),i.gain.setValueAtTime(0,this.audioContext.currentTime),i.gain.linearRampToValueAtTime(.02,this.audioContext.currentTime+2),a.start(),e.push({oscillator:a,gainNode:i})}catch(e){this.error("Error creating ambient sound",e)}},2e3*a)})},stop:()=>{this.log("Stopping ambient background music"),e.forEach(({oscillator:e,gainNode:t})=>{try{t.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+1),e.stop(this.audioContext.currentTime+1)}catch(e){}}),e=[]}}}addSoundControls(){const e=document.querySelector(".game-header");if(e){const t=document.createElement("div");t.className="sound-controls",t.innerHTML='\n                <button id="soundToggle" class="sound-btn" title="Toggle Sound Effects">\n                    ðŸ”Š\n                </button>\n                <button id="musicToggle" class="sound-btn" title="Toggle Background Music">\n                    ðŸŽµ\n                </button>\n            ';const a=document.createElement("style");a.textContent="\n                .sound-controls {\n                    position: absolute;\n                    top: 1rem;\n                    right: 1rem;\n                    display: flex;\n                    gap: 0.5rem;\n                    z-index: 100;\n                }\n                \n                .sound-btn {\n                    background: rgba(255, 255, 255, 0.1);\n                    border: 1px solid rgba(255, 255, 255, 0.2);\n                    border-radius: 50%;\n                    width: 40px;\n                    height: 40px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    cursor: pointer;\n                    font-size: 1.2rem;\n                    transition: all 0.3s ease;\n                    color: white;\n                }\n                \n                .sound-btn:hover {\n                    background: rgba(255, 255, 255, 0.2);\n                    transform: scale(1.1);\n                }\n                \n                .sound-btn.disabled {\n                    opacity: 0.5;\n                    filter: grayscale(100%);\n                }\n            ",document.head.appendChild(a),e.appendChild(t),document.getElementById("soundToggle").addEventListener("click",()=>{this.toggleSound()}),document.getElementById("musicToggle").addEventListener("click",()=>{this.toggleMusic()})}}toggleSound(){this.soundEnabled=!this.soundEnabled;const e=document.getElementById("soundToggle");e&&(e.textContent=this.soundEnabled?"ðŸ”Š":"ðŸ”‡",e.classList.toggle("disabled",!this.soundEnabled)),this.soundEnabled&&this.playSound("click"),this.log("Sound "+(this.soundEnabled?"enabled":"disabled"))}toggleMusic(){this.musicEnabled=!this.musicEnabled;const e=document.getElementById("musicToggle");e&&(e.textContent=this.musicEnabled?"ðŸŽµ":"ðŸŽ¶",e.classList.toggle("disabled",!this.musicEnabled)),this.musicEnabled?this.sounds.background.start():this.sounds.background.stop(),this.log("Music "+(this.musicEnabled?"enabled":"disabled"))}playSound(e){if(this.sounds[e]&&"function"==typeof this.sounds[e])try{this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume(),this.sounds[e]()}catch(t){this.error(`Error playing sound ${e}`,t)}}async init(){this.log("ðŸ§˜ Enhanced Chakra Memory Game initializing...");try{await this.waitForSystems(),firebase.auth().onAuthStateChanged(async e=>{e?(this.log(`User authenticated: ${e.email}`),this.currentUser=e,await this.loadGameData(),this.updateBestTimes(),this.musicEnabled&&setTimeout(()=>{this.sounds.background.start()},1e3)):(this.log("No user authenticated, redirecting to login"),window.location.href="../login.html")})}catch(e){this.error("Initialization failed",e)}}async waitForSystems(){return this.log("Waiting for Firebase and Progress System..."),new Promise((e,t)=>{let a=0;const i=setInterval(()=>{a++;const n="undefined"!=typeof firebase&&firebase.auth,o=window.progressSystem||!0;n&&o?(clearInterval(i),this.log("âœ… All systems ready"),e()):a>=50&&(clearInterval(i),this.error("Systems timeout"),t(new Error("Systems timeout")))},100)})}async loadGameData(){this.log("Loading game data...");try{const e=await firebase.firestore().collection("chakraMemoryProgress").doc(this.currentUser.uid).get();e.exists?(this.gameData=e.data(),this.log("Game data loaded:",this.gameData)):(this.log("No existing data, initializing new user"),this.gameData={userId:this.currentUser.uid,gamesPlayed:0,perfectGames:0,totalXPEarned:0,lastPlayed:null,bestTimes:{easy:null,medium:null,hard:null},stats:{easy:{played:0,wins:0,totalMoves:0,totalTime:0},medium:{played:0,wins:0,totalMoves:0,totalTime:0},hard:{played:0,wins:0,totalMoves:0,totalTime:0}},achievements:[],settings:{soundEnabled:!0,musicEnabled:!0}},await this.saveGameData()),this.gameData.settings&&(this.soundEnabled=!1!==this.gameData.settings.soundEnabled,this.musicEnabled=!1!==this.gameData.settings.musicEnabled,this.updateSoundControls())}catch(e){this.error("Error loading game data",e),this.gameData={userId:this.currentUser.uid,gamesPlayed:0,perfectGames:0,totalXPEarned:0,lastPlayed:null,bestTimes:{easy:null,medium:null,hard:null},stats:{easy:{played:0,wins:0,totalMoves:0,totalTime:0},medium:{played:0,wins:0,totalMoves:0,totalTime:0},hard:{played:0,wins:0,totalMoves:0,totalTime:0}},achievements:[],settings:{soundEnabled:!0,musicEnabled:!0}}}}async saveGameData(){if(this.gameData&&this.currentUser)try{this.gameData.lastPlayed=firebase.firestore.FieldValue.serverTimestamp(),this.gameData.settings={soundEnabled:this.soundEnabled,musicEnabled:this.musicEnabled},await firebase.firestore().collection("chakraMemoryProgress").doc(this.currentUser.uid).set(this.gameData,{merge:!0}),this.log("Game data saved successfully")}catch(e){this.error("Error saving game data",e)}}updateSoundControls(){const e=document.getElementById("soundToggle"),t=document.getElementById("musicToggle");e&&(e.textContent=this.soundEnabled?"ðŸ”Š":"ðŸ”‡",e.classList.toggle("disabled",!this.soundEnabled)),t&&(t.textContent=this.musicEnabled?"ðŸŽµ":"ðŸŽ¶",t.classList.toggle("disabled",!this.musicEnabled))}updateBestTimes(){if(!this.gameData)return;const e={bestTimeEasy:this.gameData.bestTimes.easy,bestTimeMedium:this.gameData.bestTimes.medium,bestTimeHard:this.gameData.bestTimes.hard};Object.entries(e).forEach(([e,t])=>{const a=document.getElementById(e);a&&(a.textContent=(e=>{if(!e)return"--:--";const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`})(t))}),this.log("Best times updated")}selectMode(e){this.selectedMode=e,this.playSound("click"),this.log(`Mode selected: ${e}`),document.querySelectorAll(".mode-btn").forEach(e=>{e.classList.remove("selected")});const t=document.querySelector(`[data-mode="${e}"]`);t&&t.classList.add("selected");const a=document.querySelector(".start-game-btn");a&&(a.disabled=!1,a.textContent=`Start ${e.charAt(0).toUpperCase()+e.slice(1)} Game ðŸŽ®`)}startGame(){if(!this.selectedMode)return;this.log(`Starting ${this.selectedMode} game`),this.playSound("click");const e=document.getElementById("modeSelection");e&&(e.style.display="none");const t=document.getElementById("gameBoard");t&&t.classList.add("active"),this.setupGame()}setupGame(){this.log("Setting up game..."),this.moves=0,this.matchedPairs=0,this.flippedCards=[],this.startTime=Date.now(),this.isProcessing=!1;const e=this.difficulties[this.selectedMode];this.cards=this.selectCards(e.pairs),this.shuffleCards();const t={movesValue:"0",pairsValue:`0/${e.pairs}`,timeValue:"00:00"};Object.entries(t).forEach(([e,t])=>{const a=document.getElementById(e);a&&(a.textContent=t)}),this.renderCards(),this.startTimer(),this.log("Game setup complete")}setTheme(e){return!!this.themes[e]&&(this.currentTheme=e,this.log(`Theme set to: ${this.themes[e].name}`),this.playSound("click"),!0)}getCurrentCards(){return this.themes[this.currentTheme].cards}selectCards(e){const t=this.getCurrentCards(),a=[...t].sort(()=>Math.random()-.5),i=[],n=new Set;for(let o=0;o<a.length&&i.length<2*e;o++){const e=a[o],r=t.find(t=>t.id===e.pair),s=e.category||e.chakra||"default";r&&!n.has(s+e.type+e.pair)&&(i.push({...e,cardId:`card-${i.length}`}),i.push({...r,cardId:`card-${i.length}`}),n.add(s+e.type+e.pair),n.add((r.category||r.chakra||"default")+r.type+r.pair))}return i.slice(0,2*e)}shuffleCards(){for(let e=this.cards.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this.cards[e],this.cards[t]]=[this.cards[t],this.cards[e]]}}renderCards(){const e=document.getElementById("cardsGrid");e&&(e.innerHTML="",e.className=`cards-grid ${this.selectedMode}`,this.cards.forEach(t=>{const a=this.createCardElement(t);e.appendChild(a)}),this.log(`Rendered ${this.cards.length} cards`))}createCardElement(e){const t=document.createElement("div");return t.className="memory-card",t.dataset.cardId=e.cardId,t.dataset.pairId=e.pair,t.dataset.chakra=e.chakra,t.innerHTML=`\n            <div class="card-face card-front">\n                <div class="card-pattern"></div>\n            </div>\n            <div class="card-face card-back" style="border-color: ${e.color}">\n                <div class="card-icon">${e.icon}</div>\n                <div class="card-text" style="color: ${e.color}">${e.text}</div>\n            </div>\n        `,t.addEventListener("click",()=>this.flipCard(t,e)),t}flipCard(e,t){if(this.isProcessing||e.classList.contains("flipped")||e.classList.contains("matched")||this.flippedCards.length>=2)this.playSound("error");else if(this.log(`Flipping card: ${t.text}`),this.playSound("flip"),e.classList.add("flipped"),this.flippedCards.push({element:e,data:t}),2===this.flippedCards.length){this.isProcessing=!0,this.moves++;const e=document.getElementById("movesValue");e&&(e.textContent=this.moves),setTimeout(()=>{this.checkMatch()},600)}}checkMatch(){const[e,t]=this.flippedCards;if(this.log(`Checking match: ${e.data.text} vs ${t.data.text}`),e.data.pair===t.data.id){this.log("âœ… Match found!"),e.element.classList.add("matched"),t.element.classList.add("matched"),this.matchedPairs++;const a=this.difficulties[this.selectedMode],i=document.getElementById("pairsValue");i&&(i.textContent=`${this.matchedPairs}/${a.pairs}`),this.playSound("match"),this.createParticles(e.element,e.data.color),this.createParticles(t.element,t.data.color),this.matchedPairs===a.pairs&&setTimeout(()=>this.gameComplete(),800)}else this.log("âŒ No match"),setTimeout(()=>{e.element.classList.remove("flipped"),t.element.classList.remove("flipped")},400);this.flippedCards=[],this.isProcessing=!1}startTimer(){this.timerInterval&&clearInterval(this.timerInterval),this.timerInterval=setInterval(()=>{const e=Math.floor((Date.now()-this.startTime)/1e3),t=Math.floor(e/60),a=e%60,i=document.getElementById("timeValue");i&&(i.textContent=`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`)},1e3)}async gameComplete(){this.log("ðŸŽ‰ Game complete!"),clearInterval(this.timerInterval);const e=Math.floor((Date.now()-this.startTime)/1e3),t=this.difficulties[this.selectedMode];let a=1;this.moves<=t.perfectMoves?a=3:this.moves<=1.5*t.minMoves&&(a=2);let i=t.baseXP;const n=[`Base: ${t.baseXP} XP`],o=this.moves===t.minMoves;if(o){const e=t.perfectXP-t.baseXP;i=t.perfectXP,n.push(`Perfect Game: +${e} XP`)}const r={easy:120,medium:180,hard:240};if(e<r[this.selectedMode]){const a=Math.floor(t.speedBonus*(1-e/r[this.selectedMode]));i+=a,n.push(`Speed Bonus: +${a} XP`)}if(3===a){const e=50;i+=e,n.push(`3-Star Bonus: +${e} XP`)}o?this.playSound("perfect"):this.playSound("victory"),this.gameData||(this.gameData={gamesPlayed:0,perfectGames:0,totalXPEarned:0,bestTimes:{},stats:{}}),this.gameData.gamesPlayed=(this.gameData.gamesPlayed||0)+1,this.gameData.totalXPEarned=(this.gameData.totalXPEarned||0)+i,o&&(this.gameData.perfectGames=(this.gameData.perfectGames||0)+1),this.gameData.stats||(this.gameData.stats={easy:{played:0,wins:0,totalMoves:0,totalTime:0},medium:{played:0,wins:0,totalMoves:0,totalTime:0},hard:{played:0,wins:0,totalMoves:0,totalTime:0}}),this.gameData.stats[this.selectedMode]||(this.gameData.stats[this.selectedMode]={played:0,wins:0,totalMoves:0,totalTime:0}),this.gameData.stats[this.selectedMode].played++,this.gameData.stats[this.selectedMode].wins++,this.gameData.stats[this.selectedMode].totalMoves+=this.moves,this.gameData.stats[this.selectedMode].totalTime+=e;let s=!1;if(this.gameData.bestTimes||(this.gameData.bestTimes={}),(!this.gameData.bestTimes[this.selectedMode]||e<this.gameData.bestTimes[this.selectedMode])&&(this.gameData.bestTimes[this.selectedMode]=e,s=!0),await this.saveGameData(),this.updateBestTimes(),window.progressSystem)try{await window.progressSystem.awardXP(i,`Chakra Memory Match (${this.selectedMode})`,"chakra-memory"),this.log("XP awarded to progress system")}catch(e){this.error("Error awarding XP",e)}this.showVictoryScreen(e,a,i,n,s)}showVictoryScreen(e,t,a,i,n){this.log("Showing victory screen");const o=document.getElementById("gameBoard");o&&o.classList.remove("active");const r=e%60,s={finalTime:`${Math.floor(e/60).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`,finalMoves:this.moves.toString(),finalStars:"â­".repeat(t),totalXP:a.toString()};Object.entries(s).forEach(([e,t])=>{const a=document.getElementById(e);a&&(a.textContent=t)});const c=document.getElementById("xpBreakdown");c&&(c.innerHTML=i.join("<br>"));const l=document.getElementById("newRecordMsg");l&&(l.style.display=n?"block":"none");const d=document.getElementById("victoryScreen");d&&d.classList.add("show")}resetGame(){this.log("Resetting game"),this.playSound("click"),this.setupGame()}playAgain(){this.log("Playing again"),this.playSound("click");const e=document.getElementById("victoryScreen");e&&e.classList.remove("show"),this.setupGame()}backToMenu(){this.log("Back to menu"),this.playSound("click"),this.timerInterval&&clearInterval(this.timerInterval),this.sounds.background.stop();const e=document.getElementById("gameBoard"),t=document.getElementById("victoryScreen"),a=document.getElementById("modeSelection");e&&e.classList.remove("active"),t&&t.classList.remove("show"),a&&(a.style.display="block"),this.selectedMode=null,document.querySelectorAll(".mode-btn").forEach(e=>{e.classList.remove("selected")});const i=document.querySelector(".start-game-btn");i&&(i.disabled=!0,i.textContent="Select a Difficulty to Start")}createParticles(e,t){if(!e)return;const a=e.getBoundingClientRect(),i=a.left+a.width/2,n=a.top+a.height/2;for(let e=0;e<12;e++){const a=document.createElement("div");a.className="particle chakra-particle",a.style.left=i+"px",a.style.top=n+"px",a.style.background=t,a.style.boxShadow=`0 0 10px ${t}`;const o=2*Math.PI*e/12,r=80+60*Math.random(),s=Math.cos(o)*r,c=Math.sin(o)*r;a.style.setProperty("--tx",s+"px"),a.style.setProperty("--ty",c+"px"),a.style.width="6px",a.style.height="6px",a.style.borderRadius="50%",a.style.position="fixed",a.style.pointerEvents="none",a.style.zIndex="9999",a.style.animation="chakraParticle 1.5s ease-out forwards",document.body.appendChild(a),setTimeout(()=>a.remove(),1500)}}shareResults(){this.log("Sharing results"),this.playSound("click");const e=document.getElementById("finalStars")?.textContent||"",t=document.getElementById("finalTime")?.textContent||"",a=document.getElementById("totalXP")?.textContent||"",i=`ðŸ§˜ Chakra Memory Match\n\nDifficulty: ${this.selectedMode?.charAt(0).toUpperCase()}${this.selectedMode?.slice(1)||""}\nRating: ${e}\nTime: ${t}\nXP Earned: +${a}\n\nAlign your chakras in Divine Temple! ðŸŒŸ`;navigator.share?navigator.share({title:"Chakra Memory Match Results",text:i,url:window.location.href}).catch(e=>this.log("Error sharing:",e)):navigator.clipboard.writeText(i).then(()=>{alert("Results copied to clipboard!")})}}const particleStyle=document.createElement("style");function selectTheme(e){if(window.chakraGameEnhanced){window.chakraGameEnhanced.setTheme(e),document.querySelectorAll(".theme-btn").forEach(e=>{e.classList.remove("active")});const t=document.querySelector(`.theme-btn[data-theme="${e}"]`);t&&t.classList.add("active")}}function selectMode(e){window.chakraGameEnhanced&&window.chakraGameEnhanced.selectMode(e)}function startGame(){window.chakraGameEnhanced&&window.chakraGameEnhanced.startGame()}function resetGame(){window.chakraGameEnhanced&&window.chakraGameEnhanced.resetGame()}function playAgain(){window.chakraGameEnhanced&&window.chakraGameEnhanced.playAgain()}function backToMenu(){window.chakraGameEnhanced&&window.chakraGameEnhanced.backToMenu()}function shareResults(){window.chakraGameEnhanced&&window.chakraGameEnhanced.shareResults()}particleStyle.textContent="\n    @keyframes chakraParticle {\n        0% {\n            transform: translate(0, 0) scale(1);\n            opacity: 1;\n        }\n        100% {\n            transform: translate(var(--tx), var(--ty)) scale(0);\n            opacity: 0;\n        }\n    }\n",document.head.appendChild(particleStyle),document.addEventListener("DOMContentLoaded",()=>{console.log("ðŸ§˜ Initializing Enhanced Chakra Memory Game..."),window.chakraGameEnhanced=new ChakraMemoryGameEnhanced});