class DailyQuestsSystem{constructor(){this.currentUser=null,this.quests=[],this.questsData=null,this.isInitialized=!1,this.questTemplates={easy:[{id:"meditate_5",type:"meditation",target:5,xp:50,icon:"üßò",name:"Quick Meditation",desc:"Meditate for 5 minutes"},{id:"gratitude_1",type:"gratitude",target:1,xp:40,icon:"üôè",name:"Practice Gratitude",desc:"Write 1 gratitude entry"},{id:"oracle_1",type:"oracle_reading",target:1,xp:50,icon:"üîÆ",name:"Seek Guidance",desc:"Draw 1 oracle card"},{id:"visit_3",type:"visit",target:3,xp:40,icon:"üö™",name:"Explorer",desc:"Visit 3 different sections"},{id:"affirmation_1",type:"affirmation",target:1,xp:30,icon:"‚ú®",name:"Positive Affirmation",desc:"Read 1 affirmation"}],medium:[{id:"meditate_10",type:"meditation",target:10,xp:100,icon:"üßò",name:"Deep Meditation",desc:"Meditate for 10 minutes"},{id:"oracle_3",type:"oracle_reading",target:3,xp:90,icon:"üîÆ",name:"Triple Reading",desc:"Draw 3 oracle cards"},{id:"chakra_2",type:"chakra_healing",target:2,xp:100,icon:"üíé",name:"Chakra Alignment",desc:"Balance 2 chakras"},{id:"journal_1",type:"journal_entry",target:1,xp:80,icon:"üìù",name:"Sacred Journal",desc:"Write 1 journal entry"},{id:"prayer_1",type:"prayer",target:1,xp:70,icon:"üôå",name:"Divine Prayer",desc:"Write 1 prayer"}],hard:[{id:"meditate_20",type:"meditation",target:20,xp:200,icon:"üßò",name:"Extended Practice",desc:"Meditate for 20 minutes"},{id:"complete_5",type:"activities",target:5,xp:150,icon:"‚ö°",name:"Power User",desc:"Complete 5 activities"},{id:"chakra_all",type:"chakra_healing",target:7,xp:280,icon:"üíé",name:"Full Alignment",desc:"Balance all 7 chakras"},{id:"gratitude_3",type:"gratitude",target:3,xp:120,icon:"üôè",name:"Gratitude Master",desc:"Write 3 gratitude entries"},{id:"visit_7",type:"visit",target:7,xp:140,icon:"üåü",name:"Temple Master",desc:"Visit 7 different sections"}]},this.init()}async init(){console.log("‚≠ê Initializing Daily Quests System..."),"undefined"!=typeof firebase&&firebase.auth?firebase.auth().onAuthStateChanged(async t=>{this.currentUser=t,t?await this.loadQuestsData():this.loadLocalQuestsData(),this.checkAndGenerateQuests(),this.isInitialized=!0,console.log("‚úÖ Daily Quests System ready")}):(this.loadLocalQuestsData(),this.checkAndGenerateQuests(),this.isInitialized=!0,console.log("‚úÖ Daily Quests System ready (local mode)")),window.progressSystem&&window.addEventListener("activityLogged",t=>this.handleActivity(t.detail))}async loadQuestsData(){if(this.currentUser)try{const t=firebase.firestore(),e=await t.collection("dailyQuests").doc(this.currentUser.uid).get();e.exists?this.questsData=e.data():(this.questsData=this.getDefaultQuestsData(),await this.saveQuestsData())}catch(t){console.error("Error loading quests data:",t),this.loadLocalQuestsData()}}loadLocalQuestsData(){const t=localStorage.getItem("dailyQuestsData");t?this.questsData=JSON.parse(t):(this.questsData=this.getDefaultQuestsData(),this.saveLocalQuestsData())}getDefaultQuestsData(){return{currentDate:(new Date).toDateString(),quests:[],completedToday:[],stats:{totalQuestsCompleted:0,perfectDays:0,currentStreak:0,longestStreak:0}}}async saveQuestsData(){if(this.currentUser&&"undefined"!=typeof firebase)try{const t=firebase.firestore();await t.collection("dailyQuests").doc(this.currentUser.uid).set(this.questsData)}catch(t){console.error("Error saving quests data:",t)}this.saveLocalQuestsData()}saveLocalQuestsData(){localStorage.setItem("dailyQuestsData",JSON.stringify(this.questsData))}checkAndGenerateQuests(){const t=(new Date).toDateString();this.questsData.currentDate!==t?(this.generateDailyQuests(),this.questsData.currentDate=t,this.saveQuestsData()):this.quests=this.questsData.quests||[]}generateDailyQuests(){console.log("üåÖ Generating new daily quests...");const t=window.progressSystem?.userData?.level||1,e=[],s=this.getRandomQuest("easy");e.push({...s,progress:0,completed:!1});const a=this.getRandomQuest("medium");e.push({...a,progress:0,completed:!1});let i=this.getRandomQuest("hard");t<5&&(i={...i,target:Math.ceil(.5*i.target),xp:Math.ceil(.7*i.xp)}),e.push({...i,progress:0,completed:!1}),this.quests=e,this.questsData.quests=e,this.questsData.completedToday=[],console.log("‚úÖ Daily quests generated:",this.quests)}getRandomQuest(t){const e=this.questTemplates[t];return{...e[Math.floor(Math.random()*e.length)]}}handleActivity(t){if(!this.quests||0===this.quests.length)return;const{type:e,data:s}=t;this.quests.forEach((t,a)=>{t.completed||this.activityMatchesQuest(e,t,s)&&this.updateQuestProgress(a,t,s)})}activityMatchesQuest(t,e,s){return"visit"===e.type||("activities"===e.type||{meditation:"meditation",oracle_reading:"oracle_reading",chakra_healing:"chakra_healing",journal_entry:"journal_entry",journal:"journal_entry",gratitude:"gratitude",prayer:"prayer",affirmation:"affirmation"}[t]===e.type)}updateQuestProgress(t,e,s){let a=1;"meditation"===e.type&&s?.duration&&(a=s.duration),e.progress+=a,e.progress>=e.target&&!e.completed&&this.completeQuest(t,e),this.saveQuestsData(),this.notifyQuestsUpdate()}async completeQuest(t,e){e.completed=!0,e.progress=e.target,console.log(`‚úÖ Quest completed: ${e.name}`),window.progressSystem&&await window.progressSystem.awardXP(e.xp,`Quest: ${e.name}`,"daily-quests"),this.questsData.completedToday.push(e.id),this.questsData.stats.totalQuestsCompleted++;this.quests.every(t=>t.completed)&&this.completePerfectDay(),this.saveQuestsData(),this.showQuestCompletionNotification(e),this.notifyQuestsUpdate()}async completePerfectDay(){console.log("üéâ PERFECT DAY! All quests completed!");window.progressSystem&&await window.progressSystem.awardXP(300,"üåü Perfect Day Bonus!","daily-quests"),this.questsData.stats.perfectDays++,this.questsData.stats.currentStreak++,this.questsData.stats.currentStreak>this.questsData.stats.longestStreak&&(this.questsData.stats.longestStreak=this.questsData.stats.currentStreak),this.showPerfectDayNotification()}showQuestCompletionNotification(t){const e=document.createElement("div");e.className="quest-completion-notification",e.innerHTML=`\n            <div class="quest-notification-content">\n                <div class="quest-notification-icon">${t.icon}</div>\n                <div class="quest-notification-text">\n                    <div class="quest-notification-title">Quest Complete!</div>\n                    <div class="quest-notification-name">${t.name}</div>\n                    <div class="quest-notification-xp">+${t.xp} XP</div>\n                </div>\n            </div>\n            <style>\n                .quest-completion-notification {\n                    position: fixed;\n                    top: 2rem;\n                    right: 2rem;\n                    background: linear-gradient(135deg, rgba(79, 195, 247, 0.95), rgba(102, 187, 106, 0.95));\n                    backdrop-filter: blur(20px);\n                    border-radius: 20px;\n                    padding: 1.5rem;\n                    box-shadow: 0 10px 40px rgba(79, 195, 247, 0.5);\n                    z-index: 99999;\n                    animation: slideInRight 0.5s ease;\n                    max-width: 350px;\n                }\n\n                .quest-notification-content {\n                    display: flex;\n                    gap: 1rem;\n                    align-items: center;\n                    color: white;\n                }\n\n                .quest-notification-icon {\n                    font-size: 3rem;\n                }\n\n                .quest-notification-title {\n                    font-size: 0.9rem;\n                    font-weight: 600;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                    margin-bottom: 0.25rem;\n                }\n\n                .quest-notification-name {\n                    font-size: 1.3rem;\n                    font-weight: 700;\n                    margin-bottom: 0.25rem;\n                }\n\n                .quest-notification-xp {\n                    font-size: 1rem;\n                    font-weight: 700;\n                    color: #FFD700;\n                }\n\n                @keyframes slideInRight {\n                    from {\n                        transform: translateX(400px);\n                        opacity: 0;\n                    }\n                    to {\n                        transform: translateX(0);\n                        opacity: 1;\n                    }\n                }\n            </style>\n        `,document.body.appendChild(e),window.divineAudio&&window.divineAudio.playBell(528,2),setTimeout(()=>{e.style.animation="slideOutRight 0.5s ease",setTimeout(()=>e.remove(),500)},4e3)}showPerfectDayNotification(){const t=document.createElement("div");t.className="perfect-day-notification",t.innerHTML='\n            <div class="perfect-day-content">\n                <div class="perfect-day-icon">üåü</div>\n                <div class="perfect-day-title">PERFECT DAY!</div>\n                <div class="perfect-day-subtitle">All Quests Completed!</div>\n                <div class="perfect-day-bonus">+300 BONUS XP</div>\n            </div>\n            <style>\n                .perfect-day-notification {\n                    position: fixed;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%);\n                    background: linear-gradient(135deg, rgba(212, 175, 55, 0.98), rgba(255, 215, 0, 0.98));\n                    backdrop-filter: blur(20px);\n                    border-radius: 30px;\n                    padding: 3rem;\n                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.7);\n                    z-index: 999999;\n                    animation: perfectDayZoom 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n                    text-align: center;\n                    min-width: 300px;\n                }\n\n                .perfect-day-icon {\n                    font-size: 5rem;\n                    margin-bottom: 1rem;\n                    animation: perfectDaySpin 1s ease;\n                }\n\n                .perfect-day-title {\n                    font-size: 2.5rem;\n                    font-weight: 700;\n                    color: #0F0F23;\n                    margin-bottom: 0.5rem;\n                }\n\n                .perfect-day-subtitle {\n                    font-size: 1.2rem;\n                    color: #0F0F23;\n                    margin-bottom: 1rem;\n                    opacity: 0.9;\n                }\n\n                .perfect-day-bonus {\n                    font-size: 2rem;\n                    font-weight: 700;\n                    color: #8B5CF6;\n                }\n\n                @keyframes perfectDayZoom {\n                    from {\n                        transform: translate(-50%, -50%) scale(0);\n                        opacity: 0;\n                    }\n                    to {\n                        transform: translate(-50%, -50%) scale(1);\n                        opacity: 1;\n                    }\n                }\n\n                @keyframes perfectDaySpin {\n                    from { transform: rotate(0deg) scale(0.5); }\n                    to { transform: rotate(360deg) scale(1); }\n                }\n            </style>\n        ',document.body.appendChild(t),window.divineAudio&&(window.divineAudio.playBell(528,3),setTimeout(()=>window.divineAudio.playBell(639,3),300),setTimeout(()=>window.divineAudio.playBell(741,3),600),setTimeout(()=>window.divineAudio.playBell(852,3),900)),setTimeout(()=>{t.style.animation="fadeOut 0.5s ease",setTimeout(()=>t.remove(),500)},5e3)}notifyQuestsUpdate(){window.dispatchEvent(new CustomEvent("questsUpdated",{detail:{quests:this.quests}}))}getQuests(){return this.quests}getQuestsProgress(){const t=this.quests.filter(t=>t.completed).length,e=this.quests.length;return{completed:t,total:e,percentage:t/e*100}}getStats(){return this.questsData?.stats||{}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.dailyQuests=new DailyQuestsSystem}):window.dailyQuests=new DailyQuestsSystem,console.log("‚≠ê Daily Quests System loaded");