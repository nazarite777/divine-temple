!function(){"use strict";window.premiumCheckout=new class{constructor(){this.currentUser=null,this.isProcessing=!1,this.init()}async init(){console.log("üí≥ Premium Checkout System initialized"),await this.waitForFirebase(),firebase.auth().onAuthStateChanged(e=>{this.currentUser=e,e&&this.checkPremiumStatus()})}async waitForFirebase(){return new Promise(e=>{const n=()=>{"undefined"!=typeof firebase&&firebase.auth&&firebase.functions?e():setTimeout(n,100)};n()})}async checkPremiumStatus(){if(this.currentUser)try{const e=firebase.functions().httpsCallable("verifyPremiumAccess");(await e({})).data.hasPremiumAccess?(console.log("‚úÖ User already has premium access"),this.hidePremiumButtons()):(console.log("üíé User can upgrade to premium"),this.showPremiumButtons())}catch(e){console.error("Error checking premium status:",e)}}async upgradeToPremium(){if(!this.currentUser)return this.showMessage("Please log in to upgrade to premium","error"),void(window.location.href="/login.html");if(this.isProcessing)console.log("Already processing...");else{this.isProcessing=!0,this.showLoadingMessage();try{const e=firebase.functions().httpsCallable("createCheckoutSession"),n=await e({successUrl:window.location.origin+"/premium-success.html",cancelUrl:window.location.origin+"/free-dashboard.html"});console.log("Checkout session created:",n.data.sessionId),window.location.href=n.data.url}catch(e){this.isProcessing=!1,console.error("Error creating checkout:",e);let n="Failed to start checkout. Please try again.";if("unauthenticated"===e.code)return n="Please log in to upgrade to premium",void(window.location.href="/login.html");"already-exists"===e.code?(n="You already have premium access!",this.hidePremiumButtons()):"failed-precondition"===e.code&&(n="Payment system is not configured. Please contact support."),this.showMessage(n,"error"),this.hideLoadingMessage()}}}showPremiumButtons(){document.querySelectorAll(".premium-upgrade-btn, .upgrade-to-premium-btn").forEach(e=>{e.style.display="inline-block",e.disabled=!1})}hidePremiumButtons(){document.querySelectorAll(".premium-upgrade-btn, .upgrade-to-premium-btn").forEach(e=>{e.style.display="none"})}showLoadingMessage(){const e=document.createElement("div");e.id="premium-checkout-loading",e.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 999999;\n                animation: fadeIn 0.3s ease;\n            ",e.innerHTML='\n                <div style="\n                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n                    border: 2px solid #d4af37;\n                    border-radius: 20px;\n                    padding: 3rem;\n                    text-align: center;\n                    max-width: 400px;\n                ">\n                    <div style="font-size: 4rem; margin-bottom: 1rem;">üíé</div>\n                    <h2 style="color: #d4af37; font-size: 1.8rem; margin-bottom: 1rem;">\n                        Preparing Checkout...\n                    </h2>\n                    <div class="spinner" style="\n                        border: 4px solid rgba(212, 175, 55, 0.1);\n                        border-top: 4px solid #d4af37;\n                        border-radius: 50%;\n                        width: 50px;\n                        height: 50px;\n                        animation: spin 1s linear infinite;\n                        margin: 0 auto;\n                    "></div>\n                    <p style="color: #ffffff; margin-top: 1rem;">\n                        Redirecting to secure payment...\n                    </p>\n                </div>\n            ';const n=document.createElement("style");n.textContent="\n                @keyframes spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n                @keyframes fadeIn {\n                    from { opacity: 0; }\n                    to { opacity: 1; }\n                }\n            ",document.head.appendChild(n),document.body.appendChild(e)}hideLoadingMessage(){const e=document.getElementById("premium-checkout-loading");e&&e.remove()}showMessage(e,n="info"){const t={error:{bg:"#DC2626",border:"#EF4444"},success:{bg:"#10b981",border:"#059669"},info:{bg:"#3B82F6",border:"#2563EB"}},r=t[n]||t.info,o=document.createElement("div");o.style.cssText=`\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                z-index: 1000000;\n                background: ${r.bg};\n                color: white;\n                padding: 1.5rem;\n                border-radius: 12px;\n                border: 2px solid ${r.border};\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n                animation: slideInRight 0.5s ease;\n                max-width: 400px;\n            `,o.innerHTML=`\n                <div style="display: flex; gap: 1rem; align-items: center;">\n                    <div style="font-size: 2rem;">${"error"===n?"‚ö†Ô∏è":"success"===n?"‚úÖ":"‚ÑπÔ∏è"}</div>\n                    <div>\n                        <p style="margin: 0; font-weight: 600;">${e}</p>\n                    </div>\n                    <button onclick="this.parentElement.parentElement.remove()" style="\n                        background: rgba(255,255,255,0.2);\n                        border: none;\n                        color: white;\n                        width: 24px;\n                        height: 24px;\n                        border-radius: 50%;\n                        cursor: pointer;\n                        font-size: 16px;\n                    ">√ó</button>\n                </div>\n            `;const i=document.createElement("style");i.textContent="\n                @keyframes slideInRight {\n                    from {\n                        transform: translateX(400px);\n                        opacity: 0;\n                    }\n                    to {\n                        transform: translateX(0);\n                        opacity: 1;\n                    }\n                }\n            ",document.head.appendChild(i),document.body.appendChild(o),setTimeout(()=>o.remove(),5e3)}showUpgradeModal(){const e=document.createElement("div");e.id="premium-upgrade-modal",e.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 999999;\n                animation: fadeIn 0.3s ease;\n            ",e.innerHTML='\n                <div style="\n                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n                    border: 2px solid #d4af37;\n                    border-radius: 25px;\n                    padding: 3rem;\n                    max-width: 600px;\n                    text-align: center;\n                    box-shadow: 0 25px 70px rgba(212, 175, 55, 0.4);\n                ">\n                    <div style="font-size: 4rem; margin-bottom: 1rem;">üíé</div>\n                    <h2 style="color: #d4af37; font-size: 2rem; margin-bottom: 1rem; font-family: \'Playfair Display\', serif;">\n                        Unlock Premium Access\n                    </h2>\n                    <p style="color: #ffffff; font-size: 1.2rem; margin-bottom: 2rem; line-height: 1.6;">\n                        Get full access to all premium features with a <strong>monthly subscription</strong> for just $9.99/month!\n                    </p>\n\n                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 15px; margin: 2rem 0; text-align: left;">\n                        <div style="color: #d4af37; font-weight: 600; margin-bottom: 1rem;">Premium Features Include:</div>\n                        <div style="color: #ffffff; line-height: 2;">\n                            ‚úì Full access to all premium content<br>\n                            ‚úì Advanced spiritual tools & practices<br>\n                            ‚úì Oracle readings & tarot<br>\n                            ‚úì Meditation & mindfulness library<br>\n                            ‚úì Crystal healing & energy work<br>\n                            ‚úì Sacred knowledge & teachings<br>\n                            ‚úì Progress tracking & rewards<br>\n                            ‚úì Priority support\n                        </div>\n                    </div>\n\n                    <div style="font-size: 3rem; font-weight: 900; color: #d4af37; margin: 1.5rem 0;">\n                        $9.99<span style="font-size: 1.5rem;">/mo</span>\n                    </div>\n                    <div style="color: #8b5cf6; font-size: 1.1rem; margin-bottom: 2rem;">\n                        Monthly subscription ‚Ä¢ Cancel anytime\n                    </div>\n\n                    <div style="display: flex; gap: 1rem; justify-content: center;">\n                        <button onclick="window.premiumCheckout.upgradeToPremium()" style="\n                            background: linear-gradient(135deg, #d4af37, #f59e0b);\n                            border: none;\n                            color: white;\n                            padding: 1.2rem 2.5rem;\n                            border-radius: 15px;\n                            font-size: 1.2rem;\n                            font-weight: 600;\n                            cursor: pointer;\n                            transition: transform 0.3s ease;\n                            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);\n                        " onmouseover="this.style.transform=\'scale(1.05)\'" onmouseout="this.style.transform=\'scale(1)\'">\n                            üöÄ Upgrade Now\n                        </button>\n                        <button onclick="document.getElementById(\'premium-upgrade-modal\').remove()" style="\n                            background: rgba(255, 255, 255, 0.1);\n                            border: 1px solid rgba(255, 255, 255, 0.3);\n                            color: white;\n                            padding: 1.2rem 2.5rem;\n                            border-radius: 15px;\n                            font-size: 1.2rem;\n                            font-weight: 600;\n                            cursor: pointer;\n                        ">\n                            Maybe Later\n                        </button>\n                    </div>\n\n                    <p style="color: #8b5cf6; margin-top: 2rem; font-size: 0.9rem;">\n                        üí≥ Secure payment powered by Stripe\n                    </p>\n                </div>\n            ',document.body.appendChild(e)}},window.upgradeToPremium=function(){window.premiumCheckout.upgradeToPremium()},window.showPremiumUpgradeModal=function(){window.premiumCheckout.showUpgradeModal()},console.log("üíé Premium Checkout ready!")}();