class PWAInstallSystem{constructor(){this.deferredPrompt=null,this.isInstalled=this.checkIfInstalled(),this.isStandalone=this.checkIfStandalone(),this.isIOS=this.checkIfIOS(),this.updateAvailable=!1,this.init()}init(){console.log("üì± PWA Install System initialized"),window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),this.deferredPrompt=n,console.log("Install prompt captured"),this.isInstalled||this.isStandalone||setTimeout(()=>{this.showInstallBanner()},3e3)}),window.addEventListener("appinstalled",()=>{console.log("PWA installed successfully"),this.isInstalled=!0,this.hideInstallBanner(),window.progressSystem&&window.progressSystem.awardXP(50,"Installed Divine Temple app! üì±","pwa"),this.showInstallSuccessMessage()}),this.checkForUpdates(),window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.isStandalone&&this.trackAppLaunch(),this.isIOS&&!this.isStandalone&&setTimeout(()=>{this.showIOSInstructions()},5e3)}checkIfInstalled(){return"true"===localStorage.getItem("pwa_installed")}checkIfStandalone(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")}checkIfIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}async promptInstall(){if(!this.deferredPrompt)return console.log("No install prompt available"),{success:!1,message:"Installation not available"};this.deferredPrompt.prompt();if("accepted"===(await this.deferredPrompt.userChoice).outcome)return console.log("User accepted the install prompt"),localStorage.setItem("pwa_installed","true"),this.deferredPrompt=null,{success:!0,message:"Installation started"};{console.log("User dismissed the install prompt");const n=parseInt(localStorage.getItem("install_dismiss_count")||"0");return localStorage.setItem("install_dismiss_count",(n+1).toString()),{success:!1,message:"Installation cancelled"}}}showInstallBanner(){if(parseInt(localStorage.getItem("install_dismiss_count")||"0")>=3)return;const n=document.createElement("div");n.className="pwa-install-banner",n.id="pwaInstallBanner",n.innerHTML='\n            <div class="install-banner-content">\n                <div class="install-icon">üì±</div>\n                <div class="install-text">\n                    <h4>Install Divine Temple</h4>\n                    <p>Get the full app experience with offline access</p>\n                </div>\n                <button onclick="window.pwaInstallSystem.handleInstallClick()" class="install-btn">\n                    Install\n                </button>\n                <button onclick="window.pwaInstallSystem.dismissInstallBanner()" class="dismiss-btn">\n                    ‚úï\n                </button>\n            </div>\n        ',this.addInstallStyles(),document.body.appendChild(n),setTimeout(()=>n.classList.add("show"),100)}async handleInstallClick(){(await this.promptInstall()).success&&this.hideInstallBanner()}dismissInstallBanner(){this.hideInstallBanner();const n=parseInt(localStorage.getItem("install_dismiss_count")||"0");localStorage.setItem("install_dismiss_count",(n+1).toString())}hideInstallBanner(){const n=document.getElementById("pwaInstallBanner");n&&(n.classList.remove("show"),setTimeout(()=>n.remove(),300))}showInstallSuccessMessage(){const n=document.createElement("div");n.className="install-success-message",n.innerHTML='\n            <div class="success-content">\n                <div class="success-icon">‚úÖ</div>\n                <div class="success-text">\n                    <h4>App Installed Successfully!</h4>\n                    <p>Divine Temple is now on your home screen</p>\n                    <p class="success-xp">+50 XP</p>\n                </div>\n            </div>\n        ',document.body.appendChild(n),setTimeout(()=>n.remove(),5e3)}showIOSInstructions(){const n=document.createElement("div");n.className="ios-install-modal",n.id="iosInstallModal",n.innerHTML='\n            <div class="ios-modal-content">\n                <div class="ios-modal-header">\n                    <h3>üì± Install Divine Temple</h3>\n                    <button onclick="document.getElementById(\'iosInstallModal\').remove()" class="modal-close">‚úï</button>\n                </div>\n                <div class="ios-modal-body">\n                    <p>To install Divine Temple on your iPhone or iPad:</p>\n                    <ol class="ios-instructions">\n                        <li>\n                            <span class="instruction-icon">1Ô∏è‚É£</span>\n                            <span>Tap the Share button <span class="ios-icon">‚éã</span> in Safari</span>\n                        </li>\n                        <li>\n                            <span class="instruction-icon">2Ô∏è‚É£</span>\n                            <span>Scroll down and tap "Add to Home Screen" <span class="ios-icon">‚ûï</span></span>\n                        </li>\n                        <li>\n                            <span class="instruction-icon">3Ô∏è‚É£</span>\n                            <span>Tap "Add" in the top right corner</span>\n                        </li>\n                    </ol>\n                    <p class="ios-note">The app icon will appear on your home screen!</p>\n                </div>\n                <div class="ios-modal-footer">\n                    <button onclick="document.getElementById(\'iosInstallModal\').remove(); localStorage.setItem(\'ios_install_shown\', \'true\');" class="ios-got-it-btn">\n                        Got it!\n                    </button>\n                </div>\n            </div>\n        ',this.addInstallStyles(),document.body.appendChild(n);localStorage.getItem("ios_install_shown")}async checkForUpdates(){if("serviceWorker"in navigator)try{const n=await navigator.serviceWorker.getRegistration();if(!n)return;setInterval(()=>{n.update()},36e5),n.addEventListener("updatefound",()=>{const t=n.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&(this.updateAvailable=!0,this.showUpdateNotification())})})}catch(n){console.error("Error checking for updates:",n)}}showUpdateNotification(){const n=document.createElement("div");n.className="update-notification",n.id="updateNotification",n.innerHTML='\n            <div class="update-content">\n                <div class="update-icon">üîÑ</div>\n                <div class="update-text">\n                    <h4>Update Available</h4>\n                    <p>A new version of Divine Temple is ready</p>\n                </div>\n                <button onclick="window.pwaInstallSystem.applyUpdate()" class="update-btn">\n                    Update Now\n                </button>\n                <button onclick="document.getElementById(\'updateNotification\').remove()" class="later-btn">\n                    Later\n                </button>\n            </div>\n        ',document.body.appendChild(n),setTimeout(()=>{document.getElementById("updateNotification")&&document.getElementById("updateNotification").classList.add("show")},100)}async applyUpdate(){if("serviceWorker"in navigator)try{const n=await navigator.serviceWorker.getRegistration();n&&n.waiting&&(n.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}catch(n){console.error("Error applying update:",n)}}handleOnline(){console.log("App is online");const n=document.createElement("div");n.className="network-notification online",n.textContent="‚úÖ Back online",document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}handleOffline(){console.log("App is offline");const n=document.createElement("div");n.className="network-notification offline",n.textContent="‚ö†Ô∏è You are offline - Some features may be limited",document.body.appendChild(n),setTimeout(()=>n.remove(),5e3)}trackAppLaunch(){const n=parseInt(localStorage.getItem("app_launches")||"0")+1;localStorage.setItem("app_launches",n.toString()),console.log(`App launched ${n} times`),window.progressSystem&&(1===n?window.progressSystem.awardXP(20,"First app launch! üöÄ","pwa"):10===n?window.progressSystem.awardXP(50,"10 app launches! Dedicated! üéØ","pwa"):50===n?window.progressSystem.awardXP(100,"50 app launches! True devotee! üôè","pwa"):100===n&&window.progressSystem.awardXP(200,"100 app launches! Spiritual warrior! ‚öîÔ∏è","pwa"))}getInstallStats(){return{isInstalled:this.isInstalled,isStandalone:this.isStandalone,isIOS:this.isIOS,launches:parseInt(localStorage.getItem("app_launches")||"0"),dismissCount:parseInt(localStorage.getItem("install_dismiss_count")||"0"),updateAvailable:this.updateAvailable}}openInstallModal(){const n=document.createElement("div");n.className="install-info-modal",n.id="installInfoModal";const t=this.getInstallStats();n.innerHTML=`\n            <div class="install-modal-content">\n                <div class="install-modal-header">\n                    <h2>üì± Install App</h2>\n                    <button onclick="document.getElementById('installInfoModal').remove()" class="modal-close">‚úï</button>\n                </div>\n\n                <div class="install-modal-body">\n                    ${t.isStandalone?`\n                        <div class="install-status installed">\n                            <div class="status-icon">‚úÖ</div>\n                            <h3>App Installed</h3>\n                            <p>You're using the installed version</p>\n                        </div>\n\n                        <div class="app-stats">\n                            <h4>üìä App Statistics</h4>\n                            <div class="stat-grid">\n                                <div class="stat-item">\n                                    <div class="stat-value">${t.launches}</div>\n                                    <div class="stat-label">App Launches</div>\n                                </div>\n                                <div class="stat-item">\n                                    <div class="stat-value">${t.updateAvailable?"Yes":"No"}</div>\n                                    <div class="stat-label">Update Available</div>\n                                </div>\n                            </div>\n                        </div>\n\n                        ${t.updateAvailable?'\n                            <button onclick="window.pwaInstallSystem.applyUpdate()" class="update-now-btn">\n                                üîÑ Update Now\n                            </button>\n                        ':""}\n                    `:`\n                        <div class="install-benefits">\n                            <h3>‚ú® Benefits of Installing</h3>\n                            <ul class="benefits-list">\n                                <li>üì¥ <strong>Offline Access</strong> - Use anywhere, anytime</li>\n                                <li>‚ö° <strong>Faster Loading</strong> - Instant app launch</li>\n                                <li>üîî <strong>Push Notifications</strong> - Stay connected</li>\n                                <li>üéØ <strong>Full Screen Mode</strong> - Immersive experience</li>\n                                <li>üíæ <strong>Less Data Usage</strong> - Cached resources</li>\n                                <li>üè† <strong>Home Screen Icon</strong> - Quick access</li>\n                            </ul>\n                        </div>\n\n                        ${this.isIOS?'\n                            <div class="ios-install-section">\n                                <h4>iOS Installation</h4>\n                                <button onclick="window.pwaInstallSystem.showIOSInstructions()" class="ios-instructions-btn">\n                                    üì± View Instructions\n                                </button>\n                            </div>\n                        ':this.deferredPrompt?'\n                            <button onclick="window.pwaInstallSystem.handleInstallClick(); document.getElementById(\'installInfoModal\').remove();" class="install-now-btn">\n                                üì• Install Now\n                            </button>\n                        ':'\n                            <div class="install-note">\n                                <p>Installation is available in supported browsers</p>\n                            </div>\n                        '}\n                    `}\n                </div>\n            </div>\n        `,this.addInstallStyles(),document.body.appendChild(n)}addInstallStyles(){if(document.getElementById("pwaInstallStyles"))return;const n=document.createElement("style");n.id="pwaInstallStyles",n.textContent="\n            .pwa-install-banner {\n                position: fixed;\n                bottom: -100px;\n                left: 20px;\n                right: 20px;\n                max-width: 600px;\n                margin: 0 auto;\n                z-index: 9999;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                border-radius: 15px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n                transition: bottom 0.3s ease;\n            }\n\n            .pwa-install-banner.show {\n                bottom: 20px;\n            }\n\n            .install-banner-content {\n                display: flex;\n                align-items: center;\n                gap: 15px;\n                padding: 20px;\n                color: white;\n            }\n\n            .install-icon {\n                font-size: 40px;\n                flex-shrink: 0;\n            }\n\n            .install-text {\n                flex: 1;\n            }\n\n            .install-text h4 {\n                margin: 0 0 5px 0;\n                font-size: 16px;\n            }\n\n            .install-text p {\n                margin: 0;\n                font-size: 13px;\n                opacity: 0.95;\n            }\n\n            .install-btn, .dismiss-btn {\n                padding: 10px 20px;\n                border: none;\n                border-radius: 8px;\n                cursor: pointer;\n                font-weight: 600;\n                font-size: 14px;\n                transition: transform 0.2s;\n            }\n\n            .install-btn {\n                background: white;\n                color: #667eea;\n            }\n\n            .install-btn:hover {\n                transform: scale(1.05);\n            }\n\n            .dismiss-btn {\n                background: rgba(255,255,255,0.2);\n                color: white;\n                width: 32px;\n                height: 32px;\n                padding: 0;\n            }\n\n            .install-success-message {\n                position: fixed;\n                top: 80px;\n                right: 20px;\n                z-index: 10000;\n                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);\n                color: white;\n                padding: 20px;\n                border-radius: 15px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n                animation: slideInRight 0.5s ease;\n            }\n\n            .success-content {\n                display: flex;\n                gap: 15px;\n                align-items: center;\n            }\n\n            .success-icon {\n                font-size: 40px;\n            }\n\n            .success-text h4 {\n                margin: 0 0 5px 0;\n            }\n\n            .success-text p {\n                margin: 3px 0;\n                opacity: 0.95;\n            }\n\n            .success-xp {\n                font-weight: bold;\n                font-size: 16px;\n            }\n\n            .ios-install-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n                animation: fadeIn 0.3s ease;\n            }\n\n            .ios-modal-content {\n                background: white;\n                border-radius: 20px;\n                max-width: 500px;\n                width: 90%;\n                overflow: hidden;\n            }\n\n            .ios-modal-header {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 20px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n\n            .ios-modal-header h3 {\n                margin: 0;\n            }\n\n            .modal-close {\n                background: rgba(255,255,255,0.2);\n                border: none;\n                color: white;\n                width: 32px;\n                height: 32px;\n                border-radius: 50%;\n                cursor: pointer;\n                font-size: 20px;\n            }\n\n            .ios-modal-body {\n                padding: 30px;\n            }\n\n            .ios-instructions {\n                list-style: none;\n                padding: 0;\n                margin: 20px 0;\n            }\n\n            .ios-instructions li {\n                display: flex;\n                align-items: flex-start;\n                gap: 15px;\n                padding: 15px;\n                background: #f9f9f9;\n                border-radius: 10px;\n                margin-bottom: 15px;\n            }\n\n            .instruction-icon {\n                font-size: 24px;\n            }\n\n            .ios-icon {\n                display: inline-block;\n                padding: 2px 8px;\n                background: #667eea;\n                color: white;\n                border-radius: 5px;\n                font-weight: bold;\n                margin: 0 5px;\n            }\n\n            .ios-note {\n                text-align: center;\n                font-style: italic;\n                color: #666;\n                margin-top: 20px;\n            }\n\n            .ios-modal-footer {\n                padding: 20px;\n                background: #f9f9f9;\n                text-align: center;\n            }\n\n            .ios-got-it-btn {\n                padding: 12px 40px;\n                border: none;\n                border-radius: 10px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                font-weight: 600;\n                font-size: 16px;\n                cursor: pointer;\n            }\n\n            .update-notification {\n                position: fixed;\n                top: 80px;\n                right: 20px;\n                z-index: 10000;\n                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n                color: white;\n                padding: 20px;\n                border-radius: 15px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n                animation: slideInRight 0.5s ease;\n                max-width: 400px;\n            }\n\n            .update-content {\n                display: flex;\n                gap: 15px;\n                align-items: center;\n            }\n\n            .update-icon {\n                font-size: 40px;\n            }\n\n            .update-text {\n                flex: 1;\n            }\n\n            .update-text h4 {\n                margin: 0 0 5px 0;\n            }\n\n            .update-text p {\n                margin: 0;\n                opacity: 0.95;\n            }\n\n            .update-btn, .later-btn {\n                padding: 8px 16px;\n                border: none;\n                border-radius: 8px;\n                cursor: pointer;\n                font-weight: 600;\n                font-size: 13px;\n                margin-top: 10px;\n            }\n\n            .update-btn {\n                background: white;\n                color: #f5576c;\n            }\n\n            .later-btn {\n                background: rgba(255,255,255,0.2);\n                color: white;\n                margin-left: 8px;\n            }\n\n            .network-notification {\n                position: fixed;\n                top: 80px;\n                right: 20px;\n                z-index: 10000;\n                padding: 15px 25px;\n                border-radius: 10px;\n                color: white;\n                font-weight: 600;\n                animation: slideInRight 0.5s ease;\n            }\n\n            .network-notification.online {\n                background: #10b981;\n            }\n\n            .network-notification.offline {\n                background: #ef4444;\n            }\n\n            .install-info-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n            }\n\n            .install-modal-content {\n                background: white;\n                border-radius: 20px;\n                max-width: 600px;\n                width: 90%;\n                max-height: 90vh;\n                overflow: hidden;\n                display: flex;\n                flex-direction: column;\n            }\n\n            .install-modal-header {\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 20px 30px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n\n            .install-modal-header h2 {\n                margin: 0;\n            }\n\n            .install-modal-body {\n                flex: 1;\n                overflow-y: auto;\n                padding: 30px;\n            }\n\n            .install-status {\n                text-align: center;\n                padding: 30px;\n                background: #f0fdf4;\n                border-radius: 15px;\n                margin-bottom: 30px;\n            }\n\n            .status-icon {\n                font-size: 64px;\n                margin-bottom: 15px;\n            }\n\n            .install-status h3 {\n                margin: 0 0 10px 0;\n                color: #10b981;\n            }\n\n            .install-status p {\n                margin: 0;\n                color: #666;\n            }\n\n            .app-stats {\n                margin-bottom: 30px;\n            }\n\n            .app-stats h4 {\n                margin: 0 0 20px 0;\n            }\n\n            .stat-grid {\n                display: grid;\n                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n                gap: 15px;\n            }\n\n            .stat-item {\n                text-align: center;\n                padding: 20px;\n                background: #f9f9f9;\n                border-radius: 10px;\n            }\n\n            .stat-value {\n                font-size: 32px;\n                font-weight: bold;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                -webkit-background-clip: text;\n                -webkit-text-fill-color: transparent;\n            }\n\n            .stat-label {\n                font-size: 13px;\n                color: #666;\n                margin-top: 5px;\n            }\n\n            .install-benefits {\n                margin-bottom: 30px;\n            }\n\n            .install-benefits h3 {\n                margin: 0 0 20px 0;\n            }\n\n            .benefits-list {\n                list-style: none;\n                padding: 0;\n                margin: 0;\n            }\n\n            .benefits-list li {\n                padding: 15px;\n                background: #f9f9f9;\n                border-radius: 10px;\n                margin-bottom: 10px;\n            }\n\n            .install-now-btn, .update-now-btn, .ios-instructions-btn {\n                width: 100%;\n                padding: 14px;\n                border: none;\n                border-radius: 10px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                font-weight: 600;\n                font-size: 16px;\n                cursor: pointer;\n                transition: transform 0.2s;\n            }\n\n            .install-now-btn:hover, .update-now-btn:hover, .ios-instructions-btn:hover {\n                transform: translateY(-2px);\n            }\n\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n\n            @keyframes slideInRight {\n                from {\n                    transform: translateX(400px);\n                    opacity: 0;\n                }\n                to {\n                    transform: translateX(0);\n                    opacity: 1;\n                }\n            }\n\n            @media (max-width: 768px) {\n                .pwa-install-banner {\n                    left: 10px;\n                    right: 10px;\n                }\n\n                .install-banner-content {\n                    flex-wrap: wrap;\n                    justify-content: center;\n                }\n            }\n        ",document.head.appendChild(n)}}"undefined"!=typeof window&&(window.pwaInstallSystem=new PWAInstallSystem,console.log("üì± PWA Install System ready!"));