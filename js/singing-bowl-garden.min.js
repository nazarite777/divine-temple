class SingingBowlHarmonyGarden{constructor(){this.audioContext=null,this.masterGain=null,this.bowls=[],this.activeBowls=new Set,this.garden=null,this.isDrawing=!1,this.currentTool="rake",this.meditationTimer=0,this.timerInterval=null,this.isTimerRunning=!1,this.soundEnabled=!0,this.masterVolume=.7,this.sustainedNotes=new Map,this.spatialAudioEnabled=!0,this.feedbackSoundsEnabled=!0,this.gardenElements=[],this.sandPattern=[],this.lastMousePos={x:0,y:0},this.userProgress={level:1,experience:0,bowlsMastered:new Set,gardensCreated:0,meditationMinutes:0,achievements:new Set},this.chakraBowls=[{id:"root",name:"Root Chakra",frequency:256,color:"#c41e3a",position:{x:300,y:400},size:80,symbol:"üü•",meaning:"Grounding, Security, Stability",affirmation:"I am safe and secure in my physical existence"},{id:"sacral",name:"Sacral Chakra",frequency:288,color:"#ff8c00",position:{x:200,y:350},size:75,symbol:"üüß",meaning:"Creativity, Sexuality, Emotion",affirmation:"I embrace my creative energy and emotional flow"},{id:"solar",name:"Solar Plexus",frequency:320,color:"#ffd700",position:{x:150,y:250},size:75,symbol:"üü®",meaning:"Personal Power, Confidence, Will",affirmation:"I am confident in my personal power and choices"},{id:"heart",name:"Heart Chakra",frequency:341.3,color:"#20b2aa",position:{x:200,y:150},size:85,symbol:"üíö",meaning:"Love, Compassion, Connection",affirmation:"I give and receive love freely and unconditionally"},{id:"throat",name:"Throat Chakra",frequency:384,color:"#4169e1",position:{x:300,y:100},size:75,symbol:"üîµ",meaning:"Truth, Communication, Expression",affirmation:"I speak my truth with clarity and kindness"},{id:"third_eye",name:"Third Eye",frequency:426.7,color:"#663399",position:{x:400,y:150},size:75,symbol:"üü£",meaning:"Intuition, Wisdom, Perception",affirmation:"I trust my inner wisdom and intuitive guidance"},{id:"crown",name:"Crown Chakra",frequency:480,color:"#9370db",position:{x:450,y:250},size:75,symbol:"üü™",meaning:"Spiritual Connection, Enlightenment",affirmation:"I am connected to the divine consciousness within"}],this.gardenTools=[{id:"rake",name:"Sand Rake",icon:"ü•ç",description:"Create flowing patterns in the sand"},{id:"stone",name:"Place Stone",icon:"ü™®",description:"Add meditation stones to your garden"},{id:"bamboo",name:"Plant Bamboo",icon:"üéã",description:"Grow bamboo for natural boundaries"},{id:"lotus",name:"Lotus Flower",icon:"ü™∑",description:"Place sacred lotus flowers"},{id:"water",name:"Water Feature",icon:"üíß",description:"Add peaceful water elements"},{id:"clear",name:"Clear Garden",icon:"üóëÔ∏è",description:"Start with fresh sand"}],this.init()}async init(){console.log("ü•£ Initializing Singing Bowl Harmony Garden...");document.getElementById("singingBowlContainer")?(await this.createInterface(),await this.initAudio(),this.setupCanvas(),this.bindEvents(),this.loadProgress(),console.log("‚úÖ Singing Bowl Harmony Garden initialized")):console.warn("Singing bowl container not found")}async createInterface(){document.getElementById("singingBowlContainer").innerHTML=`\n            <div class="harmony-garden-app">\n                \x3c!-- Header --\x3e\n                <div class="garden-header">\n                    <div class="garden-title">\n                        <h3>ü•£ Singing Bowl Harmony Garden</h3>\n                        <p class="garden-subtitle">Sound Healing & Zen Meditation</p>\n                    </div>\n                    \n                    <div class="meditation-controls">\n                        <div class="timer-display">\n                            <span class="timer-icon">üßò‚Äç‚ôÄÔ∏è</span>\n                            <span id="meditationTime">00:00</span>\n                            <button id="timerToggle" class="timer-btn">‚ñ∂Ô∏è</button>\n                        </div>\n                        <div class="volume-control">\n                            <span class="volume-icon">üîä</span>\n                            <input type="range" id="masterVolume" min="0" max="100" value="70" class="volume-slider">\n                        </div>\n                        \n                        <div class="audio-controls">\n                            <h5 class="audio-title">üéµ Audio Experience</h5>\n                            <div class="audio-toggles">\n                                <button id="ambientToggle" class="audio-btn active" title="Toggle ambient nature sounds">\n                                    üåø Ambient\n                                </button>\n                                <button id="spatialToggle" class="audio-btn active" title="Toggle 3D spatial audio">\n                                    üéß Spatial\n                                </button>\n                                <button id="feedbackToggle" class="audio-btn active" title="Toggle interactive sounds">\n                                    üîà Feedback\n                                </button>\n                                <button id="harmonyBtn" class="audio-btn" title="Play chakra harmony sequence">\n                                    ‚òØÔ∏è Harmony\n                                </button>\n                            </div>\n                        </div>\n                        \n                        <style>\n                            .audio-controls {\n                                margin-top: 15px;\n                                padding: 10px;\n                                background: rgba(255, 255, 255, 0.1);\n                                border-radius: 8px;\n                                backdrop-filter: blur(5px);\n                            }\n                            \n                            .audio-title {\n                                margin: 0 0 10px 0;\n                                color: #6b46c1;\n                                font-size: 0.9em;\n                                text-align: center;\n                            }\n                            \n                            .audio-toggles {\n                                display: flex;\n                                gap: 8px;\n                                justify-content: center;\n                                flex-wrap: wrap;\n                            }\n                            \n                            .audio-btn {\n                                padding: 6px 12px;\n                                border: 2px solid #e1e5e9;\n                                border-radius: 20px;\n                                background: rgba(255, 255, 255, 0.9);\n                                font-size: 0.8em;\n                                cursor: pointer;\n                                transition: all 0.3s ease;\n                                white-space: nowrap;\n                            }\n                            \n                            .audio-btn:hover {\n                                transform: translateY(-2px);\n                                box-shadow: 0 4px 12px rgba(107, 70, 193, 0.3);\n                            }\n                            \n                            .audio-btn.active {\n                                border-color: #10b981;\n                                background: linear-gradient(135deg, #10b981, #059669);\n                                color: white;\n                                box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);\n                            }\n                            \n                            .audio-btn:not(.active) {\n                                color: #6b7280;\n                                border-color: #d1d5db;\n                            }\n                            \n                            #harmonyBtn {\n                                border-color: #8b5cf6;\n                                background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n                                color: white;\n                            }\n                            \n                            #harmonyBtn:hover {\n                                box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n                            }\n                        </style>\n                    </div>\n                </div>\n\n                \x3c!-- Singing Bowls Circle --\x3e\n                <div class="bowls-container">\n                    <h4 class="section-title">üïâÔ∏è Chakra Singing Bowls</h4>\n                    <div class="bowls-circle" id="bowlsCircle">\n                        \x3c!-- Bowls will be generated here --\x3e\n                    </div>\n                    \n                    <div class="bowl-info" id="bowlInfo">\n                        <div class="info-placeholder">\n                            <p>Click a singing bowl to learn about its healing properties</p>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Zen Garden --\x3e\n                <div class="garden-container">\n                    <h4 class="section-title">üåø Interactive Zen Garden</h4>\n                    \n                    <div class="garden-tools">\n                        ${this.gardenTools.map(e=>`\n                            <button class="tool-btn ${"rake"===e.id?"active":""}" \n                                    data-tool="${e.id}" \n                                    title="${e.description}">\n                                ${e.icon} ${e.name}\n                            </button>\n                        `).join("")}\n                    </div>\n                    \n                    <div class="garden-canvas-container">\n                        <canvas id="zenGardenCanvas" width="800" height="400"></canvas>\n                        <div class="garden-overlay" id="gardenOverlay">\n                            <div class="garden-instructions">\n                                <p>ü•ç Select the rake tool and draw patterns in the sand</p>\n                                <p>ü™® Place stones and elements to create your zen space</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Sound Visualization --\x3e\n                <div class="sound-visualization">\n                    <h4 class="section-title">üìä Sound Frequencies</h4>\n                    <canvas id="frequencyCanvas" width="800" height="120"></canvas>\n                    <div class="frequency-info">\n                        <span id="activeFrequencies">No active frequencies</span>\n                    </div>\n                </div>\n\n                \x3c!-- Controls Panel --\x3e\n                <div class="controls-panel">\n                    <div class="control-section">\n                        <button id="playHarmony" class="control-btn primary">üéµ Play Harmony</button>\n                        <button id="saveComposition" class="control-btn">üíæ Save</button>\n                        <button id="shareGarden" class="control-btn">üì§ Share</button>\n                        <button id="clearAll" class="control-btn">üîÑ Reset</button>\n                    </div>\n                    \n                    <div class="learning-section">\n                        <button id="openLearning" class="control-btn secondary">üìö Sound Healing Guide</button>\n                        <button id="viewAchievements" class="control-btn secondary">üèÜ Achievements</button>\n                    </div>\n                </div>\n\n                \x3c!-- Learning Modal --\x3e\n                <div class="learning-modal" id="learningModal" style="display: none;">\n                    <div class="modal-content">\n                        <button class="close-btn" id="closeLearning">&times;</button>\n                        <h3>üéì Sound Healing Knowledge</h3>\n                        <div class="learning-content" id="learningContent">\n                            \x3c!-- Content will be generated dynamically --\x3e\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Achievement Notification --\x3e\n                <div class="achievement-notification" id="achievementNotif" style="display: none;">\n                    <div class="achievement-content">\n                        <span class="achievement-icon">üèÜ</span>\n                        <div class="achievement-text">\n                            <h4 id="achievementTitle">Achievement Unlocked!</h4>\n                            <p id="achievementDescription">Description here</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.generateBowls(),this.initializeGarden()}generateBowls(){const e=document.getElementById("bowlsCircle");this.chakraBowls.forEach(t=>{const n=document.createElement("div");n.className="singing-bowl",n.dataset.bowlId=t.id,n.style.cssText=`\n                left: ${t.position.x-t.size/2}px;\n                top: ${t.position.y-t.size/2}px;\n                width: ${t.size}px;\n                height: ${t.size}px;\n                border: 3px solid ${t.color};\n                background: linear-gradient(135deg, ${t.color}22, ${t.color}44);\n            `,n.innerHTML=`\n                <div class="bowl-symbol">${t.symbol}</div>\n                <div class="bowl-name">${t.name}</div>\n                <div class="bowl-frequency">${t.frequency}Hz</div>\n                <div class="bowl-ripple"></div>\n            `,e.appendChild(n)})}setupCanvas(){this.garden=document.getElementById("zenGardenCanvas"),this.gardenCtx=this.garden.getContext("2d"),this.frequencyCanvas=document.getElementById("frequencyCanvas"),this.frequencyCtx=this.frequencyCanvas.getContext("2d"),this.clearGarden(),this.initFrequencyVisualization()}initializeGarden(){this.createSandTexture(),setTimeout(()=>{const e=document.getElementById("gardenOverlay");e&&(e.style.display="none")},3e3)}createSandTexture(){const e=this.gardenCtx,t=this.garden;e.fillStyle="#f4f1e8",e.fillRect(0,0,t.width,t.height);for(let n=0;n<1e3;n++)e.fillStyle=`rgba(139, 92, 46, ${.1*Math.random()})`,e.fillRect(Math.random()*t.width,Math.random()*t.height,1,1);const n=e.createLinearGradient(0,0,t.width,t.height);n.addColorStop(0,"rgba(244, 241, 232, 0.8)"),n.addColorStop(1,"rgba(222, 217, 202, 0.3)"),e.fillStyle=n,e.fillRect(0,0,t.width,t.height)}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.setValueAtTime(this.masterVolume,this.audioContext.currentTime),this.createSpatialAudio(),this.gardenSounds=this.playInteractiveFeedbackSounds(),setTimeout(()=>this.createAmbientSoundscape(),1e3),console.log("üîä Enhanced audio system initialized")}catch(e){console.warn("Audio not available:",e),this.soundEnabled=!1}}playBowl(e,t=!1){if(!this.soundEnabled||!this.audioContext)return;const n=this.chakraBowls.find(t=>t.id===e);if(!n)return;this.sustainedNotes.has(e)&&this.stopBowl(e);const i=this.createAdvancedBowlSound(e,t);if(this.spatialContext&&this.spatialContext.bowlPositions.has(e)){const t=this.spatialContext.bowlPositions.get(e);i.gains.forEach(e=>{e.positionX&&(e.positionX.setValueAtTime(t.x,this.audioContext.currentTime),e.positionY.setValueAtTime(t.y,this.audioContext.currentTime),e.positionZ.setValueAtTime(t.z,this.audioContext.currentTime))})}this.animateBowl(e),this.addToActiveFrequencies(n.frequency),this.userProgress.bowlsMastered.add(e),this.awardExperience(5),this.checkAchievements(),console.log(`ü•£ Playing ${n.name} at ${n.frequency}Hz`)}stopBowl(e){if(this.sustainedNotes.has(e)){const t=this.sustainedNotes.get(e);t.oscillators&&t.gains?(t.gains.forEach(e=>{e.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+1)}),setTimeout(()=>{t.oscillators.forEach(e=>{e.stop&&e.stop()})},1e3)):(t.gainNode.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+1),t.detuneGain.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+1),t.oscillator.stop(this.audioContext.currentTime+1),t.detuneOsc.stop(this.audioContext.currentTime+1)),this.sustainedNotes.delete(e)}}createAdvancedBowlSound(e,t=!1){if(!this.soundEnabled||!this.audioContext)return;const n=this.chakraBowls.find(t=>t.id===e);if(!n)return;const i=this.audioContext.createOscillator(),a=this.audioContext.createOscillator(),o=this.audioContext.createOscillator(),s=this.audioContext.createOscillator(),r=this.audioContext.createGain(),l=this.audioContext.createGain(),d=this.audioContext.createGain(),c=this.audioContext.createGain(),u=this.audioContext.createBiquadFilter(),h=this.createReverb();if(i.connect(r),a.connect(l),o.connect(d),s.connect(c),r.connect(u),l.connect(u),d.connect(u),c.connect(u),u.connect(h),h.connect(this.masterGain),i.frequency.setValueAtTime(n.frequency,this.audioContext.currentTime),a.frequency.setValueAtTime(1.59*n.frequency,this.audioContext.currentTime),o.frequency.setValueAtTime(2.02*n.frequency,this.audioContext.currentTime),s.frequency.setValueAtTime(3.01*n.frequency,this.audioContext.currentTime),i.type="sine",a.type="sine",o.type="triangle",s.type="sine",u.type="bandpass",u.frequency.setValueAtTime(1.5*n.frequency,this.audioContext.currentTime),u.Q.setValueAtTime(8,this.audioContext.currentTime),t)r.gain.setValueAtTime(0,this.audioContext.currentTime),r.gain.linearRampToValueAtTime(.4,this.audioContext.currentTime+.8),l.gain.setValueAtTime(0,this.audioContext.currentTime),l.gain.linearRampToValueAtTime(.15,this.audioContext.currentTime+1.2),d.gain.setValueAtTime(0,this.audioContext.currentTime),d.gain.linearRampToValueAtTime(.08,this.audioContext.currentTime+1.5),c.gain.setValueAtTime(0,this.audioContext.currentTime),c.gain.linearRampToValueAtTime(.05,this.audioContext.currentTime+2),this.sustainedNotes.set(e,{oscillators:[i,a,o,s],gains:[r,l,d,c]}),i.start(),a.start(),o.start(),s.start();else{const e=this.audioContext.currentTime,t=6;r.gain.setValueAtTime(0,e),r.gain.linearRampToValueAtTime(.6,e+.05),r.gain.exponentialRampToValueAtTime(.001,e+t),l.gain.setValueAtTime(0,e),l.gain.linearRampToValueAtTime(.2,e+.1),l.gain.exponentialRampToValueAtTime(.001,e+.8*t),d.gain.setValueAtTime(0,e),d.gain.linearRampToValueAtTime(.1,e+.2),d.gain.exponentialRampToValueAtTime(.001,e+.6*t),c.gain.setValueAtTime(0,e),c.gain.linearRampToValueAtTime(.05,e+.3),c.gain.exponentialRampToValueAtTime(.001,e+.4*t),i.start(),a.start(),o.start(),s.start(),i.stop(e+t),a.stop(e+t),o.stop(e+t),s.stop(e+t)}return{oscillators:[i,a,o,s],gains:[r,l,d,c]}}createReverb(){const e=this.audioContext.createConvolver(),t=2*this.audioContext.sampleRate,n=this.audioContext.createBuffer(2,t,this.audioContext.sampleRate);for(let e=0;e<2;e++){const i=n.getChannelData(e);for(let e=0;e<t;e++)i[e]=(2*Math.random()-1)*Math.pow(1-e/t,2)}return e.buffer=n,e}createAmbientSoundscape(){this.soundEnabled&&this.audioContext&&(this.ambientSounds={wind:this.createWindSound(),water:this.createWaterSound(),birds:this.createBirdSounds(),temple:this.createTempleBells()},Object.values(this.ambientSounds).forEach(e=>{e&&e.start&&e.start()}),console.log("üåø Ambient soundscape activated"))}createWindSound(){const e=this.audioContext.createBufferSource(),t=this.audioContext.createBiquadFilter(),n=this.audioContext.createGain(),i=10*this.audioContext.sampleRate,a=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),o=a.getChannelData(0);for(let e=0;e<i;e++)o[e]=.1*(2*Math.random()-1);return e.buffer=a,e.loop=!0,t.type="lowpass",t.frequency.setValueAtTime(200,this.audioContext.currentTime),t.Q.setValueAtTime(.5,this.audioContext.currentTime),n.gain.setValueAtTime(.05,this.audioContext.currentTime),e.connect(t),t.connect(n),n.connect(this.masterGain),e}createWaterSound(){const e=this.audioContext.createBufferSource(),t=this.audioContext.createBiquadFilter(),n=this.audioContext.createBiquadFilter(),i=this.audioContext.createGain(),a=8*this.audioContext.sampleRate,o=this.audioContext.createBuffer(1,a,this.audioContext.sampleRate),s=o.getChannelData(0);for(let e=0;e<a;e++)s[e]=.3*(2*Math.random()-1);return e.buffer=o,e.loop=!0,t.type="highpass",t.frequency.setValueAtTime(800,this.audioContext.currentTime),n.type="lowpass",n.frequency.setValueAtTime(4e3,this.audioContext.currentTime),i.gain.setValueAtTime(.03,this.audioContext.currentTime),e.connect(t),t.connect(n),n.connect(i),i.connect(this.masterGain),e}createBirdSounds(){const e=setInterval(()=>{this.soundEnabled&&Math.random()>.7&&this.createSingleBirdChirp()},5e3+1e4*Math.random());return{stop:()=>clearInterval(e)}}createSingleBirdChirp(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(t),t.connect(this.masterGain);const i=800+1200*Math.random();e.frequency.setValueAtTime(i,this.audioContext.currentTime),e.frequency.linearRampToValueAtTime(1.5*i,this.audioContext.currentTime+.1),e.frequency.linearRampToValueAtTime(.8*i,this.audioContext.currentTime+.3),e.type="square",n.type="bandpass",n.frequency.setValueAtTime(i,this.audioContext.currentTime),n.Q.setValueAtTime(10,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.02,this.audioContext.currentTime+.05),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.4),e.start(),e.stop(this.audioContext.currentTime+.4)}createTempleBells(){const e=setInterval(()=>{this.soundEnabled&&Math.random()>.9&&this.createDistantBell()},3e4+6e4*Math.random());return{stop:()=>clearInterval(e)}}createDistantBell(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter(),i=this.createReverb();e.connect(n),n.connect(i),i.connect(t),t.connect(this.masterGain),e.frequency.setValueAtTime(400+200*Math.random(),this.audioContext.currentTime),e.type="sine",n.type="lowpass",n.frequency.setValueAtTime(800,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+8),e.start(),e.stop(this.audioContext.currentTime+8)}createSpatialAudio(){this.spatialContext={listener:this.audioContext.listener,bowlPositions:new Map},this.spatialContext.listener.positionX&&(this.spatialContext.listener.positionX.setValueAtTime(0,this.audioContext.currentTime),this.spatialContext.listener.positionY.setValueAtTime(0,this.audioContext.currentTime),this.spatialContext.listener.positionZ.setValueAtTime(0,this.audioContext.currentTime)),this.chakraBowls.forEach(e=>{const t=this.chakraBowls.indexOf(e)/this.chakraBowls.length*Math.PI*2;this.spatialContext.bowlPositions.set(e.id,{x:2*Math.cos(t),y:0,z:2*Math.sin(t)})})}playInteractiveFeedbackSounds(){return{rake:()=>this.createRakeSound(),stone:()=>this.createStoneSound(),bamboo:()=>this.createBambooSound(),lotus:()=>this.createLotusSound(),water:()=>this.createWaterDropSound()}}createRakeSound(){const e=this.audioContext.createBufferSource(),t=this.audioContext.createBiquadFilter(),n=this.audioContext.createGain(),i=.2*this.audioContext.sampleRate,a=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),o=a.getChannelData(0);for(let e=0;e<i;e++)o[e]=.5*(2*Math.random()-1);e.buffer=a,t.type="bandpass",t.frequency.setValueAtTime(1200,this.audioContext.currentTime),t.Q.setValueAtTime(2,this.audioContext.currentTime),n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(.1,this.audioContext.currentTime+.02),n.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.2),e.connect(t),t.connect(n),n.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.2)}createStoneSound(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.frequency.setValueAtTime(200,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(100,this.audioContext.currentTime+.3),e.type="square",n.type="lowpass",n.frequency.setValueAtTime(400,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.15,this.audioContext.currentTime+.05),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.3),e.connect(n),n.connect(t),t.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.3)}createBambooSound(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.frequency.setValueAtTime(800,this.audioContext.currentTime),e.type="sawtooth",n.type="highpass",n.frequency.setValueAtTime(600,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.05,this.audioContext.currentTime+.1),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.5),e.connect(n),n.connect(t),t.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.5)}createLotusSound(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.frequency.setValueAtTime(1e3,this.audioContext.currentTime),e.type="sine",t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.08,this.audioContext.currentTime+.1),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+2),e.connect(t),t.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+2)}createWaterDropSound(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.frequency.setValueAtTime(1200,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(400,this.audioContext.currentTime+.1),e.type="sine",n.type="lowpass",n.frequency.setValueAtTime(2e3,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.1,this.audioContext.currentTime+.01),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.3),e.connect(n),n.connect(t),t.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.3)}stopAmbientSounds(){this.ambientSounds&&(Object.values(this.ambientSounds).forEach(e=>{e&&e.stop&&e.stop()}),this.ambientSounds=null)}animateBowl(e){const t=document.querySelector(`[data-bowl-id="${e}"]`);if(!t)return;const n=t.querySelector(".bowl-ripple");n.style.animation="none",n.offsetHeight,n.style.animation="bowlRipple 2s ease-out",t.classList.add("striking"),setTimeout(()=>{t.classList.remove("striking")},500)}addToActiveFrequencies(e){this.activeBowls.add(e),this.updateFrequencyDisplay(),setTimeout(()=>{this.activeBowls.delete(e),this.updateFrequencyDisplay()},4e3)}updateFrequencyDisplay(){const e=document.getElementById("activeFrequencies");if(0===this.activeBowls.size)e.textContent="No active frequencies";else{const t=Array.from(this.activeBowls).sort((e,t)=>e-t);e.textContent=`Active: ${t.map(e=>e.toFixed(1)+"Hz").join(", ")}`}}initFrequencyVisualization(){this.drawFrequencyBackground()}drawFrequencyBackground(){const e=this.frequencyCtx,t=this.frequencyCanvas;e.clearRect(0,0,t.width,t.height),e.strokeStyle="#e0e0e0",e.lineWidth=1;for(let n=0;n<=10;n++){const i=n/10*t.width;e.beginPath(),e.moveTo(i,0),e.lineTo(i,t.height),e.stroke()}for(let n=0;n<=4;n++){const i=n/4*t.height;e.beginPath(),e.moveTo(0,i),e.lineTo(t.width,i),e.stroke()}this.chakraBowls.forEach(n=>{const i=(n.frequency-200)/300*t.width;e.fillStyle=n.color,e.fillRect(i-2,t.height-20,4,20),e.fillStyle="#333",e.font="10px Arial",e.textAlign="center",e.fillText(n.frequency+"Hz",i,t.height-25)})}bindEvents(){document.querySelectorAll(".singing-bowl").forEach(e=>{e.addEventListener("mousedown",e=>this.handleBowlInteraction(e,"strike")),e.addEventListener("mouseup",e=>this.handleBowlInteraction(e,"release")),e.addEventListener("mouseover",e=>this.showBowlInfo(e.target.dataset.bowlId))}),document.querySelectorAll(".tool-btn").forEach(e=>{e.addEventListener("click",e=>this.selectTool(e.target.dataset.tool))}),this.garden.addEventListener("mousedown",this.startGardenInteraction.bind(this)),this.garden.addEventListener("mousemove",this.continueGardenInteraction.bind(this)),this.garden.addEventListener("mouseup",this.endGardenInteraction.bind(this)),document.getElementById("playHarmony").addEventListener("click",this.playChakraHarmony.bind(this)),document.getElementById("saveComposition").addEventListener("click",this.saveComposition.bind(this)),document.getElementById("shareGarden").addEventListener("click",this.shareGarden.bind(this)),document.getElementById("clearAll").addEventListener("click",this.clearAll.bind(this)),document.getElementById("timerToggle").addEventListener("click",this.toggleTimer.bind(this)),document.getElementById("masterVolume").addEventListener("input",this.updateVolume.bind(this)),document.getElementById("ambientToggle").addEventListener("click",this.toggleAmbient.bind(this)),document.getElementById("spatialToggle").addEventListener("click",this.toggleSpatial.bind(this)),document.getElementById("feedbackToggle").addEventListener("click",this.toggleFeedback.bind(this)),document.getElementById("harmonyBtn").addEventListener("click",this.playChakraHarmony.bind(this)),document.getElementById("openLearning").addEventListener("click",this.openLearning.bind(this)),document.getElementById("closeLearning").addEventListener("click",this.closeLearning.bind(this)),document.getElementById("viewAchievements").addEventListener("click",this.viewAchievements.bind(this))}handleBowlInteraction(e,t){const n=e.target.closest(".singing-bowl").dataset.bowlId;"strike"===t?(e.shiftKey?this.playBowl(n,!0):this.playBowl(n,!1),this.startTimer()):"release"===t&&this.stopBowl(n)}showBowlInfo(e){const t=this.chakraBowls.find(t=>t.id===e);if(!t)return;document.getElementById("bowlInfo").innerHTML=`\n            <div class="bowl-details">\n                <h4>${t.symbol} ${t.name}</h4>\n                <p class="bowl-meaning">${t.meaning}</p>\n                <p class="bowl-frequency">Frequency: ${t.frequency}Hz</p>\n                <p class="bowl-affirmation">"${t.affirmation}"</p>\n                <div class="interaction-tip">\n                    Click to strike ‚Ä¢ Hold Shift + Click to sustain\n                </div>\n            </div>\n        `}selectTool(e){this.currentTool=e,document.querySelectorAll(".tool-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-tool="${e}"]`).classList.add("active"),this.garden.style.cursor=this.getToolCursor(e)}getToolCursor(e){switch(e){case"rake":return"crosshair";case"stone":return"copy";case"bamboo":return"cell";case"lotus":return"pointer";case"water":return"help";case"clear":return"not-allowed";default:return"default"}}startGardenInteraction(e){this.isDrawing=!0;const t=this.garden.getBoundingClientRect();this.lastMousePos={x:e.clientX-t.left,y:e.clientY-t.top},this.performGardenAction(this.lastMousePos.x,this.lastMousePos.y),this.startTimer()}continueGardenInteraction(e){if(!this.isDrawing||"rake"!==this.currentTool)return;const t=this.garden.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top};this.drawRakeLine(this.lastMousePos.x,this.lastMousePos.y,n.x,n.y),this.lastMousePos=n}endGardenInteraction(e){this.isDrawing=!1}performGardenAction(e,t){switch(this.currentTool){case"rake":this.drawRakePoint(e,t);break;case"stone":this.placeStone(e,t);break;case"bamboo":this.plantBamboo(e,t);break;case"lotus":this.placeLotus(e,t);break;case"water":this.addWater(e,t);break;case"clear":this.clearGarden()}}drawRakePoint(e,t){const n=this.gardenCtx;n.strokeStyle="#d4b896",n.lineWidth=3,n.lineCap="round",n.beginPath(),this.feedbackSoundsEnabled&&this.gardenSounds&&this.gardenSounds.rake&&Math.random()>.3&&this.gardenSounds.rake(),n.arc(e,t,2,0,2*Math.PI),n.stroke()}drawRakeLine(e,t,n,i){const a=this.gardenCtx;a.strokeStyle="#d4b896",a.lineWidth=3,a.lineCap="round",a.beginPath(),a.moveTo(e,t),a.lineTo(n,i),a.stroke()}placeStone(e,t){const n=this.gardenCtx,i=15+10*Math.random();this.feedbackSoundsEnabled&&this.gardenSounds&&this.gardenSounds.stone&&this.gardenSounds.stone(),n.fillStyle="rgba(0, 0, 0, 0.2)",n.beginPath(),n.ellipse(e+2,t+2,i,.8*i,0,0,2*Math.PI),n.fill(),n.fillStyle="#8a8a8a",n.beginPath(),n.ellipse(e,t,i,.8*i,0,0,2*Math.PI),n.fill(),n.fillStyle="#b0b0b0",n.beginPath(),n.ellipse(e-3,t-3,.3*i,.2*i,0,0,2*Math.PI),n.fill(),this.gardenElements.push({type:"stone",x:e,y:t,size:i})}plantBamboo(e,t){const n=this.gardenCtx,i=80+40*Math.random();this.feedbackSoundsEnabled&&this.gardenSounds&&this.gardenSounds.bamboo&&this.gardenSounds.bamboo(),n.strokeStyle="#7ba05b",n.lineWidth=6,n.lineCap="round",n.beginPath(),n.moveTo(e,t),n.lineTo(e,t-i),n.stroke();for(let a=20;a<i;a+=25)n.strokeStyle="#6d8f4f",n.lineWidth=1,n.beginPath(),n.moveTo(e-3,t-a),n.lineTo(e+3,t-a),n.stroke();for(let a=0;a<3;a++){const o=t-i+15*a,s=e+10*(Math.random()-.5);n.fillStyle="#7ba05b",n.beginPath(),n.ellipse(s,o,8,3,.5*Math.random(),0,2*Math.PI),n.fill()}this.gardenElements.push({type:"bamboo",x:e,y:t,height:i})}placeLotus(e,t){const n=this.gardenCtx;this.feedbackSoundsEnabled&&this.gardenSounds&&this.gardenSounds.lotus&&this.gardenSounds.lotus();for(let i=0;i<8;i++){const a=i/8*Math.PI*2,o=e+8*Math.cos(a),s=t+8*Math.sin(a);n.fillStyle="#ffb6c1",n.beginPath(),n.ellipse(o,s,12,6,a,0,2*Math.PI),n.fill()}n.fillStyle="#ffd700",n.beginPath(),n.arc(e,t,6,0,2*Math.PI),n.fill(),this.gardenElements.push({type:"lotus",x:e,y:t})}addWater(e,t){const n=this.gardenCtx,i=25+15*Math.random();this.feedbackSoundsEnabled&&this.gardenSounds&&this.gardenSounds.water&&this.gardenSounds.water(),n.fillStyle="rgba(168, 213, 229, 0.6)",n.beginPath(),n.ellipse(e,t,i,.7*i,0,0,2*Math.PI),n.fill();for(let a=0;a<3;a++)n.strokeStyle=`rgba(168, 213, 229, ${.3-.1*a})`,n.lineWidth=1,n.beginPath(),n.ellipse(e,t,i+5*a,.7*(i+5*a),0,0,2*Math.PI),n.stroke();this.gardenElements.push({type:"water",x:e,y:t,size:i})}clearGarden(){this.gardenElements=[],this.createSandTexture()}startTimer(){this.isTimerRunning||(this.isTimerRunning=!0,document.getElementById("timerToggle").textContent="‚è∏Ô∏è",this.timerInterval=setInterval(()=>{this.meditationTimer++,this.updateTimerDisplay()},1e3))}toggleTimer(){this.isTimerRunning?this.pauseTimer():this.startTimer()}pauseTimer(){this.isTimerRunning=!1,document.getElementById("timerToggle").textContent="‚ñ∂Ô∏è",this.timerInterval&&clearInterval(this.timerInterval),this.userProgress.meditationMinutes+=Math.floor(this.meditationTimer/60),this.saveProgress()}updateTimerDisplay(){const e=Math.floor(this.meditationTimer/60),t=this.meditationTimer%60,n=`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;document.getElementById("meditationTime").textContent=n}playChakraHarmony(){let e=0;this.chakraBowls.forEach(t=>{setTimeout(()=>{this.playBowl(t.id,!1)},e),e+=500}),setTimeout(()=>{this.chakraBowls.forEach(e=>{this.playBowl(e.id,!0)}),setTimeout(()=>{this.chakraBowls.forEach(e=>{this.stopBowl(e.id)})},1e4)},e+1e3)}saveComposition(){const e={garden:this.gardenElements,timestamp:Date.now(),meditationTime:this.meditationTimer};localStorage.setItem("harmonyGardenComposition",JSON.stringify(e)),this.userProgress.gardensCreated++,this.awardExperience(10),this.checkAchievements(),this.showNotification("üéµ Composition saved!")}shareGarden(){this.garden.toBlob(e=>{const t=[new File([e],"zen-garden.png",{type:"image/png"})];if(navigator.canShare&&navigator.canShare({files:t}))navigator.share({files:t,title:"My Zen Garden",text:"Created during my sound healing meditation session!"});else{const t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="zen-garden.png",t.click()}})}clearAll(){this.clearGarden(),this.chakraBowls.forEach(e=>this.stopBowl(e.id)),this.activeBowls.clear(),this.updateFrequencyDisplay(),this.pauseTimer(),this.meditationTimer=0,this.updateTimerDisplay()}updateVolume(e){this.masterVolume=e.target.value/100,this.masterGain&&this.masterGain.gain.setValueAtTime(this.masterVolume,this.audioContext.currentTime)}toggleAmbient(){const e=document.getElementById("ambientToggle");e.classList.contains("active")?(this.stopAmbientSounds(),e.classList.remove("active"),e.innerHTML="üåø <s>Ambient</s>",console.log("üîá Ambient sounds disabled")):(this.createAmbientSoundscape(),e.classList.add("active"),e.innerHTML="üåø Ambient",console.log("üåø Ambient sounds enabled"))}toggleSpatial(){const e=document.getElementById("spatialToggle");e.classList.contains("active")?(this.spatialAudioEnabled=!1,e.classList.remove("active"),e.innerHTML="üéß <s>Spatial</s>",console.log("üîá Spatial audio disabled")):(this.spatialAudioEnabled=!0,this.createSpatialAudio(),e.classList.add("active"),e.innerHTML="üéß Spatial",console.log("üéß Spatial audio enabled"))}toggleFeedback(){const e=document.getElementById("feedbackToggle");e.classList.contains("active")?(this.feedbackSoundsEnabled=!1,e.classList.remove("active"),e.innerHTML="üîà <s>Feedback</s>",console.log("üîá Feedback sounds disabled")):(this.feedbackSoundsEnabled=!0,e.classList.add("active"),e.innerHTML="üîà Feedback",console.log("üîà Feedback sounds enabled"))}openLearning(){document.getElementById("learningModal").style.display="flex",this.generateLearningContent()}closeLearning(){document.getElementById("learningModal").style.display="none"}generateLearningContent(){const e=document.getElementById("learningContent"),t=this.getDailyPractice();e.innerHTML=`\n            <div class="learning-sections">\n                <div class="learning-section">\n                    <h4>üåÖ Today's Practice</h4>\n                    <button class="practice-quick-btn" onclick="singingBowlHarmonyGarden.showDailyPractice()">\n                        ${t.title} (${t.duration})\n                    </button>\n                </div>\n                \n                <div class="learning-section">\n                    <h4>ü•£ About Singing Bowls</h4>\n                    <p>Tibetan singing bowls have been used for centuries in meditation and healing practices. Each bowl produces specific frequencies that resonate with different chakras and energy centers in the body.</p>\n                </div>\n                \n                <div class="learning-section">\n                    <h4>üïâÔ∏è Chakra Healing Sessions</h4>\n                    ${this.chakraBowls.map(e=>`\n                        <div class="chakra-healing">\n                            <button class="chakra-heal-btn" onclick="singingBowlHarmonyGarden.startChakraHealing('${e.id}')" style="border-color: ${e.color}">\n                                ${e.symbol} Heal ${e.name}\n                            </button>\n                        </div>\n                    `).join("")}\n                </div>\n                \n                <div class="learning-section">\n                    <h4>üéØ Spiritual Tools</h4>\n                    <button class="spiritual-btn" onclick="singingBowlHarmonyGarden.setIntention()">üí≠ Set Daily Intention</button>\n                    <button class="spiritual-btn" onclick="singingBowlHarmonyGarden.viewAchievements()">üèÜ View Achievements</button>\n                </div>\n                \n                <div class="learning-section">\n                    <h4>üßò Meditation Techniques</h4>\n                    <p>‚Ä¢ Focus on one bowl's sound to develop concentration</p>\n                    <p>‚Ä¢ Play multiple bowls to create healing harmonies</p>\n                    <p>‚Ä¢ Use the zen garden as a visual meditation focus</p>\n                    <p>‚Ä¢ Combine sounds with breath awareness</p>\n                </div>\n            </div>\n        `}checkAchievements(){const e=[];this.userProgress.bowlsMastered.size>=7&&!this.userProgress.achievements.has("bowl_master")&&e.push({id:"bowl_master",title:"Bowl Master",description:"Mastered all 7 chakra singing bowls",icon:"üèÜ"});const t=Math.floor(this.meditationTimer/60)+this.userProgress.meditationMinutes;t>=30&&!this.userProgress.achievements.has("meditation_novice")&&e.push({id:"meditation_novice",title:"Meditation Novice",description:"Meditated for 30 minutes total",icon:"üßò‚Äç‚ôÄÔ∏è"}),t>=120&&!this.userProgress.achievements.has("meditation_adept")&&e.push({id:"meditation_adept",title:"Meditation Adept",description:"Meditated for 2 hours total",icon:"üïâÔ∏è"}),t>=300&&!this.userProgress.achievements.has("zen_master")&&e.push({id:"zen_master",title:"Zen Master",description:"Meditated for 5 hours total",icon:"üëë"}),this.userProgress.gardensCreated>=5&&!this.userProgress.achievements.has("garden_creator")&&e.push({id:"garden_creator",title:"Garden Creator",description:"Created 5 unique zen gardens",icon:"üåø"}),this.userProgress.gardensCreated>=20&&!this.userProgress.achievements.has("landscape_artist")&&e.push({id:"landscape_artist",title:"Landscape Artist",description:"Created 20 beautiful gardens",icon:"üé®"}),this.activeBowls.size>=3&&!this.userProgress.achievements.has("harmony_seeker")&&e.push({id:"harmony_seeker",title:"Harmony Seeker",description:"Played 3 bowls simultaneously",icon:"üéµ"}),this.activeBowls.size>=7&&!this.userProgress.achievements.has("chakra_harmonist")&&e.push({id:"chakra_harmonist",title:"Chakra Harmonist",description:"Achieved full 7-chakra harmony",icon:"üåà"}),e.forEach(e=>{this.userProgress.achievements.add(e.id),this.showAchievement(e),this.awardExperience(50)}),this.saveProgress()}showAchievement(e){const t=document.getElementById("achievementNotif"),n=document.getElementById("achievementTitle"),i=document.getElementById("achievementDescription");n.textContent=`${e.icon} ${e.title}`,i.textContent=e.description,t.style.display="flex",t.classList.add("achievement-show"),this.playAchievementSound(),setTimeout(()=>{t.style.display="none",t.classList.remove("achievement-show")},4e3),console.log(`üèÜ Achievement unlocked: ${e.title}`)}playAchievementSound(){if(!this.soundEnabled||!this.audioContext)return;[261.63,329.63,392,523.25].forEach((e,t)=>{setTimeout(()=>{const t=this.audioContext.createOscillator(),n=this.audioContext.createGain();t.connect(n),n.connect(this.masterGain),t.frequency.setValueAtTime(e,this.audioContext.currentTime),t.type="triangle",n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.1),n.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.8),t.start(),t.stop(this.audioContext.currentTime+.8)},150*t)})}awardExperience(e){this.userProgress.experience+=e;const t=Math.floor(this.userProgress.experience/100)+1;t>this.userProgress.level&&(this.userProgress.level=t,this.showLevelUp(t)),this.updateProgressDisplay()}showLevelUp(e){if(this.showNotification(`üåü Level Up! You reached Level ${e}`),this.soundEnabled&&this.audioContext){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.masterGain),e.frequency.setValueAtTime(523.25,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(1046.5,this.audioContext.currentTime+.5),e.type="sawtooth",t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.4,this.audioContext.currentTime+.1),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.5),e.start(),e.stop(this.audioContext.currentTime+.5)}}updateProgressDisplay(){const e=document.querySelector(".progress-widget");if(e){const t=this.userProgress.experience%100;e.innerHTML=`\n                <div class="level-display">Level ${this.userProgress.level}</div>\n                <div class="xp-bar">\n                    <div class="xp-fill" style="width: ${t}%"></div>\n                </div>\n                <div class="xp-text">${this.userProgress.experience} XP</div>\n            `}}getDailyPractice(){const e=[{title:"Morning Chakra Alignment",description:"Start your day by playing each chakra bowl in sequence, focusing on the energy centers in your body.",bowls:["root","sacral","solar","heart","throat","third_eye","crown"],duration:"10 minutes"},{title:"Stress Release Garden",description:"Create flowing sand patterns while focusing on releasing tension and worry.",focus:"rake",affirmation:"I release what no longer serves me",duration:"15 minutes"},{title:"Heart Opening Meditation",description:"Focus on the heart chakra bowl while placing lotus flowers in your garden.",bowls:["heart"],focus:"lotus",affirmation:"Love flows freely through me",duration:"12 minutes"},{title:"Grounding Earth Connection",description:"Place stones mindfully while listening to root chakra tones.",bowls:["root"],focus:"stone",affirmation:"I am stable and secure",duration:"8 minutes"},{title:"Creative Expression Flow",description:"Let creativity guide your garden design with sacral chakra energy.",bowls:["sacral"],focus:"bamboo",affirmation:"My creativity flows without limits",duration:"20 minutes"}];return e[(new Date).getDay()%e.length]}showDailyPractice(){const e=this.getDailyPractice(),t=document.getElementById("learningModal");document.getElementById("learningContent").innerHTML=`\n            <div class="daily-practice">\n                <h3>üåÖ Today's Spiritual Practice</h3>\n                <div class="practice-card">\n                    <h4>${e.title}</h4>\n                    <p class="practice-description">${e.description}</p>\n                    \n                    ${e.bowls?`\n                        <div class="practice-bowls">\n                            <strong>Recommended Bowls:</strong>\n                            ${e.bowls.map(e=>{const t=this.chakraBowls.find(t=>t.id===e);return`<span class="bowl-tag" style="color: ${t.color}">${t.symbol} ${t.name}</span>`}).join(" ")}\n                        </div>\n                    `:""}\n                    \n                    ${e.affirmation?`\n                        <div class="practice-affirmation">\n                            <strong>Affirmation:</strong> "${e.affirmation}"\n                        </div>\n                    `:""}\n                    \n                    <div class="practice-duration">\n                        <strong>Duration:</strong> ${e.duration}\n                    </div>\n                    \n                    <button class="start-practice-btn" onclick="singingBowlHarmonyGarden.startGuidedPractice('${e.title}')">\n                        üßò‚Äç‚ôÄÔ∏è Begin Practice\n                    </button>\n                </div>\n                \n                <div class="mindfulness-tips">\n                    <h4>üí° Mindfulness Tips</h4>\n                    <ul>\n                        <li>Breathe deeply and naturally throughout your practice</li>\n                        <li>Notice physical sensations as you interact with the bowls</li>\n                        <li>Let thoughts come and go without judgment</li>\n                        <li>Focus on the present moment and your sensory experience</li>\n                        <li>End with gratitude for this time of self-care</li>\n                    </ul>\n                </div>\n            </div>\n        `,t.style.display="flex"}startGuidedPractice(e){this.closeLearning(),this.showNotification(`üßò‚Äç‚ôÄÔ∏è Starting: ${e}`),this.startTimer();const t=this.getDailyPractice();t.title===e&&this.runGuidedSession(t)}runGuidedSession(e){let t=0;const n=this.createPracticeSteps(e),i=()=>{t<n.length?(this.showNotification(n[t]),t++,setTimeout(i,15e3)):(this.showNotification("üåü Practice complete! Well done."),this.awardExperience(25),this.checkAchievements())};i()}createPracticeSteps(e){const t=["üßò‚Äç‚ôÄÔ∏è Find a comfortable position and take 3 deep breaths","üéØ Set your intention for this practice session"];if(e.affirmation&&t.push(`üí≠ Repeat your affirmation: "${e.affirmation}"`),e.bowls&&e.bowls.forEach(e=>{const n=this.chakraBowls.find(t=>t.id===e);t.push(`${n.symbol} Focus on your ${n.name.toLowerCase()} - click the bowl`)}),e.focus){const n=this.gardenTools.find(t=>t.id===e.focus);t.push(`${n.icon} Use the ${n.name} in your garden mindfully`)}return t.push("üôè Take a moment to appreciate your practice"),t}startChakraHealing(e){const t=this.chakraBowls.find(t=>t.id===e);if(!t)return;this.showNotification(`üïâÔ∏è Starting ${t.name} healing session`),this.playBowl(e,!0);const n=[`üí´ Focus on your ${t.name.toLowerCase()}`,`üåü Visualize ${t.color} light at this energy center`,`üí≠ Repeat: "${t.affirmation}"`,"üåä Breathe into this area of your body","‚ú® Feel the energy flowing freely"];let i=0;const a=setInterval(()=>{i<n.length?(this.showNotification(n[i]),i++):(clearInterval(a),this.stopBowl(e),this.showNotification("üåü Chakra healing complete!"),this.userProgress.bowlsMastered.add(e),this.awardExperience(15),this.checkAchievements())},1e4)}setIntention(){const e=["I am open to receiving abundance in all forms","I trust in the wisdom of my heart and intuition","I release fear and embrace love in all my actions","I am grateful for this moment and all its possibilities","I radiate peace and attract harmonious relationships","I am worthy of love, success, and happiness","I trust the process of life and my spiritual journey"][(new Date).getDay()];this.showNotification(`üí≠ Today's Intention: ${e}`),setTimeout(()=>{this.showNotification("üïØÔ∏è Place your hands over your heart and repeat your intention")},3e3),setTimeout(()=>{this.showNotification("üåü Your intention is set. Let it guide your practice.")},8e3)}showNotification(e){const t=document.createElement("div");t.className="notification",t.textContent=e,t.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: linear-gradient(135deg, #20b2aa, #4169e1);\n            color: white;\n            padding: 1rem 2rem;\n            border-radius: 10px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n            z-index: 1000;\n            animation: slideIn 0.3s ease;\n        ",document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}viewAchievements(){const e=document.getElementById("learningModal");document.getElementById("learningContent").innerHTML=`\n            <div class="achievements-display">\n                <h3>üèÜ Your Spiritual Journey</h3>\n                \n                <div class="progress-overview">\n                    <div class="stat-card">\n                        <span class="stat-icon">‚≠ê</span>\n                        <div class="stat-info">\n                            <div class="stat-value">Level ${this.userProgress.level}</div>\n                            <div class="stat-label">${this.userProgress.experience} XP</div>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card">\n                        <span class="stat-icon">üßò‚Äç‚ôÄÔ∏è</span>\n                        <div class="stat-info">\n                            <div class="stat-value">${this.userProgress.meditationMinutes+Math.floor(this.meditationTimer/60)}</div>\n                            <div class="stat-label">Minutes Meditated</div>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card">\n                        <span class="stat-icon">üåø</span>\n                        <div class="stat-info">\n                            <div class="stat-value">${this.userProgress.gardensCreated}</div>\n                            <div class="stat-label">Gardens Created</div>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card">\n                        <span class="stat-icon">ü•£</span>\n                        <div class="stat-info">\n                            <div class="stat-value">${this.userProgress.bowlsMastered.size}/7</div>\n                            <div class="stat-label">Bowls Mastered</div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="achievements-grid">\n                    ${[{id:"bowl_master",title:"Bowl Master",description:"Mastered all 7 chakra singing bowls",icon:"üèÜ"},{id:"meditation_novice",title:"Meditation Novice",description:"Meditated for 30 minutes total",icon:"üßò‚Äç‚ôÄÔ∏è"},{id:"meditation_adept",title:"Meditation Adept",description:"Meditated for 2 hours total",icon:"üïâÔ∏è"},{id:"zen_master",title:"Zen Master",description:"Meditated for 5 hours total",icon:"üëë"},{id:"garden_creator",title:"Garden Creator",description:"Created 5 unique zen gardens",icon:"üåø"},{id:"landscape_artist",title:"Landscape Artist",description:"Created 20 beautiful gardens",icon:"üé®"},{id:"harmony_seeker",title:"Harmony Seeker",description:"Played 3 bowls simultaneously",icon:"üéµ"},{id:"chakra_harmonist",title:"Chakra Harmonist",description:"Achieved full 7-chakra harmony",icon:"üåà"}].map(e=>{const t=this.userProgress.achievements.has(e.id);return`\n                            <div class="achievement-card ${t?"earned":"locked"}">\n                                <div class="achievement-icon">${e.icon}</div>\n                                <div class="achievement-info">\n                                    <h4>${e.title}</h4>\n                                    <p>${e.description}</p>\n                                </div>\n                                ${t?'<div class="earned-badge">‚úÖ</div>':'<div class="locked-badge">üîí</div>'}\n                            </div>\n                        `}).join("")}\n                </div>\n                \n                <div class="journey-encouragement">\n                    <h4>üåü Continue Your Journey</h4>\n                    <p>Each moment of practice brings you closer to inner peace and spiritual growth.</p>\n                </div>\n            </div>\n        `,e.style.display="flex"}loadProgress(){const e=localStorage.getItem("harmonyGardenProgress");if(e){const t=JSON.parse(e);this.userProgress={...this.userProgress,...t,bowlsMastered:new Set(t.bowlsMastered||[]),achievements:new Set(t.achievements||[])}}this.updateProgressDisplay()}saveProgress(){const e={...this.userProgress,bowlsMastered:Array.from(this.userProgress.bowlsMastered),achievements:Array.from(this.userProgress.achievements)};localStorage.setItem("harmonyGardenProgress",JSON.stringify(e))}destroy(){this.timerInterval&&clearInterval(this.timerInterval),this.audioContext&&this.audioContext.close(),console.log("ü•£ Singing Bowl Harmony Garden destroyed")}}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("singingBowlContainer")&&(console.log("ü•£ Initializing Singing Bowl Harmony Garden..."),window.singingBowlHarmonyGarden=new SingingBowlHarmonyGarden)}),window.addEventListener("beforeunload",()=>{window.singingBowlHarmonyGarden&&window.singingBowlHarmonyGarden.destroy()}),document.addEventListener("DOMContentLoaded",()=>{let e=0;if(document.addEventListener("touchend",function(t){const n=(new Date).getTime();n-e<=300&&t.preventDefault(),e=n},!1),window.innerWidth<=768){console.log("üì± Mobile device detected - optimizing interface");const e=document.createElement("style");e.textContent="\n            @media (max-width: 768px) {\n                .harmony-garden-app {\n                    padding: 0.5rem !important;\n                }\n                \n                .bowls-circle {\n                    transform: scale(0.8) !important;\n                    margin: 1rem auto !important;\n                }\n                \n                .zen-garden-canvas {\n                    max-width: 100% !important;\n                    height: 250px !important;\n                }\n                \n                .garden-tools {\n                    flex-wrap: wrap !important;\n                    gap: 0.5rem !important;\n                }\n                \n                .tool-btn {\n                    padding: 0.5rem 0.75rem !important;\n                    font-size: 0.8rem !important;\n                }\n                \n                .audio-toggles {\n                    flex-direction: column !important;\n                    align-items: center !important;\n                }\n                \n                .frequency-canvas {\n                    height: 80px !important;\n                }\n                \n                .progress-stats {\n                    grid-template-columns: 1fr !important;\n                    gap: 1rem !important;\n                }\n            }\n        ",document.head.appendChild(e)}}),window.addEventListener("load",()=>{const e=window.navigator.hardwareConcurrency<=2,t=navigator.connection&&"slow-2g"===navigator.connection.effectiveType;(e||t)&&(console.log("‚ö° Low-power device detected - optimizing performance"),window.singingBowlHarmonyGarden&&(window.singingBowlHarmonyGarden.performanceMode=!0,window.singingBowlHarmonyGarden.ambientSounds&&window.singingBowlHarmonyGarden.stopAmbientSounds()))}),document.addEventListener("touchstart",function(){window.singingBowlHarmonyGarden&&window.singingBowlHarmonyGarden.audioContext&&"suspended"===window.singingBowlHarmonyGarden.audioContext.state&&window.singingBowlHarmonyGarden.audioContext.resume().then(()=>{console.log("üçé iOS Audio context resumed")})},{once:!0}),window.addEventListener("DOMContentLoaded",()=>{if(!window.AudioContext&&!window.webkitAudioContext){console.warn("üîá Web Audio API not supported - providing fallback experience");const e=document.createElement("div");e.style.cssText="\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: rgba(245, 158, 11, 0.9);\n            color: white;\n            padding: 1rem 2rem;\n            border-radius: 12px;\n            z-index: 10000;\n            text-align: center;\n            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);\n        ",e.innerHTML='\n            <div style="font-weight: 600; margin-bottom: 0.5rem;">üéµ Audio Enhancement</div>\n            <div style="font-size: 0.9rem;">For the best sound healing experience, use a modern browser with audio support.</div>\n        ',document.body.appendChild(e),setTimeout(()=>e.remove(),5e3)}document.createElement("canvas").getContext||console.warn("üé® Canvas not supported - providing alternative visualization")}),console.log("‚úÖ Singing Bowl Harmony Garden - Full system loaded and optimized");