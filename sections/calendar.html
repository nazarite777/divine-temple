<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enoch Calendar - Divine Temple</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Divine Temple Systems -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/divine-audio-engine.js"></script>
    <script src="../js/universal-progress-system.js"></script>
    <script src="../js/divine-progress-widget.js"></script>

    <style>
        :root {
            --primary-gold: #D4AF37;
            --accent-purple: #8B5CF6;
            --accent-cyan: #06B6D4;
            --accent-rose: #F43F5E;
            --accent-green: #10B981;
            --accent-orange: #F97316;
            --dark-bg: #0F0F23;
            --deep-purple: #4C1D95;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-muted: rgba(255, 255, 255, 0.6);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.12);
            --shadow-medium: 0 16px 48px rgba(0, 0, 0, 0.2);
            --shadow-strong: 0 24px 64px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a1e 0%, #1a1a2e 50%, #0f3460 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        @keyframes lunarGlow {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes celebrationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .calendar-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 2rem;
            font-weight: 600;
            border: none;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, var(--primary-gold), var(--accent-purple));
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInUp 0.6s ease;
        }

        .calendar-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: lunarGlow 4s ease-in-out infinite;
        }

        .calendar-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-gold), var(--accent-purple), var(--accent-cyan));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .calendar-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Tab Navigation */
        .calendar-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-btn:hover,
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-gold), var(--accent-purple));
            color: white;
            border-color: var(--primary-gold);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Main Layout */
        .calendar-main-interface {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 1200px) {
            .calendar-main-interface {
                grid-template-columns: 1.5fr 1fr;
            }
        }

        /* Calendar View */
        .calendar-view-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
            transform: translateY(-2px);
        }

        .current-month {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            flex: 1;
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .calendar-day-header {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--primary-gold);
            font-size: 0.9rem;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-gold);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .calendar-day.has-events::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-gold), var(--accent-purple));
        }

        .calendar-day.has-journal {
            border-color: var(--accent-cyan);
        }

        .calendar-day.streak-day {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border-color: var(--accent-green);
        }

        .day-number {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .day-lunar {
            font-size: 1.2rem;
            margin: 0.25rem 0;
        }

        .day-events {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--primary-gold);
        }

        .event-dot.event-meditation {
            background: var(--accent-purple);
        }

        .event-dot.event-prayer {
            background: var(--accent-cyan);
        }

        .event-dot.event-journal {
            background: var(--accent-green);
        }

        .event-dot.event-sacred {
            background: var(--primary-gold);
            animation: celebrationPulse 2s infinite;
        }

        /* Sidebar */
        .calendar-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
        }

        .sidebar-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary-gold);
        }

        .event-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .event-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 10px;
            border-left: 3px solid var(--primary-gold);
        }

        .event-date {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .event-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .event-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Stats Grid */
        .calendar-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-gold);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Goals Section */
        .goals-grid {
            display: grid;
            gap: 1rem;
        }

        .goal-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .goal-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-2px);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .goal-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .goal-icon {
            font-size: 1.5rem;
        }

        .goal-progress {
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-gold), var(--accent-purple));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .goal-streak {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Journal Section */
        .journal-entries {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .journal-entry {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .journal-entry:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .journal-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .journal-date {
            font-weight: 600;
            color: var(--accent-cyan);
        }

        .journal-mood {
            font-size: 1.5rem;
        }

        .journal-content {
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* Achievements */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .achievement-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-2px);
        }

        .achievement-card.unlocked {
            border-color: var(--primary-gold);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(139, 92, 246, 0.1));
        }

        .achievement-card.locked {
            opacity: 0.5;
        }

        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .achievement-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .achievement-description {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-gold);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-gold), var(--accent-purple));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 1rem;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: white;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-strong);
            z-index: 10001;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast-success {
            border-left: 4px solid var(--accent-green);
        }

        .toast-error {
            border-left: 4px solid var(--accent-rose);
        }

        .toast-achievement {
            border-left: 4px solid var(--primary-gold);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(139, 92, 246, 0.2));
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.5);
        }

        @media (max-width: 768px) {
            .calendar-container {
                padding: 1rem;
            }

            .calendar-grid {
                gap: 0.25rem;
            }

            .calendar-day {
                padding: 0.5rem;
            }

            .day-number {
                font-size: 1rem;
            }

            .calendar-stats {
                grid-template-columns: 1fr;
            }

            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
            <button class="back-btn" onclick="goBack()">
                ‚Üê Back to Temple
            </button>

            <a href="https://medium.com/@edenconsciousnesssdt" target="_blank" rel="noopener noreferrer" class="back-btn" style="text-decoration: none; background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(6,182,212,0.2)); border-color: rgba(6,182,212,0.3);">
                üìù Visit Our Blog ‚Üí
            </a>
        </div>

        <div class="calendar-header">
            <div class="calendar-logo">üìÖ</div>
            <h1 class="calendar-title">Sacred Calendar</h1>
            <p class="calendar-subtitle">
                Enochian Calendar (364 days, 52 perfect weeks) with Gregorian reference<br>
                <span style="font-size: 0.9rem; opacity: 0.8;">Hebrew months aligned with divine timing ‚Ä¢ Spring Equinox foundation</span>
            </p>
        </div>

        <!-- Divine Progress Widget -->
        <div id="divine-progress-widget"></div>

        <!-- Tab Navigation -->
        <div class="calendar-tabs">
            <button class="tab-btn active" onclick="switchTab('calendar')" id="tab-calendar">
                üìÖ Calendar
            </button>
            <button class="tab-btn" onclick="switchTab('goals')" id="tab-goals">
                üéØ Goals
            </button>
            <button class="tab-btn" onclick="switchTab('journal')" id="tab-journal">
                üìù Journal
            </button>
            <button class="tab-btn" onclick="switchTab('achievements')" id="tab-achievements">
                üèÜ Achievements
            </button>
        </div>

        <!-- CALENDAR TAB -->
        <div class="tab-content active" id="content-calendar">
            <div class="calendar-main-interface">
                <!-- Calendar View -->
                <div class="calendar-view-panel">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="previousMonth()">‚Üê Previous</button>
                        <div class="current-month" id="current-month"></div>
                        <button class="nav-btn" onclick="nextMonth()">Next ‚Üí</button>
                    </div>

                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Headers -->
                        <div class="calendar-day-header">Day 1</div>
                        <div class="calendar-day-header">Day 2</div>
                        <div class="calendar-day-header">Day 3</div>
                        <div class="calendar-day-header">Day 4</div>
                        <div class="calendar-day-header">Day 5</div>
                        <div class="calendar-day-header">Day 6</div>
                        <div class="calendar-day-header">Sabbath</div>
                        <!-- Days generated by JS -->
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="calendar-sidebar">
                    <div class="sidebar-section">
                        <h4 class="sidebar-title">üåü Today's Events</h4>
                        <div class="event-list" id="todays-events">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h4 class="sidebar-title">üìä Sacred Journey Stats</h4>
                        <div class="calendar-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="stat-streak">0</div>
                                <div class="stat-label">Day Streak üî•</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="stat-meditations">0</div>
                                <div class="stat-label">Meditations</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="stat-prayers">0</div>
                                <div class="stat-label">Prayers</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="stat-journals">0</div>
                                <div class="stat-label">Journal Entries</div>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h4 class="sidebar-title">üé≠ Upcoming Sacred Days</h4>
                        <div class="event-list" id="upcoming-holidays">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GOALS TAB -->
        <div class="tab-content" id="content-goals">
            <div class="calendar-view-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 2rem;">üéØ Your Sacred Goals</h2>
                    <button class="btn btn-primary" style="width: auto;" onclick="openNewGoalModal()">+ New Goal</button>
                </div>

                <div class="goals-grid" id="goals-list">
                    <div class="loading">Loading goals...</div>
                </div>
            </div>
        </div>

        <!-- JOURNAL TAB -->
        <div class="tab-content" id="content-journal">
            <div class="calendar-view-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 2rem;">üìù Sacred Journal</h2>
                    <button class="btn btn-primary" style="width: auto;" onclick="openNewJournalModal()">+ New Entry</button>
                </div>

                <div class="journal-entries" id="journal-list">
                    <div class="loading">Loading journal entries...</div>
                </div>
            </div>
        </div>

        <!-- ACHIEVEMENTS TAB -->
        <div class="tab-content" id="content-achievements">
            <div class="calendar-view-panel">
                <h2 style="font-family: 'Playfair Display', serif; font-size: 2rem; margin-bottom: 2rem;">üèÜ Achievements</h2>
                
                <div class="achievements-grid" id="achievements-list">
                    <div class="loading">Loading achievements...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Day Details Modal -->
    <div class="modal-overlay" id="day-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="day-modal-title">Day Details</h2>
                <button class="modal-close" onclick="closeModal('day-modal')">√ó</button>
            </div>
            <div id="day-modal-content"></div>
        </div>
    </div>

    <!-- New Goal Modal -->
    <div class="modal-overlay" id="goal-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create New Goal</h2>
                <button class="modal-close" onclick="closeModal('goal-modal')">√ó</button>
            </div>
            <form onsubmit="createGoal(event)">
                <div class="form-group">
                    <label class="form-label">Goal Type</label>
                    <select class="form-select" id="goal-type" required>
                        <option value="meditation">Daily Meditation</option>
                        <option value="prayer">Daily Prayer</option>
                        <option value="journal">Daily Journaling</option>
                        <option value="study">Sacred Study</option>
                        <option value="gratitude">Gratitude Practice</option>
                        <option value="custom">Custom Goal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Goal Title</label>
                    <input type="text" class="form-input" id="goal-title" placeholder="e.g., Meditate 20 min daily" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Target (days)</label>
                    <input type="number" class="form-input" id="goal-target" placeholder="30" min="1" required>
                </div>
                <button type="submit" class="btn btn-primary">Create Goal üéØ</button>
            </form>
        </div>
    </div>

    <!-- New Journal Modal -->
    <div class="modal-overlay" id="journal-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">New Journal Entry</h2>
                <button class="modal-close" onclick="closeModal('journal-modal')">√ó</button>
            </div>
            <form onsubmit="createJournalEntry(event)">
                <div class="form-group">
                    <label class="form-label">How are you feeling?</label>
                    <select class="form-select" id="journal-mood" required>
                        <option value="üòä">üòä Joyful</option>
                        <option value="üòå">üòå Peaceful</option>
                        <option value="üôè">üôè Grateful</option>
                        <option value="üí≠">üí≠ Reflective</option>
                        <option value="üòî">üòî Struggling</option>
                        <option value="‚ú®">‚ú® Inspired</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Thoughts</label>
                    <textarea class="form-textarea" id="journal-content" placeholder="Write your sacred reflections..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Gratitude (optional)</label>
                    <input type="text" class="form-input" id="journal-gratitude" placeholder="What are you grateful for today?">
                </div>
                <button type="submit" class="btn btn-primary">Save Entry üìù</button>
            </form>
        </div>
    </div>

    <script>
        // ==================== FIREBASE SETUP ====================
        // Firebase is already initialized by firebase-config.js
        // Get references to auth and db
        let auth, db;

        // Wait for firebase-config.js to initialize
        function initializeFirebaseRefs() {
            if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                auth = firebase.auth();
                db = firebase.firestore();
                console.log('‚úÖ Firebase references initialized for calendar');
                return true;
            }
            return false;
        }

        // Try to initialize immediately, or wait a bit
        if (!initializeFirebaseRefs()) {
            setTimeout(initializeFirebaseRefs, 100);
        }

        // ==================== ENOCH CALENDAR CONSTANTS ====================
        
        // Hebrew months (12 months √ó 30 days = 360 days + 4 quarter days = 364 days)
        const HEBREW_MONTHS = [
            { name: "Nisan", season: "Spring", emoji: "üå∏" },
            { name: "Iyar", season: "Spring", emoji: "üå∫" },
            { name: "Sivan", season: "Spring", emoji: "üåº" },
            { name: "Tammuz", season: "Summer", emoji: "‚òÄÔ∏è" },
            { name: "Av", season: "Summer", emoji: "üåû" },
            { name: "Elul", season: "Summer", emoji: "üî•" },
            { name: "Tishrei", season: "Autumn", emoji: "üçÇ" },
            { name: "Cheshvan", season: "Autumn", emoji: "üçÅ" },
            { name: "Kislev", season: "Autumn", emoji: "üåæ" },
            { name: "Tevet", season: "Winter", emoji: "‚ùÑÔ∏è" },
            { name: "Shevat", season: "Winter", emoji: "üå®Ô∏è" },
            { name: "Adar", season: "Winter", emoji: "‚õÑ" }
        ];

        // Quarter Days (Sacred Season Markers)
        const QUARTER_DAYS = [
            { month: 3, day: 31, name: "Spring Equinox Quarter", description: "Renewal of life and light" },
            { month: 6, day: 31, name: "Summer Solstice Quarter", description: "Peak of light and warmth" },
            { month: 9, day: 31, name: "Autumn Equinox Quarter", description: "Harvest and balance" },
            { month: 12, day: 31, name: "Winter Solstice Quarter", description: "Return of light from darkness" }
        ];

        // Achievements
        const ACHIEVEMENTS = [
            { id: 'first-journal', icon: 'üìù', name: 'First Entry', description: 'Write your first journal entry', requirement: 1, type: 'journal' },
            { id: 'week-streak', icon: 'üî•', name: 'Week Warrior', description: '7-day activity streak', requirement: 7, type: 'streak' },
            { id: 'month-streak', icon: 'üí´', name: 'Monthly Master', description: '30-day activity streak', requirement: 30, type: 'streak' },
            { id: 'meditation-10', icon: 'üßò', name: 'Meditation Novice', description: 'Complete 10 meditations', requirement: 10, type: 'meditation' },
            { id: 'meditation-100', icon: 'üôè', name: 'Meditation Master', description: 'Complete 100 meditations', requirement: 100, type: 'meditation' },
            { id: 'journal-30', icon: 'üìñ', name: 'Dedicated Diarist', description: 'Write 30 journal entries', requirement: 30, type: 'journal' },
            { id: 'all-quarters', icon: 'üåü', name: 'Quarter Guardian', description: 'Celebrate all 4 quarter days', requirement: 4, type: 'quarters' },
            { id: 'goal-complete', icon: 'üéØ', name: 'Goal Achiever', description: 'Complete your first goal', requirement: 1, type: 'goals' },
            { id: 'year-complete', icon: 'üëë', name: 'Enoch Master', description: 'Complete a full 364-day cycle', requirement: 364, type: 'days' }
        ];

        // ==================== ENOCH CALENDAR SYSTEM ====================
        class EnochCalendarSystem {
            constructor() {
                // Spring Equinox 2025 as Year 1, Day 1 (March 20, 2025)
                this.REFERENCE_DATE = new Date(2025, 2, 20); // Month is 0-indexed (2 = March)
                
                this.currentUser = null;
                this.todayIndex = this.getEnochDayIndex();
                this.viewMonth = this.getMonthFromIndex(this.todayIndex);
                this.viewYear = this.getYearFromIndex(this.todayIndex);
                
                this.userData = {
                    goals: [],
                    journal: [],
                    achievements: [],
                    stats: {
                        streak: 0,
                        longestStreak: 0,
                        meditations: 0,
                        prayers: 0,
                        journals: 0,
                        lastActivityDate: null
                    }
                };

                this.init();
            }

            async init() {
                // Generate calendar immediately so it's visible
                this.generateCalendar();
                this.updateAllViews();
                console.log('üìÖ Calendar generated');

                // Then check for auth and load user data if available
                if (auth) {
                    auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            this.currentUser = user;
                            await this.loadUserData();
                            this.updateAllViews();
                            console.log('‚úÖ User data loaded for:', user.email);
                        } else {
                            console.log('‚ÑπÔ∏è  Calendar running in guest mode (no user logged in)');
                        }
                    });
                } else {
                    console.log('‚ÑπÔ∏è Firebase auth not available, calendar running in offline mode');
                }
            }

            // ==================== DATE CALCULATIONS ====================
            getEnochDayIndex(date = new Date()) {
                const daysDiff = Math.floor((date - this.REFERENCE_DATE) / (1000 * 60 * 60 * 24));
                return daysDiff >= 0 ? daysDiff % 364 : 0;
            }

            getYearFromIndex(index = this.todayIndex) {
                const daysSinceReference = Math.floor((new Date() - this.REFERENCE_DATE) / (1000 * 60 * 60 * 24));
                return Math.floor(daysSinceReference / 364) + 1;
            }

            getMonthFromIndex(index) {
                // Each month has 30 days, except months 3, 6, 9, 12 which have 31 (quarter day)
                let day = 0;
                for (let month = 1; month <= 12; month++) {
                    const daysInMonth = [3, 6, 9, 12].includes(month) ? 31 : 30;
                    if (index < day + daysInMonth) {
                        return month;
                    }
                    day += daysInMonth;
                }
                return 12;
            }

            getDayInMonth(index) {
                let day = index;
                let month = 1;
                
                for (month = 1; month <= 12; month++) {
                    const daysInMonth = [3, 6, 9, 12].includes(month) ? 31 : 30;
                    if (day < daysInMonth) {
                        return day + 1;
                    }
                    day -= daysInMonth;
                }
                return 1;
            }

            getWeekday(index) {
                return (index % 7) + 1;
            }

            // Convert Enochian day index to Gregorian date
            getGregorianDate(index) {
                const daysFromReference = Math.floor((index + (Math.floor((new Date() - this.REFERENCE_DATE) / (1000 * 60 * 60 * 24)) / 364) * 364));
                const gregorianDate = new Date(this.REFERENCE_DATE);
                gregorianDate.setDate(gregorianDate.getDate() + daysFromReference);
                return gregorianDate;
            }

            formatGregorianShort(date) {
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return `${months[date.getMonth()]} ${date.getDate()}`;
            }

            // ==================== FIREBASE DATA ====================
            async loadUserData() {
                if (!this.currentUser) return;

                try {
                    const doc = await db.collection('enochCalendar').doc(this.currentUser.uid).get();
                    if (doc.exists) {
                        this.userData = doc.data();
                    }
                    this.checkStreak();
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            }

            async saveUserData() {
                if (!this.currentUser) return;

                try {
                    await db.collection('enochCalendar').doc(this.currentUser.uid).set(this.userData);
                } catch (error) {
                    console.error('Error saving user data:', error);
                }
            }

            // ==================== STREAK SYSTEM ====================
            checkStreak() {
                const today = new Date().toDateString();
                const lastActivity = this.userData.stats.lastActivityDate;

                if (!lastActivity) {
                    this.userData.stats.streak = 0;
                    return;
                }

                const lastDate = new Date(lastActivity).toDateString();
                const yesterday = new Date(Date.now() - 86400000).toDateString();

                if (lastDate === today) {
                    // Already logged today
                    return;
                } else if (lastDate === yesterday) {
                    // Streak continues
                    return;
                } else {
                    // Streak broken
                    this.userData.stats.streak = 0;
                    this.saveUserData();
                }
            }

            async logActivity(type) {
                if (!this.currentUser) {
                    showToast('Please sign in to track your progress', 'error');
                    return;
                }

                const today = new Date().toDateString();
                const lastActivity = this.userData.stats.lastActivityDate;

                // Update streak
                if (!lastActivity || new Date(lastActivity).toDateString() !== today) {
                    this.userData.stats.streak++;
                    if (this.userData.stats.streak > this.userData.stats.longestStreak) {
                        this.userData.stats.longestStreak = this.userData.stats.streak;
                    }
                    this.userData.stats.lastActivityDate = new Date().toISOString();
                }

                // Update specific stats
                if (type === 'meditation') this.userData.stats.meditations++;
                if (type === 'prayer') this.userData.stats.prayers++;
                if (type === 'journal') this.userData.stats.journals++;

                await this.saveUserData();
                this.checkAchievements();
                this.updateAllViews();
            }

            // ==================== ACHIEVEMENTS ====================
            checkAchievements() {
                ACHIEVEMENTS.forEach(achievement => {
                    if (this.userData.achievements.includes(achievement.id)) return;

                    let achieved = false;
                    
                    switch (achievement.type) {
                        case 'journal':
                            achieved = this.userData.stats.journals >= achievement.requirement;
                            break;
                        case 'streak':
                            achieved = this.userData.stats.streak >= achievement.requirement;
                            break;
                        case 'meditation':
                            achieved = this.userData.stats.meditations >= achievement.requirement;
                            break;
                        case 'goals':
                            const completedGoals = this.userData.goals.filter(g => g.current >= g.target).length;
                            achieved = completedGoals >= achievement.requirement;
                            break;
                    }

                    if (achieved) {
                        this.unlockAchievement(achievement);
                    }
                });
            }

            unlockAchievement(achievement) {
                this.userData.achievements.push(achievement.id);
                this.saveUserData();
                showToast(`üéâ Achievement Unlocked: ${achievement.name}!`, 'achievement');
            }

            // ==================== CALENDAR GENERATION ====================
            generateCalendar() {
                const grid = document.getElementById('calendar-grid');
                const monthDisplay = document.getElementById('current-month');

                // Clear existing days
                grid.querySelectorAll('.calendar-day').forEach(day => day.remove());

                const month = HEBREW_MONTHS[this.viewMonth - 1];
                monthDisplay.innerHTML = `${month.emoji} ${month.name} - Year ${this.viewYear} <span style="font-size:0.8rem;color:var(--text-muted)">(${month.season})</span>`;

                // Calculate starting index for this month
                let startIndex = 0;
                for (let m = 1; m < this.viewMonth; m++) {
                    startIndex += [3, 6, 9, 12].includes(m) ? 31 : 30;
                }

                // Generate days
                const daysInMonth = [3, 6, 9, 12].includes(this.viewMonth) ? 31 : 30;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayIndex = startIndex + day - 1;
                    const dayElement = this.createDayElement(this.viewMonth, day, dayIndex);
                    grid.appendChild(dayElement);
                }
            }

            createDayElement(month, day, globalIndex) {
                const div = document.createElement('div');
                div.className = 'calendar-day';
                
                const isToday = globalIndex === this.todayIndex;
                const isQuarterDay = day === 31;
                const weekday = this.getWeekday(globalIndex);
                const isSabbath = weekday === 7;

                // Check for events
                const hasJournal = this.userData.journal.some(j => 
                    j.month === month && j.day === day
                );
                const hasActivity = this.hasActivityOnDay(month, day);

                if (isToday) div.style.background = 'linear-gradient(135deg, rgba(212,175,55,0.2), rgba(139,92,246,0.2))';
                if (hasJournal) div.classList.add('has-journal');
                if (hasActivity) div.classList.add('streak-day');
                if (isQuarterDay) div.classList.add('has-events');

                div.onclick = () => this.openDayModal(month, day, globalIndex, isQuarterDay);

                const lunarPhase = this.getLunarPhase(day);
                const gregorianDate = this.getGregorianDate(globalIndex);
                const gregorianStr = this.formatGregorianShort(gregorianDate);

                div.innerHTML = `
                    <div class="day-number" ${isSabbath ? 'style="color:var(--primary-gold)"' : ''}>${isQuarterDay ? 'Q' : day}</div>
                    <div class="day-lunar">${lunarPhase}</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 0.25rem;">${gregorianStr}</div>
                    <div class="day-events">
                        ${hasJournal ? '<span class="event-dot event-journal"></span>' : ''}
                        ${hasActivity ? '<span class="event-dot event-meditation"></span>' : ''}
                        ${isQuarterDay ? '<span class="event-dot event-sacred"></span>' : ''}
                    </div>
                `;

                return div;
            }

            getLunarPhase(day) {
                // Simplified lunar phase visualization
                if (day <= 7) return 'üåë';
                if (day <= 14) return 'üåì';
                if (day <= 21) return 'üåï';
                if (day <= 28) return 'üåó';
                return 'üåë';
            }

            hasActivityOnDay(month, day) {
                // Check if user has any logged activity on this day
                return this.userData.journal.some(j => j.month === month && j.day === day);
            }

            // ==================== MODALS ====================
            openDayModal(month, day, index, isQuarterDay) {
                const monthData = HEBREW_MONTHS[month - 1];
                const weekday = this.getWeekday(index);
                
                let content = `
                    <div style="text-align:center;margin-bottom:2rem;">
                        <h3 style="color:var(--accent-cyan);font-size:1.8rem;margin-bottom:0.5rem;">
                            ${monthData.emoji} ${monthData.name} ${day}
                        </h3>
                        <p style="color:var(--text-muted);">Year ${this.viewYear} ‚Ä¢ Day ${weekday} of 7</p>
                    </div>
                `;

                if (isQuarterDay) {
                    const quarterData = QUARTER_DAYS.find(q => q.month === month);
                    content += `
                        <div style="background:linear-gradient(135deg,rgba(212,175,55,0.2),rgba(139,92,246,0.2));padding:1.5rem;border-radius:15px;margin-bottom:1.5rem;">
                            <h4 style="color:var(--primary-gold);margin-bottom:0.5rem;">${quarterData.name}</h4>
                            <p style="color:var(--text-secondary);">${quarterData.description}</p>
                        </div>
                    `;
                }

                // Show journal entries for this day
                const journals = this.userData.journal.filter(j => j.month === month && j.day === day);
                if (journals.length > 0) {
                    content += '<h4 style="margin:1.5rem 0 1rem;">üìù Journal Entries</h4>';
                    journals.forEach(j => {
                        content += `
                            <div style="background:rgba(255,255,255,0.05);padding:1rem;border-radius:10px;margin-bottom:1rem;">
                                <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">
                                    <span>${j.mood}</span>
                                    <span style="color:var(--text-muted);font-size:0.85rem;">${new Date(j.timestamp).toLocaleString()}</span>
                                </div>
                                <p style="color:var(--text-secondary);white-space:pre-wrap;">${j.content}</p>
                            </div>
                        `;
                    });
                }

                content += `
                    <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                        <button class="btn btn-primary" onclick="enochCalendar.quickJournal(${month},${day})">üìù Add Journal Entry</button>
                    </div>
                `;

                document.getElementById('day-modal-title').textContent = `${monthData.name} ${day}`;
                document.getElementById('day-modal-content').innerHTML = content;
                openModal('day-modal');
            }

            quickJournal(month, day) {
                closeModal('day-modal');
                openModal('journal-modal');
                // Store month/day for journal entry
                window.currentJournalDate = { month, day };
            }

            // ==================== GOALS ====================
            async createGoal(type, title, target) {
                if (!this.currentUser) {
                    showToast('Please sign in to create goals', 'error');
                    return;
                }

                const goal = {
                    id: Date.now().toString(),
                    type,
                    title,
                    target,
                    current: 0,
                    created: new Date().toISOString()
                };

                this.userData.goals.push(goal);
                await this.saveUserData();
                this.updateGoalsView();
                showToast('Goal created! üéØ', 'success');
            }

            async updateGoalProgress(goalId, increment = 1) {
                const goal = this.userData.goals.find(g => g.id === goalId);
                if (!goal) return;

                goal.current = Math.min(goal.current + increment, goal.target);
                
                if (goal.current === goal.target) {
                    showToast(`üéâ Goal Complete: ${goal.title}!`, 'success');
                }

                await this.saveUserData();
                await this.logActivity(goal.type);
                this.updateGoalsView();
            }

            updateGoalsView() {
                const container = document.getElementById('goals-list');
                
                if (this.userData.goals.length === 0) {
                    container.innerHTML = `
                        <div style="text-align:center;padding:3rem;color:var(--text-muted);">
                            <div style="font-size:3rem;margin-bottom:1rem;">üéØ</div>
                            <p>No goals yet. Create your first goal to start your journey!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.userData.goals.map(goal => {
                    const progress = (goal.current / goal.target) * 100;
                    const isComplete = goal.current >= goal.target;
                    const streak = this.getGoalStreak(goal);

                    return `
                        <div class="goal-card">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">${goal.title}</div>
                                    ${streak > 0 ? `<span class="goal-streak">üî• ${streak} day streak</span>` : ''}
                                </div>
                                <div class="goal-icon">${this.getGoalIcon(goal.type)}</div>
                            </div>
                            <div class="goal-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width:${progress}%"></div>
                                </div>
                                <div class="progress-text">
                                    <span>${goal.current} / ${goal.target}</span>
                                    <span>${Math.round(progress)}%</span>
                                </div>
                            </div>
                            ${!isComplete ? `
                                <button class="btn btn-primary" onclick="enochCalendar.updateGoalProgress('${goal.id}')">
                                    Mark Complete Today ‚úì
                                </button>
                            ` : `
                                <div style="text-align:center;color:var(--accent-green);font-weight:600;">
                                    üéâ Goal Achieved!
                                </div>
                            `}
                        </div>
                    `;
                }).join('');
            }

            getGoalIcon(type) {
                const icons = {
                    meditation: 'üßò',
                    prayer: 'üôè',
                    journal: 'üìù',
                    study: 'üìö',
                    gratitude: 'üíù',
                    custom: '‚≠ê'
                };
                return icons[type] || '‚≠ê';
            }

            getGoalStreak(goal) {
                // Calculate consecutive days this goal was completed
                // This is simplified - you'd want to store daily completion data
                return 0;
            }

            // ==================== JOURNAL ====================
            async createJournalEntry(mood, content, gratitude) {
                if (!this.currentUser) {
                    showToast('Please sign in to journal', 'error');
                    return;
                }

                const today = this.todayIndex;
                const month = this.getMonthFromIndex(today);
                const day = this.getDayInMonth(today);

                // Use stored date if quick journaling from day modal
                const journalDate = window.currentJournalDate || { month, day };

                const entry = {
                    id: Date.now().toString(),
                    month: journalDate.month,
                    day: journalDate.day,
                    mood,
                    content,
                    gratitude,
                    timestamp: new Date().toISOString()
                };

                this.userData.journal.unshift(entry);
                await this.saveUserData();
                await this.logActivity('journal');

                // üéØ AWARD XP FOR JOURNAL ENTRY
                if (window.progressSystem) {
                    await window.progressSystem.awardXP(50, 'Sacred journal entry', 'calendar');
                    await window.progressSystem.logActivity('journal_entry', 'calendar', {
                        mood,
                        hasGratitude: !!gratitude
                    });
                }

                this.updateJournalView();
                this.generateCalendar(); // Refresh to show journal dot

                showToast('Journal entry saved! üìù', 'success');
                window.currentJournalDate = null;
            }

            updateJournalView() {
                const container = document.getElementById('journal-list');
                
                if (this.userData.journal.length === 0) {
                    container.innerHTML = `
                        <div style="text-align:center;padding:3rem;color:var(--text-muted);">
                            <div style="font-size:3rem;margin-bottom:1rem;">üìù</div>
                            <p>No journal entries yet. Start documenting your sacred journey!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.userData.journal.slice(0, 20).map(entry => {
                    const monthData = HEBREW_MONTHS[entry.month - 1];
                    const date = new Date(entry.timestamp);
                    
                    return `
                        <div class="journal-entry">
                            <div class="journal-entry-header">
                                <div class="journal-date">${monthData.name} ${entry.day}, Year ${this.viewYear}</div>
                                <div class="journal-mood">${entry.mood}</div>
                            </div>
                            <div class="journal-content">${entry.content}</div>
                            ${entry.gratitude ? `
                                <div style="margin-top:1rem;padding:0.75rem;background:rgba(16,185,129,0.1);border-radius:8px;border-left:3px solid var(--accent-green);">
                                    <strong style="color:var(--accent-green);">üôè Gratitude:</strong> ${entry.gratitude}
                                </div>
                            ` : ''}
                            <div style="text-align:right;margin-top:0.5rem;font-size:0.8rem;color:var(--text-muted);">
                                ${date.toLocaleString()}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // ==================== ACHIEVEMENTS ====================
            updateAchievementsView() {
                const container = document.getElementById('achievements-list');
                
                container.innerHTML = ACHIEVEMENTS.map(achievement => {
                    const unlocked = this.userData.achievements.includes(achievement.id);
                    let progress = 0;
                    
                    // Calculate progress
                    switch (achievement.type) {
                        case 'journal':
                            progress = (this.userData.stats.journals / achievement.requirement) * 100;
                            break;
                        case 'streak':
                            progress = (this.userData.stats.streak / achievement.requirement) * 100;
                            break;
                        case 'meditation':
                            progress = (this.userData.stats.meditations / achievement.requirement) * 100;
                            break;
                        case 'goals':
                            const completed = this.userData.goals.filter(g => g.current >= g.target).length;
                            progress = (completed / achievement.requirement) * 100;
                            break;
                    }
                    
                    progress = Math.min(progress, 100);

                    return `
                        <div class="achievement-card ${unlocked ? 'unlocked' : 'locked'}">
                            <div class="achievement-icon">${achievement.icon}</div>
                            <div class="achievement-name">${achievement.name}</div>
                            <div class="achievement-description">${achievement.description}</div>
                            ${!unlocked ? `
                                <div style="margin-top:0.5rem;">
                                    <div class="progress-bar" style="height:4px;">
                                        <div class="progress-fill" style="width:${progress}%"></div>
                                    </div>
                                </div>
                            ` : `
                                <div style="color:var(--primary-gold);font-weight:600;margin-top:0.5rem;">‚úì Unlocked</div>
                            `}
                        </div>
                    `;
                }).join('');
            }

            // ==================== VIEW UPDATES ====================
            updateAllViews() {
                this.updateTodaysEvents();
                this.updateUpcomingHolidays();
                this.updateStats();
                this.updateGoalsView();
                this.updateJournalView();
                this.updateAchievementsView();
            }

            updateTodaysEvents() {
                const container = document.getElementById('todays-events');
                const month = this.getMonthFromIndex(this.todayIndex);
                const day = this.getDayInMonth(this.todayIndex);
                const monthData = HEBREW_MONTHS[month - 1];
                
                const isQuarterDay = [3, 6, 9, 12].includes(month) && day === 31;
                const journals = this.userData.journal.filter(j => j.month === month && j.day === day);

                let html = `
                    <div class="event-item">
                        <div class="event-title">${monthData.emoji} ${monthData.name} ${day}</div>
                        <div class="event-description">Year ${this.viewYear} ‚Ä¢ ${monthData.season}</div>
                    </div>
                `;

                if (isQuarterDay) {
                    const quarter = QUARTER_DAYS.find(q => q.month === month);
                    html += `
                        <div class="event-item" style="border-color:var(--primary-gold);">
                            <div class="event-title">üåü ${quarter.name}</div>
                            <div class="event-description">${quarter.description}</div>
                        </div>
                    `;
                }

                if (journals.length > 0) {
                    html += `
                        <div class="event-item" style="border-color:var(--accent-green);">
                            <div class="event-title">üìù ${journals.length} Journal ${journals.length === 1 ? 'Entry' : 'Entries'}</div>
                            <div class="event-description">You've documented your thoughts today</div>
                        </div>
                    `;
                }

                container.innerHTML = html;
            }

            updateUpcomingHolidays() {
                const container = document.getElementById('upcoming-holidays');
                const upcoming = QUARTER_DAYS.filter(q => {
                    const quarterIndex = this.getIndexForDate(q.month, q.day);
                    return quarterIndex > this.todayIndex;
                }).slice(0, 2);

                if (upcoming.length === 0) {
                    container.innerHTML = `
                        <div class="event-item">
                            <div class="event-title">No upcoming quarters this year</div>
                            <div class="event-description">Next cycle begins at Spring Equinox</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = upcoming.map(q => {
                    const monthData = HEBREW_MONTHS[q.month - 1];
                    const daysUntil = this.getIndexForDate(q.month, q.day) - this.todayIndex;
                    
                    return `
                        <div class="event-item">
                            <div class="event-date">${monthData.name} ${q.day} ‚Ä¢ ${daysUntil} days</div>
                            <div class="event-title">${q.name}</div>
                            <div class="event-description">${q.description}</div>
                        </div>
                    `;
                }).join('');
            }

            updateStats() {
                document.getElementById('stat-streak').textContent = this.userData.stats.streak;
                document.getElementById('stat-meditations').textContent = this.userData.stats.meditations;
                document.getElementById('stat-prayers').textContent = this.userData.stats.prayers;
                document.getElementById('stat-journals').textContent = this.userData.stats.journals;
            }

            getIndexForDate(month, day) {
                let index = 0;
                for (let m = 1; m < month; m++) {
                    index += [3, 6, 9, 12].includes(m) ? 31 : 30;
                }
                return index + day - 1;
            }

            // ==================== NAVIGATION ====================
            previousMonth() {
                this.viewMonth = this.viewMonth === 1 ? 12 : this.viewMonth - 1;
                this.generateCalendar();
            }

            nextMonth() {
                this.viewMonth = this.viewMonth === 12 ? 1 : this.viewMonth + 1;
                this.generateCalendar();
            }
        }

        // ==================== GLOBAL FUNCTIONS ====================
        let enochCalendar;

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÖ Calendar DOM loaded');

            // Ensure Firebase is initialized before creating calendar
            function startCalendar() {
                if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                    // Make sure auth and db are set
                    if (!auth || !db) {
                        initializeFirebaseRefs();
                    }

                    enochCalendar = new EnochCalendarSystem();
                    console.log('‚úÖ Enoch Calendar System loaded successfully');
                } else {
                    console.log('‚è≥ Waiting for Firebase to initialize...');
                    setTimeout(startCalendar, 100);
                }
            }

            startCalendar();

            // Hide back button if in iframe (already on dashboard)
            if (window.parent && window.parent !== window) {
                const backBtns = document.querySelectorAll('.back-btn');
                backBtns.forEach(btn => {
                    if (btn.textContent.includes('Back to Temple')) {
                        btn.style.display = 'none';
                    }
                });
            }
        });

        function previousMonth() {
            enochCalendar.previousMonth();
        }

        function nextMonth() {
            enochCalendar.nextMonth();
        }

        function switchTab(tab) {
            // Update tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`content-${tab}`).classList.add('active');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('open');
        }

        function openNewGoalModal() {
            openModal('goal-modal');
        }

        function openNewJournalModal() {
            openModal('journal-modal');
        }

        function createGoal(e) {
            e.preventDefault();
            const type = document.getElementById('goal-type').value;
            const title = document.getElementById('goal-title').value;
            const target = parseInt(document.getElementById('goal-target').value);

            enochCalendar.createGoal(type, title, target);
            
            e.target.reset();
            closeModal('goal-modal');
        }

        function createJournalEntry(e) {
            e.preventDefault();
            const mood = document.getElementById('journal-mood').value;
            const content = document.getElementById('journal-content').value;
            const gratitude = document.getElementById('journal-gratitude').value;

            enochCalendar.createJournalEntry(mood, content, gratitude);
            
            e.target.reset();
            closeModal('journal-modal');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        function goBack() {
            if (window.parent && window.parent !== window) {
                window.parent.postMessage('back', '*');
            } else {
                window.history.back();
            }
        }

        // Close modals on click outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('open');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('open');
                });
            }
            if (e.key === 'ArrowLeft' && e.ctrlKey) previousMonth();
            if (e.key === 'ArrowRight' && e.ctrlKey) nextMonth();
        });

        console.log('‚ú® Enoch Calendar script loaded successfully');
    </script>
</body>
</html>
