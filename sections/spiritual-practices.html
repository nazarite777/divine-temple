<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiritual Practices - Divine Temple</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Divine Temple Systems -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/divine-audio-engine.js"></script>
    <script src="../js/universal-progress-system.js"></script>
    <script src="../js/divine-progress-widget.js"></script>

    <style>
        :root {
            --primary-gold: #D4AF37;
            --accent-purple: #8B5CF6;
            --accent-blue: #3B82F6;
            --accent-green: #10B981;
            --accent-rose: #F43F5E;
            --deep-purple: #4C1D95;
            --dark-bg: #0F0F23;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-muted: rgba(255, 255, 255, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a1e 0%, #1a1a2e 50%, #4c1d95 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(212, 175, 55, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-5px);
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
        }

        .header-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        .title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-purple), var(--primary-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Progress Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-gold);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-gold);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Quick Action Banner */
        .quick-actions {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2));
            border: 2px solid var(--accent-purple);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 3rem;
            text-align: center;
        }

        .quick-actions-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-gold);
            margin-bottom: 1rem;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .quick-action-btn {
            padding: 0.875rem 1.5rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .quick-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-gold);
            transform: translateY(-2px);
        }

        /* Practices Grid */
        .practices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .practice-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(76, 29, 149, 0.2));
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .practice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-purple), var(--primary-gold));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .practice-card:hover::before {
            transform: scaleX(1);
        }

        .practice-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary-gold);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.3);
        }

        .practice-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            display: block;
        }

        .practice-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--primary-gold);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .practice-desc {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .practice-stats {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .practice-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .practice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 1rem;
            overflow-y: auto;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, #0a0a1e, #1a1a2e);
            border: 2px solid var(--primary-gold);
            border-radius: 25px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-purple), var(--deep-purple));
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            color: white;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-content {
            padding: 2rem;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--glass-border);
            overflow-x: auto;
        }

        .tab-btn {
            padding: 0.875rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab-btn.active {
            color: var(--primary-gold);
            border-bottom-color: var(--primary-gold);
        }

        .tab-btn:hover {
            color: var(--text-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Journal Styles */
        .journal-entry-form {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .journal-textarea {
            width: 100%;
            min-height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .journal-textarea:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .journal-textarea::placeholder {
            color: var(--text-muted);
        }

        .save-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-green), #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }

        .journal-list {
            display: grid;
            gap: 1.5rem;
        }

        .journal-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-left: 4px solid var(--accent-purple);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .journal-item:hover {
            border-left-color: var(--primary-gold);
            transform: translateX(5px);
        }

        .journal-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .journal-date {
            color: var(--primary-gold);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .journal-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-gold);
        }

        .journal-text {
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* Gratitude Styles */
        .gratitude-input-form {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .gratitude-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .gratitude-field {
            flex: 1;
            padding: 0.875rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-family: 'Inter', sans-serif;
        }

        .gratitude-field:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .gratitude-field::placeholder {
            color: var(--text-muted);
        }

        .gratitude-add-btn {
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-green), #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gratitude-add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .gratitude-list {
            display: grid;
            gap: 1rem;
        }

        .gratitude-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-left: 4px solid var(--accent-green);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .gratitude-item:hover {
            transform: translateX(5px);
            border-left-color: var(--primary-gold);
        }

        .gratitude-item-content {
            flex: 1;
        }

        .gratitude-text {
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .gratitude-date {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Affirmations Styles */
        .affirmation-display {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(212, 175, 55, 0.2));
            border: 2px solid var(--primary-gold);
            border-radius: 20px;
            padding: 3rem 2rem;
            text-align: center;
            margin-bottom: 2rem;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .affirmation-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--primary-gold);
            font-style: italic;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .affirmation-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .affirmation-btn {
            padding: 0.875rem 1.5rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .affirmation-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-gold);
        }

        .affirmation-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .affirmation-category {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .affirmation-category:hover {
            border-color: var(--primary-gold);
            transform: translateY(-3px);
        }

        .affirmation-category.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--accent-purple);
        }

        .category-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .category-name {
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Prayer Styles */
        .prayer-form {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .prayer-input {
            width: 100%;
            padding: 0.875rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-family: 'Inter', sans-serif;
            margin-bottom: 1rem;
        }

        .prayer-input:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .prayer-textarea {
            width: 100%;
            min-height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            color: white;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            margin-bottom: 1rem;
        }

        .prayer-textarea:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .prayer-list {
            display: grid;
            gap: 1.5rem;
        }

        .prayer-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-left: 4px solid var(--accent-blue);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .prayer-item.answered {
            border-left-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .prayer-item:hover {
            border-left-color: var(--primary-gold);
            transform: translateX(5px);
        }

        .prayer-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .prayer-title {
            color: var(--primary-gold);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .prayer-text {
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
            margin-bottom: 1rem;
        }

        .prayer-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--glass-border);
        }

        .prayer-date {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .prayer-status {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .prayer-status.pending {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-blue);
        }

        .prayer-status.answered {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1.1rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(212, 175, 55, 0.3);
            border-top: 4px solid var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 10001;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--accent-green);
        }

        .toast.error {
            border-left: 4px solid var(--accent-rose);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .practices-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal {
                max-height: 95vh;
            }

            .modal-content {
                padding: 1rem;
            }

            .affirmation-text {
                font-size: 1.3rem;
            }

            .tab-nav {
                overflow-x: scroll;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" onclick="goBack()">
            ‚Üê Back to Temple
        </button>

        <div class="header">
            <div class="header-icon">üìø</div>
            <h1 class="title">Spiritual Practices</h1>
            <p class="subtitle">Journal ‚Ä¢ Gratitude ‚Ä¢ Affirmations ‚Ä¢ Prayer</p>
        </div>

        <!-- Divine Progress Widget -->
        <div id="divine-progress-widget"></div>

        <!-- Progress Stats -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìî</div>
                <div class="stat-value" id="journal-count">0</div>
                <div class="stat-label">Journal Entries</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üôè</div>
                <div class="stat-value" id="gratitude-count">0</div>
                <div class="stat-label">Gratitude Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value" id="practice-streak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üôå</div>
                <div class="stat-value" id="prayer-count">0</div>
                <div class="stat-label">Prayers</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-actions-title">üßò Want to meditate or practice breathwork?</div>
            <div class="quick-actions-grid">
                <button class="quick-action-btn" onclick="goToMeditation()">
                    üßò Open Meditation Center
                </button>
                <button class="quick-action-btn" onclick="practiceApp.quickGratitude()">
                    ‚ö° Quick Gratitude
                </button>
                <button class="quick-action-btn" onclick="practiceApp.quickJournal()">
                    ‚ö° Quick Journal
                </button>
            </div>
        </div>

        <!-- Practices Grid -->
        <div class="practices-grid">
            <!-- Journal -->
            <div class="practice-card" onclick="practiceApp.openPractice('journal')">
                <span class="practice-icon">üìî</span>
                <h3 class="practice-title">Spiritual Journal</h3>
                <p class="practice-desc">
                    Document your journey, insights, and spiritual revelations
                </p>
                <div class="practice-stats">
                    <span id="journal-stat">0 entries</span>
                </div>
                <button class="practice-btn">Open Journal</button>
            </div>

            <!-- Gratitude -->
            <div class="practice-card" onclick="practiceApp.openPractice('gratitude')">
                <span class="practice-icon">üôè</span>
                <h3 class="practice-title">Gratitude Practice</h3>
                <p class="practice-desc">
                    Cultivate abundance consciousness through daily thankfulness
                </p>
                <div class="practice-stats">
                    <span id="gratitude-stat">0 items</span>
                </div>
                <button class="practice-btn">Practice Gratitude</button>
            </div>

            <!-- Affirmations -->
            <div class="practice-card" onclick="practiceApp.openPractice('affirmations')">
                <span class="practice-icon">üí≠</span>
                <h3 class="practice-title">Affirmations</h3>
                <p class="practice-desc">
                    Powerful declarations to reprogram your subconscious mind
                </p>
                <div class="practice-stats">
                    <span>Daily rotation</span>
                </div>
                <button class="practice-btn">View Affirmations</button>
            </div>

            <!-- Prayer Journal -->
            <div class="practice-card" onclick="practiceApp.openPractice('prayer')">
                <span class="practice-icon">üôå</span>
                <h3 class="practice-title">Prayer Journal</h3>
                <p class="practice-desc">
                    Record prayers and track answered prayers
                </p>
                <div class="practice-stats">
                    <span id="prayer-stat">0 prayers</span>
                </div>
                <button class="practice-btn">Open Prayer Journal</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="practice-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Practice</h2>
                <button class="modal-close" onclick="practiceApp.closeModal()">√ó</button>
            </div>
            <div class="modal-content" id="modal-content">
                <!-- Dynamic content loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCOyZPb4gfYE5q_RwmYaKG6cpTvrE-3LxI",
            authDomain: "sacred-community.firebaseapp.com",
            projectId: "sacred-community",
            storageBucket: "sacred-community.firebasestorage.app",
            messagingSenderId: "582271923489",
            appId: "1:582271923489:web:aa46a8bb5ac0859fe83a60",
            measurementId: "G-83D6SSJKMH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ==================== SPIRITUAL PRACTICES APP ====================
        class SpiritualPracticesApp {
            constructor() {
                this.currentUser = null;
                this.currentPractice = null;
                
                this.data = {
                    journal: [],
                    gratitude: [],
                    prayers: [],
                    stats: {
                        journalCount: 0,
                        gratitudeCount: 0,
                        prayerCount: 0,
                        streak: 0,
                        lastActive: null
                    }
                };

                this.affirmations = {
                    power: [
                        "I AM divine consciousness in human form",
                        "I AM unlimited in power and potential",
                        "I AM the creator of my reality",
                        "I AM worthy of all good things",
                        "I trust in my divine path and purpose"
                    ],
                    abundance: [
                        "Money flows to me effortlessly and abundantly",
                        "I attract success in all I do",
                        "Opportunities seek me out constantly",
                        "I live in overflow and abundance",
                        "Wealth comes to me from expected and unexpected sources"
                    ],
                    health: [
                        "Every cell in my body radiates perfect health",
                        "I am strong, energized, and vibrant",
                        "My body heals itself naturally and perfectly",
                        "I feel younger and more vital every day",
                        "Health and vitality are my natural state"
                    ],
                    love: [
                        "I am loved, cherished, and appreciated",
                        "I attract divine relationships into my life",
                        "Love flows to me and through me effortlessly",
                        "I am surrounded by supportive, loving people",
                        "My heart is open to giving and receiving love"
                    ],
                    spiritual: [
                        "I am connected to infinite divine wisdom",
                        "My intuition guides me perfectly",
                        "I trust the universe and its perfect timing",
                        "I am protected by divine light always",
                        "Miracles happen for me every day"
                    ]
                };

                this.currentAffirmationCategory = 'power';
                this.currentAffirmationIndex = 0;

                this.init();
            }

            async init() {
                console.log('üìø Initializing Spiritual Practices App...');
                
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        this.currentUser = user;
                        await this.loadData();
                        this.updateStats();
                    } else {
                        this.loadLocalData();
                        this.updateStats();
                    }
                });

                console.log('‚úÖ Spiritual Practices App ready');
            }

            // ==================== DATA MANAGEMENT ====================
            async loadData() {
                try {
                    const docRef = db.collection('spiritualPractices').doc(this.currentUser.uid);
                    const doc = await docRef.get();
                    
                    if (doc.exists) {
                        this.data = { ...this.data, ...doc.data() };
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.loadLocalData();
                }
            }

            loadLocalData() {
                const saved = localStorage.getItem('spiritualPractices');
                if (saved) {
                    this.data = { ...this.data, ...JSON.parse(saved) };
                }
            }

            async saveData() {
                if (this.currentUser) {
                    try {
                        await db.collection('spiritualPractices').doc(this.currentUser.uid).set(this.data);
                    } catch (error) {
                        console.error('Error saving data:', error);
                    }
                }
                
                localStorage.setItem('spiritualPractices', JSON.stringify(this.data));
                this.updateStats();
            }

            updateStats() {
                document.getElementById('journal-count').textContent = this.data.journal.length;
                document.getElementById('gratitude-count').textContent = this.data.gratitude.length;
                document.getElementById('prayer-count').textContent = this.data.prayers.length;
                document.getElementById('practice-streak').textContent = this.data.stats.streak;
                
                document.getElementById('journal-stat').textContent = `${this.data.journal.length} entries`;
                document.getElementById('gratitude-stat').textContent = `${this.data.gratitude.length} items`;
                document.getElementById('prayer-stat').textContent = `${this.data.prayers.length} prayers`;
            }

            updateStreak() {
                const today = new Date().toDateString();
                const last = this.data.stats.lastActive ? new Date(this.data.stats.lastActive).toDateString() : null;
                
                if (last === today) {
                    return;
                } else if (last === new Date(Date.now() - 86400000).toDateString()) {
                    this.data.stats.streak++;
                } else {
                    this.data.stats.streak = 1;
                }
                
                this.data.stats.lastActive = new Date().toISOString();
            }

            // ==================== PRACTICE MODALS ====================
            openPractice(type) {
                this.currentPractice = type;
                document.getElementById('modal-title').textContent = this.getPracticeTitle(type);
                
                const content = this.getPracticeContent(type);
                document.getElementById('modal-content').innerHTML = content;
                document.getElementById('practice-modal').classList.add('open');

                // Initialize practice-specific features
                if (type === 'affirmations') {
                    this.initAffirmations();
                } else if (type === 'journal') {
                    this.renderJournalList();
                } else if (type === 'gratitude') {
                    this.renderGratitudeList();
                } else if (type === 'prayer') {
                    this.renderPrayerList();
                }
            }

            getPracticeTitle(type) {
                const titles = {
                    journal: 'üìî Spiritual Journal',
                    gratitude: 'üôè Gratitude Practice',
                    affirmations: 'üí≠ Daily Affirmations',
                    prayer: 'üôå Prayer Journal'
                };
                return titles[type] || 'Practice';
            }

            getPracticeContent(type) {
                switch (type) {
                    case 'journal':
                        return this.getJournalContent();
                    case 'gratitude':
                        return this.getGratitudeContent();
                    case 'affirmations':
                        return this.getAffirmationsContent();
                    case 'prayer':
                        return this.getPrayerContent();
                    default:
                        return '<div class="loading">Loading...</div>';
                }
            }

            // ==================== JOURNAL ====================
            getJournalContent() {
                return `
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="practiceApp.switchTab('write')">‚úçÔ∏è Write</button>
                        <button class="tab-btn" onclick="practiceApp.switchTab('read')">üìñ Read Entries</button>
                    </div>

                    <div class="tab-content active" id="write-tab">
                        <div class="journal-entry-form">
                            <h3 style="color: var(--primary-gold); margin-bottom: 1rem;">Write in your journal</h3>
                            <textarea 
                                class="journal-textarea" 
                                id="journal-input"
                                placeholder="What's on your mind today? What insights or revelations have you received? What are you grateful for?"
                            ></textarea>
                            <button class="save-btn" onclick="practiceApp.saveJournalEntry()">üíæ Save Entry</button>
                        </div>

                        <div style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem;">
                            <h4 style="color: var(--primary-gold); margin-bottom: 1rem;">‚ú® Journal Prompts</h4>
                            <ul style="color: var(--text-secondary); line-height: 2;">
                                <li>What am I grateful for today?</li>
                                <li>What signs or synchronicities did I notice?</li>
                                <li>How did I grow spiritually today?</li>
                                <li>What limiting belief can I release?</li>
                                <li>What is my soul calling me to do?</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tab-content" id="read-tab">
                        <div class="journal-list" id="journal-list">
                            <!-- Entries will be rendered here -->
                        </div>
                    </div>
                `;
            }

            switchTab(tab) {
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`${tab}-tab`).classList.add('active');

                if (tab === 'read') {
                    this.renderJournalList();
                }
            }

            saveJournalEntry() {
                const input = document.getElementById('journal-input');
                const text = input.value.trim();
                
                if (!text) {
                    this.showToast('Please write something first', 'error');
                    return;
                }

                const entry = {
                    id: Date.now().toString(),
                    text: text,
                    date: new Date().toISOString(),
                    timestamp: Date.now()
                };

                this.data.journal.unshift(entry);
                this.updateStreak();
                this.saveData();

                // üéØ AWARD XP FOR JOURNAL ENTRY
                if (window.progressSystem) {
                    window.progressSystem.awardXP(40, 'Spiritual journal entry', 'spiritual-practices');
                    window.progressSystem.logActivity('journal', 'spiritual-practices', {
                        wordCount: text.split(/\s+/).length
                    });
                }

                input.value = '';
                this.showToast('‚ú® Journal entry saved!', 'success');
            }

            renderJournalList() {
                const container = document.getElementById('journal-list');
                
                if (this.data.journal.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìî</div>
                            <div class="empty-text">No journal entries yet. Start writing!</div>
                        </div>
                    `;
                    return;
                }

                const entriesHtml = this.data.journal.map(entry => `
                    <div class="journal-item">
                        <div class="journal-item-header">
                            <div class="journal-date">${this.formatDate(entry.date)}</div>
                            <div class="journal-actions">
                                <button class="icon-btn" onclick="practiceApp.deleteJournal('${entry.id}')" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="journal-text">${this.escapeHtml(entry.text)}</div>
                    </div>
                `).join('');

                container.innerHTML = entriesHtml;
            }

            deleteJournal(id) {
                if (confirm('Delete this journal entry?')) {
                    this.data.journal = this.data.journal.filter(entry => entry.id !== id);
                    this.saveData();
                    this.renderJournalList();
                    this.showToast('Entry deleted', 'success');
                }
            }

            // ==================== GRATITUDE ====================
            getGratitudeContent() {
                return `
                    <div class="gratitude-input-form">
                        <h3 style="color: var(--primary-gold); margin-bottom: 1rem;">What are you grateful for today?</h3>
                        <div class="gratitude-input">
                            <input 
                                type="text" 
                                class="gratitude-field" 
                                id="gratitude-input"
                                placeholder="I am grateful for..."
                                onkeypress="if(event.key === 'Enter') practiceApp.addGratitude()"
                            />
                            <button class="gratitude-add-btn" onclick="practiceApp.addGratitude()">Add</button>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.5rem;">
                            üí° Tip: Be specific and feel the emotion of gratitude as you write
                        </p>
                    </div>

                    <div style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
                        <h4 style="color: var(--primary-gold); margin-bottom: 1rem;">üåü Gratitude Categories</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <div>üí™ Health & Body</div>
                            <div>üë• Relationships</div>
                            <div>üè† Home & Safety</div>
                            <div>üí∞ Abundance</div>
                            <div>üåà Opportunities</div>
                            <div>‚ú® Simple Pleasures</div>
                        </div>
                    </div>

                    <div class="gratitude-list" id="gratitude-list">
                        <!-- Items will be rendered here -->
                    </div>
                `;
            }

            addGratitude() {
                const input = document.getElementById('gratitude-input');
                const text = input.value.trim();
                
                if (!text) {
                    this.showToast('Please write something first', 'error');
                    return;
                }

                const item = {
                    id: Date.now().toString(),
                    text: text,
                    date: new Date().toISOString(),
                    timestamp: Date.now()
                };

                this.data.gratitude.unshift(item);
                this.updateStreak();
                this.saveData();

                // üéØ AWARD XP FOR GRATITUDE PRACTICE
                if (window.progressSystem) {
                    window.progressSystem.awardXP(20, 'Gratitude practice', 'spiritual-practices');
                    window.progressSystem.logActivity('gratitude', 'spiritual-practices', {
                        text: text.substring(0, 50) // First 50 chars for tracking
                    });
                }

                input.value = '';
                this.renderGratitudeList();
                this.showToast('üôè Added to gratitude list!', 'success');
            }

            renderGratitudeList() {
                const container = document.getElementById('gratitude-list');
                
                if (this.data.gratitude.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üôè</div>
                            <div class="empty-text">Start your gratitude practice today!</div>
                        </div>
                    `;
                    return;
                }

                const itemsHtml = this.data.gratitude.map(item => `
                    <div class="gratitude-item">
                        <div class="gratitude-item-content">
                            <div class="gratitude-text">${this.escapeHtml(item.text)}</div>
                            <div class="gratitude-date">${this.formatDate(item.date)}</div>
                        </div>
                        <button class="icon-btn" onclick="practiceApp.deleteGratitude('${item.id}')" title="Delete">üóëÔ∏è</button>
                    </div>
                `).join('');

                container.innerHTML = itemsHtml;
            }

            deleteGratitude(id) {
                if (confirm('Remove this gratitude item?')) {
                    this.data.gratitude = this.data.gratitude.filter(item => item.id !== id);
                    this.saveData();
                    this.renderGratitudeList();
                    this.showToast('Item removed', 'success');
                }
            }

            // ==================== AFFIRMATIONS ====================
            getAffirmationsContent() {
                return `
                    <div class="affirmation-display" id="affirmation-display">
                        <div class="affirmation-text" id="affirmation-text">
                            Loading affirmation...
                        </div>
                        <div class="affirmation-controls">
                            <button class="affirmation-btn" onclick="practiceApp.nextAffirmation()">Next Affirmation ‚Üí</button>
                            <button class="affirmation-btn" onclick="practiceApp.startAutoRotation()">üîÑ Auto-Rotate</button>
                        </div>
                    </div>

                    <h3 style="color: var(--primary-gold); margin-bottom: 1rem; text-align: center;">Choose a category:</h3>
                    <div class="affirmation-categories">
                        <div class="affirmation-category active" onclick="practiceApp.selectAffirmationCategory('power')" data-category="power">
                            <div class="category-icon">‚ö°</div>
                            <div class="category-name">Personal Power</div>
                        </div>
                        <div class="affirmation-category" onclick="practiceApp.selectAffirmationCategory('abundance')" data-category="abundance">
                            <div class="category-icon">üí∞</div>
                            <div class="category-name">Abundance</div>
                        </div>
                        <div class="affirmation-category" onclick="practiceApp.selectAffirmationCategory('health')" data-category="health">
                            <div class="category-icon">üí™</div>
                            <div class="category-name">Health</div>
                        </div>
                        <div class="affirmation-category" onclick="practiceApp.selectAffirmationCategory('love')" data-category="love">
                            <div class="category-icon">üíñ</div>
                            <div class="category-name">Love</div>
                        </div>
                        <div class="affirmation-category" onclick="practiceApp.selectAffirmationCategory('spiritual')" data-category="spiritual">
                            <div class="category-icon">‚ú®</div>
                            <div class="category-name">Spiritual</div>
                        </div>
                    </div>

                    <div style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; margin-top: 2rem;">
                        <h4 style="color: var(--primary-gold); margin-bottom: 1rem;">üí° How to Use Affirmations</h4>
                        <ul style="color: var(--text-secondary); line-height: 2;">
                            <li>Read each affirmation slowly and intentionally</li>
                            <li>Feel the truth of the words in your body</li>
                            <li>Repeat morning and evening for best results</li>
                            <li>Speak them out loud when possible</li>
                            <li>Believe them as already true</li>
                        </ul>
                    </div>
                `;
            }

            initAffirmations() {
                this.displayCurrentAffirmation();
            }

            selectAffirmationCategory(category) {
                this.currentAffirmationCategory = category;
                this.currentAffirmationIndex = 0;
                
                document.querySelectorAll('.affirmation-category').forEach(cat => {
                    cat.classList.remove('active');
                });
                document.querySelector(`[data-category="${category}"]`).classList.add('active');
                
                this.displayCurrentAffirmation();
            }

            displayCurrentAffirmation() {
                const affirmations = this.affirmations[this.currentAffirmationCategory];
                const affirmation = affirmations[this.currentAffirmationIndex];
                document.getElementById('affirmation-text').textContent = affirmation;
            }

            nextAffirmation() {
                const affirmations = this.affirmations[this.currentAffirmationCategory];
                this.currentAffirmationIndex = (this.currentAffirmationIndex + 1) % affirmations.length;
                this.displayCurrentAffirmation();
            }

            startAutoRotation() {
                if (this.affirmationInterval) {
                    clearInterval(this.affirmationInterval);
                    this.affirmationInterval = null;
                    this.showToast('Auto-rotation stopped', 'success');
                    return;
                }

                this.affirmationInterval = setInterval(() => {
                    this.nextAffirmation();
                }, 8000);
                
                this.showToast('Auto-rotation started (8 seconds)', 'success');
            }

            // ==================== PRAYER JOURNAL ====================
            getPrayerContent() {
                return `
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="practiceApp.switchTab('add-prayer')">‚úçÔ∏è New Prayer</button>
                        <button class="tab-btn" onclick="practiceApp.switchTab('view-prayers')">üìñ My Prayers</button>
                    </div>

                    <div class="tab-content active" id="add-prayer-tab">
                        <div class="prayer-form">
                            <h3 style="color: var(--primary-gold); margin-bottom: 1rem;">Write your prayer</h3>
                            <input 
                                type="text" 
                                class="prayer-input" 
                                id="prayer-title"
                                placeholder="Prayer title (e.g., For healing, For guidance)"
                            />
                            <textarea 
                                class="prayer-textarea" 
                                id="prayer-text"
                                placeholder="Write your prayer here..."
                            ></textarea>
                            <button class="save-btn" onclick="practiceApp.savePrayer()">üôè Save Prayer</button>
                        </div>

                        <div style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; margin-top: 2rem;">
                            <h4 style="color: var(--primary-gold); margin-bottom: 1rem;">üí´ Prayer Templates</h4>
                            <div style="color: var(--text-secondary); line-height: 2;">
                                <p><strong>Gratitude:</strong> "Divine Source, I thank you for..."</p>
                                <p><strong>Guidance:</strong> "Please show me the path to..."</p>
                                <p><strong>Healing:</strong> "I ask for healing energy for..."</p>
                                <p><strong>Protection:</strong> "Surround me/us with divine light..."</p>
                                <p><strong>Manifestation:</strong> "I call forth into my life..."</p>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="view-prayers-tab">
                        <div class="prayer-list" id="prayer-list">
                            <!-- Prayers will be rendered here -->
                        </div>
                    </div>
                `;
            }

            savePrayer() {
                const titleInput = document.getElementById('prayer-title');
                const textInput = document.getElementById('prayer-text');
                
                const title = titleInput.value.trim();
                const text = textInput.value.trim();
                
                if (!title || !text) {
                    this.showToast('Please fill in both title and prayer', 'error');
                    return;
                }

                const prayer = {
                    id: Date.now().toString(),
                    title: title,
                    text: text,
                    date: new Date().toISOString(),
                    answered: false,
                    timestamp: Date.now()
                };

                this.data.prayers.unshift(prayer);
                this.updateStreak();
                this.saveData();

                // üéØ AWARD XP FOR PRAYER
                if (window.progressSystem) {
                    window.progressSystem.awardXP(30, 'Sacred prayer', 'spiritual-practices');
                    window.progressSystem.logActivity('prayer', 'spiritual-practices', {
                        title: title.substring(0, 50)
                    });
                }

                titleInput.value = '';
                textInput.value = '';
                this.showToast('üôè Prayer saved!', 'success');
            }

            renderPrayerList() {
                const container = document.getElementById('prayer-list');
                
                if (this.data.prayers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üôå</div>
                            <div class="empty-text">No prayers yet. Start your prayer journal!</div>
                        </div>
                    `;
                    return;
                }

                const prayersHtml = this.data.prayers.map(prayer => `
                    <div class="prayer-item ${prayer.answered ? 'answered' : ''}">
                        <div class="prayer-header">
                            <div class="prayer-title">${this.escapeHtml(prayer.title)}</div>
                            <div class="journal-actions">
                                <button class="icon-btn" onclick="practiceApp.toggleAnswered('${prayer.id}')" title="${prayer.answered ? 'Mark as pending' : 'Mark as answered'}">
                                    ${prayer.answered ? '‚úÖ' : '‚è≥'}
                                </button>
                                <button class="icon-btn" onclick="practiceApp.deletePrayer('${prayer.id}')" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="prayer-text">${this.escapeHtml(prayer.text)}</div>
                        <div class="prayer-footer">
                            <div class="prayer-date">${this.formatDate(prayer.date)}</div>
                            <div class="prayer-status ${prayer.answered ? 'answered' : 'pending'}">
                                ${prayer.answered ? '‚ú® Answered' : '‚è≥ Pending'}
                            </div>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = prayersHtml;
            }

            toggleAnswered(id) {
                const prayer = this.data.prayers.find(p => p.id === id);
                if (prayer) {
                    prayer.answered = !prayer.answered;
                    this.saveData();
                    this.renderPrayerList();
                    this.showToast(prayer.answered ? '‚ú® Prayer marked as answered!' : 'Prayer marked as pending', 'success');
                }
            }

            deletePrayer(id) {
                if (confirm('Delete this prayer?')) {
                    this.data.prayers = this.data.prayers.filter(prayer => prayer.id !== id);
                    this.saveData();
                    this.renderPrayerList();
                    this.showToast('Prayer deleted', 'success');
                }
            }

            // ==================== QUICK ACTIONS ====================
            quickGratitude() {
                const text = prompt('What are you grateful for right now?');
                if (text && text.trim()) {
                    const item = {
                        id: Date.now().toString(),
                        text: text.trim(),
                        date: new Date().toISOString(),
                        timestamp: Date.now()
                    };
                    this.data.gratitude.unshift(item);
                    this.updateStreak();
                    this.saveData();
                    this.showToast('üôè Gratitude recorded!', 'success');
                }
            }

            quickJournal() {
                const text = prompt('Quick journal entry:');
                if (text && text.trim()) {
                    const entry = {
                        id: Date.now().toString(),
                        text: text.trim(),
                        date: new Date().toISOString(),
                        timestamp: Date.now()
                    };
                    this.data.journal.unshift(entry);
                    this.updateStreak();
                    this.saveData();
                    this.showToast('‚ú® Journal entry saved!', 'success');
                }
            }

            // ==================== UTILITIES ====================
            closeModal() {
                document.getElementById('practice-modal').classList.remove('open');
                if (this.affirmationInterval) {
                    clearInterval(this.affirmationInterval);
                    this.affirmationInterval = null;
                }
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diff = now - date;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) {
                    return 'Today ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                } else if (days === 1) {
                    return 'Yesterday';
                } else if (days < 7) {
                    return days + ' days ago';
                } else {
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                }
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => toast.remove(), 3000);
            }
        }

        // ==================== INITIALIZE ====================
        let practiceApp;

        document.addEventListener('DOMContentLoaded', () => {
            practiceApp = new SpiritualPracticesApp();
            console.log('üìø Spiritual Practices ready');
        });

        function goBack() {
            if (window.parent && window.parent !== window) {
                window.parent.postMessage('back', '*');
            } else {
                window.history.back();
            }
        }

        function goToMeditation() {
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'navigate', page: 'meditation' }, '*');
            } else {
                window.location.href = 'meditation.html';
            }
        }

        // Close modal on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && practiceApp) {
                practiceApp.closeModal();
            }
        });

        // Close modal on outside click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                practiceApp.closeModal();
            }
        });

        console.log('‚ú® Spiritual Practices loaded successfully');
    </script>
</body>
</html>
